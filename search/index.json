[{"content":"云原生 云：抽象的计算资源（计算资源池: 公有云、私有云、混合云）\n云原生的基本思想： 0. 基础架构即代码，GitOps: 云原生中管理的一切对象都用git的方式以源代码的形式管理起来，做到绝对的可追溯。\n 动态环境（云资源一体，不关心是哪来的资源） 自动化（声明式API，最终一致性） DevOps  CI/CD（流水线对接云服务）   \u0026hellip;\u0026hellip;  kubernetes  云生态的核心组件\n Kubernetes（简称K8s）是一个开源的容器编排平台，用于自动化部署、扩展和管理容器化应用程序。\n容器技术  Namespace: 进程隔离  PID（Process ID）命名空间：隔离进程ID，每个容器可以有自己的进程编号。 网络（Network）命名空间：隔离网络接口，容器内的应用看到的只是容器内的网络环境。 挂载（Mount）命名空间：隔离文件系统挂载点，每个容器可以有自己的文件系统布局。 IPC（Inter-Process Communication）命名空间：隔离进程间通信资源，例如信号量和消息队列。 UTS（Unix Timesharing System）命名空间：隔离主机名和域名，容器可以有自己的主机名。 用户（User）命名空间：隔离用户ID和组ID，容器内的root可以与宿主机的root有不同的权限。   Cgroup：资源管控  CPU 内存 硬盘 I/O   UnionFS：文件系统服务  容器技术解决了哪些问题 1. 环境一致性问题 容器确保了从开发到测试再到生产的环境一致性。这解决了“在我的机器上运行正常”这类问题，因为容器为应用程序提供了一个隔离的、一致的运行环境，包括相同的软件、配置和依赖。\n2. 配置管理问题 容器通过将应用程序及其全部依赖打包在一起，简化了配置管理。这意味着开发者不需要在每个环境中重新配置应用程序，可以避免因配置差异导致的错误。\n3. 兼容性和依赖问题 通过使用容器，开发者可以打包应用程序所需的库、工具和运行时环境，避免了软件在不同系统环境下运行时可能遇到的兼容性和依赖问题。\n4. 快速部署和扩展 容器的轻量级特性使得启动速度非常快，几乎可以实现秒级部署。这对于需要快速扩展的服务尤其重要。容器还支持自动化的部署和扩展，使得管理大规模应用程序变得更加容易。\n5. 资源利用和隔离 容器在操作系统级别进行资源隔离，使得每个容器都运行在指定的资源限制之内，而不会干扰其他容器。同时，容器共享同一个操作系统核心，与传统的虚拟机相比，能更有效地利用物理资源。\n6. 移植性问题 容器技术提高了应用程序的移植性。由于容器在任何支持容器运行时的系统上都能运行，这使得从一个环境迁移到另一个环境（如从物理机到云平台）变得简单和可靠。\n7. 持续集成和持续交付（CI/CD） 容器非常适合实现自动化的持续集成和持续交付流程。开发者可以快速构建和回滚应用程序版本，实现高频率的更新和部署，而不影响系统的稳定性。\n8. 降低开发与运维（DevOps）的障碍 容器化鼓励采用微服务架构，每个服务可以独立开发、部署和扩展。这降低了团队间的协调复杂性，加速了开发流程，使开发和运维更加紧密地合作。\ndocker 安装 在 ubuntu 上安装 Docker 运行时，参考 https://docs.docker.com/engine/install/ubuntu/\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  $ sudo apt-get update $ sudo apt-get install \\ apt-transport-https \\ ca-certificates \\ curl \\ gnupg-agent \\ software-properties-common $ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - $ sudo add-apt-repository \\ \u0026#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu \\ $(lsb_release -cs) \\ stable\u0026#34; $ sudo apt-get update $ sudo apt-get install docker-ce docker-ce-cli containerd.io   操作 启动：\n docker run  -it 交互 -d 后台运行 -p 端口映射 -v 磁盘挂载   启动已终止容器  docker start   停止容器  docker stop   查看容器进程  docker ps   查看容器细节：  docker inspect \u0026lt;containerid\u0026gt;   进入容器；  docker exec -it \u0026lt;containerid\u0026gt; bash   Docker attach：  通过 nsenter PID=$(docker inspect \u0026ndash;format \u0026ldquo;{{ .State.Pid }}\u0026rdquo; \u0026lt;container\u0026gt;) $ nsenter \u0026ndash;target $PID \u0026ndash;mount \u0026ndash;uts \u0026ndash;ipc \u0026ndash;net \u0026ndash;pid   拷贝文件至容器内：  docker cp file1 \u0026lt;containerid\u0026gt;:/file-to-path    Demo 代码: main.go\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42  package main import ( \u0026#34;fmt\u0026#34; \u0026#34;os\u0026#34; \u0026#34;github.com/gin-gonic/gin\u0026#34; \u0026#34;github.com/thinkeridea/go-extend/exnet\u0026#34; ) func main() { r := gin.Default() r.GET(\u0026#34;/healthz\u0026#34;, healthHandler) // listen and serve on 0.0.0.0:8080 \tif err := r.Run(); err != nil { panic(err) } } // healthHandler healthcheck实现, curl -v localhost:8080/healthz -H \u0026#34;ttt:yyy\u0026#34; func healthHandler(c *gin.Context) { // 遍历request的header并循环写入response header \tfor k, v := range c.Request.Header { c.Writer.Header().Set(k, v[0]) } // 获取环境变量VERSION并写入reponse header \tc.Writer.Header().Set(\u0026#34;version\u0026#34;, os.Getenv(\u0026#34;VERSION\u0026#34;)) // 日志记录客户端ip, http返回码, 输出到标准输出 \tip := exnet.ClientPublicIP(c.Request) if ip == \u0026#34;\u0026#34; { ip = exnet.ClientIP(c.Request) } fmt.Printf(\u0026#34;客户端ip:%s, http返回码:%d\\n\u0026#34;, ip, 200) // 响应healthcheck信息, 状态码为200 \tc.JSON(200, gin.H{ \u0026#34;message\u0026#34;: \u0026#34;pong\u0026#34;, }) }   Dockerfile1：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  FROMgolang:alpineENV GO111MODULE=on \\  CGO_ENABLED=0 \\  GOOS=linux \\  GOARCH=amd64 \\ \tGOPROXY=\u0026#34;https://goproxy.cn,direct\u0026#34;WORKDIR/root/ccxCOPY main.go .RUN go mod init example.com/httpserverRUN go mod tidyRUN go build -o httpserver .WORKDIR/opt/modules/httpserverRUN mkdir src .RUN cp /root/ccx/httpserver ./srcEXPOSE8080CMD [\u0026#34;/opt/modules/httpserver/src/httpserver\u0026#34;]  测试运行：\n1 2 3 4 5  docker build -t ccx/httpserver:v0.0.1 . docker run -d --name httpserver -p 9090:8080 -e VERSION=v0.0.1 ccx/httpserver:v0.0.1 docker logs -f httpserver curl -v localhost:9090/healthz -H \u0026#34;ttt:yyy\u0026#34;   构建优化：Dockerfile2：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32  # 编译阶段FROMgolang:1.17-alpine AS build# GO111MODULE=on: 强制开启gomod# GOPROXY=\u0026#34;https://goproxy.cn,direct\u0026#34;: 使用国内七牛云包代理# CGO_ENABLED=0: 关闭cgo，否则在alpine不可运行。ENV GO111MODULE=on \\  CGO_ENABLED=0 \\  GOOS=linux \\  GOARCH=amd64 \\ \tGOPROXY=\u0026#34;https://goproxy.cn,direct\u0026#34;# 拷贝源码WORKDIR/go/src/COPY main.go .# 预下载依赖 modules 到容器本地 cacheRUN go mod init example.com/httpserverRUN go mod tidy# 编译go程序RUN go build -o /tmp/httpserver# 运行阶段FROMscratch# 拷贝编译阶段编译好的程序包COPY --from=build /tmp/httpserver /bin/httpserver# 开放的端口EXPOSE8080# 容器启动执行命令，启动httpserver服务ENTRYPOINT [\u0026#34;/bin/httpserver\u0026#34;]  测试运行：\n1 2 3 4 5 6 7 8 9 10  docker build -t ccx/httpserver:v0.0.2 . docker run -d --name httpserver -p 9090:8080 -e VERSION=v0.0.2 ccx/httpserver:v0.0.2 docker logs -f httpserver curl -v localhost:9090/healthz -H \u0026#34;ttt:yyy\u0026#34; # 镜像比较 docker images|grep httpserver ccx/httpserver v0.0.2 1fc9919e6afa About a minute ago 9.93MB ccx/httpserver v0.0.1 22fc44df77a6 1 days ago 558MB   基础镜像差异: Dockerfile3：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32  # 编译阶段FROMgolang:1.17-alpine AS build# GO111MODULE=on: 强制开启gomod# GOPROXY=\u0026#34;https://goproxy.cn,direct\u0026#34;: 使用国内七牛云包代理# CGO_ENABLED=0: 关闭cgo，否则在alpine不可运行。ENV GO111MODULE=on \\  CGO_ENABLED=0 \\  GOOS=linux \\  GOARCH=amd64 \\ \tGOPROXY=\u0026#34;https://goproxy.cn,direct\u0026#34;# 拷贝源码WORKDIR/go/src/COPY main.go .# 预下载依赖 modules 到容器本地 cacheRUN go mod init example.com/httpserverRUN go mod tidy# 编译go程序RUN go build -o /tmp/httpserver# 运行阶段FROMalpine:latest# 拷贝编译阶段编译好的程序包COPY --from=build /tmp/httpserver /bin/httpserver# 开放的端口EXPOSE8080# 容器启动执行命令，启动httpserver服务ENTRYPOINT [\u0026#34;/bin/httpserver\u0026#34;]  测试\n1 2 3 4 5 6 7 8 9 10 11  docker build -t ccx/httpserver:v0.0.3 . docker run -d --name httpserver -p 9090:8080 -e VERSION=v0.0.3 ccx/httpserver:v0.0.3 docker logs -f httpserver curl -v localhost:9090/healthz -H \u0026#34;ttt:yyy\u0026#34; # 镜像比较 docker images|grep httpserver ccx/httpserver v0.0.3 e6ccaa261248 29 seconds ago 15.5MB ccx/httpserver v0.0.2 1fc9919e6afa 4 minutes ago 9.93MB ccx/httpserver v0.0.1 22fc44df77a6 1 days ago 558MB   问题：同样的一份代码，在不同环境中可以打出完全一样的制品吗？  可信要求\n 可能导致差异的几点因素：\n 基础镜像版本  原因：基础镜像虽然指定了版本，但不同镜像仓库下同一版本的镜像不能保证一致。 应对措施：将常用的基础镜像和依赖包（构建镜像过程中的依赖包）存储在私有镜像仓库中。   依赖包的版本  原因：go mod tidy 会拉取依赖包的最新版本，如果某些包有新的发布，构建出的镜像也会有所不同。 应对措施：通过 go.mod 文件来锁定具体版本，结合 go.sum 确保依赖的一致性。   缓存  原因：Docker 使用构建缓存来加速构建过程。如果缓存不同，构建结果也可能有所不同。 应对措施：通过 \u0026ndash;no-cache 选项来禁用缓存，确保每次构建都是全新的。    Namespace 接口测试 进入容器测试 1 2 3 4  docker exec -it httpserver sh /opt/modules/httpserver # curl -v localhost:8080/healthz -H \u0026#34;ttt:yyy\u0026#34; sh: curl: not found   宿主机测试 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  curl -v localhost:9090/healthz -H \u0026#34;ttt:yyy\u0026#34; * Trying 127.0.0.1:9090... * TCP_NODELAY set * Connected to localhost (127.0.0.1) port 9090 (#0) \u0026gt; GET /healthz HTTP/1.1 \u0026gt; Host: localhost:9090 \u0026gt; User-Agent: curl/7.68.0 \u0026gt; Accept: */* \u0026gt; ttt:yyy \u0026gt; * Mark bundle as not supporting multiuse \u0026lt; HTTP/1.1 200 OK \u0026lt; Accept: */* \u0026lt; Content-Type: application/json; charset=utf-8 \u0026lt; Ttt: yyy \u0026lt; User-Agent: curl/7.68.0 \u0026lt; Version: v0.0.1 \u0026lt; Date: Thu, 06 Oct 2022 10:07:17 GMT \u0026lt; Content-Length: 18 \u0026lt; * Connection #0 to host localhost left intact {\u0026#34;message\u0026#34;:\u0026#34;pong\u0026#34;}%   查看容器信息 获取Pid\n1 2 3 4 5 6  docker ps | grep httpserver docker inspect httpserver|grep -i pid \u0026#34;Pid\u0026#34;: 36309, \u0026#34;PidMode\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;PidsLimit\u0026#34;: null,   查看容器 ip 1 2 3 4 5 6 7 8 9 10 11  docker exec -it httpserver sh /opt/modules/httpserver # ip a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 23: eth0@if24: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN\u0026gt; mtu 1500 qdisc noqueue state UP link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0 valid_lft forever preferred_lft forever   从宿主机通过 namespace 访问容器的网络 查看当前系统的 namespace：lsns –t \u0026lt;type\u0026gt;\n1 2 3 4 5 6  lsns -t net NS TYPE NPROCS PID USER NETNSID NSFS COMMAND 4026531992 net 124 9158 cjx unassigned /lib/systemd/systemd --user 4026533051 net 2 19842 cjx unassigned /usr/share/code/code --type=zygo 4026533633 net 25 9679 cjx unassigned /opt/google/chrome/chrome --type 4026533725 net 1 9680 cjx unassigned /opt/google/chrome/nacl_helper   查看某进程的 namespace：ls -la /proc/\u0026lt;pid\u0026gt;/ns/\n1 2 3 4 5 6 7 8 9 10 11 12  sudo ls -la /proc/36309/ns/ 总用量 0 dr-x--x--x 2 root root 0 10月 6 17:55 . dr-xr-xr-x 9 root root 0 10月 6 17:55 .. lrwxrwxrwx 1 root root 0 10月 6 18:03 cgroup -\u0026gt; \u0026#39;cgroup:[4026531835]\u0026#39; lrwxrwxrwx 1 root root 0 10月 6 17:56 ipc -\u0026gt; \u0026#39;ipc:[4026533336]\u0026#39; lrwxrwxrwx 1 root root 0 10月 6 17:56 mnt -\u0026gt; \u0026#39;mnt:[4026533334]\u0026#39; lrwxrwxrwx 1 root root 0 10月 6 17:55 net -\u0026gt; \u0026#39;net:[4026533339]\u0026#39; lrwxrwxrwx 1 root root 0 10月 6 17:56 pid -\u0026gt; \u0026#39;pid:[4026533337]\u0026#39; lrwxrwxrwx 1 root root 0 10月 6 18:03 pid_for_children -\u0026gt; \u0026#39;pid:[4026533337]\u0026#39; lrwxrwxrwx 1 root root 0 10月 6 18:03 user -\u0026gt; \u0026#39;user:[4026531837]\u0026#39; lrwxrwxrwx 1 root root 0 10月 6 17:56 uts -\u0026gt; \u0026#39;uts:[4026533335]\u0026#39;   进入某 namespace 运行命令：nsenter -t \u0026lt;pid\u0026gt; -n ip addr\n -n: 指定网络 ns  1 2 3 4 5 6 7 8 9  sudo nsenter -t 36309 -n ip a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 23: eth0@if24: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0 valid_lft forever preferred_lft forever   测试接口(容器内没有安装 curl，只能通过这个方法测试，否则需要把接口端口开放出来) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  sudo nsenter -t 36309 -n curl -v localhost:8080/healthz -H \u0026#34;ttt:yyy\u0026#34; * Trying 127.0.0.1:8080... * TCP_NODELAY set * Connected to localhost (127.0.0.1) port 8080 (#0) \u0026gt; GET /healthz HTTP/1.1 \u0026gt; Host: localhost:8080 \u0026gt; User-Agent: curl/7.68.0 \u0026gt; Accept: */* \u0026gt; ttt:yyy \u0026gt; * Mark bundle as not supporting multiuse \u0026lt; HTTP/1.1 200 OK \u0026lt; Accept: */* \u0026lt; Content-Type: application/json; charset=utf-8 \u0026lt; Ttt: yyy \u0026lt; User-Agent: curl/7.68.0 \u0026lt; Version: v0.0.1 \u0026lt; Date: Thu, 06 Oct 2022 10:05:41 GMT \u0026lt; Content-Length: 18 \u0026lt; * Connection #0 to host localhost left intact {\u0026#34;message\u0026#34;:\u0026#34;pong\u0026#34;}%   将新进程放入独立的网络 在新 network namespace 执行 sleep 指令：sudo unshare -fn sleep 60\n -fn: 放入独立的网络 ns  查看进程信息sudo ps -ef|grep 'sleep 60'\n1 2 3 4 5 6  sudo ps -ef|grep \u0026#39;sleep 60\u0026#39; root 13747 12656 0 12:31 pts/0 00:00:00 sudo unshare -fn sleep 60 root 13748 13747 0 12:31 pts/0 00:00:00 unshare -fn sleep 60 root 13749 13748 0 12:31 pts/0 00:00:00 sleep 60 cjx 13766 13489 0 12:31 pts/1 00:00:00 grep --color=auto sleep 60   进入改进程所在 Namespace 查看网络配置，与主机不一致sudo nsenter -t 13489 -n ip a\n1 2 3  sudo nsenter -t 13489 -n ip a 1: lo: \u0026lt;LOOPBACK\u0026gt; mtu 65536 qdisc noop state DOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00   查看网络 Namespacelsns -t net\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  lsns -t net NS TYPE NPROCS PID USER NETNSID NSFS COMMAND 4026531840 net 66 8880 cjx unassigned /lib/systemd/systemd --user sudo lsns -t net NS TYPE NPROCS PID USER NETNSID NSFS COMMAND 4026531840 net 327 1 root unassigned /sbin/init auto noprompt 4026532649 net 1 1288 rtkit unassigned /usr/libexec/rtkit-daemon 4026532716 net 5 13036 root 0 /run/docker/netns/d07ea2c2f615 nginx: master process nginx -g daemon off; 4026532800 net 2 13748 root unassigned unshare -fn sleep 60 sudo ls -la /proc/13748/ns/ total 0 dr-x--x--x 2 root root 0 Jul 18 12:31 . dr-xr-xr-x 9 root root 0 Jul 18 12:31 .. lrwxrwxrwx 1 root root 0 Jul 18 12:31 cgroup -\u0026gt; \u0026#39;cgroup:[4026531835]\u0026#39; lrwxrwxrwx 1 root root 0 Jul 18 12:31 ipc -\u0026gt; \u0026#39;ipc:[4026531839]\u0026#39; lrwxrwxrwx 1 root root 0 Jul 18 12:31 mnt -\u0026gt; \u0026#39;mnt:[4026531841]\u0026#39; lrwxrwxrwx 1 root root 0 Jul 18 12:31 net -\u0026gt; \u0026#39;net:[4026532800]\u0026#39; lrwxrwxrwx 1 root root 0 Jul 18 12:31 pid -\u0026gt; \u0026#39;pid:[4026531836]\u0026#39; lrwxrwxrwx 1 root root 0 Jul 18 12:31 pid_for_children -\u0026gt; \u0026#39;pid:[4026531836]\u0026#39; lrwxrwxrwx 1 root root 0 Jul 18 12:31 time -\u0026gt; \u0026#39;time:[4026531834]\u0026#39; lrwxrwxrwx 1 root root 0 Jul 18 12:31 time_for_children -\u0026gt; \u0026#39;time:[4026531834]\u0026#39; lrwxrwxrwx 1 root root 0 Jul 18 12:31 user -\u0026gt; \u0026#39;user:[4026531837]\u0026#39; lrwxrwxrwx 1 root root 0 Jul 18 12:31 uts -\u0026gt; \u0026#39;uts:[4026531838]\u0026#39;   cgroup cpu 代码：main.go\n1 2 3 4 5 6 7 8 9 10 11 12 13  package main func main() { go func() { for { } }() for { } }   在 cgroup cpu 子系统目录中创建目录结构\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40  cd /sys/fs/cgroup/cpu sudo mkdir cpudemo cd cpudemo ➜ cpudemo ll 总用量 0 drwxr-xr-x 2 root root 0 10月 7 20:37 . dr-xr-xr-x 7 root root 0 10月 7 07:21 .. -rw-r--r-- 1 root root 0 10月 7 20:37 cgroup.clone_children -rw-r--r-- 1 root root 0 10月 7 20:37 cgroup.procs -r--r--r-- 1 root root 0 10月 7 20:37 cpuacct.stat -rw-r--r-- 1 root root 0 10月 7 20:37 cpuacct.usage -r--r--r-- 1 root root 0 10月 7 20:37 cpuacct.usage_all -r--r--r-- 1 root root 0 10月 7 20:37 cpuacct.usage_percpu -r--r--r-- 1 root root 0 10月 7 20:37 cpuacct.usage_percpu_sys -r--r--r-- 1 root root 0 10月 7 20:37 cpuacct.usage_percpu_user -r--r--r-- 1 root root 0 10月 7 20:37 cpuacct.usage_sys -r--r--r-- 1 root root 0 10月 7 20:37 cpuacct.usage_user -rw-r--r-- 1 root root 0 10月 7 20:37 cpu.cfs_period_us -rw-r--r-- 1 root root 0 10月 7 20:37 cpu.cfs_quota_us -rw-r--r-- 1 root root 0 10月 7 20:37 cpu.shares -r--r--r-- 1 root root 0 10月 7 20:37 cpu.stat -rw-r--r-- 1 root root 0 10月 7 20:37 cpu.uclamp.max -rw-r--r-- 1 root root 0 10月 7 20:37 cpu.uclamp.min -rw-r--r-- 1 root root 0 10月 7 20:37 notify_on_release -rw-r--r-- 1 root root 0 10月 7 20:37 tasks ➜ cpudemo cat cpu.shares 1024 限制使用多少 CPU 时间片，-1 表示不限制 ➜ cpudemo cat cpu.cfs_quota_us -1 一个 CPU 时间片数 ➜ cpudemo cat cpu.cfs_period_us 100000 监控的进程 ID，新建出来的为空 ➜ cpudemo cat cgroup.procs   cpu.shares、cpu.cfs_quota_us、cpu.cfs_period_us关系：\ncpu.cfs_quota_us 与 cpu.cfs_period_us 一起使用，用于限制 cgroup 中所有进程在一定时间周期内可以使用的 CPU 时间总量。这个参数提供了一种硬性限制，确保 cgroup 中的进程不会超过指定的 CPU 使用量。\ncpu.shares 是一个相对权重参数，它决定了在多个 cgroup 之间竞争 CPU 资源时，每个 cgroup 能够获得的 CPU 时间的相对比例。这个参数并不提供硬性限制，而是在资源竞争时影响 CPU 时间的分配比例。\n当 cpu.cfs_quota_us 和 cpu.shares 同时设置时，它们会按照以下方式共同作用：\n资源竞争时的优先级：如果系统上的 CPU 资源充足，不在竞争状态，那么所有 cgroup 都可以使用更多的 CPU 时间，不会受到 cpu.shares 设置的限制。但是，如果 CPU 资源紧张，多个 cgroup 之间开始竞争 CPU 时间，cpu.shares 的值将决定它们获取 CPU 时间的相对权重。\n运行 busyloop 1 2 3 4 5 6  ➜ busyloop git:(main) ✗ go build -o busyloop main.go ➜ busyloop git:(main) ✗ ll 总用量 1.2M -rwxrwxr-x 1 cjx cjx 1.2M 10月 7 20:42 busyloop -rw-rw-r-- 1 cjx cjx 73 10月 7 20:34 main.go ➜ busyloop git:(main) ✗ ./busyloop   执行 top 查看 CPU 使用情况，CPU 占用 200%\n1 2 3 4 5 6 7 8 9  top - 20:43:20 up 13:21, 1 user, load average: 1.62, 0.87, 0.91 任务: 531 total, 3 running, 527 sleeping, 0 stopped, 1 zombie %Cpu(s): 11.1 us, 0.3 sy, 0.0 ni, 87.2 id, 0.0 wa, 0.0 hi, 1.4 si, 0.0 st MiB Mem : 128749.5 total, 117783.0 free, 5873.8 used, 5092.6 buff/cache MiB Swap: 0.0 total, 0.0 free, 0.0 used. 121378.7 avail Mem 进程号 USER PR NI VIRT RES SHR %CPU %MEM TIME+ COMMAND 52435 cjx 20 0 702364 1160 648 R 200.0 0.0 0:44.07 busyloop ......   1 2 3 4 5 6 7 8 9 10 11 12 13  # 通过 cgroup 限制 cpu cd /sys/fs/cgroup/cpu/cpudemo # 把进程添加到 cgroup 进程配置组 # echo ps -ef|grep busyloop|grep -v grep|awk \u0026#39;{print $2}\u0026#39; \u0026gt; cgroup.procs ➜ cpudemo ps -ef|grep busyloop|grep -v grep|awk \u0026#39;{print $2}\u0026#39; 52435 ➜ cpudemo cat cgroup.procs 52435 # 设置 cpuquota echo 10000 \u0026gt; cpu.cfs_quota_us cat cpu.cfs_quota_us   执行 top 查看 CPU 使用情况，CPU 占用变为10%(cpu.cfs_quota_us/cpu.cfs_period_us -\u0026gt; 10000/100000)\n1 2 3 4 5 6 7 8 9  top - 20:49:11 up 13:27, 1 user, load average: 1.28, 1.58, 1.26 任务: 531 total, 3 running, 527 sleeping, 0 stopped, 1 zombie %Cpu(s): 1.7 us, 0.5 sy, 0.0 ni, 97.7 id, 0.0 wa, 0.0 hi, 0.1 si, 0.0 st MiB Mem : 128749.5 total, 117765.6 free, 5888.9 used, 5095.0 buff/cache MiB Swap: 0.0 total, 0.0 free, 0.0 used. 121364.8 avail Mem 进程号 USER PR NI VIRT RES SHR %CPU %MEM TIME+ COMMAND 4507 cjx 20 0 1125.5g 481848 208608 S 11.0 0.4 46:28.85 chrome 52435 cjx 20 0 702364 1160 648 R 10.3 0.0 11:28.43 busyloop   善后删除 1 2  sudo apt install cgroup-tools sudo cgdelete cpu:cpudemo   cgroup memory 在 cgroup memory 子系统目录中创建目录结构\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35  cd /sys/fs/cgroup/memory mkdir memorydemo cd memorydemo ls -la 总用量 0 drwxr-xr-x 2 root root 0 10月 7 21:01 . dr-xr-xr-x 7 root root 0 10月 7 07:21 .. -rw-r--r-- 1 root root 0 10月 7 21:02 cgroup.clone_children --w--w--w- 1 root root 0 10月 7 21:02 cgroup.event_control -rw-r--r-- 1 root root 0 10月 7 21:02 cgroup.procs # 管控的进程 -rw-r--r-- 1 root root 0 10月 7 21:02 memory.failcnt --w------- 1 root root 0 10月 7 21:02 memory.force_empty -rw-r--r-- 1 root root 0 10月 7 21:02 memory.kmem.failcnt -rw-r--r-- 1 root root 0 10月 7 21:02 memory.kmem.limit_in_bytes -rw-r--r-- 1 root root 0 10月 7 21:02 memory.kmem.max_usage_in_bytes -r--r--r-- 1 root root 0 10月 7 21:02 memory.kmem.slabinfo -rw-r--r-- 1 root root 0 10月 7 21:02 memory.kmem.tcp.failcnt -rw-r--r-- 1 root root 0 10月 7 21:02 memory.kmem.tcp.limit_in_bytes -rw-r--r-- 1 root root 0 10月 7 21:02 memory.kmem.tcp.max_usage_in_bytes -r--r--r-- 1 root root 0 10月 7 21:02 memory.kmem.tcp.usage_in_bytes -r--r--r-- 1 root root 0 10月 7 21:02 memory.kmem.usage_in_bytes -rw-r--r-- 1 root root 0 10月 7 21:02 memory.limit_in_bytes -rw-r--r-- 1 root root 0 10月 7 21:02 memory.max_usage_in_bytes -rw-r--r-- 1 root root 0 10月 7 21:02 memory.move_charge_at_immigrate -r--r--r-- 1 root root 0 10月 7 21:02 memory.numa_stat -rw-r--r-- 1 root root 0 10月 7 21:02 memory.oom_control ---------- 1 root root 0 10月 7 21:02 memory.pressure_level -rw-r--r-- 1 root root 0 10月 7 21:02 memory.soft_limit_in_bytes -r--r--r-- 1 root root 0 10月 7 21:02 memory.stat -rw-r--r-- 1 root root 0 10月 7 21:02 memory.swappiness -r--r--r-- 1 root root 0 10月 7 21:02 memory.usage_in_bytes -rw-r--r-- 1 root root 0 10月 7 21:02 memory.use_hierarchy -rw-r--r-- 1 root root 0 10月 7 21:02 notify_on_release -rw-r--r-- 1 root root 0 10月 7 21:02 tasks   通过 cgroup 限制 memory\n把进程添加到 cgroup 进程配置组\n1  echo \u0026lt;pid\u0026gt; \u0026gt; cgroup.procs   设置 memory.limit_in_bytes\n1  echo 104960000 \u0026gt; memory.limit_in_bytes   OverlayFS ","date":"2024-07-18T23:01:00+08:00","permalink":"https://mkbooks.github.io/blog/p/kubernetes/","title":"kubernetes"},{"content":"Supervisor 的主要功能  进程管理：Supervisor 可以启动、停止、重启和监控多个进程。 配置简单：通过一个或多个配置文件（通常是 supervisord.conf），用户可以定义需要管理的进程及其运行参数。 事件监听：Supervisor 支持事件监听机制，可以与其他系统集成，实现自动化处理。 Web 界面：提供了一个简单的 Web 界面，用于查看和管理进程状态。  使用 Supervisor 的步骤：  安装 Supervisor：  1  pip install supervisor    创建配置文件： 通常，Supervisor 的配置文件位于 /etc/supervisor/supervisord.conf，用户可以在这个文件中定义需要管理的进程。\n  定义进程： 在配置文件中，使用 [program:x] 部分定义每个进程的启动命令、工作目录、日志路径等。\n  启动 Supervisor：\n  1  supervisord -c /etc/supervisor/supervisord.conf   管理进程： 使用 supervisorctl 命令来管理进程，例如启动、停止、重启等。  在 Docker 容器中使用 Supervisor： 在 Docker 容器中使用 Supervisor 时，通常会在 Dockerfile 中安装 Supervisor，并在容器启动时运行 supervisord 来管理其他进程。例如：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  FROM python:3.8-slim # 安装 Supervisor RUN pip install supervisor # 复制 Supervisor 配置文件 COPY supervisord.conf /etc/supervisor/supervisord.conf # 复制应用代码 COPY app /app # 设置工作目录 WORKDIR /app # 启动 Supervisor CMD [\u0026#34;supervisord\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;/etc/supervisor/supervisord.conf\u0026#34;]   在 supervisord.conf 文件中，可以定义多个 [program:x] 部分来管理不同的进程。\nSupervisor 的主要用途 Supervisor 更适合于以下场景：\n 单主机进程管理：在单个服务器上管理多个进程，确保这些进程按预期运行。 故障恢复：监控进程状态，如果进程异常退出，Supervisor 可以自动重启这些进程。 日志管理：集中管理和记录所有被其监控进程的输出日志。  ","date":"2024-07-17T22:13:18+08:00","permalink":"https://mkbooks.github.io/blog/p/supervisor/","title":"Supervisor"},{"content":"实现推送后自动编译并部署到 gh-pages 分支 要实现推送后自动编译并部署到 gh-pages 分支，你有几种方法可以选择：\n方法1：使用 GitHub Actions（推荐） 这是最现代、最灵活的方式：\n 创建 GitHub Actions 工作流文件：    在仓库根目录创建：.github/workflows/deploy.yml\n  内容如下：\n  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43  name:Deploy to GitHub Pageson:push:branches:[\u0026#34;main\u0026#34;]# 如果你的主分支是 mainpull_request:branches:[\u0026#34;main\u0026#34;]permissions:contents:writepages:writeid-token:writejobs:build-and-deploy:runs-on:ubuntu-lateststeps:- name:Checkoutuses:actions/checkout@v4# 这里添加你的构建步骤# 例如，如果是 Jekyll：# - name: Setup Ruby# uses: ruby/setup-ruby@v1# - name: Build with Jekyll# run: |# bundle install# bundle exec jekyll build# 如果是静态文件，直接复制到输出目录- name:Buildrun:|# 你的构建命令 # 例如：npm run build 或 hugo echo \u0026#34;Building site...\u0026#34; # 构建后的文件放在 dist/ 或 public/ 目录 - name:Deployuses:peaceiris/actions-gh-pages@v3with:github_token:${{ secrets.GITHUB_TOKEN }}publish_dir:./dist # 改为你的输出目录publish_branch:gh-pages  根据你的博客类型调整：   Jekyll：GitHub Pages 会自动构建，但如果你想自定义：  1 2 3 4 5 6  - name:Setup Jekylluses:ruby/setup-ruby@v1- name:Buildrun:|bundle install bundle exec jekyll build  Hugo：\n1 2 3 4  - name:Setup Hugouses:peaceiris/actions-hugo@v2- name:Buildrun:hugo --minify  Hexo：\n1 2 3 4 5 6  - name:Setup Node.jsuses:actions/setup-node@v3- name:Install and Buildrun:|npm install npm run build  方法2：使用 CI 工具的构建脚本 如果你已经在使用其他工具，可以在 package.json 中添加脚本：\n1 2 3 4 5 6 7 8  { \u0026#34;scripts\u0026#34;: { \u0026#34;deploy\u0026#34;: \u0026#34;npm run build \u0026amp;\u0026amp; gh-pages -d dist\u0026#34; }, \u0026#34;devDependencies\u0026#34;: { \u0026#34;gh-pages\u0026#34;: \u0026#34;^5.0.0\u0026#34; } }   然后手动运行npm run deploy\n方法3：手动设置分支   确保 gh-pages 分支存在\n  在主分支中添加构建脚本\n  使用 Git 子模块或 subtree 推送\n  配置建议  检查 Pages 设置：    仓库 Settings → Pages\n  Source: Deploy from a branch\n  Branch: gh-pages / root\n  验证部署：    推送代码后，查看 Actions 标签页\n  成功部署后，访问 https://.github.io/  常见问题解决   权限问题：确保 Actions 有写入权限\n  构建失败：检查本地构建是否正常\n  缓存问题：在 Actions 中配置缓存以提高速度\n  推荐使用 方法1（GitHub Actions），因为它最灵活且与 GitHub 生态集成最好。你需要根据自己的博客框架调整构建步骤。\n基于旧的YAML文件修复 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60  name: auto-hugo # 名字自取 on: push: branches: - main # 这里的意思是当 main分支发生push的时候，运行下面的jobs jobs: deploy: # 任务名自取 runs-on: ubuntu-latest\t# 在什么环境运行任务 steps: - uses: actions/checkout@v3\t# 引用actions/checkout这个action，与所在的github仓库同名 with: submodules: true # Fetch Hugo themes (true OR recursive) 获取submodule主题 fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod - name: Setup Hugo\t# 步骤名自取 uses: peaceiris/actions-hugo@v2\t# hugo官方提供的action，用于在任务环境中获取hugo with: hugo-version: \u0026#39;0.91.2\u0026#39; #\u0026#39;latest\u0026#39;# 获取最新版本的hugo extended: true - name: Build run: hugo --minify -b https://mkbooks.github.io/blog/ # 使用hugo构建静态网页 # - name: Deploy # uses: peaceiris/actions-gh-pages@v3\t# 一个自动发布github pages的action # with: # # github_token: ${{ secrets.GITHUB_TOKEN }} # 该项适用于发布到源码相同repo的情况，不能用于发布到其他repo # # external_repository: mkbooks/blog 发布到哪个repo # github_token: ${{ secrets.ACTIONS_DEPLOY_KEY }} # 发布到其他repo需要提供上面生成的personal access token # publish_dir: ./public\t# 注意这里指的是要发布哪个文件夹的内容，而不是指发布到目的仓库的什么位置，因为hugo默认生成静态网页到public文件夹，所以这里发布public文件夹里的内容 # publish_branch: gh-pages\t# 发布到哪个branch # commit_message: ${{ github.event.head_commit.message }} # name: Debugging with SSH # on: push # jobs: # build: # runs-on: ubuntu-latest # steps: # - uses: actions/checkout@v1 # - name: Try Build # run: ./not-exist-file.sh it bloke build # - name: Start SSH via Ngrok # if: ${{ failure() }} # run: curl -sL https://gist.githubusercontent.com/retyui/7115bb6acf151351a143ec8f96a7c561/raw/7099b9db76729dc5761da72aa8525f632d8875c9/debug-github-actions.sh | bash # env: # # After sign up on the https://ngrok.com/ # # You can find this token here: https://dashboard.ngrok.com/get-started/setup # NGROK_TOKEN: ${{ secrets.NGROK_TOKEN }} # # This password you will use when authorizing via SSH # USER_PASS: ${{ secrets.USER_PASS }} # - name: Don\u0026#39;t kill instace # if: ${{ failure() }} # run: sleep 8640h # Prevent to killing instance after failure   基于旧的YAML文件，修改了一个完整可用的版本，将Hugo构建的网站自动部署到gh-pages分支：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37  name:Build and Deploy Hugo Siteon:push:branches:- mainjobs:build-and-deploy:runs-on:ubuntu-latestpermissions:contents:write # 需要写入权限来推送gh-pages分支steps:- name:Checkout repositoryuses:actions/checkout@v3with:submodules:truefetch-depth:0- name:Setup Hugouses:peaceiris/actions-hugo@v2with:hugo-version:\u0026#39;0.91.2\u0026#39;extended:true- name:Build with Hugorun:hugo --minify -b https://mkbooks.github.io/blog/- name:Deploy to GitHub Pagesuses:peaceiris/actions-gh-pages@v3with:github_token:${{ secrets.GITHUB_TOKEN }}publish_dir:./publicpublish_branch:gh-pages# cname: mkbooks.github.io # 如果使用自定义域名，可以取消注释并修改commit_message:${{ github.event.head_commit.message }}  重要配置说明：\n 权限设置：  1 2  permissions:contents:write  这行很重要，它允许工作流有写入权限来创建/更新gh-pages分支。\nGITHUB_TOKEN：    使用 ${{ secrets.GITHUB_TOKEN }} 而不是 ACTIONS_DEPLOY_KEY\n  GITHUB_TOKEN是GitHub自动为工作流生成的令牌，不需要额外配置\n   部署后的设置： 部署完成后，需要在仓库设置中配置GitHub Pages：\n  进入仓库 Settings → Pages\n  Source选择：Deploy from a branch\n  Branch选择：gh-pages → /(root)\n  保存\n  备用方案（如果上述方案失败）： 如果遇到权限问题，可以使用个人访问令牌：\n  1 2 3 4 5 6 7  - name:Deploy to GitHub Pagesuses:peaceiris/actions-gh-pages@v3with:deploy_key:${{ secrets.ACTIONS_DEPLOY_KEY }} # 或者使用 personal_access_token# 或者使用 personal_token: ${{ secrets.PERSONAL_TOKEN }}publish_dir:./publicpublish_branch:gh-pages  调试版本（遇到问题时使用）：  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49  name:Build and Deploy Hugo Site (Debug)on:push:branches:[main]jobs:build-deploy-debug:runs-on:ubuntu-lateststeps:- name:Checkoutuses:actions/checkout@v3with:submodules:truefetch-depth:0- name:Debug Inforun:|echo \u0026#34;Repository: ${{ github.repository }}\u0026#34; echo \u0026#34;Event name: ${{ github.event_name }}\u0026#34; echo \u0026#34;Ref: ${{ github.ref }}\u0026#34; ls -la- name:Setup Hugouses:peaceiris/actions-hugo@v2with:hugo-version:\u0026#39;0.91.2\u0026#39;extended:true- name:Build Hugorun:|hugo version hugo --minify -b https://mkbooks.github.io/blog/ echo \u0026#34;Build completed\u0026#34; ls -la public/- name:Deployuses:peaceiris/actions-gh-pages@v3with:github_token:${{ secrets.GITHUB_TOKEN }}publish_dir:./publicpublish_branch:gh-pageskeep_files:false# 清除gh-pages分支的旧文件force_orphan:true# 创建单次提交的gh-pages分支- name:Verify Deploymentrun:|echo \u0026#34;Deployment completed at $(date)\u0026#34; echo \u0026#34;Visit https://mkbooks.github.io/blog/\u0026#34;  故障排除步骤：  检查工作流运行状态：    到仓库的 \u0026ldquo;Actions\u0026rdquo; 标签页查看运行状态\n  点击失败的作业查看详细错误信息\n  常见问题：    权限不足：确保工作流有 contents: write 权限\n  构建失败：检查Hugo配置是否正确\n  部署失败：确认public目录存在且包含index.html\n  手动测试：  1 2 3 4 5  # 本地测试构建 hugo --minify -b https://mkbooks.github.io/blog/ # 查看生成的文件 ls -la public/   将修改后的YAML文件保存到 .github/workflows/deploy.yml，然后推送到main分支就会自动触发构建和部署。\n","date":"2023-12-24T00:00:00Z","permalink":"https://mkbooks.github.io/blog/p/%E5%AE%9E%E7%8E%B0%E6%8E%A8%E9%80%81%E5%90%8E%E8%87%AA%E5%8A%A8%E7%BC%96%E8%AF%91%E5%B9%B6%E9%83%A8%E7%BD%B2%E5%88%B0-gh-pages-%E5%88%86%E6%94%AF/","title":"实现推送后自动编译并部署到 gh-pages 分支"},{"content":"脚本功能 指定一个目录，删除其中内容重复的文件。根据md5sum值判断文件是否重复，根据文件名长短判断保留文件名短的文件。根据文件数量判断处理进度。\n脚本内容 文件名：cleanup_duplicates.sh\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48  #!/bin/bash  # 设置默认文件夹路径为 /home/user/test folder=${1:-\u0026#34;/home/user/test\u0026#34;} # 统计文件夹下的文件总数 file_count=$(find \u0026#34;$folder\u0026#34; -maxdepth 1 -type f | wc -l) processed_count=0 # 找出文件夹下所有文件，并计算每个文件的 MD5 值 find \u0026#34;$folder\u0026#34; -maxdepth 1 -type f -exec md5sum {} + | sort \u0026gt; \u0026#34;$folder/md5sum.txt\u0026#34; # 根据 MD5 值进行重复文件的处理 while read -r line; do md5=$(echo \u0026#34;$line\u0026#34; | awk \u0026#39;{print $1}\u0026#39;) filename=$(echo \u0026#34;$line\u0026#34; | awk \u0026#39;{print $2}\u0026#39;) # 检查是否有重复的文件 duplicates=$(grep \u0026#34;$md5\u0026#34; \u0026#34;$folder/md5sum.txt\u0026#34; | grep -v \u0026#34;$filename\u0026#34;) if [[ -n $duplicates ]]; then shortest_filename=$filename # 查找文件名较短的重复文件 while read -r duplicate; do duplicate_filename=$(echo \u0026#34;$duplicate\u0026#34; | awk \u0026#39;{print $2}\u0026#39;) if [[ ${#duplicate_filename} -lt ${#shortest_filename} ]]; then shortest_filename=$duplicate_filename fi done \u0026lt;\u0026lt;\u0026lt; \u0026#34;$duplicates\u0026#34; # 删除除了文件名最短的重复文件之外的其他文件 while read -r duplicate; do duplicate_filename=$(echo \u0026#34;$duplicate\u0026#34; | awk \u0026#39;{print $2}\u0026#39;) if [[ \u0026#34;$duplicate_filename\u0026#34; != \u0026#34;$shortest_filename\u0026#34; ]]; then rm \u0026#34;$duplicate_filename\u0026#34; fi done \u0026lt;\u0026lt;\u0026lt; \u0026#34;$duplicates\u0026#34; fi # 更新进度 processed_count=$((processed_count + 1)) progress=$((processed_count * 100 / file_count)) echo \u0026#34;Processing: $progress%\u0026#34; done \u0026lt;\u0026lt;\u0026lt; \u0026#34;$(tail -n +2 \u0026#34;$folder/md5sum.txt\u0026#34;)\u0026#34; # 跳过第一行，不包括 md5sum.txt 文件本身 # 删除临时文件 rm \u0026#34;$folder/md5sum.txt\u0026#34;   使用方法 1 2  chmod +x cleanup_duplicates.sh $ ./cleanup_duplicates.sh /home/cjx/test/test   ","date":"2023-07-16T14:00:00+08:00","permalink":"https://mkbooks.github.io/blog/p/%E5%88%A0%E9%99%A4%E5%86%85%E5%AE%B9%E9%87%8D%E5%A4%8D%E7%9A%84%E6%96%87%E4%BB%B6/","title":"删除内容重复的文件"},{"content":"下载项目 1 2  git clone https://github.com/wordweb/langchain-ChatGLM-and-TigerBot.git cd langchain-ChatGLM-and-TigerBot/   Docker 部署 为了能让容器使用主机GPU资源，需要在主机上安装 NVIDIA Container Toolkit。具体安装步骤如下：\n1 2 3 4  sudo apt-get update sudo apt-get install -y nvidia-container-toolkit-base sudo systemctl daemon-reload sudo systemctl restart docker   安装完成后，可以使用以下命令编译镜像和启动容器：\n1  docker build -f Dockerfile-cuda -t chatglm-cuda-tigerbot:latest .   使用离线模型 text2vec-large-chinese\n1 2 3 4 5 6 7 8 9 10 11 12 13  cjx@cjx:/ssd2/huggingface/GanymedeNil/text2vec-large-chinese$ ll 总计 1272280 drwxrwxr-x 2 cjx cjx 4096 6月 9 20:46 ./ drwxrwxr-x 3 cjx cjx 4096 6月 9 20:45 ../ -rw-rw-r-- 1 cjx cjx 821 6月 9 20:46 config.json -rw-rw-r-- 1 cjx cjx 69 6月 9 20:46 eval_results.txt -rw-rw-r-- 1 cjx cjx 1477 6月 9 20:45 .gitattributes -rw-rw-r-- 1 cjx cjx 1302223089 3月 7 11:34 pytorch_model.bin -rw-rw-r-- 1 cjx cjx 317 6月 9 20:46 README.md -rw-rw-r-- 1 cjx cjx 125 6月 9 20:46 special_tokens_map.json -rw-rw-r-- 1 cjx cjx 514 6月 9 20:46 tokenizer_config.json -rw-rw-r-- 1 cjx cjx 439387 6月 9 20:46 tokenizer.json -rw-rw-r-- 1 cjx cjx 109540 6月 9 20:46 vocab.txt   ChatGLM-6B\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26  cjx@cjx:/ssd2/github/THUDM/ChatGLM-6B/chatglm-6b$ ll 总计 13105340 drwxrwxr-x 3 cjx cjx 4096 5月 22 14:55 ./ drwxrwxr-x 10 cjx cjx 4096 5月 22 15:18 ../ -rw-rw-r-- 1 cjx cjx 773 5月 22 14:43 config.json -rw-rw-r-- 1 cjx cjx 4276 5月 22 14:43 configuration_chatglm.py drwxrwxr-x 8 cjx cjx 4096 5月 22 14:43 .git/ -rw-rw-r-- 1 cjx cjx 1477 5月 22 14:43 .gitattributes -rw-rw-r-- 1 cjx cjx 2706249 5月 22 14:44 ice_text.model -rw-rw-r-- 1 cjx cjx 11336 5月 22 14:44 LICENSE -rw-rw-r-- 1 cjx cjx 57620 5月 22 14:43 modeling_chatglm.py -rw-rw-r-- 1 cjx cjx 2354 5月 22 14:44 MODEL_LICENSE -rw-rw-r-- 1 cjx cjx 1740651802 5月 22 14:53 pytorch_model-00001-of-00008.bin -rw-rw-r-- 1 cjx cjx 1879731432 5月 22 14:53 pytorch_model-00002-of-00008.bin -rw-rw-r-- 1 cjx cjx 1980385902 5月 22 14:53 pytorch_model-00003-of-00008.bin -rw-rw-r-- 1 cjx cjx 1913294120 5月 22 14:53 pytorch_model-00004-of-00008.bin -rw-rw-r-- 1 cjx cjx 1879722289 5月 22 14:53 pytorch_model-00005-of-00008.bin -rw-rw-r-- 1 cjx cjx 1879731496 5月 22 14:53 pytorch_model-00006-of-00008.bin -rw-rw-r-- 1 cjx cjx 1074103621 5月 22 14:50 pytorch_model-00007-of-00008.bin -rw-rw-r-- 1 cjx cjx 1069286123 5月 22 14:50 pytorch_model-00008-of-00008.bin -rw-rw-r-- 1 cjx cjx 33416 5月 22 14:43 pytorch_model.bin.index.json -rw-rw-r-- 1 cjx cjx 15054 5月 22 14:43 quantization.py -rw-rw-r-- 1 cjx cjx 6087 5月 22 14:43 README.md -rw-rw-r-- 1 cjx cjx 13822 5月 22 14:43 test_modeling_chatglm.py -rw-rw-r-- 1 cjx cjx 17047 5月 22 14:43 tokenization_chatglm.py -rw-rw-r-- 1 cjx cjx 441 5月 22 14:43 tokenizer_config.json   TigerResearch\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  cjx@cjx:/ssd2/huggingface/TigerResearch/tigerbot-7b-sft$ ll 总计 15824908 drwxrwxr-x 2 cjx cjx 4096 6月 9 20:35 ./ drwxrwxr-x 3 cjx cjx 4096 6月 9 20:09 ../ -rw-rw-r-- 1 cjx cjx 765 6月 9 20:10 config.json -rw-rw-r-- 1 cjx cjx 132 6月 9 20:10 generation_config.json -rw-rw-r-- 1 cjx cjx 1528 6月 9 20:10 .gitattributes -rw-rw-r-- 1 cjx cjx 9974654870 6月 7 19:14 pytorch_model-00001-of-00002.bin -rw-rw-r-- 1 cjx cjx 6215469038 6月 7 18:53 pytorch_model-00002-of-00002.bin -rw-rw-r-- 1 cjx cjx 31898 6月 9 20:10 pytorch_model.bin.index.json -rw-rw-r-- 1 cjx cjx 2123 6月 9 20:10 README.md -rw-rw-r-- 1 cjx cjx 190 6月 9 20:10 special_tokens_map.json -rw-rw-r-- 1 cjx cjx 289 6月 9 20:10 tokenizer_config.json -rw-rw-r-- 1 cjx cjx 14500838 6月 9 20:11 tokenizer.json   修改配置 configs/model_config\n1 2 3  # 如果你需要加载本地的model，指定这个参数 ` --no-remote-model`，或者下方参数修改为 `True` # NO_REMOTE_MODEL = False NO_REMOTE_MODEL=True  编译镜像 1  docker build -f Dockerfile-cuda -t chatglm-cuda:latest .   启动容器 配置好模型路径，然后此repo挂载到Container\n1 2 3 4 5 6 7  docker run --gpus all -d \\ --name chatglm-tigerbot \\ -p 7861:7860 \\ -v /ssd2/huggingface/GanymedeNil/text2vec-large-chinese:/chatGLM/model/text2vec-large-chinese \\ -v /ssd2/github/THUDM/ChatGLM-6B/chatglm-6b:/chatGLM/model/chatglm-6b \\ -v /ssd2/huggingface/TigerResearch/tigerbot-7b-sft:/chatGLM/model/TigerBot \\ chatglm-cuda-tigerbot:latest   ","date":"2023-06-09T10:00:00+08:00","permalink":"https://mkbooks.github.io/blog/p/langchain-chatglm-and-tigerbot/","title":"langchain-ChatGLM-and-TigerBot"},{"content":"下载项目 1 2  git clone https://github.com/TigerResearch/TigerBot.git cd TigerBot/   宿主机部署 环境安装 模型下载 1 2 3  git lfs install GIT_LFS_SKIP_SMUDGE=1 git clone https://huggingface.co/TigerResearch/tigerbot-7b-sft   ","date":"2023-06-09T10:00:00+08:00","permalink":"https://mkbooks.github.io/blog/p/tigerbot/","title":"TigerBot"},{"content":"下载项目 1 2 3 4  git clone https://github.com/imClumsyPanda/langchain-ChatGLM cd langchain-ChatGLM git fetch --all git checkout v0.1.14   docker 部署 在主机上安装 NVIDIA Container Toolkit\n1 2 3 4  sudo apt-get update sudo apt-get install -y nvidia-container-toolkit-base sudo systemctl daemon-reload sudo systemctl restart docker   联网使用 编译镜像 1  docker build -f Dockerfile-cuda -t chatglm-cuda:latest .   启动容器 1  docker run --gpus all -d --name chatglm -p 7860:7860 chatglm-cuda:latest   使用离线模型 text2vec-large-chinese\n1 2 3 4 5 6 7 8 9 10 11 12 13  cjx@cjx:/ssd2/huggingface/GanymedeNil/text2vec-large-chinese$ ll 总计 1272280 drwxrwxr-x 2 cjx cjx 4096 6月 9 20:46 ./ drwxrwxr-x 3 cjx cjx 4096 6月 9 20:45 ../ -rw-rw-r-- 1 cjx cjx 821 6月 9 20:46 config.json -rw-rw-r-- 1 cjx cjx 69 6月 9 20:46 eval_results.txt -rw-rw-r-- 1 cjx cjx 1477 6月 9 20:45 .gitattributes -rw-rw-r-- 1 cjx cjx 1302223089 3月 7 11:34 pytorch_model.bin -rw-rw-r-- 1 cjx cjx 317 6月 9 20:46 README.md -rw-rw-r-- 1 cjx cjx 125 6月 9 20:46 special_tokens_map.json -rw-rw-r-- 1 cjx cjx 514 6月 9 20:46 tokenizer_config.json -rw-rw-r-- 1 cjx cjx 439387 6月 9 20:46 tokenizer.json -rw-rw-r-- 1 cjx cjx 109540 6月 9 20:46 vocab.txt   ChatGLM-6B\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26  cjx@cjx:/ssd2/github/THUDM/ChatGLM-6B/chatglm-6b$ ll 总计 13105340 drwxrwxr-x 3 cjx cjx 4096 5月 22 14:55 ./ drwxrwxr-x 10 cjx cjx 4096 5月 22 15:18 ../ -rw-rw-r-- 1 cjx cjx 773 5月 22 14:43 config.json -rw-rw-r-- 1 cjx cjx 4276 5月 22 14:43 configuration_chatglm.py drwxrwxr-x 8 cjx cjx 4096 5月 22 14:43 .git/ -rw-rw-r-- 1 cjx cjx 1477 5月 22 14:43 .gitattributes -rw-rw-r-- 1 cjx cjx 2706249 5月 22 14:44 ice_text.model -rw-rw-r-- 1 cjx cjx 11336 5月 22 14:44 LICENSE -rw-rw-r-- 1 cjx cjx 57620 5月 22 14:43 modeling_chatglm.py -rw-rw-r-- 1 cjx cjx 2354 5月 22 14:44 MODEL_LICENSE -rw-rw-r-- 1 cjx cjx 1740651802 5月 22 14:53 pytorch_model-00001-of-00008.bin -rw-rw-r-- 1 cjx cjx 1879731432 5月 22 14:53 pytorch_model-00002-of-00008.bin -rw-rw-r-- 1 cjx cjx 1980385902 5月 22 14:53 pytorch_model-00003-of-00008.bin -rw-rw-r-- 1 cjx cjx 1913294120 5月 22 14:53 pytorch_model-00004-of-00008.bin -rw-rw-r-- 1 cjx cjx 1879722289 5月 22 14:53 pytorch_model-00005-of-00008.bin -rw-rw-r-- 1 cjx cjx 1879731496 5月 22 14:53 pytorch_model-00006-of-00008.bin -rw-rw-r-- 1 cjx cjx 1074103621 5月 22 14:50 pytorch_model-00007-of-00008.bin -rw-rw-r-- 1 cjx cjx 1069286123 5月 22 14:50 pytorch_model-00008-of-00008.bin -rw-rw-r-- 1 cjx cjx 33416 5月 22 14:43 pytorch_model.bin.index.json -rw-rw-r-- 1 cjx cjx 15054 5月 22 14:43 quantization.py -rw-rw-r-- 1 cjx cjx 6087 5月 22 14:43 README.md -rw-rw-r-- 1 cjx cjx 13822 5月 22 14:43 test_modeling_chatglm.py -rw-rw-r-- 1 cjx cjx 17047 5月 22 14:43 tokenization_chatglm.py -rw-rw-r-- 1 cjx cjx 441 5月 22 14:43 tokenizer_config.json   修改配置 configs/model_config\n1 2 3  # 如果你需要加载本地的model，指定这个参数 ` --no-remote-model`，或者下方参数修改为 `True` # NO_REMOTE_MODEL = False NO_REMOTE_MODEL=True  编译镜像 1  docker build -f Dockerfile-cuda -t chatglm-cuda:latest .   启动容器 配置好模型路径，然后此repo挂载到Container\n1 2 3 4 5 6  docker run --gpus all -d \\ --name chatglm \\ -p 7860:7860 \\ -v /ssd2/huggingface/GanymedeNil/text2vec-large-chinese:/chatGLM/GanymedeNil/text2vec-large-chinese \\ -v /ssd2/github/THUDM/ChatGLM-6B/chatglm-6b:/chatGLM/model/chatglm-6b \\ chatglm-cuda:latest   ","date":"2023-06-04T10:00:00+08:00","permalink":"https://mkbooks.github.io/blog/p/docker%E9%83%A8%E7%BD%B2langchain-chatglm/","title":"docker部署langchain-ChatGLM"},{"content":"安装服务 Prometheus Grafana DCGM ","date":"2023-05-25T08:00:00+08:00","permalink":"https://mkbooks.github.io/blog/p/gpu%E7%9B%91%E6%8E%A7/","title":"GPU监控"},{"content":"运行 1  /usr/bin$ ./apipost7 --in-process-gpu   ","date":"2023-05-09T20:00:00+08:00","permalink":"https://mkbooks.github.io/blog/p/%E4%BD%BF%E7%94%A8ceph-deploy%E5%AE%89%E8%A3%85ceph/","title":"使用ceph-deploy安装ceph"},{"content":"刷题模板 Python3 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39  class Pipe: def __init__(self, func): self.func = func def __ror__(self, other): return self.func(other) def __call__(self, *args, **kwargs): return self.func(*args, **kwargs) @Pipe def deal(datas): result = [] for data in datas: pass return result @Pipe def print_data(datas): for data in datas: print(data) if __name__ == \u0026#34;__main__\u0026#34;: datas = [] while True: try: data = input() if data == \u0026#34;\u0026#34;: break datas.append(data) except: break datas | deal | print_data   样例 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51  # HJ19 简单错误记录 class Pipe: def __init__(self, func): self.func = func def __ror__(self, other): return self.func(other) def __call__(self, *args, **kwargs): return self.func(*args, **kwargs) @Pipe def split_data(datas): return [data.split(\u0026#34;\\\\\u0026#34;)[-1].split() for data in datas] @Pipe def get_error(datas): return [data[0][-16:] + \u0026#34; \u0026#34; + data[1] for data in datas] @Pipe def get_count(datas): result = dict() for data in datas: result[data] = result.get(data, 0) + 1 return result @Pipe def print_data(datas): for key, val in list(datas.items())[-8:]: print(key, val) if __name__ == \u0026#34;__main__\u0026#34;: datas = [] while True: try: data = input() if data == \u0026#34;\u0026#34;: break datas.append(data) except: break datas | split_data | get_error | get_count | print_data   ","date":"2023-05-06T20:20:30+08:00","permalink":"https://mkbooks.github.io/blog/p/%E7%89%9B%E5%AE%A2%E7%BD%91%E5%88%B7%E9%A2%98%E6%A8%A1%E6%9D%BF/","title":"牛客网刷题模板"},{"content":"使用子进程调用 Go 程序 将 Go 程序编译为可执行文件，然后在 Python 脚本中使用 subprocess 模块运行 Go 可执行文件。这是一种简单且通用的方法，但通信可能受到限制，因为它依赖于进程间通信（IPC）。\ngo程序 main.go\n1 2 3 4 5 6 7 8 9 10 11 12 13  package main import ( \u0026#34;fmt\u0026#34; ) func GoFunctiono() { fmt.Printf(\u0026#34;GoFunctiono\u0026#34;) } func main() { fmt.Printf(\u0026#34;cjx go\u0026#34;) }   使用 Python 调用 Go 程序 main.py\n1 2 3 4 5  import subprocess # 编译并运行 Go 程序 go_executable = \u0026#34;./main\u0026#34; subprocess.run([go_executable])   编译并运行 Go 程序\n1 2 3 4  go build -o main main.go ./main cjx go%   运行 Python 程序\n1 2  python main.py cjx go%   使用 C 扩展 将 Go 函数编译为 C 共享库，然后使用 Python 的 C 扩展（如 ctypes 或 cffi）调用该库。这种方法可能会增加复杂性，但在性能方面可能更优越。\ngo程序 main_c.go\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  package main import ( \u0026#34;C\u0026#34; \u0026#34;fmt\u0026#34; ) //export GoFunction func GoFunction() { fmt.Printf(\u0026#34;GoFunction\u0026#34;) } func main() {}   将 Go 函数编译为 C 共享库\n1  go build -o go_function.so -buildmode=c-shared main_c.go   cffi(性能好) cffi_go.py\n1 2 3 4 5 6  from cffi import FFI ffi = FFI() ffi.cdef(\u0026#34;void GoFunction();\u0026#34;) go_lib = ffi.dlopen(\u0026#34;./go_function.so\u0026#34;) go_lib.GoFunction()   运行 Python 程序\n1 2 3  python cffi_go.py GoFunctiono   ctypes(Python标准库) ctypes_go.py\n1 2 3 4  import ctypes go_lib = ctypes.CDLL(\u0026#34;./go_function.so\u0026#34;) go_lib.GoFunction()   运行 Python 程序\n1 2  python ctypes_go.py GoFunctiono   使用 gRPC 或其他 RPC 框架 创建一个 Go 服务并通过 gRPC（或其他 RPC 框架）公开函数，然后在 Python 中调用该服务。这种方法适用于跨语言和跨平台的通信，但可能需要额外的设置和依赖项。\n https://github.com/chenjinxin1124/grpc-python https://github.com/chenjinxin1124/grpc-go  ","date":"2023-04-25T14:10:00+08:00","permalink":"https://mkbooks.github.io/blog/p/python%E8%B0%83%E7%94%A8go%E7%A8%8B%E5%BA%8F/","title":"Python调用Go程序"},{"content":"C程序 mylib.c\n1 2 3 4 5  #include \u0026lt;stdio.h\u0026gt; int add(int a, int b) { return a + b; }   编译这个 C 文件为共享库：\n1  gcc -shared -o mylib.so mylib.c   cffi(性能好) 1  pip install cffi   cffi_c.py\n1 2 3 4 5 6 7 8 9 10 11 12 13  import cffi ffi = cffi.FFI() # 定义C函数的接口 ffi.cdef(\u0026#34;\u0026#34;\u0026#34; int add(int a, int b); \u0026#34;\u0026#34;\u0026#34;) # 加载动态链接库 lib = ffi.dlopen(\u0026#34;./mylib.so\u0026#34;) # 这里假设动态库名为test.so，需要将其放在与Python脚本同一目录下 # 调用C函数 result = lib.add(2, 3) print(result)   运行 Python 程序\n1 2 3  python cffi_c.py 5   ctypes(Python标准库) ctypes_c.py\n1 2 3 4 5 6 7 8 9 10 11 12  import ctypes # 加载库 mylib = ctypes.CDLL(\u0026#34;./mylib.so\u0026#34;) # 定义参数类型和返回值类型 mylib.add.argtypes = (ctypes.c_int, ctypes.c_int) mylib.add.restype = ctypes.c_int # 调用 C 函数 result = mylib.add(3, 4) print(f\u0026#34;3 + 4 = {result}\u0026#34;)   运行 Python 程序\n1 2 3  python ctypes_c.py 3 + 4 = 7   ","date":"2023-04-25T13:00:00+08:00","permalink":"https://mkbooks.github.io/blog/p/python%E8%B0%83%E7%94%A8c%E7%A8%8B%E5%BA%8F/","title":"Python调用C程序"},{"content":"油猴插件 脚本：\n https://github.com/xcanwin/KeepChatGPT/  ","date":"2023-04-23T00:00:00+08:00","permalink":"https://mkbooks.github.io/blog/p/chrom%E6%8F%92%E4%BB%B6/","title":"chrom插件"},{"content":"环境要求  Python 3.8 or later OpenAI GPT-3 API Key(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)  安装 下载Auto-GPT 1 2  git clone https://github.com/Torantulino/Auto-GPT.git cd Auto-GPT   切换到标签v0.1.1 1 2 3  git fetch --all --tags git tag git checkout v0.1.1   安装依赖 1  pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple --trusted-host mirrors.aliyun.com   运行Redis容器 1  docker run -d --name redis-stack-server -p 6379:6379 redis/redis-stack-server:latest   配置 1  cp .env.example .env   修改.env文件中的配置\n OPENAI_API_KEY: OpenAI GPT-3 API Key MEMORY_BACKEND=redis  REDIS_HOST=localhost REDIS_PORT=6379 REDIS_PASSWORD=    修改AI设置 1  cp ai_settings.yaml ai_settings.yaml.bak   添加待修改程序 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  touch auto_gpt_workspace/basic_math.py import math def calc_area(radius): return math.pi * radius**2 def calc_circumference(radius): radius = float(radius) def main(radius): try: radius = float(radius) except ValueError: print(\u0026#34;Please enter a valid number\u0026#34;) return area = calc_area(radius) circumference = calc_circumference(radius) print(\u0026#34;Area: \u0026#34;, area) print(\u0026#34;Circumference: \u0026#34;, circumference)   修改ai_settings.yaml 1 2 3 4 5 6 7 8  ai_goals:- \u0026#34;Denonstrate your new programming abilities!\u0026#34;- \u0026#34;Improve basic_math.py\u0026#34;- \u0026#34;Build and run tests for it\u0026#34;- \u0026#34;When the file is error free, shut yourself down\u0026#34;- \u0026#34;Be sure to write your outputs to file.\u0026#34;ai_name:NBGPTai_role:\u0026#34;Read, evaluate, improve write tests for and execute the code contained in basic_math.py\u0026#34;  运行 1  python3 scripts/main.py --gpt3only --continuous   ","date":"2023-04-16T21:22:00+08:00","permalink":"https://mkbooks.github.io/blog/p/%E4%BD%BF%E7%94%A8auto-gpt-v0.1.1/","title":"使用Auto-GPT v0.1.1"},{"content":"环境要求  Python 3.8 or later OpenAI GPT-3 API Key(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)  安装 下载Auto-GPT 1 2  git clone https://github.com/Torantulino/Auto-GPT.git cd Auto-GPT   安装依赖 1 2 3 4 5  pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple --trusted-host mirrors.aliyun.com 或 pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple --trusted-host pypi.tuna.tsinghua.edu.cn 或 pip install -r requirements.txt -i https://pypi.douban.com/simple --trusted-host pypi.douban.com   运行Redis容器 1  docker run -d -p 6379:6379 --name redis redis   配置 1  cp .env.example .env   修改.env文件中的配置\n OPENAI_API_KEY: OpenAI GPT-3 API Key MEMORY_BACKEND=redis  运行 1  python -m autogpt   ","date":"2023-04-16T20:48:00+08:00","permalink":"https://mkbooks.github.io/blog/p/%E4%BD%BF%E7%94%A8auto-gpt/","title":"使用Auto-GPT"},{"content":"文件内容查找 1  sudo grep -r --exclude=\u0026#34;*.log\u0026#34; --exclude=\u0026#34;*.pom\u0026#34; --exclude=\u0026#34;.zsh_history\u0026#34; --exclude-dir=.vscode --exclude-dir=wise-projects --exclude-dir=go --exclude-dir=maven --exclude-dir=temp --exclude-dir=.gradle --exclude=\u0026#34;*.xml\u0026#34; --exclude=\u0026#34;*.tar\u0026#34; --exclude-dir=\u0026#34;images\u0026#34; \u0026#34;JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64\u0026#34; /etc 2\u0026gt;/dev/null   output:\n1  /etc/profile:export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64   这是一个在Linux系统中使用sudo命令搜索文件内容的命令。该命令的作用是在/etc目录下搜索包含\u0026quot;JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64\u0026quot;字符串的文件内容，但是排除了一些文件类型和目录。具体的参数解释如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  sudo: 表示以管理员权限运行该命令。 grep: 用于在文件中查找匹配的字符串。 -r: 表示递归搜索子目录。 --exclude=\u0026#34;*.log\u0026#34;: 排除所有后缀为.log的文件。 --exclude=\u0026#34;*.pom\u0026#34;: 排除所有后缀为.pom的文件。 --exclude=\u0026#34;.zsh_history\u0026#34;: 排除所有名为.zsh_history的文件。 --exclude-dir=.vscode: 排除名为.vscode的子目录。 --exclude-dir=wise-projects: 排除名为wise-projects的子目录。 --exclude-dir=go: 排除名为go的子目录。 --exclude-dir=maven: 排除名为maven的子目录。 --exclude-dir=temp: 排除名为temp的子目录。 --exclude-dir=.gradle: 排除名为.gradle的子目录。 --exclude=\u0026#34;*.xml\u0026#34;: 排除所有后缀为.xml的文件。 --exclude=\u0026#34;*.tar\u0026#34;: 排除所有后缀为.tar的文件。 --exclude-dir=\u0026#34;images\u0026#34;: 排除名为images的子目录。 \u0026#34;JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64\u0026#34;: 要搜索的字符串。 /etc: 要搜索的目录。 2\u0026gt;/dev/null: 将错误信息输出到空设备，即不输出任何错误信息。   ","date":"2023-03-22T17:00:00+08:00","permalink":"https://mkbooks.github.io/blog/p/grep-%E4%BD%BF%E7%94%A8/","title":"grep 使用"},{"content":"网站 https://civitai.com/\n模型介绍 模型: ChilloutMix Generation Data 1 2 3  masterpiece, best quality, (realistic, photo-realistic:1.4), (RAW photo:1.2), extremely detailed CG unity 8k wallpaper, an extremely delicate and beautiful, amazing, finely detail, official art, absurdres, incredibly absurdres, huge filesize, ultra-detailed, extremely detailed, beautiful detailed girl, extremely detailed eyes and face, beautiful detailed eyes, light on the face, 1girl, short hair, solo, cute, looking at the viewer, (perfect female figure), slim waist, full body, thigh, showing feet, large breasts, standing, lingerie, micro skirt, miniskirt, off-shoulder sleeve, navel, midriff, sleeveless shirt, bare arms Negative prompt: (worst quality:2), (low quality:2), (normal quality:2), lowres, ((monochrome)), ((grayscale)), paintings, sketches, skin spots, acnes, skin blemishes, bad anatomy,facing away, looking away,tilted head,lowres,bad anatomy,bad hands, text, error, missing fingers,extra digit, fewer digits, blurry,bad feet,cropped,poorly drawn hands,poorly drawn face,mutation,deformed,worst quality,low quality,normal quality,jpeg artifacts,signature,watermark,extra fingers,fewer digits,extra limbs,extra arms,extra legs,malformed limbs,fused fingers,too many fingers,long neck,cross-eyed,mutated hands,polar lowres,bad body,bad proportions,gross,ng_deepnegative_v1_75t Size: 640x720, Seed: 340437954, Model: chilloutmix_NiPrunedFp32Fix, Steps: 30, hashes: [object Object], Sampler: DPM++ SDE Karras, CFG scale: 7, Clip skip: 2, Mask blur: 4, Model hash: fc2511737a, Face restoration: CodeFormer, Denoising strength: 0.7   1 2 3  (((beautiful anatomy hands and fingers))), 8K RAW photo, ultra highres, professional lighting, photon mapping, radiosity, physically-based rendering, best quality, (photorealistic:1.2), 1girl, (ulzzang-6500:0.7), kpop idol, yae miko, memegirl, marie rose, chunmomo,hanfu, torn clothes, ((bare breasts, medium breasts, puffy nipples)),pussy, nsfw, shaved vagina, sexy pose, long hair, (multicolored hair:1.2),(red_hair|pink_hair:0.5), (hair ornament:1.35), blue eyes, extremely_detailed_eyes_and_face,detailed face,earrings, detailed face, face focus, (looking at viewer:1.25), shiny skin, smile, thick lips, game cg, torii, cherry blossoms, lantern light, depth of field, east asian architecture, blurry background, close-up to face,portrait, (naked) Negative prompt: (((bra))), ((apron)),((panties)),(extra fingers,fewer fingers,strange fingers,bad anatomy, bad hands, sleeves),EasyNegative, paintings, sketches, (worst quality:2), (low quality:2), (normal quality:2), lowres, normal quality, ((monochrome)), ((grayscale)), skin spots, acnes, skin blemishes, age spot, glans, Size: 496x800, Model: chilloutmix_NiPrunedFp32Fix, Steps: 30, hashes: [object Object], Sampler: DPM++ 2M Karras, CFG scale: 7, Mask blur: 4, Model hash: fc2511737a, Denoising strength: 0.75   1 2 3  \u0026lt;lora:shan3:1\u0026gt;, by shanshan, 85mm lens, 1girl, 3d, bikini_tan, blonde_hair, breasts, female_pubic_hair, grin, lips, long_hair, looking_at_viewer, medium_breasts, navel, nipples, nose, nude, photorealistic, pussy, realistic, smile, solo, standing, tanlines, teeth, window Negative prompt: ugly,bad_anatomy,bad_hands,extra_hands,missing_fingers,broken hand,more than two hands,well proportioned hands,more than two legs,unclear eyes,missing_arms,mutilated,extra limbs,extra legs,cloned face,fused fingers,extra_digit, fewer_digits,extra_digits,jpeg_artifacts,signature,watermark,username,blurry,large_breasts,worst_quality,low_quality,normal_quality,mirror image, Vague, paintings, sketches, (worst quality:2), (low quality:2), (normal quality:2), lowres, normal quality, ((monochrome)), ((grayscale)), skin spots, acnes, skin blemishes, age spot Size: 512x944, Seed: 2395123447, Model: chilloutmix_NiPrunedFp32Fix, Steps: 20, hashes: [object Object], Sampler: DPM++ SDE Karras, CFG scale: 7, Mask blur: 4, Model hash: fc2511737a, Denoising strength: 0.75   1 2 3 4  1girl,\u0026lt;lora:koreanDollLikeness_v10:0.2\u0026gt;, \u0026lt;lora:taiwanDollLikeness_v10:0.2\u0026gt;,natural day light, best quality ,masterpiece, illustration, an extremely delicate and beautiful, extremely detailed ,CG ,unity ,8k wallpaper, Amazing, finely detail, masterpiece,best quality,extremely detailed CG unity 8k wallpaper,absurdres, incredibly absurdres, huge filesize , ultra-detailed, highres, extremely detailed, beautiful detailed girl, extremely detailed eyes and face, beautiful detailed eyes, (RAW photo, best quality), (realistic, photo-realistic:1.3), light on face, ((full body)),((standing)), white dress, black pantyhose, red high heels,long hair, red hair,smille, Negative prompt: (low quality:1.5), (worst quality:1.5),lowres, bad anatomy, bad hands, (((text))), error, missing fingers, extra digit, fewer digits, cropped, worst quality,normal quality,jpeg artifacts, signature, watermark, username, blurry, (((deformed))), (blurry), bad anatomy, disfigured, poorly drawn face,mutated,(ugly), (poorly drawn hands), messy drawing, broken legs, (((distorted hands))),((disfigured)), ((bad art)), ((deformed)),((extra limbs)),((b\u0026amp;w)), ((morbid)), ((mutilated)), extra fingers, mutated hands, ((poorly drawn hands)), ((poorly drawn face)), (((mutation))), (((deformed))), ((ugly)), blurry, ((bad anatomy)), (((bad proportions))),cloned face, (((disfigured))), out of frame, ugly,gross proportions, (malformed limbs), (((extra arms))), (((extra legs))), mutated hands, (((fused fingers))), (too many fingers), (((long neck))),tiling, poorly drawn hands, poorly drawn feet, poorly drawn face, out of frame, mutated,disfigured, deformed, cross-eye, body out of frame, blurry, bad art,signature, monster, animal, big nipples, ((distorted boobs)),rib cage, (worst quality, (low quality:1.4), ((bad art)), ((b\u0026amp;w)), blurry,tiling, body out of frame, out of frame, gross proportions,signature,(malformed limbs),(((extra feet))), poorly drawn feet, ((poorly drawn hands)), (((distorted hands))), (((extra hands))), ((mutated hands)), (((fused fingers))), (((too many fingers))), ((extra fingers)), ((extra digit)), ((poorly drawn face)), cloned face, (((long neck))), ((distorted boobs)), horse coat,bad anatomy, bad hands, extra digit, fewer digits, cropped, worst quality,jpeg artifacts,signature, watermark, username, blurry,multiple breasts, (mutated hands and fingers:1.5), (long body :1.3),poorly drawn: 1.2), black-white, bad anatomy,liquid body, liquid tongue, disfigured,malformed,mutated, anatomical nonsense, malformed hands, long neck, blurred. lowers, lowers, bad anatomy, bad proportions, bad shadow, uncoordinated body, unnatural body, fused breasts, bad breasts,poorly drawn breasts, extra breasts,missing breasts, huge haunch, huge thighs, huge calf, bad hands, fused hand, missing hand, disappearing a arms, disappearing thigh, disappearing calf, disappearing legs, fused ears, bad ears, poorly drawn ears, extra ears, liquid ears, heavy ears, missing ears, fused animal ears, bad animal ears, poorly drawn animal ears, extra animals ears,liquid animal ears, heavy animal ears, missing animal ears, missing limb, fused fingers, one hand with more than 5 fingers, one hand with less than 5 fingers, one hand with more than 5 digit, one hand with less than 5 digit, extra digit, fewer digits, fused digit, missing digit, bad digit, liquid digit, colorful tongue, black tongue, cropped, watermark, username, blurry, JPEG artifacts, signature,malformed feet, extra feet, bad feet, poorly drawn feet, fused feet, missing feet, extra shoes, bad shoes, fused shoes, more than two shoes, poorly drawn shoes, bad gloves, poorly drawn gloves, fused gloves, bad cum, poorly drawn cum, fused cum, , bad hairs, poorly drawn hairs, fused hairs, big muscles, ugly, bad face, fused face, poorly drawn face, cloned face, big face, long face, bad eyes, fused eyes, poorly drawn eyes, extra eyes, malformed limbs, more than 2 nipples, missing nipples, different nipples, fused nipples, bad nipples, poorly drawn nipples, black nipples, colorful nipples, gross proportions, short arm, (((missing arms))), missing thighs, missing calf,poorly drawn hands, more than 1 left hand, more then 1 right hand, deformed, (blurry), disfigured, missing legs,extra thighs, more than 2 thighs, extra calf, fused calf, bad knee, extra knee, more than 2 legs, bad tails, bad mouth, fused mouth, poorly drawn mouth, bad tongue, tongue within mouth, too long tongue, black tongue, big mouth, cracked mouth, bad mouth, dirty face, dirty teeth,fused pantie, poorly drawn pantie, fused cloth, poorly drawn cloth, bad pantie, yellow teeth, thick lips, bad cameltoe, bad asshole, fused asshole,missing asshole, bad anus,fused anus,bad pussy, bad crotch, bad crotch seam, fused anus, fused pussy, fused anus, fused crotch, poorly drawn cotch, fused seam, poorly drawn anus, poorly drawn pussy, poorly drawn crotch, poorly drawn crotch seam, bad thigh gap, missing thigh gap, fused thigh gap, liquid thigh gap , poorly drawn thigh gap, poorly drawn anus, bad collarbone, strong girl obesity,worst quality,poorly drawn tentacles, split tentacles, missing clit, bad clit, fused clit, colorful clit, black clit,safety knickers, beard, furry, pony, pubic hair, mosaic, excrement, faeces, shit,testis, (worst quality),(bad anatomy),sweat, wet,fangs, watermarks, artist logo, logo, blood on face, (bloody face),((apron)),EasyNegative, paintings, sketches, (worst quality:2), (low quality:2), ((monochrome)), ((grayscale)), skin spots, acnes, skin blemishes, age spot, glans (low quality:2), (normal quality:2), lowres, normal quality, ((monochrome)), ((grayscale)), skin spots, acnes, skin blemishes,(((two girls))) Size: 704x1024, Seed: 2, Model: chilloutmix_NiPrunedFp32Fix, Steps: 30, hashes: [object Object], Sampler: DPM adaptive, CFG scale: 7, Model hash: fc2511737a   1 2 3  big finger in water Negative prompt: bad-picture-chill-75v, (bad anatomy:1.1), (bad fingers:1.3), ugly Size: 300x300, Seed: 2531046818, Model: chilloutmix_NiPrunedFp32Fix, Steps: 20, hashes: [object Object], Sampler: DPM++ 2M Karras, CFG scale: 5, Mask blur: 4, Model hash: fc2511737a, Denoising strength: 0.4   1 2 3 4 5  photo of a beautiful woman, dancing, perfect face, pumps heels, see-through tight mini skirt, patterned_pantyhose, exquisite shoes, best quality, ultra high res, photo realism, (high detail:1.11), octane render, unreal engine, 8k, hyper realistic, trending on artstation Negative prompt: easynegative, bad-image-v2-39000, (bad_prompt_version2:0.8), cross-eyed, worst quality, lowres, hermaphrodite, cropped, not in the frame, additional faces, jpeg large artifacts, jpeg small artifacts, ugly, tiling, poorly drawn hands, poorly drawn feet, poorly drawn face, out of frame, extra limbs, disfigured, deformed, body out of frame, blurry, bad anatomy, blurred, watermark, grainy, signature, cut off, draft, not finished drawing, unfinished image, bad eyes, doll, 3d, cartoon, (bad eyes:1.2), (worst quality:1.2), (low quality:1.2),, easynegative, bad-image-v2-39000, (bad_prompt_version2:0.8), cross-eyed, worst quality, lowres, hermaphrodite, cropped, not in the frame, additional faces, jpeg large artifacts, jpeg small artifacts, ugly, tiling, poorly drawn hands, poorly drawn feet, poorly drawn face, out of frame, extra limbs, disfigured, deformed, body out of frame, blurry, bad anatomy, blurred, watermark, grainy, signature, cut off, draft, not finished drawing, unfinished image, bad eyes, doll, 3d, cartoon, (bad eyes:1.2), (worst quality:1.2), (low quality:1.2), Size: 768x1024, Seed: 2791946702, Model: z_chilloutmix-Ni, Steps: 35, hashes: [object Object], Sampler: DPM++ SDE Karras, CFG scale: 7, Model hash: 7234b76e42, Face restoration: CodeFormer   1 2 3  (Nude:1.2), 8K RAW photo, ultra highres, professional lighting, photon mapping, radiosity, physically-based rendering, best quality, (photorealistic:1.2), 1girl, (ulzzang-6500:0.7), kpop idol, yae miko, memegirl, marie rose, hanfu, torn clothes, ((bare breasts, medium breasts, puffy nipples)), sexy pose, beautiful anatomy finger, long hair, (multicolored hair:1.2),(red_hair|pink_hair:0.5), (hair ornament:1.35), blue eyes, extremely_detailed_eyes_and_face,detailed face,earrings, detailed face, face focus, (looking at viewer:1.25), shiny skin, smile, thick lips, game cg, torii, cherry blossoms, lantern light, depth of field, east asian architecture, blurry background,(pussy), nsfw, shaved vagina ,close-up to face,portrait, (naked) Negative prompt: (((bra))), ((apron)),((panties)),(extra fingers,fewer fingers,strange fingers,bad anatomy, bad hands, sleeves),EasyNegative, paintings, sketches, (worst quality:2), (low quality:2), (normal quality:2), lowres, normal quality, ((monochrome)), ((grayscale)), skin spots, acnes, skin blemishes, age spot, glans, Size: 500x800, Model: chilloutmix_NiPrunedFp32Fix, Steps: 30, hashes: [object Object], Sampler: DPM++ 2M Karras, CFG scale: 7, Model hash: fc2511737a   模型: Deliberate Generation Data 1 2 3  a closeup portrait of a playful maid, undercut hair, apron, amazing body, pronounced feminine feature, busty, kitchen, [ash blonde | ginger | pink hair], freckles, flirting with camera Negative prompt: (deformed, distorted, disfigured:1.3), poorly drawn, bad anatomy, wrong anatomy, extra limb, missing limb, floating limbs, (mutated hands and fingers:1.4), disconnected limbs, mutation, mutated, ugly, disgusting, blurry, amputation. tattoo ENSD: 31337, Size: 768x1024, Seed: 1804518985, Model: Deliberate, Steps: 30, Sampler: DPM++ 2M Karras, CFG scale: 6.5, Model hash: 9aba26abdf   1 2 3  award-winning photo of a 25 years old fantasy girl, outside, in front of mountains, full height photo, ((standing firm, spread legs)), ((black fantasy shoulders, black choker, black fantasy gauntlets, white fishnet stockings)), (((ash-white undercut hair, curly hair, tanned skin))), realistic, (((perfect body, big perfect breast, naked breasts, perky, pointy nipples))), seductive smile, perky nipples, ((juicy lips, sexy lips, seductive lips)) Negative prompt: umbrella, umbrellas, canvas frame, cartoon, 3d, ((disfigured)), ((bad art)), ((deformed)),((extra limbs)),((close up)),((b\u0026amp;w)), wierd colors, blurry, (((duplicate))), ((morbid)), ((mutilated)), [out of frame], extra fingers, mutated hands, ((poorly drawn hands)), ((poorly drawn face)), (((mutation))), (((deformed))), ((ugly)), blurry, ((bad anatomy)), (((bad proportions))), ((extra limbs)), cloned face, (((disfigured))), out of frame, ugly, extra limbs, (bad anatomy), gross proportions, (malformed limbs), ((missing arms)), ((missing legs)), (((extra arms))), (((extra legs))), mutated hands, (fused fingers), (too many fingers), (((long neck))), Photoshop, video game, ugly, tiling, poorly drawn hands, poorly drawn feet, poorly drawn face, out of frame, mutation, mutated, extra limbs, extra legs, extra arms, disfigured, deformed, cross-eye, body out of frame, blurry, bad art, bad anatomy, 3d render, blurry eyes, asian Size: 768x1024, Seed: 675418633, Model: deliberate_v2, Steps: 30, hashes: [object Object], Sampler: DPM++ SDE Karras, CFG scale: 7, Model hash: 9aba26abdf   1 2 3  photograph of a gorgeous 20 year old russian woman with small breasts powder blue hair wearing a (split:0.8) (see-through:1.1) (powder blue flowing dress:1.3) off one shoulder exposing her breast, with delicate (fairy wings:1.2), (looking at camera:1.1), biting her lip, raining, (on a neon cyberpunk street:1.3), proudly standing next to a nude portait of herself, by studio ghibli, masterpiece, 85mm, barefoot, (nsfw:1.1), (natural lighting:0.8), 8k, ((realistic)), Negative prompt: (ng_deepnegative_v1_75t:0.7), necklace, jewellery, bruises Size: 512x768, Seed: 2662954953, Model: deliberate_v2, Steps: 66, hashes: [object Object], Sampler: Euler a, CFG scale: 10, Model hash: 9aba26abdf, Face restoration: CodeFormer   1 2 3  very attractive Beautiful nude model girl, (full body),nude Exciting 20yo european girl in the loincloth,((((scowling: 1.9)))),((PUSSY)), ((stocking)), ((white woman)),angelic woman, young woman gothic vampire, (perfect breast),((outdoor)), (river), ((NUDE)), nsfw, 8k, GIRL, ((PERFECT FACE)), ((DETAILED PUPILS)), ((FULL BODY)) ,FEMININE, (HIGH DETAIL), LONG HAIR, dominate, best quality, full body shot,high quality, realistic lighting, , wearing a bondage harness, topless,((NYLON)), ((NAKED)) symmetrical natural eyes, fascinating makeup,long legs, pale skin, stunning lady, sensual mouth, natural eyes, beautiful realistic face, glamour photo, vogue style, front lit, RAW, detailed facial features, high detail, sharp focus, smooth, aesthetic, extremely detailed, photo_\\(ultra\\), photorealistic, realistic, post-processing, max detail, roughness, real life, ultra realistic, photorealism, photography, 8k uhd, photography, perfect hands, nipples, nude pussy, french manicure, lake Negative prompt: pubic hair not visible, animal ears, child, childish, large breasts, large boobs, text, logo, ((big hands, un-detailed skin, semi-realistic, cgi, 3d, render, sketch, cartoon, drawing, anime)), ((ugly mouth, ugly eyes, missing teeth, crooked teeth, close up, cropped, out of frame)), worst quality, low quality, jpeg artifacts, ugly, duplicate, morbid, mutilated, extra fingers, mutated hands, poorly drawn hands, poorly drawn face, mutation, deformed, blurry, dehydrated, bad anatomy, bad proportions, extra limbs, cloned face, disfigured, gross proportions, malformed limbs, missing arms, missing legs, extra arms, extra legs, fused fingers, too many fingers, long neck,(more than two arm per body:1.5), (more than two leg per body:1.5), (more than five fingers on one hand:1.5), multi arms, multi legs, bad arm anatomy, bad leg anatomy, bad hand anatomy, bad finger anatomy, bad detailed background, unclear architectural outline, non-linear background, elf-ears, hair crosses the screen border, obesity, fat, lowres, worst quality, low quality, blurry, mutated hands and fingers, disfigured, fused, cloned, duplicate, artist name, giantess, odd eyes, long fingers, long neck, watermarked, Size: 768x1024, Seed: 2774535475, Model: deliberate_v2, Steps: 25, Sampler: Euler a, CFG scale: 7, Model hash: 9aba26abdf, Face restoration: CodeFormer   模型: Perfect World 完美世界 Generation Data 1 2 3  ultra realistic 8k cg, picture-perfect face, flawless, clean, masterpiece, professional artwork, famous artwork, cinematic lighting, cinematic bloom, perfect face, beautiful face, beautiful eyes, ((perfect female body, narrow waist)), black hair, gorgeous queen, royal, divine, goddess, godlike, (royal palace), fantasy, dreamlike, unreal, science fiction, huge breasts, beautiful clothes, lace, lace trim, lace-trimmed legwear, nsfw, breasts out, absurdly long hair, very long hair, (rich:1.4), prestige, luxury, jewelry, diamond, gold, pearl, gem, sapphire, ruby, emerald, intricate detail, delicate pattern, sexy, charming, alluring, seductive, erotic, enchanting, hair ornament, necklace, earrings, bracelet, armlet, Negative prompt: (worst quality, low quality:1.3), simple background, logo, watermark, text Size: 512x768, Seed: 3157911442, Model: Baked_GF2+BM+AOM3_20-30-50, Steps: 80, Sampler: Euler a, CFG scale: 7, Clip skip: 2, Model hash: 79e42fb744, Hires upscale: 2, Hires upscaler: Latent (bicubic antialiased), Denoising strength: 0.5   1 2 3  ultra realistic 8k cg, picture-perfect face, flawless, clean, masterpiece, professional artwork, famous artwork, cinematic lighting, cinematic bloom, perfect face, beautiful face, beautiful eyes, ((perfect female body, narrow waist)), white hair, red eyes, gorgeous queen, royal, divine, goddess, godlike, (royal palace), fantasy, dreamlike, unreal, science fiction, huge breasts, beautiful clothes, lace, lace trim, lace-trimmed legwear, nsfw, breasts out, absurdly long hair, very long hair, (rich:1.4), prestige, luxury, jewelry, diamond, gold, pearl, gem, sapphire, ruby, emerald, intricate detail, delicate pattern, sexy, charming, alluring, seductive, erotic, enchanting, hair ornament, necklace, earrings, bracelet, armlet, Negative prompt: (worst quality, low quality:1.3), simple background, logo, watermark, text Size: 1024x1536, Seed: 3847885752, Model: PW2, Steps: 25, Sampler: Euler a, CFG scale: 7, Clip skip: 2, Mask blur: 4, Model hash: 79e42fb744, Denoising strength: 0.66   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  awaitingtongue, corneo_cowgirl (ultra high res,photorealistic,realistic,best quality,photo-realistic), (8k, raw photo, best quality, masterpiece), ((nsfw)), (photon mapping, radiosity, physically-based rendering,automatic white balance), technological sense, best quality, masterpiece, illustration,CG ,unity ,wallpaper, official art, Amazing, finely detail, an extremely delicate and beautiful,extremely detailed, highly detailed, sharp focus,rich background,blurry background, (real person,photograph), (((high detailed skin,visible pores))), (((face close-up,haunting smile,moist lips,short hair))), ((irises and pupils are rounded,the pupil reflects the surroundings,eyes are not the same size)), ((Big eyes,perfect eyes,watery eyes)), ((white hair,high ponytail,thick bangs)), ((((small breasts)))),white skin,bare shoulders,((white dress)), Negative prompt: nsfw,(worst quality:1.7),(low quality:1.6),(normal quality:1.5),lowres,blurry,simple background,jpeg artifacts,bad-artist,bad shadow,compressed image,low pixel,light spot, paintings,sketches,((monochrome)),((grayscale)),noise point,semi-realistic,3d,render,cg,drawing,cartoon,anime,comic,username,watermark,signature,cropped,error,censored,text,stain, deformed iris,deformed pupils,deformed nail,deformed ear,deformed eye,deformed eyelid,collapsed eyeshadow, [excessive skin spots,excessive skin imperfections,skin blemishes,skin fold,rough skinstain skin],goosebumps,skin layering,axillary fold,facial contortion, bad-hands-5,bad-image-v2-39000,bad_prompt,bad_prompt_version2,EasyNegative,NG_DeepNegative_V1_75T, jewelry,rings, earrings, necklaces,teeth,(flawless face),trimming, Size: 1024x1376, Seed: 2903109138, Model: perfectWorld_v2Baked, Steps: 50, hashes: [object Object], Sampler: DPM++ SDE Karras, CFG scale: 7, Mask blur: 4, Model hash: 79e42fb744, Denoising strength: 0.5   1 2 3 4 5 6 7 8 9  ultra realistic 8k cg, picture-perfect face, flawless, clean, masterpiece, professional artwork, famous artwork, cinematic lighting, cinematic bloom, 1girl, 2boys, large penis, (anal sex:1.4), fellatio, bent over, cum, cum in pussy, facial, dripping cum, pussy juice, thighhighs, full body, penis, testicles, breasts,danglingspitroastms,nsfw, thick thighs,wide hips,huge thighs, full body , large breasts, perfect face, beautiful face, beautiful eyes, ((perfect female body, narrow waist)), white hair, red eyes, open mouth (orgasm, screaming), (pain), heavy breathing, blush, crying tears, (cross-eyed:1.4), looking up Negative prompt: (worst quality, low quality:1.4), monochrome, zombie, extra limbs, Size: 768x512, Seed: 1596746753, Model: perfectWorld_v2Baked, Steps: 24, hashes: [object Object], Sampler: Euler a, CFG scale: 7, Clip skip: 2, Model hash: 79e42fb744, Hires steps: 10, Hires upscale: 2, Hires upscaler: R-ESRGAN 4x+, Denoising strength: 0.3   1 2 3  (Masterpiece), (best quality), (absurdres), (1girl),mature women,wallpaper quality,extremely detailed, intricate details, goddess, pigtail, feathered black wings, perfect body, wide hips, large breasts,((nsfw)), damaged clothed((nipples)),embarrassed,holding magic ward,standing,\u0026lt;lora:hipoly3DModelLora_v10:0.2\u0026gt; Negative prompt: Negatives: painting, sketches, (worst quality:2), (low quality:2), (normal quality:2), lowres, normal quality, ((monochrome)), ((grayscale)), skin spots, acne, skin blemishes, age spot, (outdoor:1.6), manboobs, backlight, (ugly:1.331), (duplicate:1.331), (mutilated:1.21), (tranny:1.331), mutated hands, (poorly drawn hands:1.331), (bad anatomy:1.21), (bad proportions:1.331), extra limbs, (disfigured:1.331), (more than 2 nipples:1.551), (missing arms:1.331), (extra legs:1.331), (fused fingers:1.61051), (too many fingers:1.61051), (unclear eyes:1.331), bad hands, missing fingers, extra digit, (futa:1.1), bad body,glans, boring background, bad-artist-anime, bad-artist, cropped, lowres, text, jpeg artifacts, signature, watermark, username, trademark, title, multiple view, Reference sheet, (child, child like), boring background, (muscles), (muscular), bad-hands-5, bad_prompt_version2, (fat:1.4), ng_deepnegative_v1_75t, EasyNegative, bottomless, no panties, tail, 2girls, bunny ears, 6 pack, muscular, long body Size: 1024x1536, Seed: 1692500435, Model: perfectWorld_v2Baked, Steps: 32, hashes: [object Object], Sampler: DPM++ SDE Karras, CFG scale: 15, Model hash: 79e42fb744   1 2 3  \u0026lt;lora:yelanLoraCollectionOf_yelanHard:1\u0026gt;,ultra realistic 8k cg, masterpiece, ((ultra detailed background, delicate pattern, intricate detail)), sitting, formal, serious, (displeased:1.5, anrgy, upset, head tilt), cursed, dark fantasy, (hair over one eye), (((malevolent shrine, dark water, night, red moon))), looking at viewer, huge breasts, lace, lace trim, lace-trimmed legwear, Negative prompt: (worst quality, low quality:1.3), logo, watermark, text, Size: 512x768, Seed: 3329439271, Model: perfectWorld_v2Baked, Steps: 25, hashes: [object Object], Sampler: Euler a, CFG scale: 6.5, Model hash: 79e42fb744, Hires upscale: 2, Hires upscaler: Latent, Denoising strength: 0.66   1 2 3 4 5 6 7  ultra realistic 8k cg, picture-perfect face, flawless, clean, masterpiece, professional artwork, famous artwork, cinematic lighting, cinematic bloom, perfect face, beautiful face, beautiful eyes, ((perfect female body, narrow waist)), white hair, red eyes, huge breasts, beautiful clothes, nsfw, breasts out, absurdly long hair, very long hair, large insertion, (tentacles anal), many (tentacles), (tentacle bdsm), (tentacle sex), belly bulge, cum, red eyes, legs up, clitoris, arms up, lower body up, (rich:1.4), prestige, luxury, jewelry, diamond, gold, pearl, gem, sapphire, ruby, emerald, intricate detail, delicate pattern, sexy, charming, alluring, seductive, erotic, enchanting, hair ornament, necklace, earrings, bracelet, armlet, gorgeous queen, royal, divine, goddess, godlike, (royal palace), fantasy, dreamlike, unreal, science fiction, Negative prompt: (worst quality, low quality:1.3), simple background, logo, watermark, text Size: 512x768, Seed: 3863176697, Model: perfectWorld_v2Baked, Steps: 35, Sampler: Euler a, CFG scale: 7, Clip skip: 2, Model hash: 79e42fb744, Hires upscale: 2, Hires upscaler: Latent (bicubic antialiased), Denoising strength: 0.5   1 2 3  unparalleled masterpiece, ultra realistic 8k CG, perfect artwork, ((perfect female figure)), (pink hair:1.5,huge breasts:1.6), ((white thighhigh:1.75,wedding dress:1.6)),(((nude:1.8))),(on bed:1.5),best quality,ultra high res,(photo realistic:1.4),1girl, indoors,(completely nude:1.4),shibari, (spread legs:1.5), bodysuit, perfect artwork, picture-perfect face, perfect face, beautiful face, ((perfect female body)), (jewelry,charming, seductive, erotic, alluring, enchanting, mature female, narrow waist, gorgeous goddess, deity, divine queen, absurdly long hair),((intricate detail, delicate pattern)),(spotlight, perfect lighting, detailed light, dramatic shadow, ray tracing), (body dripping with sweat:1.6), (huge breasts:1.4,puffy nipples:1.4),cute, young, Japanese, (high heel:1.5),glowing eyes,\u0026lt;lora:fashionGirl_v20SmallFileSize:0.35\u0026gt;,(shiny body:1.6),(sweat:1.6), \u0026lt;lora:seraphineee_v10:0.65\u0026gt;,(wet clothes), Negative prompt: (worst quality, low quality:1.4), (fuze:1.4), (worst quality:1.1), (low quality:1.4:1.1), lowres, bad anatomy, (bad hands), text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurrypolar,bad body,bad proportions,gross proportions,text,error,missing fingers, missing arms,missing legs, extra digit, extra fingers,fewer digits,extra limbs,extra arms,extra legs,malformed limbs,fused fingers,too many fingers,long neck,cross-eyed,mutated hands, cropped,poorly drawn hands,poorly drawn face,mutation,deformed,worst quality,low quality, normal quality, blurry,ugly,duplicate,morbid,mutilated,out of frame, body out of frame,, (worst quality, low quality:1.4), (fuze:1.4), (worst quality:1.1), (low quality:1.4:1.1), lowres, bad anatomy, bad hands, text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, Size: 512x768, Seed: 1824898258, Model: perfectWorld_v1Baked, Steps: 25, Sampler: DPM++ 2M Karras, CFG scale: 8, Clip skip: 2, Hires steps: 20, Hires upscale: 2, Hires upscaler: Latent, Denoising strength: 0.5   1 2 3  ultra realistic 8k cg, standing, from above, completely nude, epic, perfect artwork, masterpiece, picture-perfect face, perfect face, beautiful face, ((perfect female body)), sexy, charming, seductive, erotic, alluring, enchanting, nsfw, mature female, narrow waist, absurdly long hair, glowing eyes, piercing eyes, looking away, large breasts, puffy nipples, breasts out, black hair, arms up, ((intricate detail)), pussy juice, indoors, \u0026lt;lora:koreanDollLikeness_v10:0.2\u0026gt;, ultra realistic 8k cg, standing, from above, completely nude, epic, perfect artwork, masterpiece, picture-perfect face, perfect face, beautiful face, ((perfect female body)), sexy, charming, seductive, erotic, alluring, enchanting, nsfw, mature female, milf, narrow waist, deity, divine queen, absurdly long hair, glowing eyes, piercing eyes, looking at viewer, large breasts, puffy nipples, breasts out, black hair, ((intricate detail)), science fiction, pussy juice, indoors, \u0026lt;lora:koreanDollLikeness_v10:0.2\u0026gt; Negative prompt: (worst quality, low quality:1.3), logo, watermark, signature, text, bad-hands-5, (worst quality, low quality:1.3), logo, watermark, signature, text Size: 512x768, Seed: 1048440739, Model: perfectworld, Steps: 21, Sampler: DPM++ 2M Karras, CFG scale: 7, Clip skip: 2, Model hash: 79e42fb744, Hires upscale: 2, Hires upscaler: Latent, Denoising strength: 0.7   1 2 3  \u0026lt;lora:fashionGirl_v20SmallFileSize:0.8\u0026gt; unparalleled masterpiece, ultra realistic 8k CG, perfect artwork, ((perfect female figure)), mature female, milf, narrow waist, chinese deity, looking at viewer, seductive posture, sexy pose, alluring, clean, beautiful face, pure face, pale skin, absurdly long hair, (huge breasts, nsfw, breasts out, puffy nipples), divine goddess, shiny skin, skindentation, lace, lace trim, lace-trimmed legwear, delicate pattern, intricate detail, (rich:1.4), prestige, gorgeous, luxury, royal palace, jewelry, gem, gold, silver, diamond, glint, sapphire, ruby, emerald, pearl, amber, obsidian Negative prompt: (worst quality, low quality:1.3), makeup, mole under eye, mole, logo, watermark, text Size: 512x824, Seed: 619488560, Model: perfectWorld_v2Baked, Steps: 30, Sampler: DPM++ 2M Karras, CFG scale: 7, Model hash: 79e42fb744   1 2 3 4 5 6 7 8 9 10 11 12 13  8k wallpaper, {{{masterpiece}}}, detailed cloth texture, ulzzang-6500-v1.1, physically-based rendering,detailed background, depth of field, (best quality, masterpiece:1.2), photorealistic,(cinematic composition:1.3), ultra high res, cinematic lighting, ambient lighting, sidelighting, Exquisite details and textures, stained glass,professional lighting, photon mapping, radiosity, Caucasian,white skin, ((cleavage)),slim body,((perfect female figure)),divine goddess,((Long legs, chopstick legs)),(large areola), (((long_hair,A ridiculous amount of hair,Pale gold, ponytail))), detailed face,beautiful face, pure face, shiny skin, skindentation,Face highlights, sophisticated makeup,blush, (Face close-up, smile, gentle eyes, big eyes, pink eyeliner, bags under the eyes), earrings, thigh_strap, (flight attendant uniform,black), (((white Silk stockings:1.2))), black high heel,((No bra, no panties), (((full body))), solo,(sitting,), ((airport, lounge)), \u0026lt;lora:stLouisLuxuriousWheels_v1:0.4\u0026gt; \u0026lt;lora:fashionGirl_v50:0.4\u0026gt; \u0026lt;lora:shojovibe_v11:0.4\u0026gt; \u0026lt;lora:koreanDollLikeness_v15:0.4\u0026gt; \u0026lt;lora:hipoly3DModelLora_v10:0.3\u0026gt; \u0026lt;lora:breastinclassBetter_v13:0.4\u0026gt; Negative prompt: (many girl),(two girl),(worst quality, low quality:1.4), (fuze:1.4), (worst quality:1.1), (low quality:1.4:1.1), lowres, bad anatomy, bad hands, text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurrypolar,bad body,bad proportions,gross proportions,text,error,missing fingers, missing arms,missing legs, extra digit, extra fingers,fewer digits,extra limbs,extra arms,extra legs,malformed limbs,fused fingers,too many fingers,long neck,cross-eyed,mutated hands, cropped,poorly drawn hands,poorly drawn face,mutation,deformed,worst quality,low quality, normal quality, blurry,ugly,duplicate,morbid,mutilated,out of frame, body out of frame,, (worst quality, low quality:1.4), (fuze:1.4), (worst quality:1.1), (low quality:1.4:1.1), lowres, bad anatomy, bad hands, text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurrypolar,bad body,bad proportions,gross proportions,text,error,missing fingers, missing arms,missing legs, extra digit, extra fingers,fewer digits,extra limbs,extra arms,extra legs,malformed limbs,fused fingers,too many fingers,long neck,cross-eyed,mutated hands, cropped,poorly drawn hands,poorly drawn face,mutation,deformed,worst quality,low quality, normal quality, blurry,ugly,duplicate,morbid,mutilated,out of frame, body out of frame Size: 512x1024, Seed: 1686447565, Model: perfectWorld_v2Baked, Steps: 30, Sampler: DPM++ SDE Karras, CFG scale: 7, Clip skip: 2, Model hash: 79e42fb744, AddNet Enabled: True, AddNet Model 4: hipoly3DModelLora_v10(7cc1730c0bcd), AddNet Model 5: breastinclassBetter_v141(d62716438a56), AddNet Module 4: LoRA, AddNet Module 5: LoRA, AddNet Weight A 4: 0.3, AddNet Weight A 5: 0.4, AddNet Weight B 4: 0.3, AddNet Weight B 5: 0.4   1 2 3  intricate details, (masterpiece, best quality),Kodak portra 400, film grain, vibrant color, highres, doupo_medusa, young, solo, perfect gorgeous face, beautiful face, brown_eyes, detailed eyes, large erotic eyes, slim_face, seductive expression, long_hair, jewelry, pointy_ears, earrings, realistic skin, (huge natural breasts:1.4), (perfect body, narrow waist, slender), (nude, nsfw, half body, navel:1.2), (pinup pose, seductive pose, erotic pose:1.3), look at viewer, 8k wallpaper, photo studio perfect lighting, \u0026lt;lora:Medusa_S1:0.46\u0026gt;, \u0026lt;lora:3loraGuofeng3Lora_v32LoraBigLight:0.6\u0026gt; Negative prompt: (worst quality, low quality:1.4), monochrome, zombie, multiple legs, poorly drawn face, ng_deepnegative_v1_75t, extra heels, wrong prespective, clothes, dress, (extra limbs:1.2), bad hand draw, deformed hands, deformed fingers, double ankle, hands in feet position, underdress, old, mature. ENSD: -1, Size: 768x768, Seed: 3060892867, Steps: 25, Sampler: DPM++ SDE Karras, CFG scale: 8, Clip skip: 2, Model hash: 79e42fb744, Hires steps: 20, Hires upscale: 2, Hires upscaler: R-ESRGAN 4x+ Anime6B, Denoising strength: 0.3   1 2 3  ultra realistic 8k cg, picture-perfect face, flawless, clean, masterpiece, professional artwork, famous artwork, cinematic lighting, cinematic bloom, perfect face, beautiful face, beautiful eyes, (black gold angle halo),((small waist,mature,medium ass,big breast)),gorgeous queen, royal, divine, goddess, godlike, fantasy, dreamlike, unreal, science fiction, wet, sweat,detailed laces,white long sleeved top,laced bra,(black skirt,gold details), green-blue eyes, shiny eyes, (background, fantasy, water,portal,lightning), sexy, charming, alluring, seductive, erotic,water diamond earrings,enchanting, cleavage,ulzzang-6500-v1.1:0.8, Negative prompt: (worst quality, low quality:1.3), simple background, logo, watermark, text Size: 512x512, Seed: 3133778120, Model: perfectWorld_v2Baked, Steps: 35, Sampler: Euler a, CFG scale: 7, Model hash: 79e42fb744, Face restoration: CodeFormer   1 2 3  \u0026lt;lora:fashionGirl_v47:0.88\u0026gt;,masterpiece, hyper detail, intricate details, beautiful detailed, colourful, highres, best quality, detailed background, intricate background,perfect anatomy, absurdres, highres, (2girls side by side), (detailed face),(evil smile,:p),castle,stairs,(shiny skin:1.1),(large breasts),covered nipples, lips, makeup, (pasties:1.2),bodysuit,looking at viewer, (disheveled hair:1.2), dark,night,dynamic angle, Negative prompt: completely nude, panties, lowres, bad anatomy, bad hands, text,error,missing fngers,extra digt ,fewer digits,cropped,wort quality ,low quality,normal quality, jpeg artifacts,signature,watermark, username, blurry, bad feet, (worst quality, low quality:1.4), china dress, dress, chinese clothes, hand, feet, foot, (dark skin:1.1), fused girls, fushion, bad-hands-5, lowres, bad anatomy, bad hands, text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, signature, watermark, username, blurry, (bad feet:1.1), (simple background:1.331), monochrome, jpeg artifacts, ugly, pregnant, vore, duplicate, morbid, mutilated, tran nsexual, hermaphrodite, long neck, mutated hands, poorly drawn hands, poorly drawn face, mutation, deformed, bad proportions, malformed limbs, extra limbs, cloned face, disfigured, gross proportions, (missing arms:1.331), (missing legs:1.331), (extra arms:1.331), (extra legs:1.331), plump, bad legs, lowres, bad anatomy, bad hands, text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurry, longbody, lowres, bad anatomy, bad hands, missing fingers, pubic hair,extra digit, fewer digits, cropped, worst quality, low quality, lowres, bad anatomy, bad hands, text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurry, lowres, bad anatomy, bad hands, text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurry ENSD: 31337, Size: 768x576, Seed: 3714763298, Steps: 33, Sampler: DPM++ 2M Karras, CFG scale: 7, Model hash: 79e42fb744, Hires steps: 22, Hires upscale: 1.6, Hires upscaler: R-ESRGAN 4x+ Anime6B, Face restoration: GFPGAN, Denoising strength: 0.52   1 2 3  (gorgeous ((white-haired:1.4)) CLERIC:1.1), (tavern whore:1.4), royal queen, divine, goddess, godlike, sexy, charming, alluring, seductive, erotic, enchanting, with perfect face, beautiful face, beautiful eyes, ((perfect female body, perfect narrow waist, perfect ankles, perfect feet, perfect wrists, perfect hands, perfect breasts)), (bared exposed jutting breasts and nipples with large aureoles and swollen peaks:1.6), long hair, updo, buns, pony tail, wearing beautiful clothes, lace, lace trim, lingerie, (lace-trimmed legwear, stockings, thick thighs:1.2), (high heeled shoes:1.4), (loincloth,belts,straps,garter,thong), elaborate (hair ornament, necklace, gorget, earrings, bracelet, armlet, rings, piercings), (rich:1.4), prestige, luxury, jewelry, diamond, gold, pearl, gem, sapphire, ruby, emerald, highly intricate detail, delicate pattern, (in dark rustic fantasy tavern:1.6), fantastic, dreamlike, unreal, in the style of (ultra realistic 8k 32K HDR Photo, flawless, clean, masterpiece, professional artwork, famous artwork, cinematic lighting, cinematic bloom, soft lighting, indirect lighting, cloudy day lighting), ((slutcore,whorecore,bondagecore,muslimcore,princesscore,priestesscore,nuncore:1.4)),((BDSM:1.6)),((NSFW:1.3)), (ulzzang-6500-v1.1:0.8)(RED LIPS),MAKEUP(deep hot strong blush:1.96)\u0026lt;lora:adventurers_v1:0.8\u0026gt;WAR_GLAM,WEARING WAR_GLAM,ARMOR\u0026lt;lora:warriorPrincesses_v10:0.2\u0026gt; Negative prompt: (bad-hands-5:1.7)(EasyNegative:1.98)(worst quality, low quality:1.8), (simple background), bright lighting,ugly,lowres,bad anatomy,amputation,amputee,missing limbs,missing fingers,extra digit,cropped head,(worst quality,low quality,normal quality:2)jpg artifacts,text,watermark,logo,collage,frame,border,split image, double image,simple background,signature,username,blurry Eta: 0.3, ENSD: 69420, Size: 512x768, Seed: 793983721, Model: perfectWorld_v2Baked, Steps: 25, Sampler: Euler a, CFG scale: 7, Clip skip: 2, Model hash: 79e42fb744, Hires steps: 25, Hires upscale: 2, Hires upscaler: Latent (bicubic antialiased), Face restoration: CodeFormer, Denoising strength: 0.55   1 2 3  ultra realistic 8k cg, picture-perfect face, flawless, clean, masterpiece, professional artwork, famous artwork, cinematic lighting, cinematic bloom, perfect face, beautiful face, beautiful eyes, ((perfect female body, narrow waist)), white lace, white lace trim, white lace-trimmed legwear, white hair, red eyes, gorgeous queen, royal, divine, goddess, godlike, (royal palace), fantasy, dreamlike, unreal, science fiction, huge breasts, breasts out, beautiful clothes, nsfw, breasts out, absurdly long hair, very long hair, intricate detail, delicate pattern, sexy, charming, alluring, seductive, erotic, enchanting, hair ornament, necklace, earrings, bracelet, armlet, spread legs, (pussy juice drip through clothes, large load of pussy juice), red high-heeled shoes, slut, slutty, slut face, prostitute, open mouth, tongue out, saliva, drooling, cum in pussy, cum on breasts, cum on ass, (anal:1.3), hand on own ass, spread ass , sweat,\u0026lt;lora:hipoly3DModelLora_v10:0.4\u0026gt; Negative prompt: (worst quality, low quality:1.3), simple background, logo, watermark, text, (fused fingers), (too many fingers),crossed fingers,((multiple anus:1.5)), prolapse, (low quality, worst quality:1.4),(bad_prompt_version2:0.8), (monochrome:1.1), extra fingers,blurry, ((bad anatomy)), (((bad proportions))), Size: 512x768, Seed: 3863176697, Model: perfectWorld_v2Baked, Steps: 35, Sampler: DPM++ 2S a Karras, CFG scale: 7, Clip skip: 2, Model hash: 79e42fb744, Hires steps: 10, Hires upscale: 2, Hires upscaler: Latent (bicubic antialiased), Face restoration: CodeFormer, Denoising strength: 0.5   1 2 3  (original: 1.2), (realistic: 1.5),absurdres, incredibly absurdres, ultra detail, high resolution, ultra detailed, best quality, amazing, top quality, extremely detailed CG unity 8k wallpaper, cinematic lighting,1girl, ((asian face)), ((ornate armor:1.6)), (Armed Knight,Tungsten armour,dark armour, sword:1.2), pose, ((paladin girl)), (perfect shiny skin:0.6),looking at viewer,long hair, curly hair, slim and smooth lines, slender waist,,dynamic pose,fighting pose, (background old castle),\u0026lt;lora:adventurers_v1:0.7\u0026gt;, \u0026lt;lora:yurisaLora_v30:0.3\u0026gt; Negative prompt: (many girl),(two girl),(worst quality, low quality:1.4), (fuze:1.4), (worst quality:1.1), (low quality:1.4:1.1), lowres, bad anatomy, bad hands, text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurrypolar,bad body,bad proportions,gross proportions,text,error,missing fingers, missing arms,missing legs, extra digit, extra fingers,fewer digits,extra limbs,extra arms,extra legs,malformed limbs,fused fingers,too many fingers,long neck,cross-eyed,mutated hands, cropped,poorly drawn hands,poorly drawn face,mutation,deformed,worst quality,low quality, normal quality, blurry,ugly,duplicate,morbid,mutilated,out of frame, body out of frame,, (worst quality, low quality:1.4), (fuze:1.4), (worst quality:1.1), (low quality:1.4:1.1), lowres, bad anatomy, bad hands, text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurrypolar,bad body,bad proportions,gross proportions,text,error,missing fingers, missing arms,missing legs, extra digit, extra fingers,fewer digits,extra limbs,extra arms,extra legs,malformed limbs,fused fingers,too many fingers,long neck,cross-eyed,mutated hands, cropped,poorly drawn hands,poorly drawn face,mutation,deformed,worst quality,low quality, normal quality, blurry,ugly,duplicate,morbid,mutilated,out of frame, body out of frame, naked, nude, nudity, nsfw, cropped head, render, cartoon, Size: 512x768, Seed: 3701282849, Model: perfectWorld_perfectWorldBakedVAE, Steps: 30, Sampler: DPM++ SDE Karras, CFG scale: 7, Model hash: ca883fecc7   1 2 3  shexyo, lying, 1girl,tall 6ft,weight 60 kg , glasgow smile,cleavage, brown hair and (white gradient hair:1.2), hair between eyes, (quad tails:1.3), wide hips , sexy pose from back ,blue eyes, detailed eyes, oceanpunk style clothing and setting, wearing t-shirt, jeans, backpack with no jewelry or neckwear, (gas station) backdrop, beautiful background, amazing background , Negative prompt: (bad_prompt:0.8), lowres, low quality, worst quality, normal quality, watermark, text, error, jpeg artifacts, signature, bad anatomy, (bad hands:1.2), poorly drawn hands, missing digit, extra digits, fewer digits, mutated hands and fingers, (fused fingers:1.2), too many fingers, mutation, Size: 488x488, Seed: 3524960154, Model: model, Steps: 150, Sampler: Euler a, CFG scale: 7, Mask blur: 4, Model hash: 79e42fb744, Denoising strength: 0.57   模型: Grapefruit (hentai model) Generation Data 1 2 3  masterpiece, best quality, detailed, 1girl, pink eyes, long hair, black hair, (grapefruit in front), (temple in the background), sitting, red kimono, medium breasts, topless, light smile, arms behind back, water, sunset, hair ornament, Negative prompt: (worst quality, low quality:1.4), signature, Size: 448x512, Seed: 2776530884, Model: grapefruitV4_1, Steps: 20, Sampler: DDIM, CFG scale: 8, Clip skip: 2, Model hash: c590550ea5, Hires steps: 20, Hires upscale: 1.9, Hires upscaler: Latent (nearest-exact), Denoising strength: 0.52   1 2 3  masterpiece, best quality, 1girl, 1boy, spread legs, sex, nude, medium breasts, penis, vaginal, open mouth, brown eyes, long hair, cum, black hair, on bed, pov, stomach bulge, Negative prompt: (worst quality, low quality:1.4), Size: 512x648, Seed: 2203514434, Model: grapefruitV4_1, Steps: 20, Sampler: DDIM, CFG scale: 8, Clip skip: 2, Model hash: c590550ea5, Hires upscale: 2, Hires upscaler: Latent (nearest-exact), Denoising strength: 0.55   1 2 3  masterpiece, best quality, 1girl, solo, night sky, outdoors, moon, stars, clouds, wind, medium hair, boots, witch, smile, red eyes, arms up, cleavage, tree, night, Negative prompt: (worst quality, low quality:1.4) ENSD: 31337, Size: 512x832, Seed: 1444169952, Steps: 20, Sampler: DDIM, CFG scale: 7, Clip skip: 2, Model hash: c590550ea5, Hires steps: 20, Hires upscale: 1.5, Hires upscaler: Latent (nearest-exact), Denoising strength: 0.52   1 2 3  masterpiece, best quality, 1girl, large breasts, red eyes, long hair, wide hips, bikini, animal ears, beach, black hair, sunny sky, sunlight, water, palm tree, sitting, pussy, Negative prompt: (low quality, worst quality:1.4), Size: 512x672, Seed: 2729176815, Model: grapefruitV4_1, Steps: 20, Sampler: DDIM, CFG scale: 7, Clip skip: 2, Model hash: c590550ea5, Hires steps: 20, Hires upscale: 2, Hires upscaler: Latent (nearest-exact), Denoising strength: 0.55   1 2 3  masterpiece, best quality, ultra-detailed, illustration, 1girl, solo, fantasy, night sky, outdoors, magic, spells, moon, stars, clouds, wind, hair, cape, hat, boots, glowing, mysterious, enchanting, whimsical, playful, adventurous, freedom, wonder, imagination, determination, skill, speed, movement, energy, realism, naturalistic, figurative, representational, beauty, fantasy culture, mythology, fairy tales, folklore, legends, witches, wizards, magical creatures, fantasy worlds, composition, scale, foreground, middle ground, background, perspective, light, color, texture, detail, beauty, fire spell. Negative prompt: easynegative,lowres,bad anatomy,bad hands,text,error,missing fingers, extra digit,fewer digits,cropped,worst quality, low quality,normal quality,jpeg artifacts,signature, watermark,username,blurry,missing arms,long neck, Humpbacked,missing limb,too many fingers, mutated,poorly drawn,out of frame,bad hands, unclear eyes,poorly drawn,cloned face,bad face,(painting by bad-artist-anime:0.9), (painting by bad-artist:0.9), watermark, text, error, blurry, jpeg artifacts, cropped, (normal quality:1.3), signature, username, artist name, (worst quality, low quality:1.5), lowres, bad anatomy, logo, poorly drawn face,fused fingers, poorly drawn hand, NG_DeepNegative_V1_75T, (holding), bad-hands-5, deformed fingers, extra arms, extra limbs, extra hands, too many hands Size: 512x768, Seed: 57709132, Model: grapefruitHentaiModel_grapefruitv41, Steps: 20, Sampler: DPM++ 2M Karras, CFG scale: 7, Model hash: c590550ea5, Hires upscale: 2, Hires upscaler: Latent, Face restoration: CodeFormer, Denoising strength: 0.7   1 2 3  masterpiece, best quality, detailed, 1girl, pink eyes, long hair, black hair, (grapefruit in front), (temple in the background), sitting, red kimono, medium breasts, topless, light smile, arms behind back, water, sunset, hair ornament, Negative prompt: (worst quality, low quality:1.4), signature,EasyNegative, paintings, sketches, (worst quality:2), (low quality:2), (normal quality:2), lowres, normal quality, ((monochrome)), ((grayscale)), skin spots, acnes, skin blemishes, age spot, glans,extra fingers,fewer fingers,strange fingers,bad hand ENSD: 31337, Size: 768x1024, Seed: 2169396982, Steps: 20, Sampler: DDIM, CFG scale: 7, Model hash: c590550ea5   1 2 3  (masterpiece), (best quality), (ultra detailed),(disheveled hair),(illustration), (1girl), (Fashionable clothing), standing,Fashion model,looking at viewer, (interview), (simple background),beautifuldetailedeyes,delicate beautiful face,Floating,(high saturation),(colorful splashes),colorful bubble,(shining),focus on face, Negative prompt: (worst quality, low quality:1.2), watermark, Size: 576x1208, Seed: 34532231834, Model: grapefruitHentaiModel_grapefruitv41, Steps: 30, Sampler: DPM++ 2M Karras, CFG scale: 6.5, Model hash: c590550ea5   1 2 3  masterpiece, best quality, 1girl, 1boy, ((breasts out)), beautiful eyes, perfect illumination, ahegao, sweat, pussy, pussy juice, ((Violet Evergarden)), ((On all four:1.1)), penis, ((sex)), ((Vaginal)), looking at viewer, POV Negative prompt: (worst quality, low quality:1.4), EasyNegative, bad anatomy, bad hands, cropped, missing fingers, too many fingers, missing arms, long neck, Humpbacked, deformed, disfigured, poorly drawn face, distorted face, mutation, mutated, extra limb, ugly, poorly drawn hands, missing limb, floating limbs, disconnected limbs, malformed hands, out of focus, long body, monochrome, symbol, text, logo, door frame, window frame, mirror frame, large penis Size: 512x512, Seed: 2158231399, Steps: 30, Sampler: DDIM, CFG scale: 7, Clip skip: 2, Model hash: 6bbfe67e, Hires upscale: 2, Hires upscaler: Latent, Denoising strength: 0.7   1 2 3 4 5 6 7 8 9 10  masterpiece, best quality,from above, ((pink hair), long hair,french braid,hair behind ear,frizzy hair,shiny hair,handled hair,floating hair), (blue hair flower, forget-me-not \\(flower\\)), teenage, ,1girl,small breasts, solo,(purple eyes, Love stickers on cheeks), ,(cityscape, tokyo \\(city\\),city night,), ,(sailor collar, pleated skirt,on arm up) ,(dynamic angle), Negative prompt: lowres, bad anatomy, bad hands, text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurry, artist name, easynegative, \\(worst quality, low quality:1.4\\), extra legs, fewer legs, extra arms, fewer arms, fewer fingers, \\(extra fingers:1.4\\), \\(\\(Nude\\)\\),panties,, lowres, bad anatomy, bad hands, text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurry, Eta: 0.67, ENSD: 31337, Size: 1280x720, Seed: 2319784117, Model: grapefruitHentaiModel_grapefruitv41, Steps: 30, Sampler: DPM++ SDE Karras, CFG scale: 6, Clip skip: 2, Model hash: c590550ea5   1 2 3  masterpiece, best quality, extremely delicate and beautiful, finely detail, details; highres, illustration,refined rendering, extremely detailed wallpaper, official art, ultra-detailed, extremely detailed 8k wallpaper, best illumination, beautiful detailed glow, best shadow, depth of field, perfect lighting, colorful, wide angle, dynamic angle, beautiful face, beautiful detailed eyes, 1girl, solo,(hand by Guido Daniele:1.5), full body, (kimono), (katana:1.3), (cherry blossoms), (cherry blossoms drifting in the wind:1.3), hair ornament, sunset, Shrine in the background, (sword dance:1.3) Negative prompt: (EasyNegative), (worst quality), (low quality), lowres, normal quality, NSFW, nude, bad anatomy,extra limbs,malformed limbs, extra toes, missing toes, mutated toes, bad toes, extra arms, missing arms, bad arms, extra legs, missing legs, bad leg, bad hands, mutated hands,missing fingers, extra fingers, fused fingers, bad fingers, more than 2 nipples, multiple breasts, bad drawn tits, bad drawn pussy, bad drawn anus, bad proportions, mutilated, tranny, futa, cropped, blurry, disfigured, ugly, morbid, cloned face, unclear eyes, watermark, text, b\u0026amp;w, weird colors, blurry, error, digit Size: 1080x1920, Seed: 2310921578, Model: GrapeFruit_inpainting, Steps: 70, Sampler: DDIM, CFG scale: 12, Clip skip: 2, Mask blur: 4, Model hash: 8729c2d67e, Denoising strength: 0.25, Conditional mask weight: 1.0   1 2 3  masterpiece, best quality, 1girls, sit on wood ground, sun light, lobby, window, flower, (Washitsu background),uncensored, vaginal\u0026lt;lora:inniesBetterVaginas_v11:0.5\u0026gt;, sex, twintails, blonde hair, very long hair, blue dress, pleated skirt, small breasts, knee high stockings, wear half ribbon panties on leg, fang, full bodys, upto down view, Negative prompt: (worst quality, low quality:1.4) , melt legs, melt limbs, melt fingers, animal, Size: 512x512, Seed: 1444169951, Model: grapefruitHentaiModel_grapefruitv41, Steps: 35, Sampler: DDIM, CFG scale: 8.5, Model hash: c590550ea5, Hires upscale: 2, Hires upscaler: Latent, ControlNet-0 Model: control_openpose-fp16 [9ca67cc5], ControlNet-1 Model: control_depth-fp16 [400750f6], Denoising strength: 0.7, ControlNet-0 Module: none, ControlNet-0 Weight: 0.5, ControlNet-1 Module: none, ControlNet-1 Weight: 0.5, ControlNet-0 Enabled: True, ControlNet-1 Enabled: True, ControlNet-0 Guidance End: 1, ControlNet-1 Guidance End: 1, ControlNet-0 Guidance Start: 0, ControlNet-1 Guidance Start: 0   1 2 3  elegant, intricate, concept art, (perfect lighting), lace lingerie Negative prompt: (worst quality:1.2), (low quality:1.2), (lowres:1.1), multiple views, futa, futanari, (large_areolae), long fingers, deformed hands, signature, plump, fat, child, (loli:1.2), (amputee), (small_breasts:1.3), (flat chest:1.5), (bored photo:1.2),lowres,bad anatomy,bad hands,text,error,missing fingers,extra digit,fewer digits,cropped,worst quality,low quality,normal quality,jpeg artifacts,signature,watermark,username,blurry,missing arms,long neck,Humpbacked,Scribbles,Low quality,Low rated,Mediocre,3D rendering,Screenshot,Software,UI,watermark,signature,robot eyes,distorted pupils,distorted eyes,Unnatural anatomy,strange anatomy, extra legs Size: 707x964, Seed: 3767323342, Model: grapefruitHentaiModel_grapefruitv41, Steps: 60, hashes: [object Object], Sampler: DPM++ SDE Karras, CFG scale: 8, Model hash: c590550ea5   1 2 3  highest quality, ultra-detailed, masterpiece, illustration, re zero emilia, standing, full body, medium breasts, dark purple eyes, sparkling eyes, sexy face, detailed face, ultra detailed background, glowing skin, slightly wet skin, more mature, slightly wet skin, cliff, ocean, depth of field, thick outlines, armpits, white bikini, nipples Negative prompt: (worst quality, low quality:1.4), (extra hands, extra fingers:1.4), ugly hands, ugly fingers, oversized breasts, deformed hands, deformed fingers, deformed body, ugly mouth, ugly ears, cropped, bad anatomy, watermarks, signatures Size: 512x768, Seed: 3130178134, Model: grapefruitHentaiModel_grapefruitv41, Steps: 20, Sampler: Euler a, CFG scale: 7, Model hash: c590550ea5, Hires upscale: 2, Hires upscaler: Latent, Denoising strength: 0.7   1 2 3  photo, masterpiece, best quality, wallpaper, 1girl, short hair, sky blue hair, sky blue eyes, hair accessories, sundress, river, nsfw, Negative prompt: (worst quality, low quality:1.4), (((distorted hands))),((disfigured)), ((bad art)), ((deformed)),((extra limbs)),((b\u0026amp;w)), (((duplicate))), ((morbid)), ((mutilated)), extra fingers, mutated hands, ((poorly drawn hands)), ((poorly drawn face)), (((mutation))), (((deformed))), ((ugly)), blurry, ((bad anatomy)), (((bad proportions))), ((extra limbs)), cloned face, (((disfigured))), out of frame, ugly, extra limbs, (bad anatomy), gross proportions, (malformed limbs), ((missing arms)), (((extra arms))), (((extra legs))), mutated hands, (((fused fingers))), (too many fingers), (((long neck))), ugly, tiling, poorly drawn hands, poorly drawn feet, poorly drawn face, out of frame, mutation, mutated, extra limbs, extra legs, extra arms, disfigured, deformed, cross-eye, body out of frame, blurry, bad art, bad anatomy, (text), signature, monster, animal, big nipples, ((distorted boobs)), (arms up) Size: 448x576, Seed: 3167218091, Model: grapefruitHentaiModel_grapefruitv41, Steps: 20, Sampler: DDIM, CFG scale: 8, Model hash: c590550ea5, Hires steps: 20, Hires upscale: 2, Hires upscaler: Latent (nearest-exact),, Denoising strength: 0.52   1 2 3  elegant, intricate, concept art, (perfect lighting), lace lingerie Negative prompt: (worst quality:1.2), (low quality:1.2), (lowres:1.1), multiple views, futa, futanari, (large_areolae), long fingers, deformed hands, signature, plump, fat, child, (loli:1.2), (amputee), (small_breasts:1.3), (flat chest:1.5), (bored photo:1.2),lowres,bad anatomy,bad hands,text,error,missing fingers,extra digit,fewer digits,cropped,worst quality,low quality,normal quality,jpeg artifacts,signature,watermark,username,blurry,missing arms,long neck,Humpbacked,Scribbles,Low quality,Low rated,Mediocre,3D rendering,Screenshot,Software,UI,watermark,signature,robot eyes,distorted pupils,distorted eyes,Unnatural anatomy,strange anatomy, extra legs Size: 512x512, Seed: 1756320189, Model: grapefruitHentaiModel_grapefruitv41, Steps: 20, Sampler: DDIM, CFG scale: 7, Clip skip: 2, Model hash: c590550ea5, Hires upscale: 2, Hires upscaler: Latent, Denoising strength: 0.7   ","date":"2023-03-08T21:00:00+08:00","permalink":"https://mkbooks.github.io/blog/p/stable-diffusion-webui-civitai/","title":"stable-diffusion-webui-civitai"},{"content":"进入网站 http://127.0.0.1:7860/\n使用方法 方法一 方法二 方法三-人体姿势检测 模型介绍 模型: elegantHanfuRuqun_v10.safetensors 1 2 3  ru_qun,best_quality,head,original_outfit,hanfu,clear details,masterpiece, best_quality, clear details,1girl,all four,on stomach,from back,cowboy shot, \u0026lt;lora:ruqun-000009:1\u0026gt; Negative prompt: pale skin,(worst quality, low quality, normal quality:1.4),(inaccurate limb:1.2),white background,simple background,bad anatomy, bad hands, text, error, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts,signature, watermark, username, blurry, artist name,bad feet,(((ugly))),(((duplicate))),((morbid)),((mutilated)),(((tranny))),mutated hands,(((poorly drawn hands))),(((blurry))),((bad anatomy)),(((bad proportions))),extra limbs,cloned face,(((disfigured))),(((more than 2 nipples))),((((missing arms)))),(((extra legs))),mutated hands,(((((fused fingers))))),(((((too many fingers))))),(((unclear eyes))),sad,missing fingers, low quality body parts, missing body parts, disproportional body parts, indistinguishable body parts, branched body parts, bent, body parts, rheumatism finers, ugly fingers, melted fingers, too fat, too skiny, low quality female, low quality male, poor colors, low quality clothes, poor background, wholesome, 3D, CG, less details, censored, multiple legs, Lesbian, gay, ENSD: 31337, Size: 480x640, Seed: 3253182695, Steps: 20, Sampler: DPM++ 2M Karras, CFG scale: 7, Clip skip: 2, Model hash: e4b17ce185, Hires steps: 10, Hires upscale: 1.5, Hires upscaler: ESRGAN_4x, Denoising strength: 0.55   模型: meinamix_meinaV7.safetensors 1 2 3  (Overhead view),dynamic angle,ultra-detailed, illustration, close-up, straight on, 1girl, (fantasy:1.4), (azure blue eyes:1.233),Her eyes shone like dreamy stars,(glowing eyes:1.233),(beautiful and detailed eyes:1.1),(Silver hair:1.14),(messy hair,very long hair,french braid,hair between eyes,sidelocks), (+(bule hair flower:1.14)),(chiffon dress,bule flower pattern in uniform)/=(military uniform:1.24),(detached sleeves,wide sleeves),(fingerless gloves),choker,(miko thighhighs),High heeled boots,(expressionless,closed mouth),(standing), (classical Princess boudoir with dressing table\u0026lt;books\u0026gt; and french window\u0026lt;a epic view outside the window\u0026gt; in a white ancient palaces),(white flowers,bloom),(abysmal sea),(flowing water),(a dull blue world tree:1.14),(ruins),(night:1.2),dreamy,soul,(fluorescence),(flying translucent blue butterflies:1.15), [[delicate fingers and hands:0.55]::0.85],(detail fingers),(yubao:0.5), Negative prompt: (worst quality, low quality:1.4), monochrome, zombie, Size: 512x1024, Seed: 2073347904, Model: Meina V7 - pruned, Steps: 50, Sampler: Euler a, CFG scale: 7, Clip skip: 2, Model hash: 9d77664fea, Hires steps: 20, Hires upscale: 2, Hires upscaler: None, Denoising strength: 0.3   stablydiffuseds_26.safetensors 1 2 3 4 5  1girl, beautiful, realistic Negative prompt: (((simple background))),monochrome ,lowres, bad anatomy, bad hands, text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurry, lowres, bad anatomy, bad hands, text, error, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurry, ugly,pregnant,vore,duplicate,morbid,mut ilated,tran nsexual, hermaphrodite,long neck,mutated hands,poorly drawn hands,poorly drawn face,mutation,deformed,blurry,bad anatomy,bad proportions,malformed limbs,extra limbs,cloned face,disfigured,gross proportions, (((missing arms))),(((missing legs))), (((extra arms))),(((extra legs))),pubic hair, plump,bad legs,error legs,username,blurry,bad feet Steps: 30, Sampler: Euler a, CFG scale: 6, Seed: 1882365488, Face restoration: CodeFormer, Size: 512x512, Model hash: 03df69045a, Model: stablydiffuseds_26, Denoising strength: 0.7, ControlNet Enabled: True, ControlNet Module: openpose, ControlNet Model: control_sd15_openpose [fef5e48e], ControlNet Weight: 1, ControlNet Guidance Start: 0, ControlNet Guidance End: 1, Hires upscale: 2, Hires steps: 30, Hires upscaler: Latent (bicubic antialiased)   Fantasy World 风景\nCheese Daddy\u0026rsquo;s Landscapes mix 风景\n","date":"2023-03-07T21:00:00+08:00","permalink":"https://mkbooks.github.io/blog/p/stable-diffusion-webui-%E4%BD%BF%E7%94%A8/","title":"stable-diffusion-webui 使用"},{"content":" 汉化: https://github.com/VinsonLaro/stable-diffusion-webui-chinese controlnet: https://github.com/Mikubill/sd-webui-controlnet depth: https://github.com/jexom/sd-webui-depth-lib  ","date":"2023-03-07T21:00:00+08:00","permalink":"https://mkbooks.github.io/blog/p/stable-diffusion-webui-%E6%8F%92%E4%BB%B6/","title":"stable-diffusion-webui 插件"},{"content":"1 2  unset all_proxy unset ALL_PROXY   ","date":"2023-03-06T21:00:00+08:00","permalink":"https://mkbooks.github.io/blog/p/proxy-unknown-scheme-socks/","title":"proxy: unknown scheme: socks"},{"content":"3倍速 F12 -\u0026gt; console -\u0026gt; 输入代码: document.querySelector(\u0026quot;video\u0026quot;).playbackRate=\u0026quot;3\u0026quot;\n","date":"2023-03-02T20:20:00+08:00","permalink":"https://mkbooks.github.io/blog/p/%E7%BD%91%E9%A1%B5%E8%A7%86%E9%A2%91%E5%8A%A0%E9%80%9F%E6%92%AD%E6%94%BE/","title":"网页视频加速播放"},{"content":"","date":"2023-02-23T20:20:00+08:00","permalink":"https://mkbooks.github.io/blog/p/%E8%B5%84%E6%BA%90%E6%B8%85%E5%8D%95%E6%96%87%E4%BB%B6%E4%B8%8Epod/","title":"资源清单文件与Pod"},{"content":" 安装 Docker。  Ubuntu  sudo apt install docker.io -y   CentOS  sudo yum update sudo yum install -y yum-utils sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo sudo yum install -y docker-ce docker-ce-cli containerd.io sudo systemctl start docker sudo docker run hello-world   普通用户执行权限添加  sudo groupadd docker sudo usermod -aG docker ${USER}   更新并激活组权限  newgrp docker     服务端  下载 FRP 镜像。  docker pull snowdreamtech/frps   创建配置文件  vim /home/sammy/frp/frps.ini   创建 FRP 容器。  docker run -d --restart always --network host --name frps -v /home/sammy/frp/frps.ini:/etc/frp/frps.ini snowdreamtech/frps   控制面板  http://${public_ip}:7500/     客户端  下载 FRP 镜像。  docker pull snowdreamtech/frpc   创建配置文件  vim /home/sammy/frp/frpc.ini   创建 FRP 容器。  docker run -d --restart always --network host --name frpc -v /home/sammy/frp/frpc.ini:/etc/frp/frpc.ini snowdreamtech/frpc     测试  ssh  ssh root@${public_ip} -p 2288   nginx  http://${public_ip}:8080/   k8s-dashboard  https://${public_ip}:1113/      ","date":"2023-02-20T10:00:00+08:00","permalink":"https://mkbooks.github.io/blog/p/%E9%80%9A%E8%BF%87frp%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/","title":"通过FRP实现内网穿透"},{"content":"环境  操作系统: CentOS7.9 cpu 架构: x86 kubernetes 版本: v1.25.6  系统版本 版本号\n1 2  [root@master ~]# cat /etc/centos-release CentOS Linux release 7.9.2009 (Core)   内核版本\n1 2  [root@master ~]# uname -r 3.10.0-1160.el7.x86_64   操作系统位数\n1 2  [root@master ~]# getconf LONG_BIT 64   环境准备 设置 hostname 1  hostnamectl set-hostname master   添加到/etc/hosts\n1 2 3  vim /etc/hosts 192.168.122.88 master   禁用防火墙 1 2  [root@master ~]# systemctl stop firewalld [root@master ~]# systemctl disable firewalld   禁用 SELINUX 1 2 3 4  # 暂时性 [root@master ~]# setenforce 0 # 永久 [root@master ~]# vim /etc/selinux/config    SELINUX=disabled，重新启动系统，使更改生效。\n 开启内核 ipv4 转发 加载 br_netfilter 模块\n1  [root@master ~]# modprobe br_netfilter   设置成开机启动\n1 2 3 4 5  vim /etc/rc.d/rc.local # 添加 for file in /etc/sysconfig/modules/*.modules ; do [ -x $file ] \u0026#34;# $file done   在 /etc/sysconfig/modules/ 目录下新建如下文件：\n1 2  mkdir -p /etc/sysconfig/modules/ vi /etc/sysconfig/modules/br_netfilter.modules    modprobe br_netfilter\n 增加权限\n1  chmod 755 /etc/sysconfig/modules/br_netfilter.modules   重启测试\n1 2 3 4  lsmod|grep br_netfilter br_netfilter 22256 0 bridge 151336 1 br_netfilter   创建 vim /etc/sysctl.d/k8s.conf 文件，添加如下内容\n1 2 3 4 5 6 7  net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 net.ipv4.ip_forward = 1 # 下面的内核参数可以解决ipvs模式下长连接空闲超时的问题 net.ipv4.tcp_keepalive_intvl = 30 net.ipv4.tcp_keepalive_probes = 10 net.ipv4.tcp_keepalive_time = 600   令使修改生效\n1  sysctl -p /etc/sysctl.d/k8s.conf   关闭 Swap 1 2  swapoff -a vi /etc/fstab   remove the line with swap keyword\n设置 iptables 1 2 3  cat \u0026lt;\u0026lt;EOF | sudo tee /etc/modules-load.d/k8s.conf br_netfilter EOF   1 2 3 4  cat \u0026lt;\u0026lt;EOF | sudo tee /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 EOF   1  sysctl --system   安装 ipvs 1 2 3 4 5 6 7 8  cat \u0026gt; /etc/sysconfig/modules/ipvs.modules \u0026lt;\u0026lt;EOF #!/bin/bash modprobe -- ip_vs modprobe -- ip_vs_rr modprobe -- ip_vs_wrr modprobe -- ip_vs_sh modprobe -- nf_conntrack_ipv4 EOF   1  chmod 755 /etc/sysconfig/modules/ipvs.modules \u0026amp;\u0026amp; bash /etc/sysconfig/modules/ipvs.modules \u0026amp;\u0026amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv4   output:\n1 2 3 4 5 6 7 8  nf_conntrack_ipv4 15053 0 nf_defrag_ipv4 12729 1 nf_conntrack_ipv4 ip_vs_sh 12688 0 ip_vs_wrr 12697 0 ip_vs_rr 12600 0 ip_vs 145458 6 ip_vs_rr,ip_vs_sh,ip_vs_wrr nf_conntrack 139264 2 ip_vs,nf_conntrack_ipv4 libcrc32c 12644 3 xfs,ip_vs,nf_conntrack   安装管理工具ipvsadm：\n1 2  yum install ipset yum install ipvsadm -y   同步服务器时间 这里使用 chrony 来进行同步，其他工具也可以：\n1 2 3 4  yum install chrony -y systemctl enable chronyd systemctl start chronyd chronyc sources   output\n1 2 3 4 5 6 7  210 Number of sources = 4 MS Name/IP address Stratum Poll Reach LastRx Last sample =============================================================================== ^- ns1.newsnet.li 2 6 17 3 -7556us[-7556us] +/- 148ms ^? ntp6.flashdance.cx 2 6 3 1 +16ms[ +16ms] +/- 161ms ^* 36.110.233.85 2 6 17 4 -53us[ -10ms] +/- 70ms ^? a.chl.la 2 6 10 9 -33ms[ -467ms] +/- 174ms   查看时间\n1 2  [root@master ~]# date 2023年 02月 19日 星期日 21:44:15 CST   关闭 swap 分区 1  swapoff -a   修改 /etc/fstab 文件，注释掉 SWAP 的自动挂载，使用 free -m 确认 swap 已经关闭。swappiness 参数调整，修改 /etc/sysctl.d/k8s.conf 添加下面一行：\n1  vm.swappiness=0   执行 sysctl -p /etc/sysctl.d/k8s.conf 使修改生效。\n当然如果是生产环境使用还可以先对内核参数进行统一的调优。\n安装 Containerd 安装 seccomp 依赖 在节点上安装 seccomp 依赖，需要版本 \u0026gt;2.4，如果有则升级\n1 2 3  rpm -qa |grep libseccomp output: libseccomp-2.3.1-4.el7.x86_64   卸载\n1  yum remove libseccomp-2.3.1-4.el7.x86_64 -y   output\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  ... Running transaction 正在删除 : chrony-3.4-1.el7.x86_64 1/2 正在删除 : libseccomp-2.3.1-4.el7.x86_64 2/2 验证中 : libseccomp-2.3.1-4.el7.x86_64 1/2 验证中 : chrony-3.4-1.el7.x86_64 2/2 删除: libseccomp.x86_64 0:2.3.1-4.el7 作为依赖被删除: chrony.x86_64 0:3.4-1.el7 完毕！   重新安装 chrony 1 2 3 4  yum install chrony -y systemctl enable chronyd systemctl start chronyd chronyc sources   安装 libseccomp 1 2  wget http://rpmfind.net/linux/centos/8-stream/BaseOS/x86_64/os/Packages/libseccomp-2.5.1-1.el8.x86_64.rpm yum install libseccomp-2.5.1-1.el8.x86_64.rpm -y   验证\n1 2 3  rpm -qa |grep libseccomp output: libseccomp-2.5.1-1.el8.x86_64   安装 Containerd 下载包\n1 2 3  # wget https://github.com/containerd/containerd/releases/download/v1.6.18/cri-containerd-cni-1.6.18-linux-amd64.tar.gz URL 加速 wget https://ghdl.feizhuqwq.cf/https://github.com/containerd/containerd/releases/download/v1.6.10/cri-containerd-1.6.10-linux-amd64.tar.gz   解压\n1  tar -C / -xzf cri-containerd-1.6.10-linux-amd64.tar.gz   将 /usr/local/bin 和 /usr/local/sbin 追加到 PATH 环境变量中：\n1 2  [root@master ~]# echo $PATH /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin   1 2 3 4 5 6 7 8 9  [root@master ~]# containerd -v containerd github.com/containerd/containerd v1.6.10 770bd0108c32f3fb5c73ae1264f7e503fe7b2661 [root@master ~]# runc -v runc version 1.1.4 commit: v1.1.4-0-g5fd4c4d1 spec: 1.0.2-dev go: go1.18.8 libseccomp: 2.5.1   修改 containerd 默认配置 Containerd 的默认配置文件为 /etc/containerd/config.toml，我们可以通过如下所示的命令生成一个默认的配置：\n1 2  mkdir -p /etc/containerd containerd config default \u0026gt; /etc/containerd/config.toml   对于使用 systemd 作为 init system 的 Linux 的发行版，使用 systemd 作为容器的 cgroup driver 可以确 保节点在资源紧张的情况更加稳定，所以推荐将 containerd 的 cgroup driver 配置为 systemd。\n修改前面生成的配置文件 /etc/containerd/config.toml，在plugins.\u0026ldquo;io.containerd.grpc.v1.cri\u0026rdquo;.containerd.runtimes.runc.options 配置块下面将 SystemdCgroup 设置为 true ：\n1 2 3 4 5 6 7  [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.containerd.runtimes.runc] ... [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.containerd.runtimes.runc.options] ... SystemdCgroup = true [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.containerd.untrusted_workload_runtime]   然后再为镜像仓库配置一个加速器，需要在 cri 配置块下面的 registry 配置块下面进行配置 registry.mirrors ：\n1 2 3 4 5 6 7 8 9  [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;] ... # sandbox_image = \u0026#34;registry.k8s.io/pause:3.6\u0026#34; sandbox_image = \u0026#34;registry.aliyuncs.com/k8sxio/pause:3.8\u0026#34; ... [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.registry] [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.registry.mirrors] [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.registry.mirrors.\u0026#34;docker.io\u0026#34;] endpoint = [\u0026#34;https://bqr1dr1n.mirror.aliyuncs.com\u0026#34;]   使配置生效\n1 2  systemctl daemon-reload systemctl enable containerd --now   验证\n1 2 3  containerd -v containerd github.com/containerd/containerd v1.6.10 770bd0108c32f3fb5c73ae1264f7e503fe7b2661   1 2 3 4 5 6 7 8 9 10 11  ctr version Client: Version: v1.6.10 Revision: 770bd0108c32f3fb5c73ae1264f7e503fe7b2661 Go version: go1.18.8 Server: Version: v1.6.10 Revision: 770bd0108c32f3fb5c73ae1264f7e503fe7b2661 UUID: b2acca82-0694-4df2-890e-93cc9f6c3069   1 2 3 4 5 6  crictl version Version: 0.1.0 RuntimeName: containerd RuntimeVersion: v1.6.10 RuntimeApiVersion: v1   安装 kubeadm、kubelet、kubectl 使用阿里云的源进行安装\n1 2 3 4 5 6 7 8 9 10  cat \u0026lt;\u0026lt;EOF \u0026gt; /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64 enabled=1 gpgcheck=0 repo_gpgcheck=0 gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg EOF   安装 kubeadm、kubelet、kubectl\n1 2 3 4 5 6 7 8 9 10  yum makecache fast # 查看可安装版本 yum list kubectl --showduplicates|grep 1.25 # --disableexcludes 禁掉除了kubernetes之外的别的仓库 yum install -y kubelet-1.25.4 kubeadm-1.25.4 kubectl-1.25.4 --disableexcludes=kubernetes # 删除软件包 yum remove -y kubelet-1.25.4 kubeadm-1.25.4 kubectl-1.25.4 yum install -y kubelet-1.25.6 kubeadm-1.25.6 kubectl-1.25.6 --disableexcludes=kubernetes   验证+开机自启\n1 2 3  kubeadm version kubectl version --client systemctl enable --now kubelet   创建成镜像，复制两台做node 设置三台机器 hostname\n1 2  hostnamectl set-hostname node1 hostnamectl set-hostname node2   重启生效\nhosts\n1 2 3 4 5 6 7  [root@master ~]# cat /etc/hosts 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 192.168.122.88 master 192.168.122.221 node1 192.168.122.105 node2   创建集群 修改 kubeadm 配置文件 输出集群初始化默认使用的配置\n1  kubeadm config print init-defaults --component-configs KubeletConfiguration \u0026gt; kubeadm.yaml   查看需要的镜像\n1 2 3 4 5 6 7 8 9  [root@master ~]# kubeadm config images list I0219 23:33:43.205958 4423 version.go:256] remote version is much newer: v1.26.1; falling back to: stable-1.25 registry.k8s.io/kube-apiserver:v1.25.6 registry.k8s.io/kube-controller-manager:v1.25.6 registry.k8s.io/kube-scheduler:v1.25.6 registry.k8s.io/kube-proxy:v1.25.6 registry.k8s.io/pause:3.8 registry.k8s.io/etcd:3.5.5-0 registry.k8s.io/coredns/coredns:v1.9.3   预先在各个服务器节点上拉取所 k8s 需要的容器镜像。\n1  kubeadm config images pull --config kubeadm.yaml   执行错误\n1 2 3  [root@master ~]# kubeadm config images pull --config kubeadm.yaml invalid configuration for GroupVersionKind /, Kind=InitConfiguration: kind and apiVersion is mandatory information that must be specified To see the stack trace of this error execute with --v=5 or higher   问题原因\n1  kubeadm.yaml文件内容粘贴错误   尝试下面方法\n1 2 3 4 5 6 7 8 9 10 11 12  [root@master ~]# kubeadm config images pull --image-repository=registry.aliyuncs.com/k8sxio I0219 23:36:09.944807 4603 version.go:256] remote version is much newer: v1.26.1; falling back to: stable-1.25 [config/images] Pulled registry.aliyuncs.com/k8sxio/kube-apiserver:v1.25.6 [config/images] Pulled registry.aliyuncs.com/k8sxio/kube-controller-manager:v1.25.6 [config/images] Pulled registry.aliyuncs.com/k8sxio/kube-scheduler:v1.25.6 [config/images] Pulled registry.aliyuncs.com/k8sxio/kube-proxy:v1.25.6 [config/images] Pulled registry.aliyuncs.com/k8sxio/pause:3.8 [config/images] Pulled registry.aliyuncs.com/k8sxio/etcd:3.5.5-0 failed to pull image \u0026#34;registry.aliyuncs.com/k8sxio/coredns:v1.9.3\u0026#34;: output: E0219 23:36:32.189360 4681 remote_image.go:238] \u0026#34;PullImage from image service failed\u0026#34; err=\u0026#34;rpc error: code = NotFound desc = failed to pull and unpack image \\\u0026#34;registry.aliyuncs.com/k8sxio/coredns:v1.9.3\\\u0026#34;: failed to resolve reference \\\u0026#34;registry.aliyuncs.com/k8sxio/coredns:v1.9.3\\\u0026#34;: registry.aliyuncs.com/k8sxio/coredns:v1.9.3: not found\u0026#34; image=\u0026#34;registry.aliyuncs.com/k8sxio/coredns:v1.9.3\u0026#34; time=\u0026#34;2023-02-19T23:36:32+08:00\u0026#34; level=fatal msg=\u0026#34;pulling image: rpc error: code = NotFound desc = failed to pull and unpack image \\\u0026#34;registry.aliyuncs.com/k8sxio/coredns:v1.9.3\\\u0026#34;: failed to resolve reference \\\u0026#34;registry.aliyuncs.com/k8sxio/coredns:v1.9.3\\\u0026#34;: registry.aliyuncs.com/k8sxio/coredns:v1.9.3: not found\u0026#34; , error: exit status 1 To see the stack trace of this error execute with --v=5 or higher   在拉取 coredns 镜像的时候出错了，没有找到这个镜像，我们可以手动 pull 该镜像，然后重新 tag 下镜像地址即可：\n1 2 3  # 在node上操作 ctr -n k8s.io i pull docker.io/coredns/coredns:1.9.3 ctr -n k8s.io i tag docker.io/coredns/coredns:1.9.3 registry.aliyuncs.com/k8sxio/coredns:v1.9.3   初始化集群\n1  kubeadm init --config kubeadm.yaml   1 2 3 4 5  kubeadm init \\ --image-repository registry.aliyuncs.com/k8sxio \\ --kubernetes-version v1.25.6 \\ --pod-network-cidr=10.244.0.0/16 \\ --cri-socket /var/run/containerd/containerd.sock   1 2 3 4 5  kubeadm init \\ --image-repository registry.aliyuncs.com/k8sxio \\ --kubernetes-version v1.25.6 \\ --pod-network-cidr=10.244.0.0/16 \\ --cri-socket /run/containerd/containerd.sock   失败处理\n1 2 3  journalctl -xeu kubelet 2月 20 00:39:05 master kubelet[6934]: E0220 00:39:05.012927 6934 remote_runtime.go:222] \u0026#34;RunPodSandbox from runtime service failed\u0026#34; err=\u0026#34;rpc error: code = Unknown desc = failed to get sandbox image \\\u0026#34;registry.k8s.io/paus 2月 20 00:39:05 master kubelet[6934]: E0220 00:39:05.012965 6934 kuberuntime_sandbox.go:71] \u0026#34;Failed to create sandbox for pod\u0026#34; err=\u0026#34;rpc error: code = Unknown desc = failed to get sandbox image \\\u0026#34;registry.k8s.io/pause:3.6   1 2 3 4 5  # 每台机器都要操作 ctr -n k8s.io i pull registry.aliyuncs.com/k8sxio/pause:3.6 ctr -n k8s.io i tag registry.aliyuncs.com/k8sxio/pause:3.6 registry.k8s.io/pause:3.6 kubeadm reset 重新初始化   根据安装提示拷贝 kubeconfig 文件：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  Your Kubernetes control-plane has initialized successfully! To start using your cluster, you need to run the following as a regular user: mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config Alternatively, if you are the root user, you can run: export KUBECONFIG=/etc/kubernetes/admin.conf You should now deploy a pod network to the cluster. Run \u0026#34;kubectl apply -f [podnetwork].yaml\u0026#34; with one of the options listed at: https://kubernetes.io/docs/concepts/cluster-administration/addons/ Then you can join any number of worker nodes by running the following on each as root: kubeadm join 192.168.122.88:6443 --token 9xmb00.jgg2ytslgqgavcxc \\ --discovery-token-ca-cert-hash sha256:5dc53c7febabebb55cdd616d6614da055a3c2c2859a3b6128ccb4366ab486342   添加节点\n1 2 3 4 5 6 7 8 9 10 11  [root@master ~]# kubeadm token create --print-join-command kubeadm join 192.168.122.88:6443 --token 57d01o.hd3y1o1g83sv8nkq --discovery-token-ca-cert-hash sha256:5dc53c7febabebb55cdd616d6614da055a3c2c2859a3b6128ccb4366ab486342 kubeadm join 192.168.122.88:6443 --token 9xmb00.jgg2ytslgqgavcxc \\ --discovery-token-ca-cert-hash sha256:5dc53c7febabebb55cdd616d6614da055a3c2c2859a3b6128ccb4366ab486342 [root@master ~]# kubectl get node NAME STATUS ROLES AGE VERSION master NotReady control-plane 7m52s v1.25.6 node1 NotReady \u0026lt;none\u0026gt; 90s v1.25.6 node2 NotReady \u0026lt;none\u0026gt; 50s v1.25.6   安装网络插件 安装 flannel 1  wget https://raw.githubusercontent.com/flannel-io/flannel/v0.20.1/Documentation/kube-flannel.yml   1  kubectl apply -f kube-flannel.yml   清理 1 2 3 4  kubeadm reset ifconfig cni0 down \u0026amp;\u0026amp; ip link delete cni0 ifconfig flannel.1 down \u0026amp;\u0026amp; ip link delete flannel.1 rm -rf /var/lib/cni/   Dashboard 一键安装\n1 2 3 4 5  wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml vim recommended.yaml # 修改Service为NodePort类型 # 创建 kubectl apply -f recommended.yaml   Dashboard 会被默认安装在 kubernetes-dashboard 这个命名空间下面\n1 2 3 4  [root@master ~]# k get pod -n kubernetes-dashboard NAME READY STATUS RESTARTS AGE dashboard-metrics-scraper-64bcc67c9c-qxxdb 1/1 Running 0 25s kubernetes-dashboard-5c8bd6b59-hvcmz 1/1 Running 0 25s   查看 Dashboard 的 NodePort 端口：\n1 2 3 4  [root@master ~]# k -n kubernetes-dashboard get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE dashboard-metrics-scraper ClusterIP 10.104.242.146 \u0026lt;none\u0026gt; 8000/TCP 58s kubernetes-dashboard NodePort 10.97.53.187 \u0026lt;none\u0026gt; 443:31113/TCP 58s   浏览器访问https://192.168.122.88:31113/\n后创建一个具有全局所有权限的用户来登录 Dashboard：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  # admin.yaml apiVersion: v1 kind: ServiceAccount metadata: name: admin-user namespace: kubernetes-dashboard --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: admin-user roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: cluster-admin subjects: - kind: ServiceAccount name: admin-user namespace: kubernetes-dashboard   1  k apply -f admin.yaml   使用 kubectl create token 命令来请求一个 service account token：\n1 2  # 请求创建一个 token 作为 kubernetes-dashboard 命名空间中的 admin-user 这个 sa 对 kube-apiserver 进行身份验证 kubectl -n kubernetes-dashboard create token admin-user   output\n1  eyJhbGciOiJSUzI1NiIsImtpZCI6IjVpN0xiazlNT1VwdGc5MGIxNTloOVVGSE9rMlp4b0J2NF9KLUZhT25ONTgifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjc2OTA0MTM2LCJpYXQiOjE2NzY5MDA1MzYsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJhZG1pbi11c2VyIiwidWlkIjoiMmNkNmZkNjktNDgwMS00NDg4LWJmNmYtYTU5OTk1NDZmNzg4In19LCJuYmYiOjE2NzY5MDA1MzYsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlcm5ldGVzLWRhc2hib2FyZDphZG1pbi11c2VyIn0.PGmc5jL4wyDCDmMAgXh4WA7kdfc1nrFuvq6zWCsM96zSyxzpB_yqtSCjfoOxlmTRvddiVuZRd8V8lcgka7rPuISJgm0AXN-1vX1sZaA7YTCLuEwMfRRo9cG8Z6k36TiWuDiKETyG5lPUh7FbfHccYh7nRHAoKyKmkkZlDrt2rEQI8jAVEpoJVDC0KEo-pC146dZe9dXgcT5JrDRjbVnYOVfTQAjxNYMkSf1uOGyKo00GoFK5PI-4NsLC751YxXxFILnhH8ojm3nz3vurJr4mNvHcGrYGnSu6ki12_SKsLHQRthzkRmDCJAOzmxMuk04sGC2KP7nxDgP4DVrJc3rZXQ   用上面的字符串作为 token 登录 Dashboard 即可\n","date":"2023-02-20T09:00:00+08:00","permalink":"https://mkbooks.github.io/blog/p/centos7.9-%E4%B8%8B%E5%AE%89%E8%A3%85-kubernetes-v1.25.6/","title":"CentOS7.9 下安装 kubernetes v1.25.6"},{"content":"环境  操作系统: CentOS7.9 cpu 架构: x86 kubernetes 版本: v1.25.6  系统版本 版本号\n1 2  [root@master ~]# cat /etc/centos-release CentOS Linux release 7.9.2009 (Core)   内核版本\n1 2  [root@master ~]# uname -r 3.10.0-1160.el7.x86_64   操作系统位数\n1 2  [root@master ~]# getconf LONG_BIT 64   环境准备 设置 hostname 1  hostnamectl set-hostname master   添加到/etc/hosts\n1 2 3  vim /etc/hosts 192.168.122.88 master   禁用防火墙 1 2  [root@master ~]# systemctl stop firewalld [root@master ~]# systemctl disable firewalld   禁用 SELINUX 1 2 3 4  # 暂时性 [root@master ~]# setenforce 0 # 永久 [root@master ~]# vim /etc/selinux/config    SELINUX=disabled，重新启动系统，使更改生效。\n 开启内核 ipv4 转发 加载 br_netfilter 模块\n1  [root@master ~]# modprobe br_netfilter   令设置成开机启动\n1 2 3 4 5  vim /etc/rc.d/rc.local # 添加 for file in /etc/sysconfig/modules/*.modules ; do [ -x $file ] \u0026#34;# $file done   在 /etc/sysconfig/modules/ 目录下新建如下文件：\n1 2  mkdir -p /etc/sysconfig/modules/ vi /etc/sysconfig/modules/br_netfilter.modules    modprobe br_netfilter\n 增加权限\n1  chmod 755 /etc/sysconfig/modules/br_netfilter.modules   重启测试\n1 2 3 4  lsmod|grep br_netfilter br_netfilter 22256 0 bridge 151336 1 br_netfilter   创建 vim /etc/sysctl.d/k8s.conf 文件，添加如下内容\n1 2 3 4 5 6 7  net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 net.ipv4.ip_forward = 1 # 下面的内核参数可以解决ipvs模式下长连接空闲超时的问题 net.ipv4.tcp_keepalive_intvl = 30 net.ipv4.tcp_keepalive_probes = 10 net.ipv4.tcp_keepalive_time = 600   令使修改生效\n1  sysctl -p /etc/sysctl.d/k8s.conf   关闭 Swap 1 2  swapoff -a vi /etc/fstab   remove the line with swap keyword\n设置 iptables 1 2 3  cat \u0026lt;\u0026lt;EOF | sudo tee /etc/modules-load.d/k8s.conf br_netfilter EOF   1 2 3 4  cat \u0026lt;\u0026lt;EOF | sudo tee /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 EOF   1  sysctl --system   安装 ipvs 1 2 3 4 5 6 7 8  cat \u0026gt; /etc/sysconfig/modules/ipvs.modules \u0026lt;\u0026lt;EOF #!/bin/bash modprobe -- ip_vs modprobe -- ip_vs_rr modprobe -- ip_vs_wrr modprobe -- ip_vs_sh modprobe -- nf_conntrack_ipv4 EOF   1  chmod 755 /etc/sysconfig/modules/ipvs.modules \u0026amp;\u0026amp; bash /etc/sysconfig/modules/ipvs.modules \u0026amp;\u0026amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv4   output:\n1 2 3 4 5 6 7 8  nf_conntrack_ipv4 15053 0 nf_defrag_ipv4 12729 1 nf_conntrack_ipv4 ip_vs_sh 12688 0 ip_vs_wrr 12697 0 ip_vs_rr 12600 0 ip_vs 145458 6 ip_vs_rr,ip_vs_sh,ip_vs_wrr nf_conntrack 139264 2 ip_vs,nf_conntrack_ipv4 libcrc32c 12644 3 xfs,ip_vs,nf_conntrack   安装管理工具ipvsadm：\n1 2  yum install ipset yum install ipvsadm -y   同步服务器时间 这里使用 chrony 来进行同步，其他工具也可以：\n1 2 3 4  yum install chrony -y systemctl enable chronyd systemctl start chronyd chronyc sources   output\n1 2 3 4 5 6 7  210 Number of sources = 4 MS Name/IP address Stratum Poll Reach LastRx Last sample =============================================================================== ^- ns1.newsnet.li 2 6 17 3 -7556us[-7556us] +/- 148ms ^? ntp6.flashdance.cx 2 6 3 1 +16ms[ +16ms] +/- 161ms ^* 36.110.233.85 2 6 17 4 -53us[ -10ms] +/- 70ms ^? a.chl.la 2 6 10 9 -33ms[ -467ms] +/- 174ms   查看时间\n1 2  [root@master ~]# date 2023年 02月 19日 星期日 21:44:15 CST   关闭 swap 分区 1  swapoff -a   修改 /etc/fstab 文件，注释掉 SWAP 的自动挂载，使用 free -m 确认 swap 已经关闭。swappiness 参数调整，修改 /etc/sysctl.d/k8s.conf 添加下面一行：\n1  vm.swappiness=0   执行 sysctl -p /etc/sysctl.d/k8s.conf 使修改生效。\n当然如果是生产环境使用还可以先对内核参数进行统一的调优。\n安装 Containerd 安装 seccomp 依赖 在节点上安装 seccomp 依赖，需要版本 \u0026gt;2.4，如果有则升级\n1 2 3  rpm -qa |grep libseccomp output: libseccomp-2.3.1-4.el7.x86_64   卸载\n1  yum remove libseccomp-2.3.1-4.el7.x86_64 -y   output\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  ... Running transaction 正在删除 : chrony-3.4-1.el7.x86_64 1/2 正在删除 : libseccomp-2.3.1-4.el7.x86_64 2/2 验证中 : libseccomp-2.3.1-4.el7.x86_64 1/2 验证中 : chrony-3.4-1.el7.x86_64 2/2 删除: libseccomp.x86_64 0:2.3.1-4.el7 作为依赖被删除: chrony.x86_64 0:3.4-1.el7 完毕！   重新安装 chrony 1 2 3 4  yum install chrony -y systemctl enable chronyd systemctl start chronyd chronyc sources   安装 libseccomp 1 2  wget http://rpmfind.net/linux/centos/8-stream/BaseOS/x86_64/os/Packages/libseccomp-2.5.1-1.el8.x86_64.rpm yum install libseccomp-2.5.1-1.el8.x86_64.rpm -y   验证\n1 2 3  rpm -qa |grep libseccomp output: libseccomp-2.5.1-1.el8.x86_64   安装 Containerd 下载包\n1 2 3  # wget https://github.com/containerd/containerd/releases/download/v1.6.18/cri-containerd-cni-1.6.18-linux-amd64.tar.gz URL 加速 wget https://ghdl.feizhuqwq.cf/https://github.com/containerd/containerd/releases/download/v1.6.10/cri-containerd-1.6.10-linux-amd64.tar.gz   解压\n1  tar -C / -xzf cri-containerd-1.6.10-linux-amd64.tar.gz   将 /usr/local/bin 和 /usr/local/sbin 追加到 PATH 环境变量中：\n1 2  [root@master ~]# echo $PATH /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin   1 2 3 4 5 6 7 8 9  [root@master ~]# containerd -v containerd github.com/containerd/containerd v1.6.10 770bd0108c32f3fb5c73ae1264f7e503fe7b2661 [root@master ~]# runc -v runc version 1.1.4 commit: v1.1.4-0-g5fd4c4d1 spec: 1.0.2-dev go: go1.18.8 libseccomp: 2.5.1   修改 containerd 默认配置 Containerd 的默认配置文件为 /etc/containerd/config.toml，我们可以通过如下所示的命令生成一个默认的配置：\n1 2  mkdir -p /etc/containerd containerd config default \u0026gt; /etc/containerd/config.toml   对于使用 systemd 作为 init system 的 Linux 的发行版，使用 systemd 作为容器的 cgroup driver 可以确 保节点在资源紧张的情况更加稳定，所以推荐将 containerd 的 cgroup driver 配置为 systemd。\n修改前面生成的配置文件 /etc/containerd/config.toml，在plugins.\u0026ldquo;io.containerd.grpc.v1.cri\u0026rdquo;.containerd.runtimes.runc.options 配置块下面将 SystemdCgroup 设置为 true ：\n1 2 3 4 5 6 7  [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.containerd.runtimes.runc] ... [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.containerd.runtimes.runc.options] ... SystemdCgroup = true [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.containerd.untrusted_workload_runtime]   然后再为镜像仓库配置一个加速器，需要在 cri 配置块下面的 registry 配置块下面进行配置 registry.mirrors ：\n1 2 3 4 5 6 7 8 9  [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;] ... # sandbox_image = \u0026#34;registry.k8s.io/pause:3.6\u0026#34; sandbox_image = \u0026#34;registry.aliyuncs.com/k8sxio/pause:3.8\u0026#34; ... [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.registry] [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.registry.mirrors] [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.registry.mirrors.\u0026#34;docker.io\u0026#34;] endpoint = [\u0026#34;https://bqr1dr1n.mirror.aliyuncs.com\u0026#34;]   使配置生效\n1 2  systemctl daemon-reload systemctl enable containerd --now   验证\n1 2 3  containerd -v containerd github.com/containerd/containerd v1.6.10 770bd0108c32f3fb5c73ae1264f7e503fe7b2661   1 2 3 4 5 6 7 8 9 10 11  ctr version Client: Version: v1.6.10 Revision: 770bd0108c32f3fb5c73ae1264f7e503fe7b2661 Go version: go1.18.8 Server: Version: v1.6.10 Revision: 770bd0108c32f3fb5c73ae1264f7e503fe7b2661 UUID: b2acca82-0694-4df2-890e-93cc9f6c3069   1 2 3 4 5 6  crictl version Version: 0.1.0 RuntimeName: containerd RuntimeVersion: v1.6.10 RuntimeApiVersion: v1   安装 kubeadm、kubelet、kubectl 使用阿里云的源进行安装\n1 2 3 4 5 6 7 8 9 10  cat \u0026lt;\u0026lt;EOF \u0026gt; /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64 enabled=1 gpgcheck=0 repo_gpgcheck=0 gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg EOF   安装 kubeadm、kubelet、kubectl\n1 2 3 4 5 6  yum makecache fast # 查看可安装版本 yum list kubectl --showduplicates|grep 1.25 # --disableexcludes 禁掉除了kubernetes之外的别的仓库 yum install -y kubelet-1.25.4 kubeadm-1.25.4 kubectl-1.25.4 --disableexcludes=kubernetes   验证+开机自启\n1 2 3  kubeadm version kubectl version --client systemctl enable --now kubelet   创建成镜像，复制两台做node 设置三台机器 hostname\n1 2  hostnamectl set-hostname node1 hostnamectl set-hostname node2   重启生效\nhosts\n1 2 3 4 5 6 7  [root@master ~]# cat /etc/hosts 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 192.168.122.88 master 192.168.122.221 node1 192.168.122.105 node2   创建集群 修改 kubeadm 配置文件 输出集群初始化默认使用的配置\n1  kubeadm config print init-defaults --component-configs KubeletConfiguration \u0026gt; kubeadm.yaml   查看需要的镜像\n1 2 3 4 5 6 7 8 9  [root@master ~]# kubeadm config images list I0219 23:33:43.205958 4423 version.go:256] remote version is much newer: v1.26.1; falling back to: stable-1.25 registry.k8s.io/kube-apiserver:v1.25.6 registry.k8s.io/kube-controller-manager:v1.25.6 registry.k8s.io/kube-scheduler:v1.25.6 registry.k8s.io/kube-proxy:v1.25.6 registry.k8s.io/pause:3.8 registry.k8s.io/etcd:3.5.5-0 registry.k8s.io/coredns/coredns:v1.9.3   预先在各个服务器节点上拉取所 k8s 需要的容器镜像。\n1  kubeadm config images pull --config kubeadm.yaml   执行错误\n1 2 3  [root@master ~]# kubeadm config images pull --config kubeadm.yaml invalid configuration for GroupVersionKind /, Kind=InitConfiguration: kind and apiVersion is mandatory information that must be specified To see the stack trace of this error execute with --v=5 or higher   尝试下面方法\n1 2 3 4 5 6 7 8 9 10 11 12  [root@master ~]# kubeadm config images pull --image-repository=registry.aliyuncs.com/k8sxio I0219 23:36:09.944807 4603 version.go:256] remote version is much newer: v1.26.1; falling back to: stable-1.25 [config/images] Pulled registry.aliyuncs.com/k8sxio/kube-apiserver:v1.25.6 [config/images] Pulled registry.aliyuncs.com/k8sxio/kube-controller-manager:v1.25.6 [config/images] Pulled registry.aliyuncs.com/k8sxio/kube-scheduler:v1.25.6 [config/images] Pulled registry.aliyuncs.com/k8sxio/kube-proxy:v1.25.6 [config/images] Pulled registry.aliyuncs.com/k8sxio/pause:3.8 [config/images] Pulled registry.aliyuncs.com/k8sxio/etcd:3.5.5-0 failed to pull image \u0026#34;registry.aliyuncs.com/k8sxio/coredns:v1.9.3\u0026#34;: output: E0219 23:36:32.189360 4681 remote_image.go:238] \u0026#34;PullImage from image service failed\u0026#34; err=\u0026#34;rpc error: code = NotFound desc = failed to pull and unpack image \\\u0026#34;registry.aliyuncs.com/k8sxio/coredns:v1.9.3\\\u0026#34;: failed to resolve reference \\\u0026#34;registry.aliyuncs.com/k8sxio/coredns:v1.9.3\\\u0026#34;: registry.aliyuncs.com/k8sxio/coredns:v1.9.3: not found\u0026#34; image=\u0026#34;registry.aliyuncs.com/k8sxio/coredns:v1.9.3\u0026#34; time=\u0026#34;2023-02-19T23:36:32+08:00\u0026#34; level=fatal msg=\u0026#34;pulling image: rpc error: code = NotFound desc = failed to pull and unpack image \\\u0026#34;registry.aliyuncs.com/k8sxio/coredns:v1.9.3\\\u0026#34;: failed to resolve reference \\\u0026#34;registry.aliyuncs.com/k8sxio/coredns:v1.9.3\\\u0026#34;: registry.aliyuncs.com/k8sxio/coredns:v1.9.3: not found\u0026#34; , error: exit status 1 To see the stack trace of this error execute with --v=5 or higher   在拉取 coredns 镜像的时候出错了，没有找到这个镜像，我们可以手动 pull 该镜像，然后重新 tag 下镜像地址即可：\n1 2 3  # 在node上操作 ctr -n k8s.io i pull docker.io/coredns/coredns:1.9.3 ctr -n k8s.io i tag docker.io/coredns/coredns:1.9.3 registry.aliyuncs.com/k8sxio/coredns:v1.9.3   初始化集群\n1  kubeadm init --config kubeadm.yaml   1 2 3 4 5  kubeadm init \\ --image-repository registry.aliyuncs.com/k8sxio \\ --kubernetes-version v1.25.6 \\ --pod-network-cidr=10.244.0.0/16 \\ --cri-socket /var/run/containerd/containerd.sock   1 2 3 4 5  kubeadm init \\ --image-repository registry.aliyuncs.com/k8sxio \\ --kubernetes-version v1.25.6 \\ --pod-network-cidr=10.244.0.0/16 \\ --cri-socket /run/containerd/containerd.sock   失败处理\n1 2 3  journalctl -xeu kubelet 2月 20 00:39:05 master kubelet[6934]: E0220 00:39:05.012927 6934 remote_runtime.go:222] \u0026#34;RunPodSandbox from runtime service failed\u0026#34; err=\u0026#34;rpc error: code = Unknown desc = failed to get sandbox image \\\u0026#34;registry.k8s.io/paus 2月 20 00:39:05 master kubelet[6934]: E0220 00:39:05.012965 6934 kuberuntime_sandbox.go:71] \u0026#34;Failed to create sandbox for pod\u0026#34; err=\u0026#34;rpc error: code = Unknown desc = failed to get sandbox image \\\u0026#34;registry.k8s.io/pause:3.6   1 2 3 4 5  # 每台机器都要操作 ctr -n k8s.io i pull registry.aliyuncs.com/k8sxio/pause:3.6 ctr -n k8s.io i tag registry.aliyuncs.com/k8sxio/pause:3.6 registry.k8s.io/pause:3.6 kubeadm reset 重新初始化   根据安装提示拷贝 kubeconfig 文件：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  Your Kubernetes control-plane has initialized successfully! To start using your cluster, you need to run the following as a regular user: mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config Alternatively, if you are the root user, you can run: export KUBECONFIG=/etc/kubernetes/admin.conf You should now deploy a pod network to the cluster. Run \u0026#34;kubectl apply -f [podnetwork].yaml\u0026#34; with one of the options listed at: https://kubernetes.io/docs/concepts/cluster-administration/addons/ Then you can join any number of worker nodes by running the following on each as root: kubeadm join 192.168.122.88:6443 --token 9xmb00.jgg2ytslgqgavcxc \\ --discovery-token-ca-cert-hash sha256:5dc53c7febabebb55cdd616d6614da055a3c2c2859a3b6128ccb4366ab486342   添加节点\n1 2 3 4 5 6 7 8 9 10 11  [root@master ~]# kubeadm token create --print-join-command kubeadm join 192.168.122.88:6443 --token 57d01o.hd3y1o1g83sv8nkq --discovery-token-ca-cert-hash sha256:5dc53c7febabebb55cdd616d6614da055a3c2c2859a3b6128ccb4366ab486342 kubeadm join 192.168.122.88:6443 --token 9xmb00.jgg2ytslgqgavcxc \\ --discovery-token-ca-cert-hash sha256:5dc53c7febabebb55cdd616d6614da055a3c2c2859a3b6128ccb4366ab486342 [root@master ~]# kubectl get node NAME STATUS ROLES AGE VERSION master NotReady control-plane 7m52s v1.25.6 node1 NotReady \u0026lt;none\u0026gt; 90s v1.25.6 node2 NotReady \u0026lt;none\u0026gt; 50s v1.25.6   安装网络插件 安装 flannel 1  wget https://raw.githubusercontent.com/flannel-io/flannel/v0.20.1/Documentation/kube-flannel.yml   1  kubectl apply -f kube-flannel.yml   清理 1 2 3 4  kubeadm reset ifconfig cni0 down \u0026amp;\u0026amp; ip link delete cni0 ifconfig flannel.1 down \u0026amp;\u0026amp; ip link delete flannel.1 rm -rf /var/lib/cni/   ","date":"2023-02-19T09:00:00+08:00","permalink":"https://mkbooks.github.io/blog/p/centos7.9%E4%B8%8B%E5%AE%89%E8%A3%85kubernetes-v1.25.4/","title":"CentOS7.9下安装kubernetes v1.25.4"},{"content":"containerd文档\n切换用户 1  sudo -i   暂停服务 1 2 3  systemctl stop kubelet systemctl stop docker systemctl stop containerd   创建 containerd 配置目录 1 2  mkdir -p /etc/containerd containerd config default | tee /etc/containerd/config.toml   修改默认配置 /etc/containerd/config.toml\n1 2  sed -i s#k8s.gcr.io/pause:3.5#registry.aliyuncs.com/google_containers/pause:3.5#g /etc/containerd/config.toml sed -i s#\u0026#39;SystemdCgroup = false\u0026#39;#\u0026#39;SystemdCgroup = true\u0026#39;#g /etc/containerd/config.toml   修改 kubelet 配置 1 2  vi /etc/systemd/system/kubelet.service.d/10-kubeadm.conf Environment=\u0026#34;KUBELET_EXTRA_ARGS=--container-runtime=remote --container-runtime-endpoint=unix:///run/containerd/containerd.sock\u0026#34;   重启服务 1 2 3  systemctl daemon-reload systemctl restart containerd systemctl restart kubelet   配置 crictl 以设置正确的端点 1 2 3  cat \u0026lt;\u0026lt;EOF | sudo tee /etc/crictl.yaml runtime-endpoint: unix:///run/containerd/containerd.sock EOF   ","date":"2023-02-17T21:20:00+08:00","permalink":"https://mkbooks.github.io/blog/p/kubernetes%E4%BF%AE%E6%94%B9%E8%BF%90%E8%A1%8C%E6%97%B6/","title":"kubernetes修改运行时"},{"content":"查看 \u0026ldquo;Controller Manager\u0026rdquo; 的帮助 1 2 3 4 5 6 7 8 9 10 11  k8s@k8s:~/101$ ks get pod NAME READY STATUS RESTARTS AGE coredns-7f6cbbb7b8-6zd49 1/1 Running 11 (15d ago) 64d coredns-7f6cbbb7b8-7kshr 1/1 Running 11 (15d ago) 64d etcd-k8s 1/1 Running 11 (15d ago) 64d kube-apiserver-k8s 1/1 Running 11 (15d ago) 64d kube-controller-manager-k8s 1/1 Running 11 (15d ago) 64d kube-proxy-m9kgw 1/1 Running 11 (15d ago) 64d kube-scheduler-k8s 1/1 Running 11 (15d ago) 64d k8s@k8s:~/101$ ks exec -it kube-controller-manager-k8s -- kube-controller-manager -h The Kubernetes controller manager is a daemon that embeds   ","date":"2023-02-12T21:29:00+08:00","permalink":"https://mkbooks.github.io/blog/p/controller-manager/","title":"Controller Manager"},{"content":"将 replicas 设为 0\n1  k scale --replicas=0 deployment/deployment_name   ","date":"2023-02-10T13:00:00+08:00","permalink":"https://mkbooks.github.io/blog/p/%E5%81%9C%E6%AD%A2deployment%E4%B8%8D%E5%88%A0%E9%99%A4/","title":"停止deployment不删除"},{"content":"问题 1 操作 1 2 3 4 5 6 7 8 9 10 11 12 13 14  if __name__ == \u0026#34;__main__\u0026#34;: name = \u0026#34;陈金鑫\u0026#34; logger.info( json.dumps( { \u0026#34;name\u0026#34;: name, \u0026#34;age\u0026#34;: 10, \u0026#34;operator_time\u0026#34;: time.strftime( \u0026#34;%Y-%m-%d %H:%M:%S\u0026#34;, time.localtime((int(round(time.time() * 1000))) / 1000), ), } ) )   print\n1  line 48： {\u0026#34;name\u0026#34;: \u0026#34;\\u9648\\u91d1\\u946b\u0026#34;, \u0026#34;age\u0026#34;: 10, \u0026#34;operator_time\u0026#34;: \u0026#34;2023-02-01 14:20:35\u0026#34;}   解决  添加：ensure_ascii=False\n 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  if __name__ == \u0026#34;__main__\u0026#34;: name = \u0026#34;陈金鑫\u0026#34; logger.info( json.dumps( { \u0026#34;name\u0026#34;: name, \u0026#34;age\u0026#34;: 10, \u0026#34;operator_time\u0026#34;: time.strftime( \u0026#34;%Y-%m-%d %H:%M:%S\u0026#34;, time.localtime((int(round(time.time() * 1000))) / 1000), ), }, ensure_ascii=False, ) )   print\n1  line 48： {\u0026#34;name\u0026#34;: \u0026#34;陈金鑫\u0026#34;, \u0026#34;age\u0026#34;: 10, \u0026#34;operator_time\u0026#34;: \u0026#34;2023-02-01 14:21:33\u0026#34;}   ","date":"2023-02-01T14:10:00+08:00","permalink":"https://mkbooks.github.io/blog/p/json-%E7%BC%96%E7%A0%81/","title":"JSON 编码"},{"content":" 版本  helm version  version.BuildInfo{Version:\u0026quot;v3.7.0\u0026quot;, GitCommit:\u0026quot;eeac83883cb4014fe60267ec6373570374ce770b\u0026quot;, GitTreeState:\u0026quot;clean\u0026quot;, GoVersion:\u0026quot;go1.16.8\u0026quot;}      问题 1 操作 1 2 3 4  helm repo add bitnami https://charts.bitnami.com/bitnami helm search repo bitnami | grep mysql helm repo update helm install bitnami/mysql --generate-name   报错 1  Error: INSTALLATION FAILED: Kubernetes cluster unreachable: Get \u0026#34;http://localhost:8080/version?timeout=32s\u0026#34;: dial tcp 127.0.0.1:8080: connect: connection refused   解决  手动配置 KUBECONFIG 环境变量\n 临时解决: export KUBECONFIG=/etc/rancher/k3s/k3s.yaml\n永久解决:\n1 2 3  vim ~/.bashrc # 写入内容: export KUBECONFIG=/etc/rancher/k3s/k3s.yaml source ~/.bashrc   原理 1  helm v3 版本不再需要 Tiller，而是直接访问 ApiServer 来与 k8s 交互，通过环境变量 KUBECONFIG 来读取存有 ApiServre 的地址与 token 的配置文件地址，默认地址为 ~/.kube/config   ","date":"2023-01-31T14:30:00+08:00","permalink":"https://mkbooks.github.io/blog/p/%E4%BD%BF%E7%94%A8-helm-%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/","title":"使用 helm 遇到的问题"},{"content":"  helm docs 官网\n  helm docs 中文文档\n  版本\n helm version  version.BuildInfo{Version:\u0026quot;v3.7.0\u0026quot;, GitCommit:\u0026quot;eeac83883cb4014fe60267ec6373570374ce770b\u0026quot;, GitTreeState:\u0026quot;clean\u0026quot;, GoVersion:\u0026quot;go1.16.8\u0026quot;}      基础操作 仓库  查看配置的仓库：helm repo list 添加新的仓库：helm repo add  helm repo add brigade https://brigadecore.github.io/charts   更新仓库：helm repo update 移除仓库: helm repo remove  Charts  查找可用的charts：helm search hub  helm search hub wordpress   从添加的仓库中查找可用的charts: helm search repo brigade  搜索使用模糊字符串匹配算法: helm search repo bri    安装一个 helm 包  使用 helm install 命令来安装一个新的 helm 包。最简单的使用方法只需要传入两个参数：你命名的release名字和你想安装的chart的名称。（如果想让Helm生成一个名称，删除发布名称并使用\u0026ndash;generate-name。）  helm install happy-panda bitnami/wordpress   使用 helm status 来追踪 release 的状态，或是重新读取配置信息：  helm status happy-panda    自定义 chart  使用 helm show values 可以查看 chart 中的可配置选项：helm show values bitnami/wordpress  使用 YAML 格式的文件覆盖上述任意配置项，并在安装过程中使用该文件。\n1 2  $ echo \u0026#39;{mariadb.auth.database: user0db, mariadb.auth.username: user0}\u0026#39; \u0026gt; values.yaml $ helm install -f values.yaml bitnami/wordpress --generate-name   安装过程中有两种方式传递配置数据：\n \u0026ndash;values (或 -f)：使用 YAML 文件覆盖配置。可以指定多次，优先使用最右边的文件。 \u0026ndash;set：通过命令行的方式对指定项进行覆盖。  升级 release 1  helm upgrade -f panda.yaml happy-panda bitnami/wordpress   失败时恢复 1  helm rollback happy-panda 1   查看配置值 helm get values happy-panda\n卸载 release 1  helm uninstall happy-panda   展示 Helm 保留的所有 release 记录，包括失败或删除的条目（指定了 \u0026ndash;keep-history）：helm list --all\n","date":"2023-01-31T14:20:00+08:00","permalink":"https://mkbooks.github.io/blog/p/helm-%E6%95%99%E7%A8%8B/","title":"helm 教程"},{"content":"系统 ubuntu20.04\n1 2  $ uname -a Linux cjx 5.15.0-56-generic #62-Ubuntu SMP Tue Nov 22 19:54:14 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux   安装工具 Ventoy\n系统设置 ssh 设置 创建秘钥 1  ssh-keygen   设置 root 密码 1  sudo passwd   sudo免密 1 2  sudo -i visudo   在%sudo ALL=(ALL:ALL) ALL的下一行添加${USER} ALL=(ALL:ALL) NOPASSWD:ALL\nsu root免密 查看组\n1 2  cjx@cjx:~$ groups cjx adm cdrom sudo dip plugdev lpadmin lxd sambashare   1  su root   给 cjx 用户添加组\n1 2  groupadd wheel usermod -G wheel cjx   修改su的配置文件（给 wheel 组设置免密）\n1  vim /etc/pam.d/su   1 2 3 4  # Uncomment this if you want wheel members to be able to # su without a password. auth required pam_wheel.so group=wheel auth sufficient pam_wheel.so trust use_uid   设置网络 火狐  登陆同步服务 设置 SwitchyOmega（使用内网其他可以上网的机器）  设置输入法 搜狗输入法  下载 安装  设置上网 设置服务器 1 2 3 4 5 6  sudo -i apt-get update -y \u0026amp;\u0026amp; apt-get install curl -y bash \u0026lt;(curl -s -L https://git.io/v2ray.sh) 1 v2ray url   Qv2ray  https://github.com/v2fly/v2ray-core/releases  unzip v2ray-linux-64.zip   https://github.com/Qv2ray/Qv2ray/releases  sudo chmod +x ./Qv2ray-refs.tags.v1.99.6-linux.AppImage sudo ./Qv2ray-refs.tags.v1.99.6-linux.AppImage    如果报错：\n1 2 3 4 5 6 7  dlopen(): error loading libfuse.so.2 AppImages require FUSE to run. You might still be able to extract the contents of this AppImage if you run it with the --appimage-extract option. See https://github.com/AppImage/AppImageKit/wiki/FUSE for more information   安装：sudo apt install libfuse2\n 首选项 -\u0026gt; 内核设置\n  设置服务器\nsudo v2ray url 搬瓦工  https://justmysocks5.net/members/clientarea.php?action=services   腾讯云 阿里云 谷歌云    SwitchyOmega.auto switch.规则列表设置: https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt\n  chrome 浏览器  下载 安装: sudo dpkg -i   设置 oh-my-zsh 参阅\noh-my-zsh\n 默认 shell: echo $SHELL 系统自带 shell: cat /etc/shells  安装 zsh  安装: sudo apt install zsh -y 查看是否已添加到 shell: cat /etc/shells  有 zsh 即可   设置 zsh 为默认 shell  当前用户: chsh -s /bin/zsh root 用户: sudo chsh -s /bin/zsh   重启: sudo reboot，或注销: logout  选择 2 : 使用推荐配置   查看默认 shell: echo $SHELL  输出/bin/zsh表示已修改成功    安装 oh-my-zsh  安装 curl: sudo apt install curl 下载 Git: sudo apt-get install git 安装 oh-my-zsh: sh -c \u0026quot;$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\u0026quot;  个性化 主题 官方主题网站\npowerlevel10k\nagnosterzak\npowerlevel10k  cd ~/.oh-my-zsh/themes git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k vi ~/.zshrc  ZSH_THEME=\u0026quot;powerlevel10k/powerlevel10k\u0026quot;, 默认: ZSH_THEME=\u0026quot;robbyrussell\u0026quot;   source ~/.zshrc sudo apt install fonts-powerline -y  agnosterzak  cd ~/.oh-my-zsh/themes wget https://raw.githubusercontent.com/zakaziko99/agnosterzak-ohmyzsh-theme/master/agnosterzak.zsh-theme vi ~/.zshrc  ZSH_THEME=\u0026quot;agnosterzak\u0026quot;, 默认: ZSH_THEME=\u0026quot;robbyrussell\u0026quot;   source ~/.zshrc sudo apt install fonts-powerline -y    如果ZSH_THEME=\u0026quot;\u0026quot;则不启用任何主题. 如果ZSH_THEME=\u0026quot;random\u0026quot;，那么每次打开一个新的终端窗口时，电脑会随机选择一个主题使用， echo $RANDOM_THEME可输出当前主题名称. 如果你想从你最喜欢的主题列表中选择随机主题，那么ZSH_THEME=\u0026quot;random\u0026quot;且 ZSH_THEME_RANDOM_CANDIDATES的值设置为你喜欢的主题名称 例如：ZSH_THEME_RANDOM_CANDIDATES=( \u0026quot;robbyrussell\u0026quot; \u0026quot;agnoster\u0026quot; )   插件 自动补全插件 incr  cd ~/.oh-my-zsh/plugins/ mkdir incr \u0026amp;\u0026amp; cd incr wget http://mimosa-pudica.net/src/incr-0.2.zsh vi ~/.zshrc  source ~/.oh-my-zsh/plugins/incr/incr*.zsh   source ~/.zshrc   提示： 与vim的提示相冲突的解决方案\n1 2  $ vim t _arguments:451: _vim_files: function definition file not found   将~/.zcompdump*删除即可\nrm -rf ~/.zcompdump*\nexec zsh\n 直接使用的插件   vi ~/.zshrc\n plugins=(git extract z)    source ~/.zshrc\n  git\n 默认开启的插件，提供了大量 git 的alias. 查看 alias: alias    extract\n 功能强大的解压插件，所有类型的文件解压一个命令x全搞定，再也不需要去记tar后面到底是哪几个参数了.    z\n 强大的目录自动跳转命令，会记忆你曾经进入过的目录，用模糊匹配快速进入你想要的目录.    安装zsh-autosuggestions语法历史记录插件  git clone --depth=1 https://github.com/zsh-users/zsh-autosuggestions.git $ZSH_CUSTOM/plugins/zsh-autosuggestions vim ~/.zshrc  1 2 3  plugins=(git zsh-autosuggestions) # 最后一行：（可以不加） # source $ZSH_CUSTOM/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh   source ~/.zshrc  其他   oh-my-zsh插件 git插件 大多数插件包括一个README，它记录了如何使用它们.   其他  更新   设置更新日期: vi ~/.zshrc  1  export UPDATE_ZSH_DAYS=13    禁用自动更新: vi ~/.zshrc  1  DISABLE_AUTO_UPDATE=\u0026#34;true\u0026#34;    手动更新oh-my-zsh: upgrade_oh_my_zsh  卸载   卸载oh-my-zsh  1  uninstall_oh_my_zsh zsh   .zshrc源文件内容  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100  # If you come from bash you might have to change your $PATH. # export PATH=$HOME/bin:/usr/local/bin:$PATH # Path to your oh-my-zsh installation. exportZSH=\u0026#34;/root/.oh-my-zsh\u0026#34;1.zsh主题# Set name of the theme to load --- if set to \u0026#34;random\u0026#34;, it will # load a random theme each time oh-my-zsh is loaded, in which case, # to know which specific one was loaded, run: echo $RANDOM_THEME # See https://github.com/robbyrussell/oh-my-zsh/wiki/Themes ZSH_THEME=\u0026#34;robbyrussell\u0026#34;# Set list of themes to pick from when loading at random # Setting this variable when ZSH_THEME=random will cause zsh to load # a theme from this variable instead of looking in ~/.oh-my-zsh/themes/ # If set to an empty array, this variable will have no effect. # ZSH_THEME_RANDOM_CANDIDATES=( \u0026#34;robbyrussell\u0026#34; \u0026#34;agnoster\u0026#34; ) # Uncomment the following line to use case-sensitive completion. # CASE_SENSITIVE=\u0026#34;true\u0026#34; # Uncomment the following line to use hyphen-insensitive completion. # Case-sensitive completion must be off. _ and - will be interchangeable. # HYPHEN_INSENSITIVE=\u0026#34;true\u0026#34; 2.是否自动更新# Uncomment the following line to disable bi-weekly auto-update checks. # DISABLE_AUTO_UPDATE=\u0026#34;true\u0026#34; 3.更新周期# Uncomment the following line to change how often to auto-update (in days). # export UPDATE_ZSH_DAYS=13 # Uncomment the following line to disable colors in ls. # DISABLE_LS_COLORS=\u0026#34;true\u0026#34; # Uncomment the following line to disable auto-setting terminal title. # DISABLE_AUTO_TITLE=\u0026#34;true\u0026#34; # Uncomment the following line to enable command auto-correction. # ENABLE_CORRECTION=\u0026#34;true\u0026#34; # Uncomment the following line to display red dots whilst waiting for completion. # COMPLETION_WAITING_DOTS=\u0026#34;true\u0026#34; # Uncomment the following line if you want to disable marking untracked files # under VCS as dirty. This makes repository status check for large repositories # much, much faster. # DISABLE_UNTRACKED_FILES_DIRTY=\u0026#34;true\u0026#34; # Uncomment the following line if you want to change the command execution time # stamp shown in the history command output. # You can set one of the optional three formats: # \u0026#34;mm/dd/yyyy\u0026#34;|\u0026#34;dd.mm.yyyy\u0026#34;|\u0026#34;yyyy-mm-dd\u0026#34; # or set a custom format using the strftime function format specifications, # see \u0026#39;man strftime\u0026#39; for details. # HIST_STAMPS=\u0026#34;mm/dd/yyyy\u0026#34; # Would you like to use another custom folder than $ZSH/custom? # ZSH_CUSTOM=/path/to/new-custom-folder 4.zsh插件# Which plugins would you like to load? # Standard plugins can be found in ~/.oh-my-zsh/plugins/* # Custom plugins may be added to ~/.oh-my-zsh/custom/plugins/ # Example format: plugins=(rails git textmate ruby lighthouse) # Add wisely, as too many plugins slow down shell startup. plugins=(git)source$ZSH/oh-my-zsh.sh# User configuration # export MANPATH=\u0026#34;/usr/local/man:$MANPATH\u0026#34; # You may need to manually set your language environment # export LANG=en_US.UTF-8 # Preferred editor for local and remote sessions # if [[ -n $SSH_CONNECTION ]]; then # export EDITOR=\u0026#39;vim\u0026#39; # else # export EDITOR=\u0026#39;mvim\u0026#39; # fi # Compilation flags # export ARCHFLAGS=\u0026#34;-arch x86_64\u0026#34; # ssh # export SSH_KEY_PATH=\u0026#34;~/.ssh/rsa_id\u0026#34; # Set personal aliases, overriding those provided by oh-my-zsh libs, # plugins, and themes. Aliases can be placed here, though oh-my-zsh # users are encouraged to define aliases within the ZSH_CUSTOM folder. # For a full list of active aliases, run `alias`. # # Example aliases # alias zshconfig=\u0026#34;mate ~/.zshrc\u0026#34; # alias ohmyzsh=\u0026#34;mate ~/.oh-my-zsh\u0026#34;   安装软件 VSCode 下载\nIDEA 下载\n tar -zxf ideaIU-2020.1.3.tar.gz cd idea-IU-201.8538.31/bin/ 安装: ./idea.sh 设置桌面快捷方式（略）  PyCharm 下载\n tar -zxf pycharm-professional-2020.1.3.tar.gz cd idea-IU-201.8538.31/bin/ 安装: ./idea.sh 设置桌面快捷方式  pycharm_pkg目录下: bin/pycharm.sh tools -\u0026gt; Create desktop entry    百度网盘 下载\n火焰截图 下载\n1  sudo apt install flameshot   微信 下载\n虚拟系统管理器 下载\n sudo apt install virt-manager sudo systemctl status libvirtd  sudo systemctl enable libvirtd sudo systemctl start libvirtd   sudo usermod -a -G libvirt ${USER}  APIPost 下载\nuGet 下载\nWPS 下载\nVLC 媒体播放器 下载\nDBeaver数据库管理工具 deb包下载\n1 2 3 4 5  sudo add-apt-repository ppa:serge-rider/dbeaver-ce sudo apt-get update sudo apt-get install dbeaver-ce # 启动DBeaver dbeaver-ce   添加硬盘 参考一\n参考二\n 查看硬盘状况: sudo fdisk -l 分区: sudo fdisk /dev/sdb  m: 查看命令 n: 开始分区  输入分区号1，然后输入大小，默认是一个分区，全部的空间大小 w保存退出   sudo fdisk -l 查看是否创建   格式化分区: sudo mkfs -t ext4 /dev/sdb1 挂载  sudo mkdir /ssd2 sudo mount /dev/sdb1 /ssd2   自动挂载  sudo vim /etc/fstab  UUID=b543f8f7-579c-45b5-96d6-31de6fa1a55e /ssd2 ext4 defaults 0 2 /dev/nvme0n1p1 /ssd2 ext4 defaults 0 2     修改权限: sudo chown -R cjx:cjx /ssd2  安装服务 mkdocs Getting Started with MkDocs\n sudo apt update sudo apt install python3-pip pip install mkdocs sudo apt install mkdocs pip install mkdocs-material mkdocs serve  go 下载\n安装\n1 2  tar -zxf go*.tar.gz sudo mv go /usr/local   设置环境变量 1  mkdir -p /ssd2/go/{src,pkg,bin}   1  sudo vim ~/.bashrc   1 2 3  export GOROOT=/usr/local/go export GOPATH=/ssd2/go export GOPROXY=https://goproxy.cn   1  source ~/.bashrc   ","date":"2022-12-05T20:00:00+08:00","permalink":"https://mkbooks.github.io/blog/p/%E5%AE%89%E8%A3%85%E6%96%B0%E7%B3%BB%E7%BB%9F-ubuntu/","title":"安装新系统-Ubuntu"},{"content":"转载: https://zhuanlan.zhihu.com/p/48048914\n随着金融知识的普及，越来越多的人开始改变了自己的消费观念，以前是“先储蓄后消费”，现在是“先消费后还钱”，不得不说，这种观念的改变使得人们的物质生活开始变得更丰富，但与此同时也带来了一些问题：部分人开始还不起款了。在贷款供应端就涉及到了信用评分的问题。\n","date":"2022-11-21T12:22:00+08:00","permalink":"https://mkbooks.github.io/blog/p/%E5%9F%BA%E4%BA%8Epython%E7%9A%84%E4%BF%A1%E7%94%A8%E8%AF%84%E5%88%86%E6%A8%A1%E5%9E%8B%E8%AF%A6%E9%99%84%E4%BB%A3%E7%A0%81/","title":"基于python的信用评分模型(详附代码)"},{"content":"查看需要哪些镜像： 1  kubeadm config images list   批量下载 1  kubeadm config images list |sed -e \u0026#39;s/^/docker pull /g\u0026#39; -e \u0026#39;s#k8s.gcr.io#registry.aliyuncs.com/google_containers#g\u0026#39; |sh -x   批量重命名镜像 1  docker images |grep registry.aliyuncs.com |awk \u0026#39;{print \u0026#34;docker tag \u0026#34;,$1\u0026#34;:\u0026#34;$2,$1\u0026#34;:\u0026#34;$2}\u0026#39; |sed -e \u0026#39;s#registry.aliyuncs.com/google_containers#k8s.gcr.io#2\u0026#39; |sh -x   删除 mirrorgooglecontainers 的镜像 1  docker images |grep registry.aliyuncs.com/google_containers |awk \u0026#39;{print \u0026#34;docker rmi \u0026#34;, $1\u0026#34;:\u0026#34;$2}\u0026#39; |sh -x   手动从 coredns 官方镜像下载 coredns 1 2 3  docker pull coredns/coredns:3.8 docker tag coredns/coredns:3.8 k8s.gcr.io/coredns:3.8 docker rmi coredns/coredns:3.8   生成 kubeadm 配置文件 1  kubeadm config print init-defaults \u0026gt; kubeadm.conf   1  vi kubeadm.conf   1 2 3 4 5 6 7 8 9 10 11 12  imageRepository: registry.aliyuncs.com/google_containers kubernetesVersion: v1.25.14 nodeRegistration: taints: - effect: PreferNoSchedule key: node-role.kubernetes.io/master localAPIEndpoint: advertiseAddress: 10.0.135.30 networking: dnsDomain: cluster.local podSubnet: 192.168.0.0/16 serviceSubnet: 172.18.0.0/16   更多 kubeadm 配置文件参数 1  kubeadm config print-defaults   查看需要哪些镜像： 1  kubeadm config images list --config kubeadm.conf   先拉镜像 1  kubeadm config images pull --config kubeadm.conf   指定配置文件 init 1  kubeadm init --config /root/kubeadm.conf   查看 kubernetes 文件 1  ls /etc/kubernetes   ","date":"2022-11-18T23:22:00+08:00","permalink":"https://mkbooks.github.io/blog/p/kubernetes-%E9%95%9C%E5%83%8F/","title":"kubernetes 镜像"},{"content":"查看 kubelet 日志 1  systemctl status kubelet -l   1  journalctl -u kubelet   ","date":"2022-11-18T23:21:00+08:00","permalink":"https://mkbooks.github.io/blog/p/kubernetes-%E5%AE%89%E8%A3%85%E9%97%AE%E9%A2%98/","title":"kubernetes 安装问题"},{"content":"环境  操作系统: Ubuntu20.04 cpu 架构: x86 kubernetes 版本: v1.22.16  基础环境设置 添加 sudo 权限 1  sudo visudo   1  %sudo ALL=(ALL:ALL) NOPASSWD:ALL   1  sudo -i   关闭 Swap 1 2  swapoff -a vi /etc/fstab   remove the line with swap keyword\n设置 iptables 1 2 3  cat \u0026lt;\u0026lt;EOF | sudo tee /etc/modules-load.d/k8s.conf br_netfilter EOF   1 2 3 4  cat \u0026lt;\u0026lt;EOF | sudo tee /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 EOF   1  sysctl --system   安装基础软件 更新 1  sudo apt-get update   安装 docker 1  sudo apt install docker.io -y   设置 docker 1  vi /etc/docker/daemon.json   1 2 3  { \u0026#34;exec-opts\u0026#34;: [\u0026#34;native.cgroupdriver=systemd\u0026#34;] }   1 2  systemctl daemon-reload systemctl restart docker   添加普通用户 1  sudo usermod -aG docker ${USER}   立即生效\n1  su - ${USER}   安装 apt-transport-https ca-certificates curl 1  apt-get install -y apt-transport-https ca-certificates curl   安装 kubeadm 添加库 1  curl -s https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | sudo apt-key add -   1 2 3  tee /etc/apt/sources.list.d/kubernetes.list \u0026lt;\u0026lt;-\u0026#39;EOF\u0026#39; deb https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial main EOF   更新源 1  apt-get update   安装 kubelet, kubeadm, kubectl 查看版本 1  apt-cache madison kubectl|grep 1.22   1 2  apt-get install -y kubelet=1.22.16-00 kubeadm=1.22.16-00 kubectl=1.22.16-00 apt-mark hold kubelet kubeadm kubectl   kubeadm init 1 2 3 4  kubeadm init \\ --image-repository registry.aliyuncs.com/google_containers \\ --kubernetes-version v1.22.16 \\ --pod-network-cidr=192.168.0.0/16   如果用 containerd 的话\n1 2 3 4 5  kubeadm init \\ --image-repository registry.aliyuncs.com/google_containers \\ --kubernetes-version v1.22.16 \\ --pod-network-cidr=192.168.0.0/16 \\ --cri-socket /run/containerd/containerd.sock   使用 普通用户\n1 2 3  mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config   root 用户\n1  export KUBECONFIG=/etc/kubernetes/admin.conf   取消节点污点 1 2 3  kubectl taint nodes --all node-role.kubernetes.io/master- kubectl taint nodes --all node-role.kubernetes.io/control-plane- node-role.kubernetes.io/master-   安装 calico cni plugin https://docs.projectcalico.org/getting-started/kubernetes/quickstart\n1 2  kubectl create -f https://docs.projectcalico.org/manifests/tigera-operator.yaml kubectl create -f https://docs.projectcalico.org/manifests/custom-resources.yaml   添加节点 master\n1 2  kubeadm token create --print-join-command kubeadm token list   node\n1  kubeadm join --token \u0026lt;token\u0026gt; \u0026lt;control-plane-host\u0026gt;:\u0026lt;control-plane-port\u0026gt; --discovery-token-ca-cert-hash sha256:\u0026lt;hash\u0026gt;   ","date":"2022-11-18T22:22:00+08:00","permalink":"https://mkbooks.github.io/blog/p/%E5%AE%89%E8%A3%85-kubernetesubuntu20.04%E7%8E%AF%E5%A2%83/","title":"安装 kubernetes(Ubuntu20.04环境)"},{"content":"参考: https://github.com/kubernetes-retired/external-storage/tree/master/nfs-client\n创建目录 1 2  mkdir -p ~/yamls/storageclass/nfs/test cd ~/yamls/storageclass/nfs   创建 yaml 文件  deployment.yaml  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42  # https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner apiVersion: apps/v1 kind: Deployment metadata: name: nfs-client-provisioner labels: app: nfs-client-provisioner # replace with namespace where provisioner is deployed namespace: default # 与RBAC文件中的namespace保持一致 spec: replicas: 1 strategy: type: Recreate selector: matchLabels: app: nfs-client-provisioner template: metadata: labels: app: nfs-client-provisioner spec: serviceAccountName: nfs-client-provisioner containers: - name: nfs-client-provisioner # image: k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2 image: quay.io/external_storage/nfs-client-provisioner:latest imagePullPolicy: IfNotPresent volumeMounts: - name: nfs-client-root mountPath: /persistentvolumes env: - name: PROVISIONER_NAME value: k8s-sigs.io/nfs-subdir-external-provisioner #provisioner名称,确保该名称与 class.yaml文件中的provisioner名称保持一致 - name: NFS_SERVER value: MY_NFS_SERVER_HOST #NFS Server IP地址 - name: NFS_PATH value: MY_NFS_SERVER_PATH #NFS挂载卷 volumes: - name: nfs-client-root nfs: server: MY_NFS_SERVER_HOST #NFS Server IP地址 path: MY_NFS_SERVER_PATH #NFS 挂载卷    class.yaml  1 2 3 4 5 6 7 8 9 10 11 12 13  apiVersion: storage.k8s.io/v1 kind: StorageClass metadata: name: managed-nfs-storage mountOptions: - noresvport # - vers=3 provisioner: k8s-sigs.io/nfs-subdir-external-provisioner # or choose another name, must match deployment\u0026#39;s env PROVISIONER_NAME\u0026#39; parameters: pathPattern: MY_NFS_SERVER_PATH # waits for nfs.io/storage-path annotation, if not specified will accept as empty string. onDelete: delete archiveOnDelete: \u0026#34;false\u0026#34; # allowVolumeExpansion: true #增加该字段表示允许动态扩容，NFS 暂时不支持    rbac.yaml  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68  apiVersion: v1 kind: ServiceAccount metadata: name: nfs-client-provisioner # replace with namespace where provisioner is deployed namespace: default --- kind: ClusterRole apiVersion: rbac.authorization.k8s.io/v1 metadata: name: nfs-client-provisioner-runner rules: - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;nodes\u0026#34;] verbs: [\u0026#34;get\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;watch\u0026#34;] - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;persistentvolumes\u0026#34;] verbs: [\u0026#34;get\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;watch\u0026#34;, \u0026#34;create\u0026#34;, \u0026#34;delete\u0026#34;] - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;persistentvolumeclaims\u0026#34;] verbs: [\u0026#34;get\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;watch\u0026#34;, \u0026#34;update\u0026#34;] - apiGroups: [\u0026#34;storage.k8s.io\u0026#34;] resources: [\u0026#34;storageclasses\u0026#34;] verbs: [\u0026#34;get\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;watch\u0026#34;] - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;events\u0026#34;] verbs: [\u0026#34;create\u0026#34;, \u0026#34;update\u0026#34;, \u0026#34;patch\u0026#34;] --- kind: ClusterRoleBinding apiVersion: rbac.authorization.k8s.io/v1 metadata: name: run-nfs-client-provisioner subjects: - kind: ServiceAccount name: nfs-client-provisioner # replace with namespace where provisioner is deployed namespace: default roleRef: kind: ClusterRole name: nfs-client-provisioner-runner apiGroup: rbac.authorization.k8s.io --- kind: Role apiVersion: rbac.authorization.k8s.io/v1 metadata: name: leader-locking-nfs-client-provisioner # replace with namespace where provisioner is deployed namespace: default rules: - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;endpoints\u0026#34;] verbs: [\u0026#34;get\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;watch\u0026#34;, \u0026#34;create\u0026#34;, \u0026#34;update\u0026#34;, \u0026#34;patch\u0026#34;] --- kind: RoleBinding apiVersion: rbac.authorization.k8s.io/v1 metadata: name: leader-locking-nfs-client-provisioner # replace with namespace where provisioner is deployed namespace: default subjects: - kind: ServiceAccount name: nfs-client-provisioner # replace with namespace where provisioner is deployed namespace: default roleRef: kind: Role name: leader-locking-nfs-client-provisioner apiGroup: rbac.authorization.k8s.io    test/claim.yaml  1 2 3 4 5 6 7 8 9 10 11  kind: PersistentVolumeClaim apiVersion: v1 metadata: name: test-claim spec: storageClassName: managed-nfs-storage accessModes: - ReadWriteMany resources: requests: storage: 1Mi    test/pod.yaml  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  kind: Pod apiVersion: v1 metadata: name: test-pod spec: containers: - name: test-pod image: busybox:latest command: - \u0026#34;/bin/sh\u0026#34; args: - \u0026#34;-c\u0026#34; - \u0026#34;touch /mnt/SUCCESS \u0026amp;\u0026amp; exit 0 || exit 1\u0026#34; #创建一个SUCCESS文件后退出 volumeMounts: - name: nfs-pvc mountPath: \u0026#34;/mnt\u0026#34; restartPolicy: \u0026#34;Never\u0026#34; volumes: - name: nfs-pvc persistentVolumeClaim: claimName: test-claim #与PVC名称保持一致   设置环境变量 1 2  export MY_NFS_SERVER_HOST=\u0026#34;192.168.3.150\u0026#34; export MY_NFS_SERVER_PATH=\u0026#34;/mnt/nfs\u0026#34;   替换文件中的值 1 2 3 4  cp deployment.yaml deployment.bak sed -i \u0026#39;s/MY_NFS_SERVER_HOST/\u0026#39;$MY_NFS_SERVER_HOST\u0026#39;/g\u0026#39; deployment.yaml sed -i \u0026#39;s#MY_NFS_SERVER_PATH#\u0026#39;$MY_NFS_SERVER_PATH\u0026#39;#g\u0026#39; deployment.yaml sed -i \u0026#39;s#MY_NFS_SERVER_PATH#\u0026#39;$MY_NFS_SERVER_PATH\u0026#39;#g\u0026#39; class.yaml   创建 下载镜像 1 2  docker pull busybox:latest docker pull quay.io/external_storage/nfs-client-provisioner:latest   apply 1  k apply -f .   检查 1 2 3 4 5 6 7  k get pod NAME READY STATUS RESTARTS AGE nfs-client-provisioner-5c4dbc6dc5-r2sb5 1/1 Running 0 7s k get sc NAME PROVISIONER RECLAIMPOLICY VOLUMEBINDINGMODE ALLOWVOLUMEEXPANSION AGE managed-nfs-storage k8s-sigs.io/nfs-subdir-external-provisioner Delete Immediate false 8s   测试 1  k apply -f test   1  ls $MY_NFS_SERVER_PATH   ","date":"2022-11-16T20:46:00+08:00","permalink":"https://mkbooks.github.io/blog/p/%E4%BD%BF%E7%94%A8-nfs-%E5%88%9B%E5%BB%BA-storageclass/","title":"使用 NFS 创建 StorageClass"},{"content":"创建目录 1 2  mkdir -p ~/yamls/storageclass/local/test cd ~/yamls/storageclass/local   创建 yaml 文件  StorageClass.yaml  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  apiVersion: storage.k8s.io/v1 kind: StorageClass metadata: annotations: cas.openebs.io/config: | - name: StorageType value: \u0026#34;hostpath\u0026#34; - name: BasePath value: \u0026#34;/var/openebs/local/\u0026#34; kubectl.kubernetes.io/last-applied-configuration: | {\u0026#34;apiVersion\u0026#34;:\u0026#34;storage.k8s.io/v1\u0026#34;,\u0026#34;kind\u0026#34;:\u0026#34;StorageClass\u0026#34;,\u0026#34;metadata\u0026#34;:{\u0026#34;annotations\u0026#34;:{\u0026#34;cas.openebs.io/config\u0026#34;:\u0026#34;- name: StorageType\\n value: \\\u0026#34;hostpath\\\u0026#34;\\n- name: BasePath\\n value: \\\u0026#34;/var/openebs/local/\\\u0026#34;\\n\u0026#34;,\u0026#34;openebs.io/cas-type\u0026#34;:\u0026#34;local\u0026#34;,\u0026#34;storageclass.beta.kubernetes.io/is-default-class\u0026#34;:\u0026#34;true\u0026#34;,\u0026#34;storageclass.kubesphere.io/supported-access-modes\u0026#34;:\u0026#34;[\\\u0026#34;ReadWriteOnce\\\u0026#34;]\u0026#34;},\u0026#34;name\u0026#34;:\u0026#34;local\u0026#34;},\u0026#34;provisioner\u0026#34;:\u0026#34;openebs.io/local\u0026#34;,\u0026#34;reclaimPolicy\u0026#34;:\u0026#34;Delete\u0026#34;,\u0026#34;volumeBindingMode\u0026#34;:\u0026#34;WaitForFirstConsumer\u0026#34;} openebs.io/cas-type: local storageclass.beta.kubernetes.io/is-default-class: \u0026#34;true\u0026#34; storageclass.kubesphere.io/supported-access-modes: \u0026#39;[\u0026#34;ReadWriteOnce\u0026#34;]\u0026#39; creationTimestamp: \u0026#34;2022-11-15T14:04:07Z\u0026#34; name: local resourceVersion: \u0026#34;430\u0026#34; uid: f4c69e41-7ea3-4970-b026-8606c1ef97a5 provisioner: openebs.io/local reclaimPolicy: Delete volumeBindingMode: WaitForFirstConsumer    test/claim.yaml  1 2 3 4 5 6 7 8 9 10 11  kind: PersistentVolumeClaim apiVersion: v1 metadata: name: test-claim spec: storageClassName: local accessModes: - ReadWriteMany resources: requests: storage: 1Mi    test/pod.yaml  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  kind: Pod apiVersion: v1 metadata: name: test-pod spec: containers: - name: test-pod image: busybox:latest command: - \u0026#34;/bin/sh\u0026#34; args: - \u0026#34;-c\u0026#34; - \u0026#34;touch /mnt/SUCCESS \u0026amp;\u0026amp; exit 0 || exit 1\u0026#34; #创建一个SUCCESS文件后退出 volumeMounts: - name: local-pvc mountPath: \u0026#34;/mnt\u0026#34; restartPolicy: \u0026#34;Never\u0026#34; volumes: - name: local-pvc persistentVolumeClaim: claimName: test-claim #与PVC名称保持一致   创建 下载镜像 1 2  docker pull busybox:latest docker pull quay.io/external_storage/nfs-client-provisioner:latest   apply 1  k apply -f .   检查 1 2 3  k get sc NAME PROVISIONER RECLAIMPOLICY VOLUMEBINDINGMODE ALLOWVOLUMEEXPANSION AGE local (default) openebs.io/local Delete WaitForFirstConsumer false 2s   测试 1  k apply -f test   1  ls /var/openebs/local/   ","date":"2022-11-16T20:35:00+08:00","permalink":"https://mkbooks.github.io/blog/p/%E5%88%9B%E5%BB%BA-storageclass/","title":"创建 StorageClass"},{"content":"安装\n1 2  sudo apt update sudo apt install nfs-kernel-server   查看版本\n1  sudo cat /proc/fs/nfsd/versions   创建共享目录\n1  sudo mkdir -p /mnt/nfs   导出文件系统\n1  sudo vim /etc/exports   1  /mnt/nfs *(rw,sync,no_root_squash,no_subtree_check)   保存文件并导出共享共享目录\n1  sudo exportfs -ra   查看当前活动的 export 及其状态\n1  sudo exportfs -v   查看 nfs 服务状态\n1  sudo systemctl status nfs-kernel-server   ","date":"2022-11-16T20:27:00+08:00","permalink":"https://mkbooks.github.io/blog/p/nfs/","title":"NFS"},{"content":"参考: https://blog.csdn.net/weixin_40294256/article/details/79137488\n安装\n1  sudo apt install pavucontrol   运行\n1  pavucontrol   Chrome 浏览器，视频没有剩余，音乐有 重启浏览器\n","date":"2022-11-14T19:46:00+08:00","permalink":"https://mkbooks.github.io/blog/p/%E8%80%B3%E6%9C%BA%E6%B2%A1%E6%9C%89%E5%A3%B0%E9%9F%B3/","title":"耳机没有声音"},{"content":" 修改 config.yaml  添加 favicon 的值，这里使用网络图片\n1 2 3 4 5 6  params: mainSections: - post featuredImageField: image rssFullContent: true favicon: https://chenjinxin.cn/images/favicon.png   测试  访问博客\n","date":"2022-11-11T22:24:00+08:00","permalink":"https://mkbooks.github.io/blog/p/%E8%AE%BE%E7%BD%AE-favicon-%E5%9B%BE%E6%A0%87/","title":"设置 favicon 图标"},{"content":"参考: https://www.jianshu.com/p/a49eaabef205\n 用 vi 编辑器打开 nginx 配置文件  vi /etc/nginx/nginx.conf\n添加\n1 2 3  location /images { root /home/sammy/data/; autoindex on;   添加后如下\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  http { ...... server { listen 443 ssl; ssl_certificate /usr/share/nginx/chenjinxin.cn_bundle.crt; ssl_certificate_key /usr/share/nginx/chenjinxin.cn.key; ssl_session_timeout 5m; #请按照以下套件配置，配置加密套件，写法遵循 openssl 标准。 ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; #请按照以下协议配置 ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; server_name chenjinxin.cn www.chenjinxin.cn; location / { root /home/sammy/cjx_blog/public; } location /images { root /home/sammy/data/; autoindex on;    autoindex是开启浏览功能再把首行的user设为root，配置文件访问权限\n 编辑完成后保存退出，重启nginx\n1  sudo /usr/sbin/nginx -s reload   测试：\n 向映射的路径 /home/sammy/data/ 下放张图片  1 2 3 4 5  sammy@VM-8-4-ubuntu:~/cjx_blog$ ll /home/sammy/data/images/ total 100 drwxrwxr-x 2 sammy sammy 4096 Nov 11 21:48 ./ drwxrwxr-x 4 sammy sammy 4096 Nov 11 21:39 ../ -rw-rw-r-- 1 sammy sammy 61250 Nov 11 21:39 1.jpg   在浏览器访问  1  https://chenjinxin.cn/images/1.jpg   ","date":"2022-11-11T21:53:00+08:00","permalink":"https://mkbooks.github.io/blog/p/%E5%9B%BE%E7%89%87%E6%9C%8D%E5%8A%A1%E5%99%A8/","title":"图片服务器"},{"content":"测试准备 初始化仓库 1 2 3 4  ➜ ~ mkdir git-test ➜ ~ cd git-test/ ➜ git-test git init 已初始化空的 Git 仓库于 /home/cjx/git-test/.git/   初始化文件 1 2 3 4 5 6 7 8 9 10 11 12  ➜ git-test git:(master) echo master \u0026gt; 1.txt ➜ git-test git:(master) ✗ echo master \u0026gt; 2.txt ➜ git-test git:(master) ✗ echo master \u0026gt; 3.txt ➜ git-test git:(master) ✗ echo master \u0026gt; 4.txt ➜ git-test git:(master) ✗ git add . ➜ git-test git:(master) ✗ git commit -m\u0026#39;master: commit\u0026#39; [master （根提交） 9a14d41] master: commit 4 files changed, 4 insertions(+) create mode 100644 1.txt create mode 100644 2.txt create mode 100644 3.txt create mode 100644 4.txt   新建分支 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26  ➜ git-test git:(master) git checkout -b branch-a 切换到一个新分支 \u0026#39;branch-a\u0026#39; ➜ git-test git:(branch-a) echo branch-a \u0026gt; 5.txt ➜ git-test git:(branch-a) ✗ rm 1.txt ➜ git-test git:(branch-a) ✗ echo branch-a \u0026gt; 2.txt ➜ git-test git:(branch-a) ✗ git add . ➜ git-test git:(branch-a) ✗ git commit -m\u0026#39;branch-a: commit\u0026#39; [branch-a 1c2ae82] branch-a: commit 3 files changed, 2 insertions(+), 2 deletions(-) delete mode 100644 1.txt create mode 100644 5.txt ➜ git-test git:(branch-a) ll 总用量 16K -rw-rw-r-- 1 cjx cjx 9 11月 10 22:45 2.txt -rw-rw-r-- 1 cjx cjx 7 11月 10 22:45 3.txt -rw-rw-r-- 1 cjx cjx 7 11月 10 22:37 4.txt -rw-rw-r-- 1 cjx cjx 9 11月 10 22:45 5.txt ➜ git-test git:(branch-a) cat 2.txt branch-a ➜ git-test git:(branch-a) cat 3.txt master ➜ git-test git:(branch-a) cat 4.txt master ➜ git-test git:(branch-a) cat 5.txt branch-a   修改 master 分支 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24  ➜ git-test git:(branch-a) git checkout master 切换到分支 \u0026#39;master\u0026#39; ➜ git-test git:(master) echo master \u0026gt; 5.txt ➜ git-test git:(master) ✗ rm 3.txt ➜ git-test git:(master) ✗ echo master-2 \u0026gt; 2.txt ➜ git-test git:(master) ✗ ll 总用量 16K -rw-rw-r-- 1 cjx cjx 7 11月 10 22:43 1.txt -rw-rw-r-- 1 cjx cjx 9 11月 10 22:43 2.txt -rw-rw-r-- 1 cjx cjx 7 11月 10 22:37 4.txt -rw-rw-r-- 1 cjx cjx 7 11月 10 22:43 5.txt ➜ git-test git:(master) ✗ cat 1.txt master ➜ git-test git:(master) ✗ cat 2.txt master-2 ➜ git-test git:(master) ✗ cat 4.txt master ➜ git-test git:(master) ✗ cat 5.txt master ➜ git-test git:(master) ✗ git add . ➜ git-test git:(master) ✗ git commit -m\u0026#39;master: commit -2\u0026#39; [master c43e460] master: commit -2 2 files changed, 1 insertion(+), 1 deletion(-) rename 3.txt =\u0026gt; 5.txt (100%)   错误的 merge 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  ➜ git-test git:(master) git checkout branch-a 切换到分支 \u0026#39;branch-a\u0026#39; ➜ git-test git:(branch-a) git merge master 冲突（重命名/添加）：在 master 中重命名 3.txt-\u0026gt;5.txt。在 HEAD 中添加 5.txt 自动合并 5.txt 自动合并 2.txt 冲突（内容）：合并冲突于 2.txt 自动合并失败，修正冲突然后提交修正的结果。 ➜ git-test git:(branch-a) ✗ vim 2.txt ➜ git-test git:(branch-a) ✗ ll 总用量 12K -rw-rw-r-- 1 cjx cjx 9 11月 10 22:47 2.txt -rw-rw-r-- 1 cjx cjx 7 11月 10 22:37 4.txt -rw-rw-r-- 1 cjx cjx 52 11月 10 22:46 5.txt ➜ git-test git:(branch-a) ✗ cat 2.txt branch-a ➜ git-test git:(branch-a) ✗ cat 4.txt master ➜ git-test git:(branch-a) ✗ cat 5.txt \u0026lt;\u0026lt;\u0026lt;\u0026lt;\u0026lt;\u0026lt;\u0026lt; HEAD branch-a ======= master \u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt; master ➜ git-test git:(branch-a) ✗ vim 5.txt ➜ git-test git:(branch-a) ✗ cat 5.txt branch-a ➜ git-test git:(branch-a) ✗ git add . ➜ git-test git:(branch-a) ✗ git commit [branch-a 89c0c25] Merge branch \u0026#39;master\u0026#39; into branch-a ➜ git-test git:(branch-a) git status 位于分支 branch-a 无文件要提交，干净的工作区 ➜ git-test git:(branch-a) ll 总用量 12K -rw-rw-r-- 1 cjx cjx 9 11月 10 22:47 2.txt -rw-rw-r-- 1 cjx cjx 7 11月 10 22:37 4.txt -rw-rw-r-- 1 cjx cjx 9 11月 10 22:48 5.txt ➜ git-test git:(branch-a) cat 2.txt branch-a ➜ git-test git:(branch-a) cat 4.txt master ➜ git-test git:(branch-a) cat 5.txt branch-a   正常提交 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33  ➜ git-test git:(branch-a) echo branch-a \u0026gt; 6.txt ➜ git-test git:(branch-a) ✗ rm 4.txt ➜ git-test git:(branch-a) ✗ echo branch-a-2 \u0026gt; 5.txt ➜ git-test git:(branch-a) ✗ ll 总用量 12K -rw-rw-r-- 1 cjx cjx 9 11月 10 22:47 2.txt -rw-rw-r-- 1 cjx cjx 11 11月 10 22:52 5.txt -rw-rw-r-- 1 cjx cjx 9 11月 10 22:51 6.txt ➜ git-test git:(branch-a) ✗ cat 2.txt branch-a ➜ git-test git:(branch-a) ✗ cat 5.txt branch-a-2 ➜ git-test git:(branch-a) ✗ cat 6.txt branch-a ➜ git-test git:(branch-a) ✗ git status 位于分支 branch-a 尚未暂存以备提交的变更： （使用 \u0026#34;git add/rm \u0026lt;文件\u0026gt;...\u0026#34; 更新要提交的内容） （使用 \u0026#34;git restore \u0026lt;文件\u0026gt;...\u0026#34; 丢弃工作区的改动） 删除： 4.txt 修改： 5.txt 未跟踪的文件: （使用 \u0026#34;git add \u0026lt;文件\u0026gt;...\u0026#34; 以包含要提交的内容） 6.txt 修改尚未加入提交（使用 \u0026#34;git add\u0026#34; 和/或 \u0026#34;git commit -a\u0026#34;） ➜ git-test git:(branch-a) ✗ git add . ➜ git-test git:(branch-a) ✗ git commit -m\u0026#39;branch-a: commit-2\u0026#39; [branch-a 6d7ee80] branch-a: commit-2 3 files changed, 2 insertions(+), 2 deletions(-) delete mode 100644 4.txt create mode 100644 6.txt   消除 merge 操作 方法一  首先 git log 查看提交记录，找到出错的前一笔提交的 commit_id: 1c2ae824d8b9e2a7870345654c90c1d6cd72f0bf  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  commit 67d371b5e4c11e57709c22a03e23eed92856c986 (HEAD -\u0026gt; branch-a) Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:38:45 2022 +0800 branch-a: commit-2 commit 60d5af4cd95166bdb8c7fba3787c93ec2c75f012 Merge: 1c2ae82 1869c6f Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:37:55 2022 +0800 Merge branch \u0026#39;master\u0026#39; into branch-a commit 1869c6f758fe8b6a001fa13444aa6b1881fb48a9 (master) Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:37:01 2022 +0800 master: commit -2 commit 1c2ae824d8b9e2a7870345654c90c1d6cd72f0bf Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:35:31 2022 +0800 branch-a: commit commit 9a14d41905fc3283137dd582df816de8d5578445 Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:34:48 2022 +0800 master: commit   用命令 git rebase -i commit_id，查找提交记录  1  ➜ git-test git:(branch-a) git rebase -i 1c2ae824d8b9e2a7870345654c90c1d6cd72f0bf   将出错那笔提交的 pick 改为 drop  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29  GNU nano 4.8 /home/cjx/git-test/.git/rebase-merge/git-rebase-todo 已更改 drop 1869c6f master: commit -2 pick 67d371b branch-a: commit-2 # 变基 310f23a..6d7ee80 到 310f23a（2 个提交） # # 命令: # p, pick \u0026lt;提交\u0026gt; = 使用提交 # r, reword \u0026lt;提交\u0026gt; = 使用提交，但修改提交说明 # e, edit \u0026lt;提交\u0026gt; = 使用提交，进入 shell 以便进行提交修补 # s, squash \u0026lt;提交\u0026gt; = 使用提交，但融合到前一个提交 # f, fixup \u0026lt;提交\u0026gt; = 类似于 \u0026#34;squash\u0026#34;，但丢弃提交说明日志 # x, exec \u0026lt;命令\u0026gt; = 使用 shell 运行命令（此行剩余部分） # b, break = 在此处停止（使用 \u0026#39;git rebase --continue\u0026#39; 继续变基） # d, drop \u0026lt;提交\u0026gt; = 删除提交 # l, label \u0026lt;label\u0026gt; = 为当前 HEAD 打上标记 # t, reset \u0026lt;label\u0026gt; = 重置 HEAD 到该标记 # m, merge [-C \u0026lt;commit\u0026gt; | -c \u0026lt;commit\u0026gt;] \u0026lt;label\u0026gt; [# \u0026lt;oneline\u0026gt;] # . 创建一个合并提交，并使用原始的合并提交说明（如果没有指定 # . 原始提交，使用注释部分的 oneline 作为提交说明）。使用 # . -c \u0026lt;提交\u0026gt; 可以编辑提交说明。 # # 可以对这些行重新排序，将从上至下执行。 # # 如果您在这里删除一行，对应的提交将会丢失。 # # 然而，如果您删除全部内容，变基操作将会终止。 # # 注意空提交已被注释掉   保存修改  1  Successfully rebased and updated refs/heads/branch-a.   查看状态\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  ➜ git-test git:(branch-a) git status 位于分支 branch-a 无文件要提交，干净的工作区 ➜ git-test git:(branch-a) ll 总用量 16K -rw-rw-r-- 1 cjx cjx 9 11月 10 22:47 2.txt -rw-rw-r-- 1 cjx cjx 7 11月 10 23:01 3.txt -rw-rw-r-- 1 cjx cjx 11 11月 10 23:01 5.txt -rw-rw-r-- 1 cjx cjx 9 11月 10 23:01 6.txt ➜ git-test git:(branch-a) cat 2.txt branch-a ➜ git-test git:(branch-a) cat 3.txt master ➜ git-test git:(branch-a) cat 5.txt branch-a-2 ➜ git-test git:(branch-a) cat 6.txt branch-a   git log\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  commit 7639dc395eb07aa01909a2e4fca686a25a58e107 (HEAD -\u0026gt; branch-a) Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:38:45 2022 +0800 branch-a: commit-2 commit 1c2ae824d8b9e2a7870345654c90c1d6cd72f0bf Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:35:31 2022 +0800 branch-a: commit commit 9a14d41905fc3283137dd582df816de8d5578445 Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:34:48 2022 +0800 master: commit   方法二  首先 git log 查看提交记录，找到出错的前一笔提交的 commit_id: b2cf7c92a2aec2dcbb60375a98956ebab77d4c7c  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  commit 400d064b55cd378e3fa277a1d9f33b709e784d00 (HEAD -\u0026gt; branch-a) Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:13:43 2022 +0800 branch-a: commit-2 commit 4b0a8fd90aebe5356915febb508dd7b0accde9a3 Merge: b2cf7c9 fb7a14a Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:12:34 2022 +0800 Merge branch \u0026#39;master\u0026#39; into branch-a commit fb7a14aabbc9a2431ccf591c247661d49b1e5ef9 (master) Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:11:08 2022 +0800 master: commit -2 commit b2cf7c92a2aec2dcbb60375a98956ebab77d4c7c Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:09:49 2022 +0800 branch-a: commit commit 74fe787600665ce709fc1fc62c7f616015f628fb Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:09:12 2022 +0800 master: commit   git reset --hard 回退到出错版本前一个commit  1 2  ➜ git-test git:(branch-a) git reset --hard b2cf7c92a2aec2dcbb60375a98956ebab77d4c7c HEAD 现在位于 b2cf7c9 branch-a: commit   git cherry-pick 626335 #将某次commit的更改应用到当前版本(将出错 cmmit 之后别人提交的代码合并到当前正常代码分支上)  1 2 3 4 5 6 7  ➜ git-test git:(branch-a) git cherry-pick 400d064b55cd378e3fa277a1d9f33b709e784d00 删除 4.txt [branch-a 6e82565] branch-a: commit-2 Date: Thu Nov 10 23:13:43 2022 +0800 3 files changed, 2 insertions(+), 2 deletions(-) delete mode 100644 4.txt create mode 100644 6.txt   查看状态  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  ➜ git-test git:(branch-a) git status 位于分支 branch-a 无文件要提交，干净的工作区 ➜ git-test git:(branch-a) ll 总用量 16K -rw-rw-r-- 1 cjx cjx 9 11月 10 23:11 2.txt -rw-rw-r-- 1 cjx cjx 7 11月 10 23:19 3.txt -rw-rw-r-- 1 cjx cjx 11 11月 10 23:20 5.txt -rw-rw-r-- 1 cjx cjx 9 11月 10 23:20 6.txt ➜ git-test git:(branch-a) cat 2.txt branch-a ➜ git-test git:(branch-a) cat 3.txt master ➜ git-test git:(branch-a) cat 5.txt branch-a-2 ➜ git-test git:(branch-a) cat 6.txt branch-a   方法三  首先 git log 查看提交记录，找到要撤销提交的 commit_id: 8c3a09c15a589e98449891f97de0192f351fe63c  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  commit f5f80b21580443b191b3cc79a128e8334deca490 (HEAD -\u0026gt; branch-a) Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:26:49 2022 +0800 branch-a: commit-2 commit 8c3a09c15a589e98449891f97de0192f351fe63c Merge: 4317d1b 72ef326 Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:25:47 2022 +0800 Merge branch \u0026#39;master\u0026#39; into branch-a commit 72ef326d304e9e78fb29137fd175329716bac68a (master) Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:25:01 2022 +0800 master: commit -2 commit 4317d1bddc2bc02cf6155b9ac469a472a1b20eee Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:23:37 2022 +0800 branch-a: commit commit 2f344da767fc6334a3e73ade666d281bffc3a366 Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:23:07 2022 +0800 master: commit   git revert 8c3a09c15a589e98449891f97de0192f351fe63c -m 1 参数 -m 就是指定要撤销的那个提价，从左往右，从 1 开始数；也就是我撤销的是 72ef326d304e9e78fb29137fd175329716bac68a  接着其把代码冲突，然后我就解决冲突，保留主分支的代码，去掉那个人的代码。\n1 2 3 4  ➜ git-test git:(branch-a) git revert 8c3a09c15a589e98449891f97de0192f351fe63c -m 1 [branch-a 95521f3] Revert \u0026#34;Merge branch \u0026#39;master\u0026#39; into branch-a\u0026#34; 1 file changed, 1 insertion(+) create mode 100644 3.txt   查看状态  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  ➜ git-test git:(branch-a) git status 位于分支 branch-a 无文件要提交，干净的工作区 ➜ git-test git:(branch-a) ll 总用量 16K -rw-rw-r-- 1 cjx cjx 9 11月 10 23:11 2.txt -rw-rw-r-- 1 cjx cjx 7 11月 10 23:19 3.txt -rw-rw-r-- 1 cjx cjx 11 11月 10 23:20 5.txt -rw-rw-r-- 1 cjx cjx 9 11月 10 23:20 6.txt ➜ git-test git:(branch-a) cat 2.txt branch-a ➜ git-test git:(branch-a) cat 3.txt master ➜ git-test git:(branch-a) cat 5.txt branch-a-2 ➜ git-test git:(branch-a) cat 6.txt branch-a   git log\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37  commit 95521f3a60269bbfb172d419d97366f8a23e0316 (HEAD -\u0026gt; branch-a) Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:29:06 2022 +0800 Revert \u0026#34;Merge branch \u0026#39;master\u0026#39; into branch-a\u0026#34; This reverts commit 8c3a09c15a589e98449891f97de0192f351fe63c, reversing changes made to 4317d1bddc2bc02cf6155b9ac469a472a1b20eee. commit f5f80b21580443b191b3cc79a128e8334deca490 Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:26:49 2022 +0800 branch-a: commit-2 commit 8c3a09c15a589e98449891f97de0192f351fe63c Merge: 4317d1b 72ef326 Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:25:47 2022 +0800 Merge branch \u0026#39;master\u0026#39; into branch-a commit 72ef326d304e9e78fb29137fd175329716bac68a (master) Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:25:01 2022 +0800 master: commit -2 commit 4317d1bddc2bc02cf6155b9ac469a472a1b20eee Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:23:37 2022 +0800 branch-a: commit commit 2f344da767fc6334a3e73ade666d281bffc3a366 Author: cjx \u0026lt;1067446576@qq.com\u0026gt; Date: Thu Nov 10 23:23:07 2022 +0800   ","date":"2022-11-08T20:36:18+08:00","permalink":"https://mkbooks.github.io/blog/p/error-merge/","title":"error merge"},{"content":"转载: https://blog.csdn.net/Man_In_The_Night/article/details/109184175\n查看 namespace 下面所有的资源\n1  kubectl api-resources -o name --verbs=list --namespaced | xargs -n 1 kubectl get --show-kind --ignore-not-found -n {namespace}   删除 namespace 下面所有的资源\n1  kubectl delete all --all -n {namespace}   删除 namespace 下面某种的资源\n1 2 3  kubectl delete --all pods -n {namespace} kubectl delete --all deploy -n {namespace} kubectl delete --all sts -n {namespace}   有时候删除资源会出现长时间处于 terminating 状态，可以使用 \u0026ndash;force \u0026ndash;grace-period=0\n1  kubectl delete po xxx --force --grace-period=0   有时候删除 namespace ，会出现长时间处于 terminating 状态，即使使用 \u0026ndash;force \u0026ndash;grace-period=0 ，仍然处于 terminating 状态，可以使用原生接口删除\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55  # 获取namespace的详情信息 $ kubectl get ns rdbms -o json \u0026gt; rdbms.json # 查看napespace定义的json配置 ## 删除掉spec部分即可 $ cat rdbms.json { \u0026#34;apiVersion\u0026#34;: \u0026#34;v1\u0026#34;, \u0026#34;kind\u0026#34;: \u0026#34;Namespace\u0026#34;, \u0026#34;metadata\u0026#34;: { \u0026#34;annotations\u0026#34;: { \u0026#34;kubectl.kubernetes.io/last-applied-configuration\u0026#34;: \u0026#34;{\\\u0026#34;apiVersion\\\u0026#34;:\\\u0026#34;v1\\\u0026#34;,\\\u0026#34;kind\\\u0026#34;:\\\u0026#34;Namespace\\\u0026#34;,\\\u0026#34;metadata\\\u0026#34;:{\\\u0026#34;annotations\\\u0026#34;:{},\\\u0026#34;name\\\u0026#34;:\\\u0026#34;rdbms\\\u0026#34;}}\\n\u0026#34; }, \u0026#34;creationTimestamp\u0026#34;: \u0026#34;2019-10-14T12:17:44Z\u0026#34;, \u0026#34;deletionTimestamp\u0026#34;: \u0026#34;2019-10-14T12:30:27Z\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;rdbms\u0026#34;, \u0026#34;resourceVersion\u0026#34;: \u0026#34;8844754\u0026#34;, \u0026#34;selfLink\u0026#34;: \u0026#34;/api/v1/namespaces/rdbms\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;29067ddf-56d7-4cce-afa3-1fbdbb221ab1\u0026#34; }, \u0026#34;spec\u0026#34;: { \u0026#34;finalizers\u0026#34;: [ \u0026#34;kubernetes\u0026#34; ] }, \u0026#34;status\u0026#34;: { \u0026#34;phase\u0026#34;: \u0026#34;Terminating\u0026#34; } } # 使用http接口进行删除 $ curl -k -H \u0026#34;Content-Type:application/json\u0026#34; -X PUT --data-binary @rdbms.json https://x.x.x.x:6443/api/v1/namespaces/rdbms/finalize { \u0026#34;kind\u0026#34;: \u0026#34;Namespace\u0026#34;, \u0026#34;apiVersion\u0026#34;: \u0026#34;v1\u0026#34;, \u0026#34;metadata\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;rdbms\u0026#34;, \u0026#34;selfLink\u0026#34;: \u0026#34;/api/v1/namespaces/rdbms/finalize\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;29067ddf-56d7-4cce-afa3-1fbdbb221ab1\u0026#34;, \u0026#34;resourceVersion\u0026#34;: \u0026#34;8844754\u0026#34;, \u0026#34;creationTimestamp\u0026#34;: \u0026#34;2019-10-14T12:17:44Z\u0026#34;, \u0026#34;deletionTimestamp\u0026#34;: \u0026#34;2019-10-14T12:30:27Z\u0026#34;, \u0026#34;annotations\u0026#34;: { \u0026#34;kubectl.kubernetes.io/last-applied-configuration\u0026#34;: \u0026#34;{\\\u0026#34;apiVersion\\\u0026#34;:\\\u0026#34;v1\\\u0026#34;,\\\u0026#34;kind\\\u0026#34;:\\\u0026#34;Namespace\\\u0026#34;,\\\u0026#34;metadata\\\u0026#34;:{\\\u0026#34;annotations\\\u0026#34;:{},\\\u0026#34;name\\\u0026#34;:\\\u0026#34;rdbms\\\u0026#34;}}\\n\u0026#34; } }, \u0026#34;spec\u0026#34;: { }, \u0026#34;status\u0026#34;: { \u0026#34;phase\u0026#34;: \u0026#34;Terminating\u0026#34; } # 再次查看namespace发现已经被删除了 $ kubectl get ns | grep rdb   如果在这些命令后 Pod 仍处于 Unknown 状态，请使用以下命令从集群中删除 Pod:\n1  kubectl patch pod \u0026lt;pod\u0026gt; -p \u0026#39;{\u0026#34;metadata\u0026#34;:{\u0026#34;finalizers\u0026#34;:null}}\u0026#39;   ","date":"2022-11-01T10:03:18+08:00","permalink":"https://mkbooks.github.io/blog/p/%E6%9F%A5%E7%9C%8B-namespace-%E4%B8%8B%E9%9D%A2%E6%89%80%E6%9C%89%E7%9A%84%E8%B5%84%E6%BA%90%E5%B9%B6%E5%88%A0%E9%99%A4/","title":"查看 namespace 下面所有的资源并删除"},{"content":"问题 1 问题描述 Failed to connect to 127.0.0.1 port 8889: Connection refused\n解决步骤 查看代理使用情况\n1  env | grep -i proxy   取消代理端口为 8889 的设置\n1 2  unset HTTPS_PROXY unset HTTP_PROXY   设置代理\n1 2 3  export HTTPS_PROXY=http://127.0.0.1:8889/ export all_proxy=socks://127.0.0.1:1089/ export ftp_proxy=http://127.0.0.1:8889/   如果设置了永久代理，比如在 ~/.bashrc, /etc/profile, /etc/environment, 添加的代理，则需要修改文件并 source 一下。\n如果不知道在哪里添加了代理，只能全局搜索了\n1 2 3  sudo grep -r -i http_proxy=http://127.0.0.1:8889/ sudo grep -rnw \u0026#39;/\u0026#39; -e \u0026#34;127.0.0.1:8889\u0026#34;   ","date":"2022-10-31T10:24:00+08:00","permalink":"https://mkbooks.github.io/blog/p/git-%E9%97%AE%E9%A2%98/","title":"git 问题"},{"content":"进入网站 http://10.8.0.10:6969/\n","date":"2022-10-30T16:38:18+08:00","permalink":"https://mkbooks.github.io/blog/p/naifu-%E4%BD%BF%E7%94%A8/","title":"NAIFU 使用"},{"content":"Windows平台 下载客户端 官方下载地址页面\n客户端选择\n官网提供两种Windows的客户端，根据自己的Windows版本安装即可\nopenvpn-install-2.4.8-I602-Win7.exe\nopenvpn-install-2.4.8-I602-Win10.exe\n安装OpenVPN 双击下载好的exe文件\n一路下一步直至安装完成\n使用  将 *.ovpn 文件放到安装目录的 conf 目录下 使用管理员权限启动 bin 下的 openvpn-gui 程序 在任务栏中连接服务  ","date":"2022-10-30T16:38:18+08:00","permalink":"https://mkbooks.github.io/blog/p/%E5%AE%89%E8%A3%85openvpn%E5%AE%A2%E6%88%B7%E7%AB%AF/","title":"安装openVPN客户端"},{"content":" 参考: https://cloud.tencent.com/document/product/400/35244\n 环境 1 2  ~$ nginx -v nginx version: nginx/1.18.0 (Ubuntu)   申请 SSL 证书 腾讯云\n下载 Nginx 服务器类型\n解压发送\n1  scp {chenjinxin.cn_bundle.crt,chenjinxin.cn.key} root@changxiangyu.cn:/usr/share/nginx/   编辑服务器 Nginx 配置文件 /etc/nginx/nginx.conf 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146  user www-data; worker_processes auto; pid /run/nginx.pid; include /etc/nginx/modules-enabled/*.conf; events { worker_connections 768; # multi_accept on; } http { # changxiangyu.cn server { listen\t80; listen [::]:80; server_name changxiangyu.cn www.changxiangyu.cn; #把http的域名请求转成https return 301 https://$host$request_uri; #location / { #\troot /home/sammy/blog/public; #} #location /images { #\troot /home/sammy/data/; #\tautoindex on; #} } server { listen 443 ssl; ssl_certificate /usr/share/nginx/changxiangyu.cn_bundle.crt; ssl_certificate_key /usr/share/nginx/changxiangyu.cn.key; ssl_session_timeout 5m; #请按照以下套件配置，配置加密套件，写法遵循 openssl 标准。 ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; #请按照以下协议配置 ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; server_name changxiangyu.cn www.changxiangyu.cn; location / { root /home/sammy/blog/public; } location /images { root /home/sammy/data/; autoindex on; } } # chenjinxin.cn server { listen\t80; listen [::]:80; server_name chenjinxin.cn www.chenjinxin.cn; #把http的域名请求转成https return 301 https://$host$request_uri; } server { listen 443 ssl; ssl_certificate /usr/share/nginx/chenjinxin.cn_bundle.crt; ssl_certificate_key /usr/share/nginx/chenjinxin.cn.key; ssl_session_timeout 5m; #请按照以下套件配置，配置加密套件，写法遵循 openssl 标准。 ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; #请按照以下协议配置 ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; server_name chenjinxin.cn www.chenjinxin.cn; location / { root /home/sammy/cjx_blog/public; } location /images { root /home/sammy/data/; autoindex on; } } ## # Basic Settings ## sendfile on; tcp_nopush on; tcp_nodelay on; keepalive_timeout 65; types_hash_max_size 2048; # server_tokens off; # server_names_hash_bucket_size 64; # server_name_in_redirect off; include /etc/nginx/mime.types; default_type application/octet-stream; ## # SSL Settings ## ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE ssl_prefer_server_ciphers on; ## # Logging Settings ## access_log /var/log/nginx/access.log; error_log /var/log/nginx/error.log; ## # Gzip Settings ## gzip on; # gzip_vary on; # gzip_proxied any; # gzip_comp_level 6; # gzip_buffers 16 8k; # gzip_http_version 1.1; # gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript; ## # Virtual Host Configs ## include /etc/nginx/conf.d/*.conf; include /etc/nginx/sites-enabled/*; } #mail { #\t# See sample authentication script at: #\t# http://wiki.nginx.org/ImapAuthenticateWithApachePhpScript # #\t# auth_http localhost/auth.php; #\t# pop3_capabilities \u0026#34;TOP\u0026#34; \u0026#34;USER\u0026#34;; #\t# imap_capabilities \u0026#34;IMAP4rev1\u0026#34; \u0026#34;UIDPLUS\u0026#34;; # #\tserver { #\tlisten localhost:110; #\tprotocol pop3; #\tproxy on; #\t} # #\tserver { #\tlisten localhost:143; #\tprotocol imap; #\tproxy on; #\t} #}   验证配置文件问题 1  sudo /usr/sbin/nginx -t   重载 Nginx 1  sudo /usr/sbin/nginx -s reload   成功后即可使用 chenjinxin.cn 进行访问\n","date":"2022-10-05T20:46:00+08:00","permalink":"https://mkbooks.github.io/blog/p/%E5%8D%95%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BB%91%E5%AE%9A%E5%A4%9A%E4%B8%AA%E5%9F%9F%E5%90%8D/","title":"单服务器绑定多个域名"},{"content":"PyHive\n安装依赖包 1 2 3 4  pip install sasl pip install thrift pip install thrift-sasl pip install PyHive   如果安装 sasl 出现错误，尝试以下解决方法\n ubuntu20.04  1  sudo apt-get install libsasl2-dev    windows  1 2  # 下载: https://www.lfd.uci.edu/~gohlke/pythonlibs/#sasl pip install xxx/sasl-0.3.1-cp38-cp38-win_amd64.whl   代码样例 1 2 3 4 5 6 7 8  from pyhive import hive conn = hive.Connection(host=\u0026#39;192.168.122.251\u0026#39;, port=10000, username=\u0026#39;root\u0026#39;, database=\u0026#39;default\u0026#39;, auth=\u0026#39;NOSASL\u0026#39;) cursor = conn.cursor() cursor.execute(\u0026#39;SELECT * FROM test LIMIT 10\u0026#39;) for i in cursor.fetchall(): print(i) conn.close()   配置 hadoop /opt/modules/hadoop-2.7.0/etc/hadoop/core-site.xml\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33  \u0026lt;configuration\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;fs.defaultFS\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;hdfs://172.168.0.2:9000\u0026lt;/value\u0026gt; \u0026lt;description\u0026gt;配置NameNode的主机地址及其端口号\u0026lt;/description\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hadoop.http.staticuser.user\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;kfk\u0026lt;/value\u0026gt; \u0026lt;description\u0026gt;HDFS Web UI 用户名\u0026lt;/description\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hadoop.tmp.dir\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;/opt/modules/hadoop-2.7.0/tmp\u0026lt;/value\u0026gt; \u0026lt;description\u0026gt;其他临时目录的基础。（HDFS等相关文件的存储目录基础，很重要）\u0026lt;/description\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;!--hive--\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hadoop.proxyuser.root.hosts\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;*\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;!--下面二选一，root 可以改为真实使用的用户，name 和 value 中的 root 都要改--\u0026gt; \u0026lt;!--property\u0026gt; \u0026lt;name\u0026gt;hadoop.proxyuser.root.groups\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;*\u0026lt;/value\u0026gt; \u0026lt;/property--\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hadoop.proxyuser.root.groups\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;root\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;/configuration\u0026gt;   hive /opt/modules/hive-2.3.4-bin/conf/hive-site.xml\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78  \u0026lt;configuration\u0026gt; \u0026lt;!--Hive集成MySQL--\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;javax.jdo.option.ConnectionURL\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;jdbc:mysql://172.168.0.3/metastore?createDatabaseIfNotExist=true\u0026lt;/value\u0026gt; \u0026lt;description\u0026gt;JDBC connect string for a JDBC metastore\u0026lt;/description\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;javax.jdo.option.ConnectionDriverName\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;com.mysql.jdbc.Driver\u0026lt;/value\u0026gt; \u0026lt;description\u0026gt;Driver class name for a JDBC metastore\u0026lt;/description\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;javax.jdo.option.ConnectionUserName\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;root\u0026lt;/value\u0026gt; \u0026lt;description\u0026gt;username to use against metastore database\u0026lt;/description\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;javax.jdo.option.ConnectionPassword\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;123456\u0026lt;/value\u0026gt; \u0026lt;description\u0026gt;password to use against metastore database\u0026lt;/description\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;!--Hive显示设置--\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hive.cli.print.header\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;true\u0026lt;/value\u0026gt; \u0026lt;description\u0026gt;Whether to print the names of the columns in query output.\u0026lt;/description\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hive.cli.print.current.db\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;true\u0026lt;/value\u0026gt; \u0026lt;description\u0026gt;Whether to include the current database in the Hive prompt.\u0026lt;/description\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hive.metastore.schema.verification\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;false\u0026lt;/value\u0026gt; \u0026lt;description\u0026gt; Enforce metastore schema version consistency. True: Verify that version information stored in metastore matches with one from Hive jars. Also disable automatic schema migration attempt. Users are required to manully migrate schema after Hive upgrade which ensures proper metastore schema migration. (Default) False: Warn if the version information stored in metastore doesn\u0026#39;t match with one from in Hive jars. \u0026lt;/description\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;datanucleus.schema.autoCreateAll\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;true\u0026lt;/value\u0026gt; \u0026lt;description\u0026gt;creates necessary schema on a startup if one doesn\u0026#39;t exist. set this to false, after creating it once\u0026lt;/description\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;!--hiveserver2 配置--\u0026gt; \u0026lt;!--property\u0026gt; \u0026lt;name\u0026gt;hive.server2.authentication\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;CUSTOM\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hive.server2.custom.authentication.class\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;org.apache.hadoop.hive.contrib.auth.CustomPasswdAuthenticator\u0026lt;/value\u0026gt; \u0026lt;description\u0026gt;指定解析jar包 注意修改成自己的类，注意是全路径名即包名和类名\u0026lt;/description\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hive.jdbc_passwd.auth.root\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;123456\u0026lt;/value\u0026gt; \u0026lt;description\u0026gt;设置用户名和密码，如果有多个用户和密码，可以多写几个property。name: 用户名为最后一个:用户,value: 密码\u0026lt;/description\u0026gt; \u0026lt;/property--\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hive.server2.authentication\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;NOSASL\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;/configuration\u0026gt;   可能出现的问题 1 2 3  AccessControlException: Permission denied: user=anonymous, access=EXECUTE, inode=\u0026#34;/tmp/hive\u0026#34;:root:supergroup:d-wx-w 类似于以上错误；可以对hdfs上的/tmp目录加权： [root@node1 ~]# hdfs dfs -chmod -R 777 /tmp   hiveserver2 自定义验证账户类（未验证） 将此自定义类打成jar包放入到 hive/lib 目录下。不然会报错找不到class。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  package org.apache.hadoop.hive.contrib.auth; import javax.security.sasl.AuthenticationException; import org.apache.hadoop.conf.Configuration; import org.apache.hadoop.hive.conf.HiveConf; import org.slf4j.Logger; public class CustomPasswdAuthenticator implements org.apache.hive.service.auth.PasswdAuthenticationProvider{ private Logger LOG = org.slf4j.LoggerFactory.getLogger(CustomPasswdAuthenticator.class); private static final String HIVE_JDBC_PASSWD_AUTH_PREFIX=\u0026#34;hive.jdbc_passwd.auth.%s\u0026#34;; private Configuration conf=null; @Override public void Authenticate(String userName, String passwd) throws AuthenticationException { LOG.info(\u0026#34;user: \u0026#34;+userName+\u0026#34; try login.\u0026#34;); String passwdConf = getConf().get(String.format(HIVE_JDBC_PASSWD_AUTH_PREFIX, userName)); if(passwdConf==null){ String message = \u0026#34;user\u0026#39;s ACL configration is not found. user:\u0026#34;+userName; LOG.info(message); throw new AuthenticationException(message); } if(!passwd.equals(passwdConf)){ String message = \u0026#34;user name and password is mismatch. user:\u0026#34;+userName; throw new AuthenticationException(message); } } public Configuration getConf() { if(conf==null){ this.conf=new Configuration(new HiveConf()); } return conf; } public void setConf(Configuration conf) { this.conf=conf; } }   ","date":"2022-09-16T11:20:00+08:00","permalink":"https://mkbooks.github.io/blog/p/%E4%BD%BF%E7%94%A8python%E6%93%8D%E4%BD%9Chive/","title":"使用Python操作hive"},{"content":"更新源 1  sudo apt-get update   安装ssh服务 1  sudo apt-get install openssh-server   验证SSH服务 1  sudo systemctl status ssh   创建密钥 1  ssh-keygen   修改ssh登录端口 1 2 3 4 5  $ vi /etc/ssh/sshd_config #Port 22 #修改为： Port 8848 #这里修改为你想要设置的端口,以 8848 为例   修改防火墙配置 1  $ vi /etc/sysconfig/iptabels   添加以下规则\n1  -A INPUT -m state --state NEW -m tcp -p tcp --dport 60022 -j ACCEPT   刷新iptables并重启ssh服务\n1 2  $ systemctl restart iptables.service $ systemctl restart sshd.service   禁止 ssh 口令登录 更改ssh配置\n1  $ vi /etc/ssh/sshd_config   1 2  #PasswordAuthentication yes 改为 PasswordAuthentication no   编辑保存完成后，重启ssh服务使得新配置生效，然后就无法使用口令来登录ssh了\n1  $ systemctl restart sshd.service   ","date":"2022-09-13T14:44:00+08:00","permalink":"https://mkbooks.github.io/blog/p/ssh%E6%9C%8D%E5%8A%A1/","title":"ssh服务"},{"content":"create config 1 2  pptpsetup --create vpn --server vpn.bjklb.com --username ai-lijinxin --password 123 pptpsetup --create vpn --server 111.198.75.20 --username ai-lijinxin --password 123   connect 1  pon vpn   then will create a network device named ppp0\nroute route for target like 10.0.1.0 to ppp0\n1  ip route add 10.0.1.0/24 dev ppp0   disconnect 1  poff vpn   ","date":"2022-09-08T11:02:00+08:00","permalink":"https://mkbooks.github.io/blog/p/%E7%BB%88%E7%AB%AF%E8%AE%BE%E7%BD%AE%E7%89%B9%E5%AE%9Aip%E6%AE%B5%E8%B5%B0%E8%B7%AF%E7%94%B1/","title":"终端设置特定IP段走路由"},{"content":" 参考: https://www.jianshu.com/p/dc7e86b171cb\n 安装软件工具 1 2  pip install requests pip install bypy   授权登陆 执行 bypy info，显示下边信息，根据提示，通过浏览器访问下边灰色的https链接，如果此时百度网盘账号正在登陆，会出现长串授权码，复制。\n1 2 3 4 5 6  [root@yu~]# bypy info Please visit: # 访问下边这个连接，复制授权码 https://openapi.baidu.com/oauth/2.0/authorize?scope=basic+netdisk\u0026amp;redirect_uri=oob\u0026amp;response_type=code\u0026amp;client_id=q8WE4EpCsau1oS0MplgMKNBn And authorize this app Paste the Authorization Code here within 10 minutes. Press [Enter] when you are done # 提示在下边粘贴授权码   在下边图示位置粘贴授权码，耐心等待一会即可\n1 2 3 4 5  Press [Enter] when you are done 2d2416c9e27c5b19f14da97c82daf18e Authorizing, please be patient, it may take upto 300 seconds... Quota: 14.020TB Used: 5.497TB   授权成功。\n测试上传和同步本地文件到云盘 由于百度PCS API权限限制，程序只能存取百度云端/apps/bypy目录下面的文件和目录。我们可以通过：\n1 2  [root@yu~]# bypy list /apps/bypy ($t $f $s $m $d):   把本地当前目录下的文件同步到百度云盘：\n1  bypy upload   把云盘上的内容同步到本地:\n1  bypy downdir   比较本地当前目录和云盘根目录，看是否一致，来判断是否同步成功：\n1  bypy compare   ","date":"2022-09-07T14:18:00+08:00","permalink":"https://mkbooks.github.io/blog/p/linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%88%B0%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98/","title":"Linux命令行上传文件到百度网盘"},{"content":"restart 创建容器时没有添加参数 \u0026ndash;restart=always ，导致的后果是：当 Docker 重启时，容器未能自动启动。\n添加该参数的方法：\n1  docker container update --restart=always 容器名字   ","date":"2022-09-06T11:33:18+08:00","permalink":"https://mkbooks.github.io/blog/p/docker-%E9%95%9C%E5%83%8F%E5%8F%82%E6%95%B0/","title":"docker 镜像参数"},{"content":"参考: https://blog.csdn.net/nklinsirui/article/details/104673286\nSSH远程执行脚本报错 SSH 远程执行脚本报错\u0026quot;command not found\u0026quot;。在宿主机可以执行命令。\n原因是之前将环境变量配置在了 /etc/profile 中，但是SSH远程执行脚本时实际上执行的是 non-login shell，而 non-login shell不会读取 /etc/profile 配置文件，只读取 ~/.bashrc。\nlogin shell和non-login shell 用SSH客户端登陆Linux系统时，要求输入用户名/密码登录或根据SSH key登录时，就是login shell。\n而在A机器上再用SSH免密码登录B机器，在B机器上执行Shell脚本，就是non-login shell。\n用Ansible在目标机器上远程执行Shell脚本时，也是non-login shell，因为Ansible是基于SSH的。\nlogin shell和non-login shell读取的环境变量配置文件 login-shell读取环境变量配置文件：\n /etc/profile ~/.bash_profile ~/.profile ~/.bashrc /etc/bashrc  注意：~/.bash_profile中已经引入了~/.bashrc，而~/.bashrc引入了/etc/bashrc，因此login shell可以读取到~/.bashrc和/etc/bashrc的配置。\n1 2 3 4  # Get the aliases and functions if [ -f ~/.bashrc ]; then . ~/.bashrc fi   non-login shell读取环境变量配置文件：\n /etc/bashrc ~/.bashrc  解决non-login shell的环境配置问题 方法一：\n将login-shell和non-login shell都需要的环境配置放在~/.bashrc中，其它配置放在~/.bash_profile中。\n方法二：\n如果环境配置只放在~/.bash_profile中，需要执行non-login shell时先source ~/.bash_profile再执行命令。\n方法三：\n在 ~/.bashrc 里添加: . /etc/profile。（立即生效需要: source ~/.bashrc）\n","date":"2022-09-06T11:33:18+08:00","permalink":"https://mkbooks.github.io/blog/p/ssh%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC%E6%8A%A5%E9%94%99command-not-found%E5%92%8C%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%97%AE%E9%A2%98/","title":"SSH远程执行脚本报错command not found和环境变量问题"},{"content":"参考: https://www.cnblogs.com/pandabang/p/10441242.html\n  音量大/小：上/下\n  静音开/关：M\n  回退/快进：ALT+左/右（步进10s），CTRL+左/右（步进1min）\n  跳到指定时间：CTRL+T\n  播放/暂停：空格\n  停止播放：S（与暂停不同，按下停止后播放进度条回到视频最开始，且窗口不显示视频；而暂停时，窗口显示暂停时的视频）\n  播放速度：{或- 减慢，最慢速度0.02倍正常速度；} 加速，最快速度31.25倍正常速度； = 正常速度\n  全屏开/关：F\n  纵横比切换：A（默认、16:9、4:3、1:1、16:10、2.21:1、2:35:1、2.39:1、5:4）\n  窗口尺寸切换：Z（¼、½、原始尺寸、2倍原始尺寸）\n  显示播放时间/总时长：T\n  播放控件显示/不显示：CTRL+H\n  ","date":"2022-09-04T16:25:18+08:00","permalink":"https://mkbooks.github.io/blog/p/vlc%E6%92%AD%E6%94%BE%E5%99%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/","title":"VLC播放器快捷键"},{"content":"多方连接测试 1: Party-9999和Party-10000\n在A集群的Master机器操作\n1 2 3 4 5 6 7 8 9  kubectl get pods -n fate-9999 | grep client 返回 client-5fcd4fdcfd-nqvrz 1/1 Running 0 2d1h 获取client容器ID kubectl exec -it client-5fcd4fdcfd-nqvrz -n fate-9999 bash flow test toy -gid 9999 -hid 10000   3: Party-10000和Party-9999\n在C集群的Master机器操作\n1 2 3 4 5 6 7 8 9 10  kubectl get pods -n fate-10000 | grep client 返回 client-845c4df74-xbf89 1/1 Running 0 47h 获取client容器ID kubectl exec -it client-845c4df74-xbf89 -n fate-10001 bash flow test toy -gid 10000 -hid 9999   成功显示结果\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  toy test job 202205090852477671460 is waiting toy test job 202205090852477671460 is waiting toy test job 202205090852477671460 is running toy test job 202205090852477671460 is running toy test job 202205090852477671460 is running toy test job 202205090852477671460 is running toy test job 202205090852477671460 is running toy test job 202205090852477671460 is running toy test job 202205090852477671460 is running toy test job 202205090852477671460 is running toy test job 202205090852477671460 is running toy test job 202205090852477671460 is running toy test job 202205090852477671460 is running toy test job 202205090852477671460 is running toy test job 202205090852477671460 is running toy test job 202205090852477671460 is running toy test job 202205090852477671460 is running toy test job 202205090852477671460 is running toy test job 202205090852477671460 is success [INFO] [2022-05-09 08:52:53,088] [202205090852477671460] [1339:139984863901504] - [secure_add_guest.run] [line:96]: begin to init parameters of secure add example guest [INFO] [2022-05-09 08:52:53,088] [202205090852477671460] [1339:139984863901504] - [secure_add_guest.run] [line:100]: begin to make guest data [INFO] [2022-05-09 08:52:53,136] [202205090852477671460] [1339:139984863901504] - [secure_add_guest.run] [line:103]: split data into two random parts [INFO] [2022-05-09 08:52:54,031] [202205090852477671460] [1339:139984863901504] - [secure_add_guest.run] [line:106]: share one random part data to host [INFO] [2022-05-09 08:52:54,035] [202205090852477671460] [1339:139984863901504] - [secure_add_guest.run] [line:109]: get share of one random part data from host [INFO] [2022-05-09 08:52:54,573] [202205090852477671460] [1339:139984863901504] - [secure_add_guest.run] [line:112]: begin to get sum of guest and host [INFO] [2022-05-09 08:52:54,645] [202205090852477671460] [1339:139984863901504] - [secure_add_guest.run] [line:115]: receive host sum from guest [INFO] [2022-05-09 08:52:54,721] [202205090852477671460] [1339:139984863901504] - [secure_add_guest.run] [line:122]: success to calculate secure_sum, it is 2000.0000000000002   6.9.5.2 多方训练测试 如何两两之间互通测试通过，我们就可以跑一个三方的test_hetero_lr来测试多方的任务训练。\ntest_hetero_lr的任务需要三方参与，Guest，Host和Arbiter。我们将Party-9999作为Guest，Party-10000作为Host和Arbiter。\n1：在Party-10000上传 host 方数据集\n1 2 3 4 5 6 7 8 9 10  kubectl get pods -n fate-10000 | grep client 返回 client-64f7959ff5-7hvt9 1/1 Running 0 2d 获取client容器ID kubectl exec -it client-64f7959ff5-7hvt9 -n fate-10000 bash 上传数据 flow data upload -c fateflow/examples/upload/upload_host.json   2：在Party-9999上传 guest 方数据集\n1 2 3 4 5 6 7 8 9 10  kubectl get pods -n fate-9999 | grep client 返回 client-5fcd4fdcfd-nqvrz 1/1 Running 0 2d1h 获取client容器ID kubectl exec -it client-5fcd4fdcfd-nqvrz -n fate-9999 bash 上传数据 flow data upload -c fateflow/examples/upload/upload_guest.json   3：在Party-9999发起训练任务\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118  kubectl get pods -n fate-9999 | grep client 返回 client-5fcd4fdcfd-nqvrz 1/1 Running 0 2d1h 获取client容器ID kubectl exec -it client-5fcd4fdcfd-nqvrz -n fate-9999 bash 修改文件 cat \u0026gt; fateflow/examples/lr/test_hetero_lr_job_conf.json \u0026lt;\u0026lt;EOF { \u0026#34;dsl_version\u0026#34;: \u0026#34;2\u0026#34;, \u0026#34;initiator\u0026#34;: { \u0026#34;role\u0026#34;: \u0026#34;guest\u0026#34;, \u0026#34;party_id\u0026#34;: 10004 }, \u0026#34;role\u0026#34;: { \u0026#34;guest\u0026#34;: [ 10004 ], \u0026#34;host\u0026#34;: [ 10001 ], \u0026#34;arbiter\u0026#34;: [ 10001 ] }, \u0026#34;job_parameters\u0026#34;: { \u0026#34;common\u0026#34;: { \u0026#34;task_parallelism\u0026#34;: 2, \u0026#34;computing_partitions\u0026#34;: 8, \u0026#34;task_cores\u0026#34;: 4, \u0026#34;auto_retries\u0026#34;: 1 } }, \u0026#34;component_parameters\u0026#34;: { \u0026#34;common\u0026#34;: { \u0026#34;intersection_0\u0026#34;: { \u0026#34;intersect_method\u0026#34;: \u0026#34;raw\u0026#34;, \u0026#34;sync_intersect_ids\u0026#34;: true, \u0026#34;only_output_key\u0026#34;: false }, \u0026#34;hetero_lr_0\u0026#34;: { \u0026#34;penalty\u0026#34;: \u0026#34;L2\u0026#34;, \u0026#34;optimizer\u0026#34;: \u0026#34;rmsprop\u0026#34;, \u0026#34;alpha\u0026#34;: 0.01, \u0026#34;max_iter\u0026#34;: 3, \u0026#34;batch_size\u0026#34;: 320, \u0026#34;learning_rate\u0026#34;: 0.15, \u0026#34;init_param\u0026#34;: { \u0026#34;init_method\u0026#34;: \u0026#34;random_uniform\u0026#34; } } }, \u0026#34;role\u0026#34;: { \u0026#34;guest\u0026#34;: { \u0026#34;0\u0026#34;: { \u0026#34;reader_0\u0026#34;: { \u0026#34;table\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;breast_hetero_guest\u0026#34;, \u0026#34;namespace\u0026#34;: \u0026#34;experiment\u0026#34; } }, \u0026#34;dataio_0\u0026#34;: { \u0026#34;with_label\u0026#34;: true, \u0026#34;label_name\u0026#34;: \u0026#34;y\u0026#34;, \u0026#34;label_type\u0026#34;: \u0026#34;int\u0026#34;, \u0026#34;output_format\u0026#34;: \u0026#34;dense\u0026#34; } } }, \u0026#34;host\u0026#34;: { \u0026#34;0\u0026#34;: { \u0026#34;reader_0\u0026#34;: { \u0026#34;table\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;breast_hetero_host\u0026#34;, \u0026#34;namespace\u0026#34;: \u0026#34;experiment\u0026#34; } }, \u0026#34;dataio_0\u0026#34;: { \u0026#34;with_label\u0026#34;: false, \u0026#34;output_format\u0026#34;: \u0026#34;dense\u0026#34; }, \u0026#34;evaluation_0\u0026#34;: { \u0026#34;need_run\u0026#34;: false } } } } } } EOF 发起训练任务 flow job submit -d fateflow/examples/lr/test_hetero_lr_job_dsl.json -c fateflow/examples/lr/test_hetero_lr_job_conf.json 返回结果 { \u0026#34;data\u0026#34;: { \u0026#34;board_url\u0026#34;: \u0026#34;http://fateboard:8080/index.html#/dashboard?job_id=202208310748436341990\u0026amp;role=guest\u0026amp;party_id=10001\u0026#34;, \u0026#34;code\u0026#34;: 0, \u0026#34;dsl_path\u0026#34;: \u0026#34;/data/projects/fate/fateflow/jobs/202208310748436341990/job_dsl.json\u0026#34;, \u0026#34;job_id\u0026#34;: \u0026#34;202208310748436341990\u0026#34;, \u0026#34;logs_directory\u0026#34;: \u0026#34;/data/projects/fate/fateflow/logs/202208310748436341990\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;success\u0026#34;, \u0026#34;model_info\u0026#34;: { \u0026#34;model_id\u0026#34;: \u0026#34;arbiter-9006#guest-10001#host-9006#model\u0026#34;, \u0026#34;model_version\u0026#34;: \u0026#34;202208310748436341990\u0026#34; }, \u0026#34;pipeline_dsl_path\u0026#34;: \u0026#34;/data/projects/fate/fateflow/jobs/202208310748436341990/pipeline_dsl.json\u0026#34;, \u0026#34;runtime_conf_on_party_path\u0026#34;: \u0026#34;/data/projects/fate/fateflow/jobs/202208310748436341990/guest/10001/job_runtime_on_party_conf.json\u0026#34;, \u0026#34;runtime_conf_path\u0026#34;: \u0026#34;/data/projects/fate/fateflow/jobs/202208310748436341990/job_runtime_conf.json\u0026#34;, \u0026#34;train_runtime_conf_path\u0026#34;: \u0026#34;/data/projects/fate/fateflow/jobs/202208310748436341990/train_runtime_conf.json\u0026#34; }, \u0026#34;jobId\u0026#34;: \u0026#34;202208310748436341990\u0026#34;, \u0026#34;retcode\u0026#34;: 0, \u0026#34;retmsg\u0026#34;: \u0026#34;success\u0026#34; }   4：命令查看任务结果\n1  flow task query -r guest -j 202208310748436341990 | grep -w f_status   6.9.6 联邦推理测试 上面已经基于hetero_lr进行多方训练，训练出模型，下面基于上面的多方训练后部署模型、加载模型、绑定模型、模型推理\n6.9.6.1 部署模型 进入party-9999容器内\n1 2 3 4 5 6 7  kubectl get pods -n fate-9999 | grep client 返回 client-5fcd4fdcfd-nqvrz 1/1 Running 0 2d1h 获取client容器ID kubectl exec -it client-5fcd4fdcfd-nqvrz -n fate-9999 bash   部署模型\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40  flow model deploy --model-id arbiter-10000#guest-9999#host-10000#model --model-version 202205180944078730290(任务ID) 返回 { \u0026#34;data\u0026#34;: { \u0026#34;arbiter\u0026#34;: { \u0026#34;9006\u0026#34;: 0 }, \u0026#34;detail\u0026#34;: { \u0026#34;arbiter\u0026#34;: { \u0026#34;9006\u0026#34;: { \u0026#34;retcode\u0026#34;: 0, \u0026#34;retmsg\u0026#34;: \u0026#34;deploy model of role arbiter 9006 success\u0026#34; } }, \u0026#34;guest\u0026#34;: { \u0026#34;10001\u0026#34;: { \u0026#34;retcode\u0026#34;: 0, \u0026#34;retmsg\u0026#34;: \u0026#34;deploy model of role guest 10001 success\u0026#34; } }, \u0026#34;host\u0026#34;: { \u0026#34;9006\u0026#34;: { \u0026#34;retcode\u0026#34;: 0, \u0026#34;retmsg\u0026#34;: \u0026#34;deploy model of role host 9006 success\u0026#34; } } }, \u0026#34;guest\u0026#34;: { \u0026#34;10001\u0026#34;: 0 }, \u0026#34;host\u0026#34;: { \u0026#34;9006\u0026#34;: 0 }, \u0026#34;model_id\u0026#34;: \u0026#34;arbiter-9006#guest-10001#host-9006#model\u0026#34;, \u0026#34;model_version\u0026#34;: \u0026#34;202208310755426963170\u0026#34; }, \u0026#34;retcode\u0026#34;: 0, \u0026#34;retmsg\u0026#34;: \u0026#34;success\u0026#34; }   获取到的信息是\n1 2  \u0026#34;model_id\u0026#34;: \u0026#34;arbiter-9006#guest-10001#host-9006#model\u0026#34;, \u0026#34;model_version\u0026#34;: \u0026#34;202208310755426963170\u0026#34;   6.9.6.2 加载模型 修改publish_load_model.json如下\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  cat \u0026gt; fateflow/examples/model/publish_load_model.json \u0026lt;\u0026lt;EOF { \u0026#34;initiator\u0026#34;: { \u0026#34;party_id\u0026#34;: \u0026#34;10001\u0026#34;, \u0026#34;role\u0026#34;: \u0026#34;guest\u0026#34; }, \u0026#34;role\u0026#34;: { \u0026#34;guest\u0026#34;: [ \u0026#34;10001\u0026#34; ], \u0026#34;host\u0026#34;: [ \u0026#34;10004\u0026#34; ], \u0026#34;arbiter\u0026#34;: [ \u0026#34;10004\u0026#34; ] }, \u0026#34;job_parameters\u0026#34;: { \u0026#34;model_id\u0026#34;: \u0026#34;arbiter-10004#guest-10001#host-10004#model\u0026#34;, \u0026#34;model_version\u0026#34;: \u0026#34;202209010444329886110\u0026#34; } } EOF   加载模型\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  flow model load -c fateflow/examples/model/publish_load_model.json 返回信息 { \u0026#34;data\u0026#34;: { \u0026#34;detail\u0026#34;: { \u0026#34;guest\u0026#34;: { \u0026#34;10001\u0026#34;: { \u0026#34;retcode\u0026#34;: 0, \u0026#34;retmsg\u0026#34;: \u0026#34;success\u0026#34; } }, \u0026#34;host\u0026#34;: { \u0026#34;9006\u0026#34;: { \u0026#34;retcode\u0026#34;: 0, \u0026#34;retmsg\u0026#34;: \u0026#34;success\u0026#34; } } }, \u0026#34;guest\u0026#34;: { \u0026#34;10001\u0026#34;: 0 }, \u0026#34;host\u0026#34;: { \u0026#34;9006\u0026#34;: 0 } }, \u0026#34;jobId\u0026#34;: \u0026#34;202208310757075993710\u0026#34;, \u0026#34;retcode\u0026#34;: 0, \u0026#34;retmsg\u0026#34;: \u0026#34;success\u0026#34; }   6.9.6.3 绑定模型 修改版定模型配置\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  cat \u0026gt; fateflow/examples/model/bind_model_service.json \u0026lt;\u0026lt;EOF { \u0026#34;service_id\u0026#34;: \u0026#34;201\u0026#34;, \u0026#34;initiator\u0026#34;: { \u0026#34;party_id\u0026#34;: \u0026#34;10001\u0026#34;, \u0026#34;role\u0026#34;: \u0026#34;guest\u0026#34; }, \u0026#34;role\u0026#34;: { \u0026#34;guest\u0026#34;: [\u0026#34;10001\u0026#34;], \u0026#34;host\u0026#34;: [\u0026#34;10004\u0026#34;], \u0026#34;arbiter\u0026#34;: [\u0026#34;10004\u0026#34;] }, \u0026#34;job_parameters\u0026#34;: { \u0026#34;work_mode\u0026#34;: 1, \u0026#34;model_id\u0026#34;: \u0026#34;arbiter-10004#guest-10001#host-10004#model\u0026#34;, \u0026#34;model_version\u0026#34;: \u0026#34;202209010444329886110\u0026#34; } } EOF   绑定模型\n1 2 3 4 5 6 7  flow model bind -c fateflow/examples/model/bind_model_service.json 返回信息 { \u0026#34;retcode\u0026#34;: 0, \u0026#34;retmsg\u0026#34;: \u0026#34;service id is test03\u0026#34; }   6.9.6.4 联邦推理 配置party-10000的ingressHost\n1 2 3 4 5 6  sudo vi /etc/hosts 增加一行 10.0.1.199 9999.serving-proxy.sj.pclab 10.0.1.199 为partry-9999所在集群的Master节点IP，请根据集群IP进行修改   6.9.6.4.1 单笔推理 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  curl -X POST -H \u0026#39;Content-Type: application/json\u0026#39; -i \u0026#39;http://10004.serving-proxy.204.pclab/federation/v1/inference\u0026#39; --data \u0026#39;{ \u0026#34;head\u0026#34;: { \u0026#34;serviceId\u0026#34;: \u0026#34;204\u0026#34; }, \u0026#34;body\u0026#34;: { \u0026#34;featureData\u0026#34;: { \u0026#34;x0\u0026#34;: 1.88669, \u0026#34;x1\u0026#34;: -1.359293, \u0026#34;x2\u0026#34;: 2.303601, \u0026#34;x3\u0026#34;: 2.00137, \u0026#34;x4\u0026#34;: 1.307686 }, \u0026#34;sendToRemoteFeatureData\u0026#34;: { \u0026#34;phone_num\u0026#34;: \u0026#34;122222222\u0026#34; } } }\u0026#39;   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  curl -X POST -H \u0026#39;Content-Type: application/json\u0026#39; -i \u0026#39;http://10001.serving-proxy.sh.com/federation/v1/inference\u0026#39; --data \u0026#39;{ \u0026#34;head\u0026#34;: { \u0026#34;serviceId\u0026#34;: \u0026#34;201\u0026#34; }, \u0026#34;body\u0026#34;: { \u0026#34;featureData\u0026#34;: { \u0026#34;x0\u0026#34;: 1.88669, \u0026#34;x1\u0026#34;: -1.359293, \u0026#34;x2\u0026#34;: 2.303601, \u0026#34;x3\u0026#34;: 2.00137, \u0026#34;x4\u0026#34;: 1.307686 }, \u0026#34;sendToRemoteFeatureData\u0026#34;: { \u0026#34;phone_num\u0026#34;: \u0026#34;122222222\u0026#34; } } }\u0026#39;   返回\n1  {\u0026#34;retcode\u0026#34;:0,\u0026#34;retmsg\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;data\u0026#34;:{\u0026#34;score\u0026#34;:0.9983544928940998,\u0026#34;modelId\u0026#34;:\u0026#34;guest#9999#arbiter-10000#guest-9999#host-10000#model\u0026#34;,\u0026#34;modelVersion\u0026#34;:\u0026#34;202205090912483804370\u0026#34;,\u0026#34;timestamp\u0026#34;:1652087899953},\u0026#34;flag\u0026#34;:0}   6.9.6.4.2 批量推理 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37  curl -X POST -H \u0026#39;Content-Type: application/json\u0026#39; -i \u0026#39;http://10004.serving-proxy.204.pclab/federation/v1/batchInference\u0026#39; --data \u0026#39;{ \u0026#34;head\u0026#34;: { \u0026#34;serviceId\u0026#34;: \u0026#34;204\u0026#34; }, \u0026#34;body\u0026#34;: { \u0026#34;batchDataList\u0026#34;: [ { \u0026#34;index\u0026#34;: 0, \u0026#34;featureData\u0026#34;: { \u0026#34;x0\u0026#34;: 1.88669, \u0026#34;x1\u0026#34;: -1.359293, \u0026#34;x2\u0026#34;: 2.303601, \u0026#34;x3\u0026#34;: 2.00137, \u0026#34;x4\u0026#34;: 1.307686 }, \u0026#34;sendToRemoteFeatureData\u0026#34;: { \u0026#34;device_id\u0026#34;: \u0026#34;aaaaa\u0026#34;, \u0026#34;phone_num\u0026#34;: \u0026#34;122222222\u0026#34; } }, { \u0026#34;index\u0026#34;: 1, \u0026#34;featureData\u0026#34;: { \u0026#34;x0\u0026#34;: 1.88669, \u0026#34;x1\u0026#34;: -1.359293, \u0026#34;x2\u0026#34;: 2.303601, \u0026#34;x3\u0026#34;: 2.00137, \u0026#34;x4\u0026#34;: 1.307686 }, \u0026#34;sendToRemoteFeatureData\u0026#34;: { \u0026#34;device_id\u0026#34;: \u0026#34;aaaaa\u0026#34;, \u0026#34;phone_num\u0026#34;: \u0026#34;122222222\u0026#34; } } ] } }\u0026#39;   返回\n1  {\u0026#34;retcode\u0026#34;:0,\u0026#34;retmsg\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;data\u0026#34;:{\u0026#34;modelId\u0026#34;:\u0026#34;guest#9999#arbiter-10000#guest-9999#host-10000#model\u0026#34;,\u0026#34;modelVersion\u0026#34;:\u0026#34;202205110759591171670\u0026#34;,\u0026#34;timestamp\u0026#34;:1652256064349},\u0026#34;flag\u0026#34;:0,\u0026#34;batchDataList\u0026#34;:[{\u0026#34;index\u0026#34;:0,\u0026#34;retcode\u0026#34;:0,\u0026#34;retmsg\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;data\u0026#34;:{\u0026#34;score\u0026#34;:0.3813935132948826}},{\u0026#34;index\u0026#34;:1,\u0026#34;retcode\u0026#34;:0,\u0026#34;retmsg\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;data\u0026#34;:{\u0026#34;score\u0026#34;:0.3813935132948826}}],\u0026#34;singleInferenceResultMap\u0026#34;:{\u0026#34;0\u0026#34;:{\u0026#34;index\u0026#34;:0,\u0026#34;retcode\u0026#34;:0,\u0026#34;retmsg\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;data\u0026#34;:{\u0026#34;score\u0026#34;:0.3813935132948826}},\u0026#34;1\u0026#34;:{\u0026#34;index\u0026#34;:1,\u0026#34;retcode\u0026#34;:0,\u0026#34;retmsg\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;data\u0026#34;:{\u0026#34;score\u0026#34;:0.3813935132948826}}}}%   ","date":"2022-08-31T15:27:18+08:00","permalink":"https://mkbooks.github.io/blog/p/kubefate%E8%AE%AD%E7%BB%83%E6%B5%8B%E8%AF%95/","title":"kubefate训练测试"},{"content":"Ubuntu 20.04 1 2  ip route show # more /etc/network/interfaces   安装 net-tools\n1 2 3 4  sudo apt install net-tools route -n netstat -r   安装 sudo apt install traceroute\n1 2  # 第一行就是自己的网关 traceroute www.baidu.com -s 100   CentOS 1  more /etc/sysconfig/network-scripts/ifcfg-eth0   ","date":"2022-08-28T16:38:18+08:00","permalink":"https://mkbooks.github.io/blog/p/%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0-0001/","title":"网络学习-0001"},{"content":"1. 使两台机器通过交换机连通 1.1 网络结构：\n1.2 网络现状：机器一和机器二不通。\n1.3 原因分析：当前两台机器都是自动获取IP模式，但是交换机不分配IP。\n1.4 目标：机器一和机器二连通。\n1.5 操作：\n给机器一设置 IP 和子网掩码(不设置网关)：\n address: 192.168.0.10 netmask: 255.255.255.0  给机器二设置 IP 和子网掩码(不设置网关)：\n address: 192.168.0.11 netmask: 255.255.255.0  1 2 3  # 临时修改 # ifconfig 网卡名称 IP地址 netmask 子网掩码 sudo ifconfig eno2 192.168.0.11 netmask 255.255.255.0   1.6 测试连通:\n1 2  # 机器一 ping 192.168.0.11   1 2  # 机器二 ping 192.168.0.10   测试连通成功\n2. 使机器一 192.168.0.0/24 的网段，可以跟机器二的 192.168.3.0/24 的网段互通 1.2 网络结构：\n1.2 网络现状：机器一和机器二 192.168.0.11 的 IP 互相连通，机器一和机器二 192.168.3.34 的 IP 互相不通。\n1.3 原因分析：两个网段不通。\n1.4 目标：使机器一 192.168.0.0/24 的网段，可以跟机器二的 192.168.3.0/24 的网段互通。\n1.5 操作：\n机器一\n1  sudo route add -net 192.168.3.0 netmask 255.255.255.0 gw 192.168.0.11   机器二\n1 2  iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -d 192.168.3.0/24 -o wlo1 -j MASQUERADE iptables -t nat -A POSTROUTING -s 192.168.3.0/24 -d 192.168.0.0/24 -o eno2 -j MASQUERADE   机器三\n1  sudo route add -net 192.168.0.0 netmask 255.255.255.0 gw 192.168.3.34   1.6 测试连通:\n1 2  # 机器一 ping 192.168.3.102   1 2  # 机器三 ping 192.168.0.10   测试连通成功\n","date":"2022-08-28T16:38:18+08:00","permalink":"https://mkbooks.github.io/blog/p/%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0-0001/","title":"网络学习-0001"},{"content":"Ubuntu 20.04 机器能连通内网及路由网关，但是上不了网 参考：https://www.cnblogs.com/tinkone/p/10498524.html\n1 2 3 4  cjx@cjx-0002:~$ ip route show default via 192.168.3.1 dev enp6s0 proto static metric 20100 169.254.0.0/16 dev enp6s0 scope link metric 1000 192.168.3.0/24 dev enp6s0 proto kernel scope link src 192.168.3.102 metric 100   解决：\n1 2 3 4  sudo nano /etc/systemd/resolved.conf #在 DNS 下添加： DNS=8.8.8.8   重启即可\n","date":"2022-08-28T16:38:18+08:00","permalink":"https://mkbooks.github.io/blog/p/%E7%BD%91%E7%BB%9C%E9%97%AE%E9%A2%98/","title":"网络问题"},{"content":"参考：https://github.com/FederatedAI/KubeFATE/blob/master/k8s-deploy/docs/swagger.json\nmaster 测试 获取服务 IP 和端口\n1 2 3 4  k -n kube-fate get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE mariadb ClusterIP 10.43.102.139 \u0026lt;none\u0026gt; 3306/TCP 113d kubefate ClusterIP 10.43.147.93 \u0026lt;none\u0026gt; 8080/TCP 113d   查看集群状态\n1 2 3 4  curl 10.43.147.93:8080 {\u0026#34;msg\u0026#34;:\u0026#34;kubefate run Success\u0026#34;} curl sh.com(域名) {\u0026#34;msg\u0026#34;:\u0026#34;kubefate run Success\u0026#34;}   获取 token\n1 2 3 4 5 6 7 8 9 10 11  curl -X POST -H \u0026#39;Content-Type: application/json\u0026#39; -i \u0026#39;http://10.43.147.93:8080/v1/user/login\u0026#39; --data \u0026#39;{ \u0026#34;username\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;admin\u0026#34; }\u0026#39; {\u0026#34;code\u0026#34;:200,\u0026#34;expire\u0026#34;:\u0026#34;2022-08-29T07:34:13Z\u0026#34;,\u0026#34;token\u0026#34;:\u0026#34;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NjE3NTg0NTMsImlkIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY2MTc1NjY1M30.HIlE-j-RxufqOgS2G0n9zLnsNVWK-GdGyX1rJeX4ons\u0026#34;} curl -X POST -H \u0026#39;Content-Type: application/json\u0026#39; -i \u0026#39;http://sh.com/v1/user/login\u0026#39; --data \u0026#39;{ \u0026#34;username\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;admin\u0026#34; }\u0026#39; {\u0026#34;code\u0026#34;:200,\u0026#34;expire\u0026#34;:\u0026#34;2022-08-29T08:10:55Z\u0026#34;,\u0026#34;token\u0026#34;:\u0026#34;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NjE3NjA2NTUsImlkIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY2MTc1ODg1NX0.UqBvGxFnP2OgRE1t73_OBUlE-_aTaCEn99GNtAGX-2o\u0026#34;}   获取集群详情\n1  curl -XGET -i 10.43.147.93:8080/v1/cluster/\\?all\\=false -H \u0026#39;Authorization:Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NjE3NjA2NTUsImlkIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY2MTc1ODg1NX0.UqBvGxFnP2OgRE1t73_OBUlE-_aTaCEn99GNtAGX-2o\u0026#39;   在容器内访问(通过完全限定域名访问) 查看集群状态\n1 2  curl kubefate.kube-fate:8080 {\u0026#34;msg\u0026#34;:\u0026#34;kubefate run Success\u0026#34;}   获取 token\n1 2 3 4 5  curl -X POST -H \u0026#39;Content-Type: application/json\u0026#39; -i \u0026#39;kubefate.kube-fate:8080/v1/user/login\u0026#39; --data \u0026#39;{ \u0026#34;username\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;admin\u0026#34; }\u0026#39; {\u0026#34;code\u0026#34;:200,\u0026#34;expire\u0026#34;:\u0026#34;2022-08-29T08:58:55Z\u0026#34;,\u0026#34;token\u0026#34;:\u0026#34;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NjE3NjM1MzUsImlkIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY2MTc2MTczNX0.T7tRQvbzVCbZfOzZZx3d00xKNbPs2_8_cUwEFAWJPUo\u0026#34;}   获取集群详情\n1  curl -XGET -i kubefate.kube-fate:8080/v1/cluster/\\?all\\=false -H \u0026#39;Authorization:Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NjE3NjM1MzUsImlkIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY2MTc2MTczNX0.T7tRQvbzVCbZfOzZZx3d00xKNbPs2_8_cUwEFAWJPUo\u0026#39;   获取集群详情\n1  curl -XGET -i kubefate.kube-fate:8080/v1/cluster/\\?all\\=false -H \u0026#39;Authorization:Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NjE3NjM1MzUsImlkIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY2MTc2MTczNX0.T7tRQvbzVCbZfOzZZx3d00xKNbPs2_8_cUwEFAWJPUo\u0026#39;   获取集群详情\n1 2 3  curl -XGET -i kubefate.kube-fate:8080/v1/cluster/c610796c-e2a4-48cc-b7b3-e911cc4bb7dc -H \u0026#39;Authorization:Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NjE3NjYwMDMsImlkIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY2MTc2NDIwM30.S5bcFEL9HURx8R9tB1A1JQFe8ggVy7vnWkzjCaSp-n0\u0026#39; curl -XGET -i kubefate.kube-fate:8080/v1/cluster/566f37e0-ca8b-4627-b48c-239e494ffaec -H \u0026#39;Authorization:Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2NjE3NjYwMDMsImlkIjoiYWRtaW4iLCJvcmlnX2lhdCI6MTY2MTc2NDIwM30.S5bcFEL9HURx8R9tB1A1JQFe8ggVy7vnWkzjCaSp-n0\u0026#39;   ","date":"2022-08-28T16:27:18+08:00","permalink":"https://mkbooks.github.io/blog/p/kubefate-api/","title":"kubefate api"},{"content":"参考：https://blog.csdn.net/wxhcyy/article/details/107718794\n 下载安装文件  1 2  # 链接从官方找 wget https://www.python.org/ftp/python/3.6.8/Python-3.6.8.tar.xz   解压  1 2  export d_path=\u0026#39;\u0026#39; tar xf Python-3.6.8.tar.xz -C $d_path   安装  1 2 3 4  cd $d_path ./configure --prefix=$d_path/python3.6.8 make all make install   测试  1  $d_path/python3.6.8/python -V   ","date":"2022-08-26T16:27:18+08:00","permalink":"https://mkbooks.github.io/blog/p/linux-%E7%B3%BB%E7%BB%9F%E4%BD%BF%E7%94%A8%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85-python/","title":"linux 系统，使用源码安装 Python"},{"content":"File -\u0026gt; Settings -\u0026gt; Project: project_name -\u0026gt; Project Interpreter -\u0026gt; Add\u0026hellip; -\u0026gt; Virtualenv Environment -\u0026gt; (配置) -\u0026gt; OK\nsource project_path/venv/bin/activate\n命令行 Installation\nTo install virtualenv via pip run:\n1  $ pip3 install virtualenv   Usage\nCreation of virtualenv:\n1  $ virtualenv -p python3 \u0026lt;desired-path\u0026gt;   Activate the virtualenv:\n1  $ source \u0026lt;desired-path\u0026gt;/bin/activate   Deactivate the virtualenv:\n1  $ deactivate   ","date":"2022-08-26T15:04:18+08:00","permalink":"https://mkbooks.github.io/blog/p/pycharm-%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83/","title":"pycharm 项目配置虚拟环境"},{"content":"转载：https://juejin.cn/post/6844903602968854542\n设置记住密码（默认15分钟） 可以将你的密码缓存下来，只用输一次密码，以后都可以不用输入了。缺点就是密码都明文保存在 ~/.git-credential 文件中。\n1  git config --global credential.helper cache   如果想自己设置时间，可以使用以下命令：\n1  git config credential.helper \u0026#39;cache --timeout=3600\u0026#39;   这样就设置一个小时之后失效\n长期存储密码： 1  git config --global credential.helper store   增加远程地址的时候带上密码也是可以的。(推荐)\n1  http://yourname:password@git.oschina.net/name/project.git   补充：使用客户端也可以存储密码。\n如果你正在使用ssh而且想体验https带来的高速，那么你可以这样做： 切换到项目目录下 ：\n1  cd project/   移除远程ssh方式的仓库地址\n1  git remote rm origin   复制代码增加https远程仓库地址\n1  git remote add origin http://yourname:password@git.oschina.net/name/project.git   ","date":"2022-08-26T14:36:18+08:00","permalink":"https://mkbooks.github.io/blog/p/git-http%E6%96%B9%E5%BC%8F%E5%85%8D%E5%AF%86%E6%8F%90%E4%BA%A4/","title":"git http方式免密提交"},{"content":"A B C 192.168.10.1 192.168.10.10 192.168.50.10 192.168.50.1\nip netns exec A ip addr add 192.168.30.246/24 dev A-To-br-A-B ip netns exec B ip addr add 192.168.30.1/24 dev B-To-br-A-B ip netns exec B ip addr add 192.168.40.1/24 dev B-To-br-B-C ip netns exec C ip addr add 192.168.40.133/24 dev C-To-br-B-C\nip netns exec B ping 192.168.30.246 -c1 ip netns exec B ping 192.168.40.133 -c1\nip netns exec A ping 192.168.30.246 -c1 ip netns exec A ping 192.168.40.133 -c1\nip netns exec C ping 192.168.30.246 -c1 ip netns exec C ping 192.168.40.133 -c1\nip netns exec A ip route add 192.168.50.0/24 via 192.168.10.10 dev A-To-br-A-B ip netns exec A ip route add 192.168.40.0/24 via 192.168.30.1 dev A-To-br-A-B\nip netns exec C ip route add 192.168.10.0/24 via 192.168.50.10 dev C-To-br-B-C ip netns exec C ip route add 192.168.30.0/24 via 192.168.40.1 dev C-To-br-B-C\nip netns exec A ping 192.168.40.133 -c 1\n","date":"2022-08-25T01:38:18+08:00","permalink":"https://mkbooks.github.io/blog/p/ip-netns/","title":"ip-netns"},{"content":"Namespace Route LAB Target 三个NS中网卡地址都可以相互访问。\n关键在创建恰当的路由，使其路由可达。\nFollow Me Check Env Status 1 2  root@network-lab:~# ip netns list root@network-lab:~# brctl show   Create Bridge 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  brctl addbr br-A-B # add bridge ip link set br-A-B up # enable bridge brctl addbr br-B-C # add bridge ip link set br-B-C up # enable bridge root@network-lab:~# brctl show bridge name bridge id STP enabled interfaces br-A-B 8000.000000000000 no br-B-C 8000.000000000000 no root@network-lab:~# ip link 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 2: ens192: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000 link/ether 00:50:56:ac:a4:9b brd ff:ff:ff:ff:ff:ff 3: br-A-B: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000 link/ether 76:8b:e0:6a:27:f8 brd ff:ff:ff:ff:ff:ff 4: br-B-C: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000 link/ether a6:64:8b:a7:4c:2c brd ff:ff:ff:ff:ff:ff   Create Net Namespace 1 2 3 4 5 6 7 8 9 10  root@network-lab:~# ip netns list ip netns add A ip netns add B ip netns add C root@network-lab:~# ip netns list C B A   NS Status \u0026amp;\u0026amp; Enable lo dev 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49  root@network-lab:~# ip -c -all netns exec ip a netns: C 1: lo: \u0026lt;LOOPBACK\u0026gt; mtu 65536 qdisc noop state DOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 netns: B 1: lo: \u0026lt;LOOPBACK\u0026gt; mtu 65536 qdisc noop state DOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 netns: A 1: lo: \u0026lt;LOOPBACK\u0026gt; mtu 65536 qdisc noop state DOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 root@network-lab:~# ip -c -all netns exec ip link set dev lo up netns: C netns: B netns: A root@network-lab:~# ip -c -all netns exec ip a netns: C 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever netns: B 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever netns: A 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever   Create Veth Pair \u0026amp;\u0026amp; Connect Bridge NetNS via Veth Pair 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118  # NS A =\u0026gt; br-A-B ip link add A-To-br-A-B type veth peer name br-A-B-To-A ip link set dev A-To-br-A-B netns A ip netns exec A ip link set A-To-br-A-B up ip link set dev br-A-B-To-A master br-A-B ip link set br-A-B-To-A up # NS B =\u0026gt; br-A-B ip link add B-To-br-A-B type veth peer name br-A-B-To-B ip link set dev B-To-br-A-B netns B ip netns exec B ip link set B-To-br-A-B up ip link set dev br-A-B-To-B master br-A-B ip link set br-A-B-To-B up # NS B =\u0026gt; br-B-C ip link add B-To-br-B-C type veth peer name br-B-C-To-B ip link set dev B-To-br-B-C netns B ip netns exec B ip link set B-To-br-B-C up ip link set dev br-B-C-To-B master br-B-C ip link set br-B-C-To-B up # NS C =\u0026gt; br-B-C ip link add C-To-br-B-C type veth peer name br-B-C-To-C ip link set dev C-To-br-B-C netns C ip netns exec C ip link set C-To-br-B-C up ip link set dev br-B-C-To-C master br-B-C ip link set br-B-C-To-C up root@network-lab:~# brctl show bridge name bridge id STP enabled interfaces br-A-B 8000.4e3feeec3e7c no br-A-B-To-A br-A-B-To-B br-B-C 8000.06c767a60064 no br-B-C-To-B br-B-C-To-C root@network-lab:~# ip a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: ens192: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc mq state UP group default qlen 1000 link/ether 00:50:56:ac:a4:9b brd ff:ff:ff:ff:ff:ff inet 192.168.31.133/24 brd 192.168.31.255 scope global dynamic ens192 valid_lft 36981sec preferred_lft 36981sec inet6 fe80::250:56ff:feac:a49b/64 scope link valid_lft forever preferred_lft forever 3: br-A-B: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether 4e:3f:ee:ec:3e:7c brd ff:ff:ff:ff:ff:ff inet6 fe80::748b:e0ff:fe6a:27f8/64 scope link valid_lft forever preferred_lft forever 4: br-B-C: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether 06:c7:67:a6:00:64 brd ff:ff:ff:ff:ff:ff inet6 fe80::a464:8bff:fea7:4c2c/64 scope link valid_lft forever preferred_lft forever 19: br-A-B-To-A@if20: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue master br-A-B state UP group default qlen 1000 link/ether 4e:3f:ee:ec:3e:7c brd ff:ff:ff:ff:ff:ff link-netns A inet6 fe80::4c3f:eeff:feec:3e7c/64 scope link valid_lft forever preferred_lft forever 21: br-A-B-To-B@if22: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue master br-A-B state UP group default qlen 1000 link/ether be:e7:ef:32:94:6a brd ff:ff:ff:ff:ff:ff link-netns B inet6 fe80::bce7:efff:fe32:946a/64 scope link valid_lft forever preferred_lft forever 23: br-B-C-To-B@if24: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue master br-B-C state UP group default qlen 1000 link/ether 06:c7:67:a6:00:64 brd ff:ff:ff:ff:ff:ff link-netns B inet6 fe80::4c7:67ff:fea6:64/64 scope link valid_lft forever preferred_lft forever 25: br-B-C-To-C@if26: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue master br-B-C state UP group default qlen 1000 link/ether 32:e7:67:9e:8a:9b brd ff:ff:ff:ff:ff:ff link-netns C inet6 fe80::30e7:67ff:fe9e:8a9b/64 scope link valid_lft forever preferred_lft forever root@network-lab:~# ip -all netns exec ip -c a netns: C 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 26: C-To-br-B-C@if25: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether 6e:5f:b1:c9:3c:09 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet6 fe80::6c5f:b1ff:fec9:3c09/64 scope link valid_lft forever preferred_lft forever netns: B 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 22: B-To-br-A-B@if21: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether 7a:4e:72:0a:0c:99 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet6 fe80::784e:72ff:fe0a:c99/64 scope link valid_lft forever preferred_lft forever 24: B-To-br-B-C@if23: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether 32:ac:2b:9c:82:3f brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet6 fe80::30ac:2bff:fe9c:823f/64 scope link valid_lft forever preferred_lft forever netns: A 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 20: A-To-br-A-B@if19: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether 3e:6a:83:aa:96:23 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet6 fe80::3c6a:83ff:feaa:9623/64 scope link valid_lft forever preferred_lft forever   Eable IP Forword 1  ip netns exec B sysctl -w net.ipv4.conf.all.forwarding=1   Assign IP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78  ip netns exec A ip addr add 192.168.10.1/24 dev A-To-br-A-B ip netns exec B ip addr add 192.168.10.10/24 dev B-To-br-A-B ip netns exec B ip addr add 192.168.50.10/24 dev B-To-br-B-C ip netns exec C ip addr add 192.168.50.1/24 dev C-To-br-B-C root@network-lab:~# ip -all netns exec ip -c a netns: C 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 26: C-To-br-B-C@if25: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether 6e:5f:b1:c9:3c:09 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 192.168.50.1/24 scope global C-To-br-B-C valid_lft forever preferred_lft forever inet6 fe80::6c5f:b1ff:fec9:3c09/64 scope link valid_lft forever preferred_lft forever netns: B 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 22: B-To-br-A-B@if21: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether 7a:4e:72:0a:0c:99 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 192.168.10.10/24 scope global B-To-br-A-B valid_lft forever preferred_lft forever inet6 fe80::784e:72ff:fe0a:c99/64 scope link valid_lft forever preferred_lft forever 24: B-To-br-B-C@if23: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether 32:ac:2b:9c:82:3f brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 192.168.50.10/24 scope global B-To-br-B-C valid_lft forever preferred_lft forever inet6 fe80::30ac:2bff:fe9c:823f/64 scope link valid_lft forever preferred_lft forever netns: A 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 20: A-To-br-A-B@if19: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether 3e:6a:83:aa:96:23 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 192.168.10.1/24 scope global A-To-br-A-B valid_lft forever preferred_lft forever inet6 fe80::3c6a:83ff:feaa:9623/64 scope link valid_lft forever preferred_lft forever # check ip address  root@network-lab:~# ip netns exec B ping 192.168.10.1 -c1 PING 192.168.10.1 (192.168.10.1) 56(84) bytes of data. 64 bytes from 192.168.10.1: icmp_seq=1 ttl=64 time=0.030 ms --- 192.168.10.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.030/0.030/0.030/0.000 ms root@network-lab:~# ip netns exec B ping 192.168.50.1 -c1 PING 192.168.50.1 (192.168.50.1) 56(84) bytes of data. 64 bytes from 192.168.50.1: icmp_seq=1 ttl=64 time=0.118 ms --- 192.168.50.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.118/0.118/0.118/0.000 ms # A access C - BAD root@network-lab:~# ip netns exec A ping 192.168.50.1 -c1 ping: connect: Network is unreachable root@network-lab:~# ip netns exec A ip r 192.168.10.0/24 dev A-To-br-A-B proto kernel scope link src 192.168.10.1   Check Route 1 2 3 4 5 6 7 8 9 10 11  root@network-lab:~# ip --all netns exec ip r netns: C 192.168.50.0/24 dev C-To-br-B-C proto kernel scope link src 192.168.50.1 netns: B 192.168.10.0/24 dev B-To-br-A-B proto kernel scope link src 192.168.10.10 192.168.50.0/24 dev B-To-br-B-C proto kernel scope link src 192.168.50.10 netns: A 192.168.10.0/24 dev A-To-br-A-B proto kernel scope link src 192.168.10.1   Add Route Make A access C 如何新增路由？\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31  # Tell A how to access C ip netns exec A ip route add 192.168.50.0/24 via 192.168.10.10 dev A-To-br-A-B # Tell C how to access A ip netns exec C ip route add 192.168.10.0/24 via 192.168.50.10 dev C-To-br-B-C root@network-lab:~# ip --all netns exec ip r netns: C 192.168.10.0/24 via 192.168.50.10 dev C-To-br-B-C 192.168.50.0/24 dev C-To-br-B-C proto kernel scope link src 192.168.50.1 netns: B 192.168.10.0/24 dev B-To-br-A-B proto kernel scope link src 192.168.10.10 192.168.50.0/24 dev B-To-br-B-C proto kernel scope link src 192.168.50.10 netns: A 192.168.10.0/24 dev A-To-br-A-B proto kernel scope link src 192.168.10.1 192.168.50.0/24 via 192.168.10.10 dev A-To-br-A-B # succeed root@network-lab:~# ip netns exec A ping 192.168.50.1 -c 1 PING 192.168.50.1 (192.168.50.1) 56(84) bytes of data. 64 bytes from 192.168.50.1: icmp_seq=1 ttl=63 time=0.054 ms --- 192.168.50.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.054/0.054/0.054/0.000 ms   ","date":"2022-08-25T01:38:18+08:00","permalink":"https://mkbooks.github.io/blog/p/ip-netns-ling/","title":"ip-netns-ling"},{"content":"准备镜像文件\n导入\n1  sudo k3s ctr images import pause.tar.gz   查看\n1  crictl images|grep pause   ","date":"2022-08-19T17:36:18+08:00","permalink":"https://mkbooks.github.io/blog/p/k3s%E6%89%8B%E5%8A%A8%E5%AF%BC%E5%85%A5%E9%95%9C%E5%83%8F/","title":"k3s手动导入镜像"},{"content":"参考链接\n https://www.ruanyifeng.com/blog/2020/08/rsync.html How To Use Rsync to Sync Local and Remote Directories on a VPS, Justin Ellingwood Mirror Your Web Site With rsync, Falko Timme Examples on how to use Rsync, Egidio Docile How to create incremental backups using rsync on Linux, Egidio Docile  一、简介 rsync 是一个常用的 Linux 应用程序，用于文件同步。\n它可以在本地计算机与远程计算机之间，或者两个本地目录之间同步文件（但不支持两台远程计算机之间的同步）。它也可以当作文件复制工具，替代cp和mv命令。\n它名称里面的r指的是 remote，rsync 其实就是\u0026quot;远程同步\u0026quot;（remote sync）的意思。与其他文件传输工具（如 FTP 或 scp）不同，rsync 的最大特点是会检查发送方和接收方已有的文件，仅传输有变动的部分（默认规则是文件大小或修改时间有变动）。\n二、安装 1 2 3 4 5  # Ubuntu/Debian $ sudo apt-get install rsync # CentOS/Red Hat $ sudo yum install rsync   注意，传输的双方都必须安装 rsync。\n三、基本用法 3.1 -r 参数 本机使用 rsync 命令时，可以作为cp和mv命令的替代方法，将源目录同步到目标目录。\n1  $ rsync -r source destination   上面命令中，-r表示递归，即包含子目录。注意，-r是必须的，否则 rsync 运行不会成功。source目录表示源目录，destination表示目标目录。\n如果有多个文件或目录需要同步，可以写成下面这样。\n1  $ rsync -r source1 source2 destination   上面命令中，source1、source2都会被同步到destination目录。\n3.2 -a 参数 -a参数可以替代-r，除了可以递归同步以外，还可以同步元信息（比如修改时间、权限等）。由于 rsync 默认使用文件大小和修改时间决定文件是否需要更新，所以-a比-r更有用。下面的用法才是常见的写法。\n1  $ rsync -a source destination   目标目录destination如果不存在，rsync 会自动创建。执行上面的命令后，源目录source被完整地复制到了目标目录destination下面，即形成了destination/source的目录结构。\n如果只想同步源目录source里面的内容到目标目录destination，则需要在源目录后面加上斜杠。\n1  $ rsync -a source/ destination   上面命令执行后，source目录里面的内容，就都被复制到了destination目录里面，并不会在destination下面创建一个source子目录。\n3.3 -n 参数 如果不确定 rsync 执行后会产生什么结果，可以先用-n或\u0026ndash;dry-run参数模拟执行的结果。\n1  $ rsync -anv source/ destination   上面命令中，-n参数模拟命令执行的结果，并不真的执行命令。-v参数则是将结果输出到终端，这样就可以看到哪些内容会被同步。\n3.4 \u0026ndash;delete 参数 默认情况下，rsync 只确保源目录的所有内容（明确排除的文件除外）都复制到目标目录。它不会使两个目录保持相同，并且不会删除文件。如果要使得目标目录成为源目录的镜像副本，则必须使用\u0026ndash;delete参数，这将删除只存在于目标目录、不存在于源目录的文件。\n1  $ rsync -av --delete source/ destination   上面命令中，\u0026ndash;delete参数会使得destination成为source的一个镜像。\n四、排除文件 4.1 \u0026ndash;exclude 参数 有时，我们希望同步时排除某些文件或目录，这时可以用\u0026ndash;exclude参数指定排除模式。\n1 2 3  $ rsync -av --exclude=\u0026#39;*.txt\u0026#39; source/ destination # 或者 $ rsync -av --exclude \u0026#39;*.txt\u0026#39; source/ destination   上面命令排除了所有 TXT 文件。\n注意，rsync 会同步以\u0026quot;点\u0026quot;开头的隐藏文件，如果要排除隐藏文件，可以这样写\u0026ndash;exclude=\u0026quot;.*\u0026quot;。\n如果要排除某个目录里面的所有文件，但不希望排除目录本身，可以写成下面这样。\n1  $ rsync -av --exclude \u0026#39;dir1/*\u0026#39; source/ destination   多个排除模式，可以用多个\u0026ndash;exclude参数。\n1  $ rsync -av --exclude \u0026#39;file1.txt\u0026#39; --exclude \u0026#39;dir1/*\u0026#39; source/ destination   多个排除模式也可以利用 Bash 的大扩号的扩展功能，只用一个\u0026ndash;exclude参数。\n1  $ rsync -av --exclude={\u0026#39;file1.txt\u0026#39;,\u0026#39;dir1/*\u0026#39;} source/ destination   如果排除模式很多，可以将它们写入一个文件，每个模式一行，然后用\u0026ndash;exclude-from参数指定这个文件。\n1  $ rsync -av --exclude-from=\u0026#39;exclude-file.txt\u0026#39; source/ destination   4.2 \u0026ndash;include 参数 \u0026ndash;include参数用来指定必须同步的文件模式，往往与\u0026ndash;exclude结合使用。\n1  $ rsync -av --include=\u0026#34;*.txt\u0026#34; --exclude=\u0026#39;*\u0026#39; source/ destination   上面命令指定同步时，排除所有文件，但是会包括 TXT 文件。\n五、远程同步 5.1 SSH 协议 rsync 除了支持本地两个目录之间的同步，也支持远程同步。它可以将本地内容，同步到远程服务器。\n1  $ rsync -av source/ username@remote_host:destination   也可以将远程内容同步到本地。\n1  $ rsync -av username@remote_host:source/ destination   rsync 默认使用 SSH 进行远程登录和数据传输。\n由于早期 rsync 不使用 SSH 协议，需要用-e参数指定协议，后来才改的。所以，下面-e ssh可以省略。\n1  $ rsync -av -e ssh source/ user@remote_host:/destination   但是，如果 ssh 命令有附加的参数，则必须使用-e参数指定所要执行的 SSH 命令。\n1  $ rsync -av -e \u0026#39;ssh -p 2234\u0026#39; source/ user@remote_host:/destination   上面命令中，-e参数指定 SSH 使用2234端口。\n5.2 rsync 协议 除了使用 SSH，如果另一台服务器安装并运行了 rsync 守护程序，则也可以用rsync://协议（默认端口873）进行传输。具体写法是服务器与目标目录之间使用双冒号分隔::。\n1  $ rsync -av source/ 192.168.122.32::module/destination   注意，上面地址中的module并不是实际路径名，而是 rsync 守护程序指定的一个资源名，由管理员分配。\n如果想知道 rsync 守护程序分配的所有 module 列表，可以执行下面命令。\n1  $ rsync rsync://192.168.122.32   rsync 协议除了使用双冒号，也可以直接用rsync://协议指定地址。\n1  $ rsync -av source/ rsync://192.168.122.32/module/destination   六、增量备份 rsync 的最大特点就是它可以完成增量备份，也就是默认只复制有变动的文件。\n除了源目录与目标目录直接比较，rsync 还支持使用基准目录，即将源目录与基准目录之间变动的部分，同步到目标目录。\n具体做法是，第一次同步是全量备份，所有文件在基准目录里面同步一份。以后每一次同步都是增量备份，只同步源目录与基准目录之间有变动的部分，将这部分保存在一个新的目标目录。这个新的目标目录之中，也是包含所有文件，但实际上，只有那些变动过的文件是存在于该目录，其他没有变动的文件都是指向基准目录文件的硬链接。\n\u0026ndash;link-dest参数用来指定同步时的基准目录。\n1  $ rsync -a --delete --link-dest /compare/path /source/path /target/path   上面命令中，\u0026ndash;link-dest参数指定基准目录/compare/path，然后源目录/source/path跟基准目录进行比较，找出变动的文件，将它们拷贝到目标目录/target/path。那些没变动的文件则会生成硬链接。这个命令的第一次备份时是全量备份，后面就都是增量备份了。\n下面是一个脚本示例，备份用户的主目录。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24  #!/bin/bash  # A script to perform incremental backups using rsync set -o errexit set -o nounset set -o pipefail readonly SOURCE_DIR=\u0026#34;${HOME}\u0026#34; readonly BACKUP_DIR=\u0026#34;/mnt/data/backups\u0026#34; readonly DATETIME=\u0026#34;$(date \u0026#39;+%Y-%m-%d_%H:%M:%S\u0026#39;)\u0026#34; readonly BACKUP_PATH=\u0026#34;${BACKUP_DIR}/${DATETIME}\u0026#34; readonly LATEST_LINK=\u0026#34;${BACKUP_DIR}/latest\u0026#34; mkdir -p \u0026#34;${BACKUP_DIR}\u0026#34; rsync -av --delete \\  \u0026#34;${SOURCE_DIR}/\u0026#34; \\  --link-dest \u0026#34;${LATEST_LINK}\u0026#34; \\  --exclude=\u0026#34;.cache\u0026#34; \\  \u0026#34;${BACKUP_PATH}\u0026#34; rm -rf \u0026#34;${LATEST_LINK}\u0026#34; ln -s \u0026#34;${BACKUP_PATH}\u0026#34; \u0026#34;${LATEST_LINK}\u0026#34;   上面脚本中，每一次同步都会生成一个新目录${BACKUP_DIR}/${DATETIME}，并将软链接${BACKUP_DIR}/latest指向这个目录。下一次备份时，就将${BACKUP_DIR}/latest作为基准目录，生成新的备份目录。最后，再将软链接${BACKUP_DIR}/latest指向新的备份目录。\n七、配置项 -a、\u0026ndash;archive参数表示存档模式，保存所有的元数据，比如修改时间（modification time）、权限、所有者等，并且软链接也会同步过去。\n\u0026ndash;append参数指定文件接着上次中断的地方，继续传输。\n\u0026ndash;append-verify参数跟\u0026ndash;append参数类似，但会对传输完成后的文件进行一次校验。如果校验失败，将重新发送整个文件。\n-b、\u0026ndash;backup参数指定在删除或更新目标目录已经存在的文件时，将该文件更名后进行备份，默认行为是删除。更名规则是添加由\u0026ndash;suffix参数指定的文件后缀名，默认是~。\n\u0026ndash;backup-dir参数指定文件备份时存放的目录，比如\u0026ndash;backup-dir=/path/to/backups。\n\u0026ndash;bwlimit参数指定带宽限制，默认单位是 KB/s，比如\u0026ndash;bwlimit=100。\n-c、\u0026ndash;checksum参数改变rsync的校验方式。默认情况下，rsync 只检查文件的大小和最后修改日期是否发生变化，如果发生变化，就重新传输；使用这个参数以后，则通过判断文件内容的校验和，决定是否重新传输。\n\u0026ndash;delete参数删除只存在于目标目录、不存在于源目标的文件，即保证目标目录是源目标的镜像。\n-e参数指定使用 SSH 协议传输数据。\n\u0026ndash;exclude参数指定排除不进行同步的文件，比如\u0026ndash;exclude=\u0026quot;*.iso\u0026quot;。\n\u0026ndash;exclude-from参数指定一个本地文件，里面是需要排除的文件模式，每个模式一行。\n\u0026ndash;existing、\u0026ndash;ignore-non-existing参数表示不同步目标目录中不存在的文件和目录。\n-h参数表示以人类可读的格式输出。\n-h、\u0026ndash;help参数返回帮助信息。\n-i参数表示输出源目录与目标目录之间文件差异的详细情况。\n\u0026ndash;ignore-existing参数表示只要该文件在目标目录中已经存在，就跳过去，不再同步这些文件。\n\u0026ndash;include参数指定同步时要包括的文件，一般与\u0026ndash;exclude结合使用。\n\u0026ndash;link-dest参数指定增量备份的基准目录。\n-m参数指定不同步空目录。\n\u0026ndash;max-size参数设置传输的最大文件的大小限制，比如不超过200KB（\u0026ndash;max-size=\u0026lsquo;200k\u0026rsquo;）。\n\u0026ndash;min-size参数设置传输的最小文件的大小限制，比如不小于10KB（\u0026ndash;min-size=10k）。\n-n参数或\u0026ndash;dry-run参数模拟将要执行的操作，而并不真的执行。配合-v参数使用，可以看到哪些内容会被同步过去。\n-P参数是\u0026ndash;progress和\u0026ndash;partial这两个参数的结合。\n\u0026ndash;partial参数允许恢复中断的传输。不使用该参数时，rsync会删除传输到一半被打断的文件；使用该参数后，传输到一半的文件也会同步到目标目录，下次同步时再恢复中断的传输。一般需要与\u0026ndash;append或\u0026ndash;append-verify配合使用。\n\u0026ndash;partial-dir参数指定将传输到一半的文件保存到一个临时目录，比如\u0026ndash;partial-dir=.rsync-partial。一般需要与\u0026ndash;append或\u0026ndash;append-verify配合使用。\n\u0026ndash;progress参数表示显示进展。\n-r参数表示递归，即包含子目录。\n\u0026ndash;remove-source-files参数表示传输成功后，删除发送方的文件。\n\u0026ndash;size-only参数表示只同步大小有变化的文件，不考虑文件修改时间的差异。\n\u0026ndash;suffix参数指定文件名备份时，对文件名添加的后缀，默认是~。\n-u、\u0026ndash;update参数表示同步时跳过目标目录中修改时间更新的文件，即不同步这些有更新的时间戳的文件。\n-v参数表示输出细节。-vv表示输出更详细的信息，-vvv表示输出最详细的信息。\n\u0026ndash;version参数返回 rsync 的版本。\n-z参数指定同步时压缩数据。\n","date":"2022-08-19T17:03:18+08:00","permalink":"https://mkbooks.github.io/blog/p/%E8%BF%9C%E7%A8%8B%E4%BC%A0%E8%BE%93%E6%96%87%E4%BB%B6-rsync/","title":"远程传输文件-rsync"},{"content":"转载: https://docs.rancher.cn/docs/rke/upgrades/configuring-strategy/_index/#%E9%A9%B1%E9%80%90%E8%8A%82%E7%82%B9\n驱逐节点 默认情况下，升级节点前需要使用kubectl cordon命令将节点标记为“不可用”，这个标记的目的是防止在节点在升级的过程中因为被分配到新的 pods 或者流量而中断。完成升级后，您需要使用kubectl uncordon命令将节点重新标记为“可用”，此时可以将 pods 和流量分配到该节点上。该操作不会对节点上已有的 pods 造成影响。\n1 2  kubectl cordon node_name kubectl uncordon node_name   除了将节点标记为“不可用”外，您也可以使用kubectl drain命令，在升级节点前将节点内的所有 pod 驱逐到其他节点上，并且将其标记为“不可用”，确保这个节点内在升级完成之前不会有正在运行的 pods。kubectl drain命令会导致节点内所有的 pods 被驱逐。\n1  kubectl drain --ignore-daemonsets node_name   请参考Kubernetes 官方文档，了解驱逐节点的注意事项。\n注意：drain的默认值是false，如果将它的值改为true，会导致 worker 节点在升级之前被驱逐，无法升级 worker 节点。\n1 2 3 4 5 6 7 8 9 10  upgrade_strategy: max_unavailable_worker: 10% max_unavailable_controlplane: 1 drain: false node_drain_input: force: false ignore_daemonsets: true delete_local_data: false grace_period: -1 // grace period specified for each pod spec will be used timeout: 60   ","date":"2022-08-18T10:03:18+08:00","permalink":"https://mkbooks.github.io/blog/p/k8s-%E9%A9%B1%E9%80%90%E8%8A%82%E7%82%B9/","title":"k8s 驱逐节点"},{"content":"转载: https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/access-cluster-api/\n访问集群 API ","date":"2022-08-18T10:03:18+08:00","permalink":"https://mkbooks.github.io/blog/p/%E4%BD%BF%E7%94%A8-kubernetes-api-%E8%AE%BF%E9%97%AE%E9%9B%86%E7%BE%A4/","title":"使用 Kubernetes API 访问集群"},{"content":"1  find . -type f -name \u0026#34;*.yaml\u0026#34; | xargs sed -i \u0026#34;s#host_path#$host_path#g\u0026#34;   ","date":"2022-08-17T17:38:18+08:00","permalink":"https://mkbooks.github.io/blog/p/%E6%9B%BF%E6%8D%A2%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%AD%E6%89%80%E6%9C%89%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E7%9A%84%E7%89%B9%E5%AE%9A%E5%AD%97%E7%AC%A6%E4%B8%B2/","title":"替换文件夹中所有文件内容的特定字符串"},{"content":"转载: https://www.cnblogs.com/fengdejiyixx/p/15186831.html\n注意：以下操作方法十分危险，三思而行！！！\n如果名称空间、pod、pv、pvc全部处于“Terminating”状态时，此时的该名称空间下的所有控制器都已经被删除了，之所以出现pod、pvc、pv、ns无法删除，那是因为kubelet 阻塞，有其他的资源在使用该namespace，比如CRD等，尝试重启kubelet，再删除该namespace 也不好使。\n正确的删除方法：删除pod\u0026ndash;\u0026gt; 删除pvc \u0026mdash;\u0026gt; 删除pv \u0026ndash;\u0026gt; 删除名称空间\n1. 强制删除pod 1  kubectl delete pod \u0026lt;your-pod-name\u0026gt; -n \u0026lt;name-space\u0026gt; --force --grace-period=0   解决方法：加参数 \u0026ndash;force \u0026ndash;grace-period=0，grace-period表示过渡存活期，默认30s，在删除POD之前允许POD慢慢终止其上的容器进程，从而优雅退出，0表示立即终止POD\n2. 强制删除pv、pvc 1 2  kubectl patch pv xxx -p \u0026#39;{\u0026#34;metadata\u0026#34;:{\u0026#34;finalizers\u0026#34;:null}}\u0026#39; kubectl patch pvc xxx -p \u0026#39;{\u0026#34;metadata\u0026#34;:{\u0026#34;finalizers\u0026#34;:null}}\u0026#39;   直接删除 k8s etcd 数据库中的记录！\n3. 强制删除ns 在尝试以下命令强制删除也不好使：\n1  kubectl delete ns \u0026lt;terminating-namespace\u0026gt; --force --grace-period=0   解决方法：\n1）运行以下命令以查看处于“Terminating”状态的namespace：\n1  kubectl get namespaces   2）选择一个Terminating namespace，并查看namespace 中的 finalizer。运行以下命令：\n1  $ kubectl get namespace \u0026lt;terminating-namespace\u0026gt; -o yaml   输出信息如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13  apiVersion: v1 kind: Namespace metadata: creationTimestamp: \u0026#34;2019-11-20T15:18:06Z\u0026#34; deletionTimestamp: \u0026#34;2020-01-16T02:50:02Z\u0026#34; name: \u0026lt;terminating-namespace\u0026gt; resourceVersion: \u0026#34;3249493\u0026#34; selfLink: /api/v1/namespaces/knative-eventing uid: f300ea38-c8c2-4653-b432-b66103e412db spec: finalizers: - kubernetes status:   3）导出json格式到文件\n1  kubectl get namespace \u0026lt;terminating-namespace\u0026gt; -o json \u0026gt;tmp.json   4）编辑tmp.josn，删除finalizers 字段的值\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  { \u0026#34;apiVersion\u0026#34;: \u0026#34;v1\u0026#34;, \u0026#34;kind\u0026#34;: \u0026#34;Namespace\u0026#34;, \u0026#34;metadata\u0026#34;: { \u0026#34;creationTimestamp\u0026#34;: \u0026#34;2019-11-20T15:18:06Z\u0026#34;, \u0026#34;deletionTimestamp\u0026#34;: \u0026#34;2020-01-16T02:50:02Z\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;\u0026lt;terminating-namespace\u0026gt;\u0026#34;, \u0026#34;resourceVersion\u0026#34;: \u0026#34;3249493\u0026#34;, \u0026#34;selfLink\u0026#34;: \u0026#34;/api/v1/namespaces/knative-eventing\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;f300ea38-c8c2-4653-b432-b66103e412db\u0026#34; }, \u0026#34;spec\u0026#34;: { #从此行开始删除 \u0026#34;finalizers\u0026#34;: [] }, # 删到此行 \u0026#34;status\u0026#34;: { \u0026#34;phase\u0026#34;: \u0026#34;Terminating\u0026#34; } }   5）开启proxy\n1  kubectl proxy   执行该命令后，当前终端会被卡住 6）打开新的一个窗口，执行以下命令\n1  curl -k -H \u0026#34;Content-Type: application/json\u0026#34; -X PUT --data-binary @tmp.json http://127.0.0.1:8001/api/v1/namespaces/\u0026lt;terminating-namespace\u0026gt;/finalize   输出信息如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  { \u0026#34;kind\u0026#34;: \u0026#34;Namespace\u0026#34;, \u0026#34;apiVersion\u0026#34;: \u0026#34;v1\u0026#34;, \u0026#34;metadata\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;istio-system\u0026#34;, \u0026#34;selfLink\u0026#34;: \u0026#34;/api/v1/namespaces/istio-system/finalize\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;2e274537-727f-4a8f-ae8c-397473ed619a\u0026#34;, \u0026#34;resourceVersion\u0026#34;: \u0026#34;3249492\u0026#34;, \u0026#34;creationTimestamp\u0026#34;: \u0026#34;2019-11-20T15:18:06Z\u0026#34;, \u0026#34;deletionTimestamp\u0026#34;: \u0026#34;2020-01-16T02:50:02Z\u0026#34; }, \u0026#34;spec\u0026#34;: { }, \u0026#34;status\u0026#34;: { \u0026#34;phase\u0026#34;: \u0026#34;Terminating\u0026#34; } }   7）确认处于Terminating 状态的namespace已经被删除\n1  kubectl get namespaces   如果还有处于Terminating 状态的namespace，重复以上操作，删除即可！\n","date":"2022-08-17T11:03:18+08:00","permalink":"https://mkbooks.github.io/blog/p/k8s%E5%BC%BA%E5%88%B6%E5%88%A0%E9%99%A4podpvpvc%E5%92%8Cnsnamespace%E6%96%B9%E6%B3%95/","title":"k8s强制删除pod\u0026pv\u0026pvc和ns\u0026namespace方法"},{"content":"转载: https://www.cnblogs.com/zisefeizhu/p/13786053.html\n在k8s集群中进行测试删除namespace是经常的事件，而为了方便操作，一般都是直接对整个名称空间进行删除操作。 相信道友们在进行此步操作的时候，会遇到要删除的namespace一直处于Terminating。下面我将给出一个完美的解决方案，\n测试demo\n1 2 3 4 5 6 7 8 9 10 11 12 13  创建demo namespace # kubectl create ns test namespace/test created 删除demo namespace # kubectl delete ns test namespace \u0026#34;test\u0026#34; deleted 一直处于deleted不见exit 查看状态 可见test namespace 处于Terminating # kubectl get ns -w NAME STATUS AGE test Terminating 18s   下面给出一种完美的解决方案：调用接口删除\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73  开启一个代理终端 # kubectl proxy Starting to serve on 127.0.0.1:8001 再开启一个操作终端 将test namespace的配置文件输出保存 # kubectl get ns test -o json \u0026gt; test.json 删除spec及status部分的内容还有metadata字段后的\u0026#34;,\u0026#34;号，切记！ 剩下内容大致如下 { \u0026#34;apiVersion\u0026#34;: \u0026#34;v1\u0026#34;, \u0026#34;kind\u0026#34;: \u0026#34;Namespace\u0026#34;, \u0026#34;metadata\u0026#34;: { \u0026#34;annotations\u0026#34;: { \u0026#34;cattle.io/status\u0026#34;: \u0026#34;{\\\u0026#34;Conditions\\\u0026#34;:[{\\\u0026#34;Type\\\u0026#34;:\\\u0026#34;ResourceQuotaInit\\\u0026#34;,\\\u0026#34;Status\\\u0026#34;:\\\u0026#34;True\\\u0026#34;,\\\u0026#34;Message\\\u0026#34;:\\\u0026#34;\\\u0026#34;,\\\u0026#34;LastUpdateTime\\\u0026#34;:\\\u0026#34;2020-10-09T07:12:17Z\\\u0026#34;},{\\\u0026#34;Type\\\u0026#34;:\\\u0026#34;InitialRolesPopulated\\\u0026#34;,\\\u0026#34;Status\\\u0026#34;:\\\u0026#34;True\\\u0026#34;,\\\u0026#34;Message\\\u0026#34;:\\\u0026#34;\\\u0026#34;,\\\u0026#34;LastUpdateTime\\\u0026#34;:\\\u0026#34;2020-10-09T07:12:18Z\\\u0026#34;}]}\u0026#34;, \u0026#34;lifecycle.cattle.io/create.namespace-auth\u0026#34;: \u0026#34;true\u0026#34; }, \u0026#34;creationTimestamp\u0026#34;: \u0026#34;2020-10-09T07:12:16Z\u0026#34;, \u0026#34;deletionTimestamp\u0026#34;: \u0026#34;2020-10-09T07:12:22Z\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;test\u0026#34;, \u0026#34;resourceVersion\u0026#34;: \u0026#34;471648079\u0026#34;, \u0026#34;selfLink\u0026#34;: \u0026#34;/api/v1/namespaces/test\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;862d311e-d87a-48c2-bc48-332a4db9dbdb\u0026#34; } } 调接口删除 # curl -k -H \u0026#34;Content-Type: application/json\u0026#34; -X PUT --data-binary @test.json http://127.0.0.1:8001/api/v1/namespaces/test/finalize { \u0026#34;kind\u0026#34;: \u0026#34;Namespace\u0026#34;, \u0026#34;apiVersion\u0026#34;: \u0026#34;v1\u0026#34;, \u0026#34;metadata\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;test\u0026#34;, \u0026#34;selfLink\u0026#34;: \u0026#34;/api/v1/namespaces/test/finalize\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;862d311e-d87a-48c2-bc48-332a4db9dbdb\u0026#34;, \u0026#34;resourceVersion\u0026#34;: \u0026#34;471648079\u0026#34;, \u0026#34;creationTimestamp\u0026#34;: \u0026#34;2020-10-09T07:12:16Z\u0026#34;, \u0026#34;deletionTimestamp\u0026#34;: \u0026#34;2020-10-09T07:12:22Z\u0026#34;, \u0026#34;annotations\u0026#34;: { \u0026#34;cattle.io/status\u0026#34;: \u0026#34;{\\\u0026#34;Conditions\\\u0026#34;:[{\\\u0026#34;Type\\\u0026#34;:\\\u0026#34;ResourceQuotaInit\\\u0026#34;,\\\u0026#34;Status\\\u0026#34;:\\\u0026#34;True\\\u0026#34;,\\\u0026#34;Message\\\u0026#34;:\\\u0026#34;\\\u0026#34;,\\\u0026#34;LastUpdateTime\\\u0026#34;:\\\u0026#34;2020-10-09T07:12:17Z\\\u0026#34;},{\\\u0026#34;Type\\\u0026#34;:\\\u0026#34;InitialRolesPopulated\\\u0026#34;,\\\u0026#34;Status\\\u0026#34;:\\\u0026#34;True\\\u0026#34;,\\\u0026#34;Message\\\u0026#34;:\\\u0026#34;\\\u0026#34;,\\\u0026#34;LastUpdateTime\\\u0026#34;:\\\u0026#34;2020-10-09T07:12:18Z\\\u0026#34;}]}\u0026#34;, \u0026#34;lifecycle.cattle.io/create.namespace-auth\u0026#34;: \u0026#34;true\u0026#34; } }, \u0026#34;spec\u0026#34;: { }, \u0026#34;status\u0026#34;: { \u0026#34;phase\u0026#34;: \u0026#34;Terminating\u0026#34;, \u0026#34;conditions\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;NamespaceDeletionDiscoveryFailure\u0026#34;, \u0026#34;status\u0026#34;: \u0026#34;True\u0026#34;, \u0026#34;lastTransitionTime\u0026#34;: \u0026#34;2020-10-09T07:12:27Z\u0026#34;, \u0026#34;reason\u0026#34;: \u0026#34;DiscoveryFailed\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;Discovery failed for some groups, 1 failing: unable to retrieve the complete list of server APIs: metrics.k8s.io/v1beta1: the server is currently unable to handle the request\u0026#34; }, { \u0026#34;type\u0026#34;: \u0026#34;NamespaceDeletionGroupVersionParsingFailure\u0026#34;, \u0026#34;status\u0026#34;: \u0026#34;False\u0026#34;, \u0026#34;lastTransitionTime\u0026#34;: \u0026#34;2020-10-09T07:12:28Z\u0026#34;, \u0026#34;reason\u0026#34;: \u0026#34;ParsedGroupVersions\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;All legacy kube types successfully parsed\u0026#34; }, { \u0026#34;type\u0026#34;: \u0026#34;NamespaceDeletionContentFailure\u0026#34;, \u0026#34;status\u0026#34;: \u0026#34;False\u0026#34;, \u0026#34;lastTransitionTime\u0026#34;: \u0026#34;2020-10-09T07:12:28Z\u0026#34;, \u0026#34;reason\u0026#34;: \u0026#34;ContentDeleted\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;All content successfully deleted\u0026#34; } ] } }   查看结果\n1 2 3 4 5 6 7 8  1、delete 状态终止 kubectl delete ns test namespace \u0026#34;test\u0026#34; deleted 2、Terminating状态终止 kubectl get ns -w test Terminating 18s test Terminating 17m   名称空间被删除掉\n","date":"2022-08-17T11:03:18+08:00","permalink":"https://mkbooks.github.io/blog/p/k8s%E7%9A%84namespace%E4%B8%80%E7%9B%B4terminating%E7%9A%84%E5%AE%8C%E7%BE%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/","title":"k8s的namespace一直Terminating的完美解决方案"},{"content":"参考: https://blog.csdn.net/laobai1015/article/details/98628860\n需求  把 /etc/rancher/k3s/k3s.yaml 文件的内容，每行前面加 4 个空格，追加到 ai-service-platform/yamls/config/kube-config.yaml 文件中； 把 ai-service-platform/yamls/config/kube-config.yaml 文件中的 127.0.0.1 替换成 $master_host_ip。  脚本：\n1 2 3 4  function fix_kube_config(){ sudo awk \u0026#39;{print \u0026#34; \u0026#34; $0 \u0026gt;\u0026gt; \u0026#34;ai-service-platform/yamls/config/kube-config.yaml\u0026#34;}\u0026#39; /etc/rancher/k3s/k3s.yaml sed -i \u0026#34;s/127.0.0.1/$master_host_ip/g\u0026#34; ai-service-platform/yamls/config/kube-config.yaml }   扩展 在前面、后面、指定列添加相同字符\n 给一个文件中的每一行开头插入字符的方法：awk \u0026lsquo;{print \u0026ldquo;需要添加的字符\u0026rdquo; $0}\u0026rsquo; fileName 给一个文件中的每一行结尾插入字符的方法：awk \u0026lsquo;{print $0 \u0026ldquo;需要添加的字符\u0026rdquo;}\u0026rsquo; fileName 给一个文件中的每一行的指定列插入字符的方法：awk \u0026lsquo;$0=$0 X\u0026quot;\u0026rsquo; fileName  删除某一个列\n 删除文件中的第一列：awk \u0026lsquo;{$1=\u0026quot;\u0026quot;;print $0}\u0026rsquo; fileName 或者另一种方法 sed -e \u0026rsquo;s/[^ ]* //' text 删除指定列：awk \u0026lsquo;{$Num=\u0026quot;\u0026quot;;print $0}\u0026rsquo; fileName  把Num换成要删除的列数即可\n练习 给文件中的每一行开头添加drop tables\n1  awk \u0026#39;{print \u0026#34;drop table \u0026#34;$0}\u0026#39; aa.txt \u0026gt; bb.txt   给文件中的每一行结尾添加分号\n1  awk \u0026#39;{print $0\u0026#34;;\u0026#34;}\u0026#39; bb.txt \u0026gt; cc.txt   ","date":"2022-08-17T10:03:18+08:00","permalink":"https://mkbooks.github.io/blog/p/linux-%E4%B8%8B%E4%BD%BF%E7%94%A8-awk-%E6%93%8D%E4%BD%9C%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9/","title":"Linux 下使用 awk 操作文件内容"},{"content":"参考: https://developer.aliyun.com/article/53579\nmycode\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29  import os import math if __name__ == \u0026#39;__main__\u0026#39;: vfs = os.statvfs(\u0026#34;/home/manager\u0026#34;) g = 1024 * 1024 * 1024 # 总容量 k_blocks = vfs.f_bsize * vfs.f_blocks / g # Used,使用量，总容量减去空闲容量 used = vfs.f_bsize * (vfs.f_blocks - vfs.f_bfree) / g # Available，有效容量 available = vfs.f_bsize * vfs.f_bavail / g # use%,使用量，%,round(浮点数，精确到小数点后的位数） use = round(used / (used + available) * 100, 2) print({ \u0026#34;容量\u0026#34;: k_blocks, \u0026#34;已用\u0026#34;: used, \u0026#34;可用\u0026#34;: available, \u0026#34;已用%\u0026#34;: use, }) print({ \u0026#34;容量\u0026#34;: f\u0026#39;{math.ceil(k_blocks)}G\u0026#39;, \u0026#34;已用\u0026#34;: f\u0026#39;{math.ceil(used)}G\u0026#39;, \u0026#34;可用\u0026#34;: f\u0026#39;{math.ceil(available)}G\u0026#39;, \u0026#34;已用%\u0026#34;: f\u0026#39;{math.ceil(use)}%\u0026#39;, })   运行测试\n1 2 3  $ df -h /home/manager 文件系统 容量 已用 可用 已用% 挂载点 /dev/nvme0n1p2 457G 325G 110G 75% /   1 2 3  python test.py {\u0026#39;容量\u0026#39;: 456.8854446411133, \u0026#39;已用\u0026#39;: 324.40053939819336, \u0026#39;可用\u0026#39;: 109.20629501342773, \u0026#39;已用%\u0026#39;: 74.81} {\u0026#39;容量\u0026#39;: \u0026#39;457G\u0026#39;, \u0026#39;已用\u0026#39;: \u0026#39;325G\u0026#39;, \u0026#39;可用\u0026#39;: \u0026#39;110G\u0026#39;, \u0026#39;已用%\u0026#39;: \u0026#39;75%\u0026#39;}   ","date":"2022-08-15T17:03:18+08:00","permalink":"https://mkbooks.github.io/blog/p/python-%E5%AE%9E%E7%8E%B0-linux-%E7%9A%84-df-h-%E5%91%BD%E4%BB%A4/","title":"Python 实现 Linux 的 'df -h' 命令"},{"content":"编辑文件：\n1  sudo gedit /etc/systemd/logind.conf   1 2 3 4  #HandlePowerKey按下电源键后的行为，默认power off #HandleSleepKey 按下挂起键后的行为，默认suspend #HandleHibernateKey按下休眠键后的行为，默认hibernate #HandleLidSwitch合上笔记本盖后的行为，一般为默认suspend（改为ignore；即合盖不休眠）在原文件中，还要去掉前面的#   1 2 3 4  然后将其中的： #HandleLidSwitch=suspend 复制一行到下面，去掉“#”号： HandleLidSwitch=ignore   最后重启服务\n1  service systemd-logind restart   ","date":"2022-08-13T15:33:18+08:00","permalink":"https://mkbooks.github.io/blog/p/ubuntu-%E8%AE%BE%E7%BD%AE%E5%90%88%E4%B8%8A%E7%AC%94%E8%AE%B0%E6%9C%AC%E7%9B%96%E5%AD%90%E4%B8%8D%E4%BC%91%E7%9C%A0%E7%9A%84%E6%96%B9%E6%B3%95/","title":"Ubuntu 设置合上笔记本盖子不休眠的方法"},{"content":"pip list\npip freeze \u0026gt; test.txt\npip uninstall -r test.txt -y\npip install -r requirements.txt\n","date":"2022-08-08T18:13:18+08:00","permalink":"https://mkbooks.github.io/blog/p/python-%E6%B8%85%E7%90%86%E5%8C%85/","title":"python 清理包"},{"content":"准备检查：内存条，硬盘，主板电池\n","date":"2022-08-08T18:13:18+08:00","permalink":"https://mkbooks.github.io/blog/p/%E7%94%B5%E8%84%91%E5%BC%80%E4%B8%8D%E4%BA%86%E6%9C%BA/","title":"电脑开不了机"},{"content":"","date":"2022-08-07T15:47:18+08:00","image":"http://changxiangyu.cn/images/small-15x15相册/1.jpg","permalink":"https://mkbooks.github.io/blog/p/%E5%A9%9A%E7%BA%B1%E7%85%A7-15x15-%E7%9B%B8%E5%86%8C/","title":"婚纱照 15x15 相册"},{"content":"","date":"2022-08-07T15:33:18+08:00","image":"https://changxiangyu.cn/images/small/30.jpg","permalink":"https://mkbooks.github.io/blog/p/%E5%A9%9A%E7%BA%B1%E7%85%A7-12x12-%E7%9B%B8%E5%86%8C/","title":"婚纱照 12x12 相册"},{"content":"初见三摆台 至美三件套艺术组合 10X8英寸时尚绢丝相架一幅 10X8英寸精美思慕相架一幅 30X20英寸时尚绢丝挂画一幅 48X24至美相框一幅 6X8英寸时尚蓝色恋人相架一幅 8X12英寸精美米娜相架一幅 8X8英寸安琪相架一幅 ","date":"2022-08-07T15:33:18+08:00","image":"https://changxiangyu.cn/images/small/115.jpg","permalink":"https://mkbooks.github.io/blog/p/%E5%A9%9A%E7%BA%B1%E7%85%A7%E6%91%86%E4%BB%B6/","title":"婚纱照摆件"},{"content":"1 2 3 4 5 6 7 8 9 10 11 12  # 准备工作：安装 imagemagick sudo apt-get install imagemagick #大图所在的目录 cd /path/to/big/images #创建小图对应的目录结构 find . -type d -print -exec mkdir \u0026#39;../small/{}\u0026#39; -p \\; #批量转换! 等比例缩小到320x320之内 320x: 只设置宽度 find . -type f -name \u0026#39;*.jpg\u0026#39; -print -exec \\ convert \u0026#39;{}\u0026#39; -resize 320x320 \u0026#39;../small/{}\u0026#39; \\;   ","date":"2022-08-07T02:33:18+08:00","permalink":"https://mkbooks.github.io/blog/p/ubuntu%E4%B8%8B%E5%9C%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%89%B9%E9%87%8F%E7%94%9F%E6%88%90%E7%BC%A9%E7%95%A5%E5%9B%BE/","title":"Ubuntu下在命令行批量生成缩略图"},{"content":"Step 1: Install Hugo 1 2 3  # Ubuntu 系统 sudo apt update sudo apt install hugo   验证您的新安装:\n1  hugo version   1 2  Output hugo v0.101.0-9f74196ce611cdf6d355bfb99fd8eba5c68ef7f8+extended linux/amd64 BuildDate=2022-06-28T10:02:18Z VendorInfo=snap   Step 2: Create a New Site 1  hugo new site quickstart   这个命令会创建一个名为 quickstart 的目录，这就是博客的根目录。目录结构如下：\n1 2 3 4 5 6 7 8  ├── archetypes │ └── default.md ├── config.toml # 博客站点的配置文件 ├── content # 博客文章所在目录 ├── data ├── layouts # 网站布局 ├── static # 一些静态内容 └── themes # 博客主题   Step 3: Add a Theme 首先，从 GitHub 下载主题并将其添加到站点的主题目录中：\n1 2 3  cd quickstart git init git submodule add https://github.com/theNewDynamic/gohugo-theme-ananke.git themes/ananke   然后，将主题添加到站点配置中：\n1  echo theme = \\\u0026#34;ananke\\\u0026#34; \u0026gt;\u0026gt; config.toml   Step 4: Add Some Content 1  hugo new posts/my-first-post.md   如果需要，可以编辑新创建的内容文件，它将以如下内容开头：\n1 2 3 4 5  --- title: \u0026#34;My First Post\u0026#34; date: 2019-03-26T08:47:11+01:00 draft: true ---   Step 5: Start the Hugo server 现在，启动启用草稿的 Hugo 服务器：\n1 2 3 4 5 6  hugo server -D # 可以在其它机器访问 hugo server --bind=\u0026#34;0.0.0.0\u0026#34; -D # 可以在其它机器访问, -p 修改端口 hugo server --bind=\u0026#34;0.0.0.0\u0026#34; -p 80 -D   在 http://114.132.247.115:1313/ 导航到您的新站点。\n第 6 步：自定义主题 在文本编辑器中打开 config.toml：\n1 2 3 4  baseURL = \u0026#34;https://example.org/\u0026#34; languageCode = \u0026#34;en-us\u0026#34; title = \u0026#34;My New Hugo Site\u0026#34; theme = \u0026#34;ananke\u0026#34;   第 7 步：构建静态页面 1  hugo -D   ","date":"2022-08-01T19:52:18+08:00","permalink":"https://mkbooks.github.io/blog/p/quick-start/","title":"Quick Start"},{"content":"下载博客主题 创建好博客项目后，接下来是下载hugo博客的主题，这里有很多主题，我们可以任意挑选，比如我们选择了bootstrap4-blog 主题。\n然后在 Blog 目录下使用git 命令来下载主题：\n1  git clone https://github.com/alanorth/hugo-theme-bootstrap4-blog.git themes/hugo-theme-bootstrap4-blog   下载下来的主题会放在themes 目录中：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  └── hugo-theme-bootstrap4-blog ├── CHANGELOG.md ├── LICENSE.txt ├── README.md ├── archetypes ├── assets ├── exampleSite # 本主题示例内容 | ├── content # 示例博客文章 │ |-- static │ |-- config.toml # 本主题配置 ├── i18n ├── images ├── layouts ├── package-lock.json ├── package.json ├── screenshot.png ├── source ├── theme.toml └── webpack.config.js   使用主题 1 2 3  vim config.toml theme = \u0026#34;hugo-theme-bootstrap4-blog\u0026#34;   ","date":"2022-08-01T00:00:00Z","permalink":"https://mkbooks.github.io/blog/p/%E4%BF%AE%E6%94%B9%E5%8D%9A%E5%AE%A2%E4%B8%BB%E9%A2%98/","title":"修改博客主题"},{"content":"准备要部署的内容 在github 上创建一个仓库: chenjinxin.github.io\n要向仓库中存放的内容，使用 hugo 命令生成的。在当前目录下，运行 hugo 命令：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  ➜ quickstart git:(master) ✗ pwd /home/cjx/quickstart ➜ quickstart git:(master) hugo Start building sites … hugo v0.101.0-9f74196ce611cdf6d355bfb99fd8eba5c68ef7f8+extended linux/amd64 BuildDate=2022-06-28T10:02:18Z VendorInfo=snap | EN -------------------+----- Pages | 28 Paginator pages | 0 Non-page files | 0 Static files | 0 Processed images | 0 Aliases | 12 Sitemaps | 1 Cleaned | 0 Total in 33 ms   执行成功后，会生成一个public 目录，这个目录中的内容，就是我们博客系统的所有内容，我们需要将这些内容存放在Git 仓库中。\n部署到 GitHub 按照如下步骤将博客内容上传到Git 仓库，在public 目录下，依次执行下面的命令：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  # 初始化仓库 git init # 将所有内容添加到git git add . # 提交到git 本地 git commit -m \u0026#34;我的博客第一次提交\u0026#34; # 关联到远程git，注意这里需要写你自己的git 地址 git remote add origin git@github.com:chenjinxin1124/chenjinxin.github.io.git # 推送到远程git git push --set-upstream origin master   ","date":"2022-08-01T00:00:00Z","permalink":"https://mkbooks.github.io/blog/p/%E5%B0%86%E5%8D%9A%E5%AE%A2%E9%83%A8%E7%BD%B2%E5%9C%A8github%E4%B8%8A/","title":"将博客部署在GitHub上"},{"content":"初始化本地仓库 1  git init   添加代码 1  git add .   提交代码 1  git commit -m\u0026#39;first commit\u0026#39;   添加远程仓库地址 1  git remote add origin git@github.com:jinyumantangcjx/hugo.git   把本地仓库的变化连接到远程仓库主分支 1  git push --set-upstream origin master   ","date":"2022-08-01T00:00:00Z","permalink":"https://mkbooks.github.io/blog/p/%E6%8E%A8%E9%80%81%E5%88%B0github/","title":"推送到GitHub"},{"content":"openvpn 操作系统: Ubuntu 20.04\n参考文档：\nopenVPN官方文档\nDigitalOcean官方文档\n初始服务器设置 OpenVPN 服务器 创建新用户 1 2 3 4 5 6 7  sudo adduser sammy # 授予 sudo 权限 sudo usermod -aG sudo sammy # 切换用户 su sammy   创建密钥对 1 2 3 4  ssh-keygen # 将公钥复制到本机 touch ~/.ssh/authorized_keys \u0026amp;\u0026amp; cat ~/.ssh/id_rsa.pub \u0026gt;\u0026gt; ~/.ssh/authorized_keys   CA 服务器 创建新用户 1 2 3 4 5 6 7  sudo adduser sammy # 授予 sudo 权限 sudo usermod -aG sudo sammy # 切换用户 su sammy   创建密钥对 1 2 3 4 5 6 7 8 9 10 11 12  ssh-keygen # 将公钥复制到本机 touch ~/.ssh/authorized_keys \u0026amp;\u0026amp; cat ~/.ssh/id_rsa.pub \u0026gt;\u0026gt; ~/.ssh/authorized_keys # 将公钥复制到 OpenVPN 服务器 cat ~/.ssh/id_rsa.pub # 将上面命令执行结果复制到 OpenVPN 服务器的 /home/sammy/.ssh/authorized_keys 文件中 # 将 OpenVPN 服务器的公钥复制到本机，在 OpenVPN 服务器执行下面命令: cat ~/.ssh/id_rsa.pub # 将上面命令执行结果复制到 CA 服务器的 /home/sammy/.ssh/authorized_keys 文件中   安装 Easy-RSA  版本：3.0.6。\n 1 2 3 4 5 6  sudo apt update sudo apt install easy-rsa # 查看版本： dpkg -l|grep easy-rsa ii easy-rsa 3.0.6-1 all Simple shell based CA utility   创建公开密码匙基础建设目录 1 2 3 4 5 6 7  mkdir ~/easy-rsa # 使用此目录创建指向前一步中安装的 easy-rsa 包文件的符号链接。 ln -s /usr/share/easy-rsa/* ~/easy-rsa/ # 确保只有所有者可以使用 chmod 命令访问它: chmod 700 /home/sammy/easy-rsa   在 easy-rsa 目录中初始化 PKI:\n1 2  cd ~/easy-rsa ./easyrsa init-pki   创建证书颁发机构 创建并用一些默认值填充一个名为 vars 的文件。\n1 2 3 4 5 6 7 8 9 10 11  vi vars cat vars set_var EASYRSA_REQ_COUNTRY \u0026#34;CN\u0026#34; set_var EASYRSA_REQ_PROVINCE \u0026#34;GuangDong\u0026#34; set_var EASYRSA_REQ_CITY \u0026#34;ShenZhen\u0026#34; set_var EASYRSA_REQ_ORG \u0026#34;KLB\u0026#34; set_var EASYRSA_REQ_EMAIL \u0026#34;chenjinxin@chenjinxin.cn\u0026#34; set_var EASYRSA_REQ_OU \u0026#34;Community\u0026#34; set_var EASYRSA_ALGO \u0026#34;ec\u0026#34; set_var EASYRSA_DIGEST \u0026#34;sha512\u0026#34;   为证书颁发机构创建根公钥和私钥对(不想每次与 CA 交互时都被提示输入密码，可以使用 nopass 选项运行 build-CA 命令)\n1 2  # 按 ENTER 接受默认配置 ./easyrsa build-ca nopass   安装 OpenVPN 和 Easy-RSA OpenVPN 服务器 更新 OpenVPN 服务器的软件包索引并安装 OpenVPN 和 Easy-RSA。\n1 2 3 4 5 6 7 8 9 10  sudo apt update sudo apt install openvpn easy-rsa # 查看版本 dpkg -l|grep easy-rsa ii easy-rsa 3.0.6-1 all Simple shell based CA utility openvpn --version OpenVPN 2.5.5 x86_64-pc-linux-gnu [SSL (OpenSSL)] [LZO] [LZ4] [EPOLL] [PKCS11] [MH/PKTINFO] [AEAD] built on Mar 22 2022 library versions: OpenSSL 3.0.2 15 Mar 2022, LZO 2.10 ......   在 OpenVPN 服务器上创建一个新目录 ~/easy-rsa, 从 easyrsa 包安装到 ~/easy-rsa 目录中的脚本创建一个符号链接:\n1 2 3 4 5 6  mkdir ~/easy-rsa ln -s /usr/share/easy-rsa/* ~/easy-rsa/ # 确保目录的所有者是您的非 root sudo 用户，并使用chmod以下命令限制对该用户的访问： sudo chown sammy ~/easy-rsa chmod 700 ~/easy-rsa   为 OpenVPN 创建 PKI OpenVPN 服务器 在创建 OpenVPN 服务器的私钥和证书之前，您需要在 OpenVPN 服务器上创建一个本地公钥基础设施目录。您将使用此目录来管理服务器和客户端的证书请求，而不是直接在您的 CA 服务器上进行。\n要在您的 OpenVPN 服务器上构建 PKI 目录，您需要填充一个 vars 使用一些默认值调用的文件。首先您将 cd 进入该 easy-rsa 目录，然后您将使用 vi 或您喜欢的文本编辑器创建和编辑文件。\n1 2  cd ~/easy-rsa vi vars   打开文件后，粘贴以下两行：\n1 2  set_var EASYRSA_ALGO \u0026#34;ec\u0026#34; set_var EASYRSA_DIGEST \u0026#34;sha512\u0026#34;   填充 vars 文件后，您可以继续创建 PKI 目录。为此，请 easyrsa 使用该 init-pki 选项运行脚本。\n1  ./easyrsa init-pki   创建 OpenVPN 服务器证书请求和私钥 OpenVPN 服务器 生成私钥和证书签名请求\n1  cd ~/easy-rsa   现在，您将 easyrsa 使用该 gen-req 选项后跟机器的通用名称 (CN) 来调用。CN 可以是您喜欢的任何内容，但使其具有描述性会很有帮助。在本教程中，OpenVPN 服务器的 CN 将是server. 一定要包括该nopass选项。如果不这样做，将对请求文件进行密码保护，这可能会导致以后出现权限问题。\n注意：如果您选择server此处以外的名称，则必须调整下面的一些说明。例如，将生成的文件复制到/etc/openvpn目录时，您必须替换正确的名称。您还必须/etc/openvpn/server.conf稍后修改该文件以指向正确的.crt和.key文件。\n1  ./easyrsa gen-req server nopass   1 2 3 4 5 6  Output Common Name (eg: your user, host, or server name) [server]: Keypair and certificate request completed. Your files are: req: /home/sammy/easy-rsa/pki/reqs/server.req key: /home/sammy/easy-rsa/pki/private/server.key   这将为服务器创建一个私钥和一个名为server.req. 将服务器密钥复制到/etc/openvpn/server目录：\n1  sudo cp /home/sammy/easy-rsa/pki/private/server.key /etc/openvpn/server/   签署 OpenVPN 服务器的证书请求 CA 服务器 在 OpenVPN 服务器上，作为您的非 root 用户，使用 SCP 或其他传输方法将 server.req 证书请求复制到 CA 服务器进行签名：\n1 2  # scp sammy@your_openvpn_server_ip:/home/sammy/easy-rsa/pki/reqs/server.req /tmp scp sammy@123.125.32.26:/home/sammy/easy-rsa/pki/reqs/server.req /tmp   进入 ~/easy-rsa 创建 PK 的目录，然后使用easyrsa脚本导入证书请求：\n1 2  cd ~/easy-rsa ./easyrsa import-req /tmp/server.req server   1 2 3 4  Output ... The request has been successfully imported with a short name of: server You may now use this name to perform signing operations on this request.   接下来，通过运行easyrsa带有sign-req选项的脚本来签署请求，后跟请求类型和通用名称。请求类型可以是client或server。由于我们正在处理 OpenVPN 服务器的证书请求，请务必使用server请求类型：\n1  ./easyrsa sign-req server server   在输出中，系统会提示您验证请求是否来自受信任的来源。输入yes然后按ENTER确认：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  Output Note: using Easy-RSA configuration from: ./vars Using SSL: openssl OpenSSL 1.1.1f 31 Mar 2020 You are about to sign the following certificate. Please check over the details shown below for accuracy. Note that this request has not been cryptographically verified. Please be sure it came from a trusted source or that you have verified the request checksum with the sender. Request subject, to be signed as a server certificate for 1080 days: subject= commonName = server Type the word \u0026#39;yes\u0026#39; to continue, or any other input to abort. Confirm request details: yes Using configuration from /home/sammy/easy-rsa/pki/safessl-easyrsa.cnf Check that the request matches the signature Signature ok The Subject\u0026#39;s Distinguished Name is as follows commonName :ASN.1 12:\u0026#39;server\u0026#39; Certificate is to be certified until Jul 6 05:46:50 2025 GMT (1080 days) Write out database with 1 new entries Data Base Updated Certificate created at: /home/sammy/easy-rsa/pki/issued/server.crt   完成这些步骤后，您已经使用 CA 服务器的私钥签署了 OpenVPN 服务器的证书请求。生成的server.crt文件包含 OpenVPN 服务器的公共加密密钥，以及来自 CA 服务器的签名。签名的目的是告诉任何信任 CA 服务器的人，当他们连接到 OpenVPN 服务器时，他们也可以信任它。\n要完成配置证书，请将server.crt和ca.crt文件从 CA 服务器复制到 OpenVPN 服务器：\n1 2 3 4  # scp pki/issued/server.crt sammy@your_vpn_server_ip:/tmp # scp pki/ca.crt sammy@your_vpn_server_ip:/tmp scp pki/issued/server.crt sammy@123.125.32.26:/tmp scp pki/ca.crt sammy@123.125.32.26:/tmp   OpenVPN 服务器 现在回到您的 OpenVPN 服务器，将文件复制 /tmp 到 /etc/openvpn/server：\n1  sudo cp /tmp/{server.crt,ca.crt} /etc/openvpn/server   配置 OpenVPN 加密材料 OpenVPN 服务器 为了增加一层安全性，我们将添加一个额外的共享密钥，服务器和所有客户端将使用OpenVPN 的tls-crypt指令。此选项用于混淆服务器和客户端最初相互连接时使用的 TLS 证书。OpenVPN 服务器也使用它来对传入的数据包执行快速检查：如果使用预共享密钥对数据包进行签名，则服务器会对其进行处理；如果它没有签名，那么服务器知道它来自不受信任的来源并且可以丢弃它而不必执行额外的解密工作。\n此选项将有助于确保您的 OpenVPN 服务器能够应对未经身份验证的流量、端口扫描和拒绝服务攻击，这些攻击会占用服务器资源。这也使得识别 OpenVPN 网络流量变得更加困难。\n要生成tls-crypt预共享密钥，请在 OpenVPN 服务器上的~/easy-rsa目录中运行以下命令：\n1 2  cd ~/easy-rsa openvpn --genkey --secret ta.key   结果将是一个名为ta.key. 复制到/etc/openvpn/server/目录：\n1  sudo cp ta.key /etc/openvpn/server   将这些文件放在 OpenVPN 服务器上后，您就可以为您的用户创建客户端证书和密钥文件，您将使用它们连接到 VPN。\n生成客户端证书和密钥对 OpenVPN 服务器 尽管您可以在客户端计算机上生成私钥和证书请求，然后将其发送到 CA 进行签名，但本指南概述了在 OpenVPN 服务器上生成证书请求的过程。这种方法的好处是我们可以创建一个脚本，该脚本将自动生成包含所有必需密钥和证书的客户端配置文件。这让您不必将密钥、证书和配置文件传输到客户端，并简化加入 VPN 的过程。\n我们将为本指南生成单个客户端密钥和证书对。如果您有多个客户，您可以对每个客户重复此过程。但请注意，您需要为每个客户端的脚本传递一个唯一的名称值。在本教程中，第一个证书/密钥对称为 client1.\n首先在您的主目录中创建一个目录结构来存储客户端证书和密钥文件：\n1  mkdir -p ~/client-configs/keys   由于您将客户的证书/密钥对和配置文件存储在此目录中，因此您现在应该锁定其权限作为安全措施：\n1  chmod -R 700 ~/client-configs   接下来，导航回 EasyRSA 目录并 easyrsa 使用gen-req 和nopass 选项以及客户端的通用名称运行脚本：\n1 2  cd ~/easy-rsa ./easyrsa gen-req client1 nopass   按 ENTER 确认常用名称。然后，将 client1.key 文件复制到 ~/client-configs/keys/ 您之前创建的目录中：\n1  cp pki/private/client1.key ~/client-configs/keys/   CA 服务器 现在登录到您的 CA 服务器。\n接下来，将 client1.req 使用安全方法将文件传输到您的 CA 服务器：\n1 2  # scp sammy@your_openvpn_server_ip:/home/sammy/easy-rsa/pki/reqs/client1.req /tmp scp sammy@123.125.32.26:/home/sammy/easy-rsa/pki/reqs/client1.req /tmp   然后，导航到 EasyRSA 目录，并导入证书请求：\n1 2  cd ~/easy-rsa ./easyrsa import-req /tmp/client1.req client1   接下来，以与您在上一步中为服务器所做的相同的方式签署请求。不过这一次，请务必指定client请求类型：\n1  ./easyrsa sign-req client client1   出现提示时，输入yes以确认您打算签署证书请求并且它来自受信任的来源：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  Output Note: using Easy-RSA configuration from: ./vars Using SSL: openssl OpenSSL 1.1.1f 31 Mar 2020 You are about to sign the following certificate. Please check over the details shown below for accuracy. Note that this request has not been cryptographically verified. Please be sure it came from a trusted source or that you have verified the request checksum with the sender. Request subject, to be signed as a client certificate for 1080 days: subject= commonName = client1 Type the word \u0026#39;yes\u0026#39; to continue, or any other input to abort. Confirm request details: yes Using configuration from /home/sammy/easy-rsa/pki/safessl-easyrsa.cnf Check that the request matches the signature Signature ok The Subject\u0026#39;s Distinguished Name is as follows commonName :ASN.1 12:\u0026#39;client1\u0026#39; Certificate is to be certified until Jul 6 06:18:09 2025 GMT (1080 days) Write out database with 1 new entries Data Base Updated Certificate created at: /home/sammy/easy-rsa/pki/issued/client1.crt   这将创建一个名为client1.crt. 将此文件传输回服务器：\n1 2  # scp pki/issued/client1.crt sammy@your_server_ip:/tmp scp pki/issued/client1.crt sammy@123.125.32.26:/tmp   OpenVPN 服务器 回到您的 OpenVPN 服务器，将客户端证书复制到~/client-configs/keys/目录：\n1  cp /tmp/client1.crt ~/client-configs/keys/   接下来，将 ca.crt 和 ta.key 文件也复制到 ~/client-configs/keys/ 目录中，并为您的 sudo 用户设置适当的权限：\n1 2 3  cp ~/easy-rsa/ta.key ~/client-configs/keys/ sudo cp /etc/openvpn/server/ca.crt ~/client-configs/keys/ sudo chown sammy.sammy ~/client-configs/keys/*   这样，您的服务器和客户端的证书和密钥都已生成并存储在 OpenVPN 服务器上的相应目录中。仍然需要对这些文件执行一些操作，但这些将在稍后的步骤中进行。现在，您可以继续配置 OpenVPN。\n配置 OpenVPN OpenVPN 服务器 像许多其他广泛使用的开源工具一样，OpenVPN 有许多配置选项可用于根据您的特定需求自定义您的服务器。在本节中，我们将提供有关如何根据此软件文档中包含的示例配置文件之一设置 OpenVPN 服务器配置的说明。\n首先，复制示例 server.conf 文件作为您自己的配置文件的起点：\n1  sudo cp /usr/share/doc/openvpn/examples/sample-config-files/server.conf /etc/openvpn/server/   使用您选择的文本编辑器打开新文件进行编辑。我们将在示例中使用 vi：\n1  sudo vi /etc/openvpn/server/server.conf   我们需要更改此文件中的几行。首先，HMAC通过搜索 tls-auth 指令找到配置的部分。默认情况下将启用此行。通过;在行的开头添加 a来注释掉它。然后在它只包含值之后添加一个新行 tls-crypt ta.key：\n/etc/openvpn/server/server.conf\n1 2  ;tls-auth ta.key 0 # This file is secret tls-crypt ta.key   接下来，通过查找cipher行找到有关加密密码的部分。默认值设置为AES-256-CBC，但是，AES-256-GCM密码提供更好的加密级别和性能，并且在最新的 OpenVPN 客户端中得到很好的支持。我们将通过;在此行的开头添加一个符号来注释掉默认值，然后我们将在它包含更新后的值之后添加另一行AES-256-GCM：\n/etc/openvpn/server/server.conf\n1 2  ;cipher AES-256-CBC cipher AES-256-GCM   在此行之后，添加一个auth指令来选择 HMAC 消息摘要算法。为此，SHA256是一个不错的选择：\n/etc/openvpn/server/server.conf\n1  auth SHA256   接下来，找到包含dh指令的行，该指令定义了 Diffie-Hellman 参数。由于我们已将所有证书配置为使用椭圆曲线密码术，因此不需要 Diffie-Hellman 种子文件。注释掉看起来像dh dh2048.pem或的现有行dh dh.pem。Diffie-Hellman 密钥的文件名可能与示例服务器配置文件中列出的不同。然后在它后面添加一行内容dh none：\n/etc/openvpn/server/server.conf\n1 2  ;dh dh2048.pem dh none   接下来，我们希望 OpenVPN 一旦启动就在没有特权的情况下运行，因此我们需要告诉它以用户nobody和组nogroup 运行。要启用此功能，请通过删除每行开头的符号来查找和取消注释user nobody和行：group nogroup;\n/etc/openvpn/server/server.conf\n1 2  user nobody group nogroup   调整 OpenVPN 服务器网络配置 OpenVPN 服务器 服务器网络配置的某些方面需要进行调整，以便 OpenVPN 可以通过 VPN 正确路由流量。其中第一个是IP 转发，这是一种确定 IP 流量应路由到何处的方法。这对于您的服务器将提供的 VPN 功能至关重要。\n要调整 OpenVPN 服务器的默认 IP 转发设置，请 /etc/sysctl.conf 使用 vi 或首选编辑器打开文件：\n1  sudo vi /etc/sysctl.conf   然后在文件底部添加以下行：\n/etc/sysctl.conf\n1  net.ipv4.ip_forward = 1   完成后保存并关闭文件。\n要读取文件并加载当前会话的新值，请键入：\n1  sudo sysctl -p   1 2  Output net.ipv4.ip_forward = 1   现在，您的 OpenVPN 服务器将能够将传入流量从一个以太网设备转发到另一个。此设置确保服务器可以将连接到虚拟 VPN 接口的客户端的流量通过其其他物理以太网设备引导出去。此配置将通过服务器的 IP 地址路由来自客户端的所有网络流量，并且将有效地隐藏客户端的公共 IP 地址。\n在下一步中，您需要配置一些防火墙规则，以确保进出 OpenVPN 服务器的流量正常流动。\n防火墙配置(未开启防火墙可以跳过) OpenVPN 服务器 到目前为止，您已经在服务器上安装了 OpenVPN，对其进行了配置，并生成了客户端访问 VPN 所需的密钥和证书。但是，您尚未向 OpenVPN 提供有关从客户端发送传入 Web 流量的位置的任何说明。您可以通过建立一些防火墙规则和路由配置来规定服务器应如何处理客户端流量。\n假设您遵循了本教程开始时的先决条件，您应该已经ufw在服务器上安装并运行。要允许 OpenVPN 通过防火墙，您需要启用伪装，这是一种 iptables 概念，可提供即时动态网络地址转换 (NAT) 以正确路由客户端连接。\n在打开防火墙配置文件添加伪装规则之前，首先要找到自己机器的公网接口。为此，请键入：\n1  ip route list default   您的公共接口是在此命令的输出中找到的跟在单词“dev”之后的字符串。例如，此结果显示名为 的接口eth0，它在下面突出显示：\n1 2  Output default via 159.65.160.1 dev eth0 proto static   当您拥有与默认路由关联的接口时，打开 /etc/ufw/before.rules 文件以添加相关配置：\n1  sudo nano /etc/ufw/before.rules   UFW 规则通常使用该ufw命令添加。before.rules但是，在加载传统 UFW 规则之前，会读取文件中列出的规则并将其放置到位。在文件顶部，添加下面突出显示的行。这将为表中的POSTROUTING链设置默认策略nat并伪装来自 VPN 的任何流量。请记住eth0将以-A POSTROUTING下行中的内容替换为您在上述命令中找到的界面：\n/etc/ufw/before.rules\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  # # rules.before # # Rules that should be run before the ufw command line added rules. Custom # rules should be added to one of these chains: # ufw-before-input # ufw-before-output # ufw-before-forward # # START OPENVPN RULES # NAT table rules *nat :POSTROUTING ACCEPT [0:0] # Allow traffic from OpenVPN client to eth0 (change to the interface you discovered!) -A POSTROUTING -s 10.8.0.0/8 -o eth0 -j MASQUERADE COMMIT # END OPENVPN RULES # Don\u0026#39;t delete these required lines, otherwise there will be errors *filter . . .   完成后保存并关闭文件。\n接下来，您需要告诉 UFW 默认情况下也允许转发数据包。为此，请打开 /etc/default/ufw 文件：\n1  sudo nano /etc/default/ufw   在里面，找到DEFAULT_FORWARD_POLICY指令并将值从 更改 DROP 为 ACCEPT ：\n/etc/default/ufw\n1  DEFAULT_FORWARD_POLICY=\u0026#34;ACCEPT\u0026#34;   完成后保存并关闭文件。\n接下来，调整防火墙本身以允许 OpenVPN 的流量。如果您没有更改文件中的端口和协议/etc/openvpn/server.conf，则需要打开 UDP 流量到 port 1194。如果您修改了端口和/或协议，请替换您在此处选择的值。\n如果您在遵循先决条件教程时忘记添加 SSH 端口，请在此处添加：\n1 2  sudo ufw allow 1194/udp sudo ufw allow OpenSSH   注意：如果您使用不同的防火墙或自定义了 UFW 配置，则可能需要添加其他防火墙规则。例如，如果你决定隧道所有的网络流量通过VPN连接，你需要确保端口53流量允许DNS请求，而像港口80和443分别为HTTP和HTTPS流量。如果您在 VPN 上使用了其他协议，那么您还需要为它们添加规则。\n添加这些规则后，禁用并重新启用 UFW 以重新启动它并从您修改的所有文件中加载更改：\n1 2  sudo ufw disable sudo ufw enable   您的服务器现已配置为正确处理 OpenVPN 流量。设置好防火墙规则后，我们可以在服务器上启动 OpenVPN 服务。\n启动 OpenVPN OpenVPN 服务器 OpenVPN 作为 systemd 服务运行，因此我们可以使用 systemctl 它来管理它。我们会将 OpenVPN 配置为在启动时启动，因此只要您的服务器正在运行，您就可以随时连接到您的 VPN。为此，请将 OpenVPN 服务添加到 systemctl：\n1  sudo systemctl -f enable openvpn-server@server.service   然后启动OpenVPN服务：\n1  sudo systemctl start openvpn-server@server.service   使用以下命令仔细检查 OpenVPN 服务是否处于活动状态。您应该active (running)在输出中看到：\n1  sudo systemctl status openvpn-server@server.service   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  Output ● openvpn-server@server.service - OpenVPN service for server Loaded: loaded (/lib/systemd/system/openvpn-server@.service; enabled; vendor preset: enabled) Active: active (running) since Wed 2020-04-29 15:39:59 UTC; 6s ago Docs: man:openvpn(8) https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage https://community.openvpn.net/openvpn/wiki/HOWTO Main PID: 16872 (openvpn) Status: \u0026#34;Initialization Sequence Completed\u0026#34; Tasks: 1 (limit: 1137) Memory: 1.0M CGroup: /system.slice/system-openvpn\\x2dserver.slice/openvpn-server@server.service └─16872 /usr/sbin/openvpn --status /run/openvpn-server/status-server.log --status-version 2 --suppress-timestamps --c\u0026gt; . . . . . . Apr 29 15:39:59 ubuntu-20 openvpn[16872]: Initialization Sequence Completed   我们现在已经完成了 OpenVPN 的服务器端配置。接下来，您将配置您的客户端机器并连接到 OpenVPN 服务器。\n创建客户端配置基础架构(无特殊需求可以跳过) OpenVPN 服务器 为 OpenVPN 客户端创建配置文件可能有些复杂，因为每个客户端都必须有自己的配置，并且每个客户端都必须与服务器配置文件中列出的设置保持一致。这一步不是编写只能在一个客户端上使用的单个配置文件，而是概述了构建客户端配置基础结构的过程，您可以使用它来即时生成配置文件。您将首先创建一个“基本”配置文件，然后构建一个脚本，该脚本将允许您根据需要生成唯一的客户端配置文件、证书和密钥。\n首先创建一个新目录，您将client-configs在之前创建的目录中存储客户端配置文件：\n1  mkdir -p ~/client-configs/files   接下来，将示例客户端配置文件复制到client-configs目录中以用作基本配置：\n1  cp /usr/share/doc/openvpn/examples/sample-config-files/client.conf ~/client-configs/base.conf   使用nano或您喜欢的文本编辑器打开这个新文件：\n1  nano ~/client-configs/base.conf   在里面，找到remote指令。这将客户端指向您的 OpenVPN 服务器地址——您的 OpenVPN 服务器的公共 IP 地址。如果您决定更改 OpenVPN 服务器正在侦听的端口，您还需要更改1194为您选择的端口：\n~/client-configs/base.conf\n1 2 3 4 5 6  . . . # The hostname/IP and port of the server. # You can have multiple remote entries # to load balance between the servers. remote your_server_ip 1194 . . .   确保协议与您在服务器配置中使用的值匹配：\n~/client-configs/base.conf\n1  proto udp   接下来，通过删除每行开头的符号来取消对userandgroup指令的注释;：\n~/client-configs/base.conf\n1 2 3  # Downgrade privileges after initialization (non-Windows only) user nobody group nogroup   查找设置的指示ca，cert和key。注释掉这些指令，因为您很快就会在文件本身中添加证书和密钥：\n~/client-configs/base.conf\n1 2 3 4 5 6 7 8 9  # SSL/TLS parms. # See the server config file for more # description. It\u0026#39;s best to use # a separate .crt/.key file pair # for each client. A single ca # file can be used for all clients. ;ca ca.crt ;cert client.crt ;key client.key   同样，注释掉该tls-auth指令，因为您将ta.key直接添加到客户端配置文件中（并且服务器设置为使用tls-crypt）：\n~/client-configs/base.conf\n1 2 3  # If a tls-auth key is used on the server # then every client must also have the key. ;tls-auth ta.key 1   镜像您在文件中设置的cipher和auth设置/etc/openvpn/server/server.conf：\n~/client-configs/base.conf\n1 2  cipher AES-256-GCM auth SHA256   接下来，key-direction在文件中的某处添加指令。您必须将其设置为“1”才能使 VPN 在客户端计算机上正常运行：\n~/client-configs/base.conf\n1  key-direction 1   最后，添加一些注释掉的行来处理基于 Linux 的 VPN 客户端将用于 DNS 解析的各种方法。您将添加两个相似但单独的注释行集。第一组用于不用于systemd-resolved管理 DNS 的客户端。这些客户端依靠该resolvconf实用程序来更新 Linux 客户端的 DNS 信息。\n~/client-configs/base.conf\n1 2 3  ; script-security 2 ; up /etc/openvpn/update-resolv-conf ; down /etc/openvpn/update-resolv-conf   现在为systemd-resolved用于 DNS 解析的客户端添加另一组行：\n~/client-configs/base.conf\n1 2 3 4 5  ; script-security 2 ; up /etc/openvpn/update-systemd-resolved ; down /etc/openvpn/update-systemd-resolved ; down-pre ; dhcp-option DOMAIN-ROUTE .   完成后保存并关闭文件。\n接下来，我们将创建一个脚本，该脚本将使用相关的证书、密钥和加密文件编译您的基本配置，然后将生成的配置放在~/client-configs/files目录中。打开make_config.sh在~/client-configs目录中调用的新文件：\n1  nano ~/client-configs/make_config.sh   在里面，添加以下内容：\n~/client-configs/make_config.sh\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  #!/bin/bash  # First argument: Client identifier KEY_DIR=~/client-configs/keys OUTPUT_DIR=~/client-configs/files BASE_CONFIG=~/client-configs/base.conf cat ${BASE_CONFIG} \\  \u0026lt;(echo -e \u0026#39;\u0026lt;ca\u0026gt;\u0026#39;) \\  ${KEY_DIR}/ca.crt \\  \u0026lt;(echo -e \u0026#39;\u0026lt;/ca\u0026gt;\\n\u0026lt;cert\u0026gt;\u0026#39;) \\  ${KEY_DIR}/${1}.crt \\  \u0026lt;(echo -e \u0026#39;\u0026lt;/cert\u0026gt;\\n\u0026lt;key\u0026gt;\u0026#39;) \\  ${KEY_DIR}/${1}.key \\  \u0026lt;(echo -e \u0026#39;\u0026lt;/key\u0026gt;\\n\u0026lt;tls-crypt\u0026gt;\u0026#39;) \\  ${KEY_DIR}/ta.key \\  \u0026lt;(echo -e \u0026#39;\u0026lt;/tls-crypt\u0026gt;\u0026#39;) \\  \u0026gt; ${OUTPUT_DIR}/${1}.ovpn   完成后保存并关闭文件。\n在继续之前，请确保通过键入以下内容将此文件标记为可执行文件：\n1  chmod 700 ~/client-configs/make_config.sh   此脚本将复制base.conf您创建的文件，收集您为客户端创建的所有证书和密钥文件，提取它们的内容，将它们附加到基本配置文件的副本，并将所有这些内容导出到新的客户端配置文件。这意味着，不必单独管理客户端的配置、证书和密钥文件，所有需要的信息都存储在一个地方。使用此方法的好处是，如果您将来需要添加客户端，您可以运行此脚本来快速创建一个新的配置文件，并确保所有重要信息都存储在一个易于访问的单个地点。\n请注意，每次添加新客户端时，您都需要为其生成新的密钥和证书，然后才能运行此脚本并生成其配置文件。您将在下一步中练习使用此脚本。\n生成客户端配置 生成配置文件：\n1 2  cd ~/client-configs ./make_config.sh client1   这将client1.ovpn在您的~/client-configs/files目录中创建一个名为的文件：\n1  ls ~/client-configs/files   1 2  Output client1.ovpn   您需要将此文件传输到您计划用作客户端的设备。例如，这可能是您的本地计算机或移动设备。\n虽然用于完成此传输的确切应用程序取决于您设备的操作系统和您的个人偏好，但可靠且安全的方法是在后端使用 SFTP（SSH 文件传输协议）或 SCP（安全复制）。这将通过加密连接传输您客户端的 VPN 身份验证文件。\n这是一个示例 SFTP 命令，您可以从本地计算机（macOS 或 Linux）运行该命令。这会将client1.ovpn我们在上一步中创建的文件复制到您的主目录：\n1 2  # sftp sammy@openvpn_server_ip:client-configs/files/client1.ovpn ~/ sftp sammy@123.125.32.26:client-configs/files/client1.ovpn ~/   安装客户端配置 离线安装\n1 2  # ubuntu20.04 系统 sudo dpkg -i pkg/ubuntu20.04/openvpn_2.4.7-1ubuntu2.20.04.4_amd64.deb   1 2  # redhat8.6 系统 sudo rpm -i pkg/redhat8.6/pkg/*   在线安装\n如果您使用的是 Linux，则可以根据您的发行版使用多种工具。您的桌面环境或窗口管理器可能还包括连接实用程序。\n然而，最通用的连接方式是使用 OpenVPN 软件。\n在 Ubuntu 或 Debian 上，您可以像在服务器上一样通过键入以下内容来安装它：\n1 2  sudo apt update sudo apt install openvpn   在 CentOS 上，您可以启用 EPEL 存储库，然后键入以下内容进行安装：\n1 2  sudo dnf install epel-release sudo dnf install openvpn   配置使用的客户端 systemd-resolved 首先systemd-resolved通过检查/etc/resolv.conf文件来确定您的系统是否用于处理 DNS 解析：\n1  cat /etc/resolv.conf   1 2 3 4 5 6  Output # This file is managed by man:systemd-resolved(8). Do not edit. . . . nameserver 127.0.0.53 options edns0   如果您的系统配置为systemd-resolved用于 DNS 解析，则nameserver选项后面的 IP 地址将为127.0.0.53. 文件中还应该有注释，如显示的输出，解释如何systemd-resolved管理文件。如果您有一个不同的 IP 地址，127.0.0.53那么您的系统可能没有使用systemd-resolved，您可以转至下一节配置具有update-resolv-conf脚本的Linux 客户端。\n要支持这些客户端，请首先安装该openvpn-systemd-resolved软件包。它提供了强制systemd-resolved使用 VPN 服务器进行 DNS 解析的脚本。\n1  sudo apt install openvpn-systemd-resolved   安装该软件包之一，配置客户端以使用它，并通过 VPN 接口发送所有 DNS 查询。打开客户端的 VPN 文件：\n1  nano client1.ovpn   现在取消注释您之前添加的以下几行：\nclient1.ovpn\n1 2 3 4 5  script-security 2 up /etc/openvpn/update-systemd-resolved down /etc/openvpn/update-systemd-resolved down-pre dhcp-option DOMAIN-ROUTE .   配置使用的客户端 update-resolv-conf 如果您的系统不systemd-resolved用于管理 DNS，请检查您的发行版是否包含/etc/openvpn/update-resolv-conf脚本：\n1  ls /etc/openvpn   1 2  Output update-resolv-conf   如果您的客户端包含该update-resolv-conf文件，请编辑您之前传输的 OpenVPN 客户端配置文件：\n1  nano client1.ovpn   取消注释您添加的用于调整 DNS 设置的三行：\nclient1.ovpn\n1 2 3  script-security 2 up /etc/openvpn/update-resolv-conf down /etc/openvpn/update-resolv-conf   如果您使用 CentOS，请将group指令从nogroupto更改nobody为匹配发行版的可用组：\nclient1.ovpn\n1  group nobody   保存并关闭文件。\n连接\n现在，您只需将openvpn命令指向客户端配置文件即可连接到 VPN ：\n1 2  # 启动前注意检查 client1.ovpn 的 62 行。在 Ubuntu 系统上是 group nogroup，在 CentOS 系统上是 group nobody sudo openvpn --config client1.ovpn   这应该将您连接到您的 VPN。\n**注意：**如果您的客户端用于systemd-resolved管理 DNS，请通过运行如下systemd-resolve --status命令检查设置是否正确应用：\n1  systemd-resolve --status tun0   1 2 3 4 5 6  Output Link 22 (tun0) . . . DNS Servers: 208.67.222.222 208.67.220.220 DNS Domain: ~.   如果您看到您在 OpenVPN 服务器上配置的 DNS 服务器的 IP 地址，以及输出中DNS 域的~.设置，那么您已正确配置您的客户端以使用 VPN 服务器的 DNS 解析器。\n撤销客户端证书 有时，您可能需要撤销客户端证书以防止进一步访问 OpenVPN 服务器。\nCA 服务器 1 2  cd ~/easy-rsa ./easyrsa revoke client1   这将要求您通过输入 yes 来确认撤销:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  Output Please confirm you wish to revoke the certificate with the following subject: subject= commonName = client-ccx Type the word \u0026#39;yes\u0026#39; to continue, or any other input to abort. Continue with revocation: yes Using configuration from /home/sammy/easy-rsa/pki/safessl-easyrsa.cnf Revoking Certificate D3060496FB55BF756C970DF564AA4C17. Data Base Updated IMPORTANT!!! Revocation was successful. You must run gen-crl and upload a CRL to your infrastructure in order to prevent the revoked cert from being accepted.   注意撤销证书行上突出显示的值。此值是要撤销的证书的唯一序列号。如果要检查本节最后一步中的撤销列表以验证证书是否在其中，则需要此值。\n在确认操作之后，CA 将撤销证书。但是，依赖 CA 的远程系统无法检查是否有任何证书被撤销。用户和服务器仍然可以使用该证书，直至该证书的证书吊销列表(CRL)分发给所有依赖该证书的系统为止。\n生成一个证书吊销列表\n在 ~/easy-rsa 目录中使用 gen-CRL 选项运行 easy-rsa 命令:\n1 2  cd ~/easy-rsa ./easyrsa gen-crl   发送证书吊销列表\n1 2  # scp ~/easy-rsa/pki/crl.pem sammy@your_server_ip:/tmp scp ~/easy-rsa/pki/crl.pem sammy@123.125.32.26:/tmp   OpenVPN 服务器 使用这些说明撤销客户端证书后，您需要将生成的 crl.pem 文件复制到 /etc/openvpn/server 目录中的 OpenVPN 服务器：\n1  sudo cp /tmp/crl.pem /etc/openvpn/server/   接下来，打开 OpenVPN 服务器配置文件:\n1  sudo nano /etc/openvpn/server/server.conf   在文件底部，添加 crl-verify 选项，该选项将指示 OpenVPN 服务器在每次尝试连接时检查您创建的证书吊销列表：\n/etc/openvpn/server/server.conf\n1  crl-verify crl.pem   保存并关闭文件。 最后，重新启动 OpenVPN 以实现证书撤销:\n1  sudo systemctl restart openvpn-server@server.service   客户端应该不再能够使用旧凭据成功连接到服务器。 要撤销其他客户端，请按照以下流程操作：\n 使用 ./easyrsa revoke client_name 命令撤销证书 生成新的 CRL 将新的 crl.pem 文件传输到您的 OpenVPN 服务器并将其复制到 /etc/openvpn/server/ 目录以覆盖旧列表。 重新启动 OpenVPN 服务。  您可以使用此过程撤销您之前为服务器颁发的任何证书。\n配置更多客户端 修改 client1 为你要的客户端名称\nOpenVPN 服务器 到 EasyRSA 目录并 easyrsa 使用gen-req 和 nopass 选项以及客户端的通用名称运行脚本：\n1 2  cd ~/easy-rsa ./easyrsa gen-req client1 nopass   按 ENTER 确认常用名称。然后，将 client1.key 文件复制到 ~/client-configs/keys/ 您之前创建的目录中：\n1  cp pki/private/client1.key ~/client-configs/keys/   CA 服务器 现在登录到您的 CA 服务器。\n接下来，将 client1.req 使用安全方法将文件传输到您的 CA 服务器：\n1 2  # scp sammy@your_openvpn_server_ip:/home/sammy/easy-rsa/pki/reqs/client1.req /tmp scp sammy@123.125.32.26:/home/sammy/easy-rsa/pki/reqs/client1.req /tmp   然后，导航到 EasyRSA 目录，并导入证书请求：\n1 2 3  cd ~/easy-rsa ./easyrsa import-req /tmp/client1.req client1 ./easyrsa sign-req client client1   出现提示时，输入 ye s以确认您打算签署证书请求并且它来自受信任的来源：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  Output Note: using Easy-RSA configuration from: ./vars Using SSL: openssl OpenSSL 1.1.1f 31 Mar 2020 You are about to sign the following certificate. Please check over the details shown below for accuracy. Note that this request has not been cryptographically verified. Please be sure it came from a trusted source or that you have verified the request checksum with the sender. Request subject, to be signed as a client certificate for 1080 days: subject= commonName = client1 Type the word \u0026#39;yes\u0026#39; to continue, or any other input to abort. Confirm request details: yes Using configuration from /home/sammy/easy-rsa/pki/safessl-easyrsa.cnf Check that the request matches the signature Signature ok The Subject\u0026#39;s Distinguished Name is as follows commonName :ASN.1 12:\u0026#39;client1\u0026#39; Certificate is to be certified until Jul 6 06:18:09 2025 GMT (1080 days) Write out database with 1 new entries Data Base Updated Certificate created at: /home/sammy/easy-rsa/pki/issued/client1.crt   这将创建一个名为 client1.crt 将此文件传输回服务器：\n1 2  # scp pki/issued/client1.crt sammy@your_server_ip:/tmp scp pki/issued/client1.crt sammy@123.125.32.26:/tmp   OpenVPN 服务器 回到您的 OpenVPN 服务器，将客户端证书复制到~/client-configs/keys/目录：\n1  cp /tmp/client1.crt ~/client-configs/keys/   生成配置文件：\n1 2  cd ~/client-configs ./make_config.sh client1   这将client1.ovpn在您的~/client-configs/files目录中创建一个名为的文件：\n1  ls ~/client-configs/files   1 2  Output client1.ovpn   您需要将此文件传输到您计划用作客户端的设备。例如，这可能是您的本地计算机或移动设备。\n1 2  # sftp sammy@openvpn_server_ip:client-configs/files/client1.ovpn ~/ sftp sammy@123.125.32.26:client-configs/files/client1.ovpn ~/   安装客户端配置 离线安装\n1 2  # ubuntu20.04 系统 sudo dpkg -i pkg/ubuntu20.04/openvpn_2.4.7-1ubuntu2.20.04.4_amd64.deb   1 2  # redhat8.6 系统 sudo rpm -i pkg/redhat8.6/pkg/*   在线安装\n如果您使用的是 Linux，则可以根据您的发行版使用多种工具。您的桌面环境或窗口管理器可能还包括连接实用程序。\n然而，最通用的连接方式是使用 OpenVPN 软件。\n在 Ubuntu 或 Debian 上，您可以像在服务器上一样通过键入以下内容来安装它：\n1 2  sudo apt update sudo apt install openvpn   在 CentOS 上，您可以启用 EPEL 存储库，然后键入以下内容进行安装：\n1 2  sudo dnf install epel-release sudo dnf install openvpn   配置使用的客户端 systemd-resolved 首先systemd-resolved通过检查/etc/resolv.conf文件来确定您的系统是否用于处理 DNS 解析：\n1  cat /etc/resolv.conf   1 2 3 4 5 6  Output # This file is managed by man:systemd-resolved(8). Do not edit. . . . nameserver 127.0.0.53 options edns0   如果您的系统配置为systemd-resolved用于 DNS 解析，则nameserver选项后面的 IP 地址将为127.0.0.53. 文件中还应该有注释，如显示的输出，解释如何systemd-resolved管理文件。如果您有一个不同的 IP 地址，127.0.0.53那么您的系统可能没有使用systemd-resolved，您可以转至下一节配置具有update-resolv-conf脚本的Linux 客户端。\n要支持这些客户端，请首先安装该openvpn-systemd-resolved软件包。它提供了强制systemd-resolved使用 VPN 服务器进行 DNS 解析的脚本。\n1  sudo apt install openvpn-systemd-resolved   安装该软件包之一，配置客户端以使用它，并通过 VPN 接口发送所有 DNS 查询。打开客户端的 VPN 文件：\n1  nano client1.ovpn   现在取消注释您之前添加的以下几行：\nclient1.ovpn\n1 2 3 4 5  script-security 2 up /etc/openvpn/update-systemd-resolved down /etc/openvpn/update-systemd-resolved down-pre dhcp-option DOMAIN-ROUTE .   配置使用的客户端 update-resolv-conf 如果您的系统不systemd-resolved用于管理 DNS，请检查您的发行版是否包含/etc/openvpn/update-resolv-conf脚本：\n1  ls /etc/openvpn   1 2  Output update-resolv-conf   如果您的客户端包含该update-resolv-conf文件，请编辑您之前传输的 OpenVPN 客户端配置文件：\n1  nano client1.ovpn   取消注释您添加的用于调整 DNS 设置的三行：\nclient1.ovpn\n1 2 3  script-security 2 up /etc/openvpn/update-resolv-conf down /etc/openvpn/update-resolv-conf   如果您使用 CentOS，请将group指令从nogroupto更改nobody为匹配发行版的可用组：\nclient1.ovpn\n1  group nobody   保存并关闭文件。\n连接\n现在，您只需将openvpn命令指向客户端配置文件即可连接到 VPN ：\n1 2  # 启动前注意检查 client1.ovpn 的 62 行。在 Ubuntu 系统上是 group nogroup，在 CentOS 系统上是 group nobody sudo openvpn --config client1.ovpn   这应该将您连接到您的 VPN。\n**注意：**如果您的客户端用于systemd-resolved管理 DNS，请通过运行如下systemd-resolve --status命令检查设置是否正确应用：\n1  systemd-resolve --status tun0   1 2 3 4 5 6  Output Link 22 (tun0) . . . DNS Servers: 208.67.222.222 208.67.220.220 DNS Domain: ~.   如果您看到您在 OpenVPN 服务器上配置的 DNS 服务器的 IP 地址，以及输出中DNS 域的~.设置，那么您已正确配置您的客户端以使用 VPN 服务器的 DNS 解析器。\n安装 OpenVPN 客户端配置 离线安装\n1  sudo rpm -i pkg/redhat8.6/pkg/*   配置文件\n xxx-master.ovpn: 在 master 节点使用，会固定 VPN 的 IP，只能单节点使用。 xxx-worker.ovpn: 在 worker 节点使用，不会固定 VPN 的 IP，可以多节点使用。  配置使用\n 如果客户端需要固定端口的情况才操作，一般情况忽略。固定客户端端口：修改 xxx.ovpn 第 58 行，nobind -\u0026gt; port 51194\n 设置 systemctl 管理\n1 2 3 4 5 6 7 8  # 复制文件 sudo cp xxx.ovpn /etc/openvpn/client/client.conf # 开机启动 systemctl enable openvpn-client@client # 启动 systemctl start openvpn-client@client # 停止 systemctl stop openvpn-client@client   测试\n1 2  systemctl status openvpn-client@client ping 10.10.0.1   其它设置 客户端固定端口 修改 client1.ovpn 第 58 行，nobind -\u0026gt; port 51194\n设置 systemctl 启动 1 2 3 4 5 6 7 8 9 10 11  sudo cp client1.ovpn /etc/openvpn/client/client.conf # 开机启动 sudo systemctl enable openvpn-client@client # 启动 sudo systemctl start openvpn-client@client # 停止 sudo systemctl stop openvpn-client@client # 测试 sudo systemctl status openvpn-client@client ping 10.8.0.1   固定客户端 IP 1 2 3 4  # openvpn 服务器 vi /etc/openvpn/server/server.conf # 添加一行 client-config-dir /etc/openvpn/ccd   在 /etc/openvpn/ccd 创建文件，文件名为客户端的 CN 名称，内容为ifconfig-push ${IP} ${NETMASK}\n样例：\n1 2 3 4 5 6 7  sammy@OpenVPN:/etc/openvpn/ccd$ ll total 12 drwxr-xr-x 2 root root 4096 Aug 22 15:50 ./ drwxr-xr-x 5 root root 4096 Aug 22 15:19 ../ -rw-r--r-- 1 root root 35 Aug 22 15:50 tx-cjx-master sammy@OpenVPN:/etc/openvpn/ccd$ cat tx-cjx-master ifconfig-push 10.8.0.100 10.8.0.99   效果 在开启了允许客户端证书复用的情况下。固定了 IP 的证书被重复使用时，只有最后一个使用者可以连接到服务器，IP 固定。 未固定 IP 的证书可以正常复用。\n安装 OpenVPN 客户端配置 离线安装\n1  sudo rpm -i pkg/redhat8.6/pkg/*   配置文件\n xxx-master.ovpn: 在 master 节点使用，会固定 VPN 的 IP，只能单节点使用。 xxx-worker.ovpn: 在 worker 节点使用，不会固定 VPN 的 IP，可以多节点使用。  配置使用\n 如果客户端需要固定端口的情况才操作，一般情况忽略。固定客户端端口：修改 xxx.ovpn 第 58 行，nobind -\u0026gt; port 51194\n 设置 systemctl 管理\n1 2 3 4 5 6 7 8  # 复制文件 sudo cp xxx.ovpn /etc/openvpn/client/client.conf # 开机启动 systemctl enable openvpn-client@client # 启动 systemctl start openvpn-client@client # 停止 systemctl stop openvpn-client@client   测试\n1 2  systemctl status openvpn-client@client ping 10.10.0.1   其它配置 服务器查看已连接客户端 1  sudo tail -f /var/log/openvpn/openvpn-status.log   允许客户端直接互通 1 2 3 4 5 6 7 8 9  sudo vim /etc/openvpn/server/server.conf # Uncomment this directive to allow different # clients to be able to \u0026#34;see\u0026#34; each other. # By default, clients will only see the server. # To force clients to only see the server, you # will also need to appropriately firewall the # server\u0026#39;s TUN/TAP interface. client-to-client   ","date":"2020-08-06T00:00:00Z","permalink":"https://mkbooks.github.io/blog/p/%E5%9C%A8-ubuntu20.04-%E5%BB%BA%E8%AE%BE-openvpn/","title":"在 Ubuntu20.04 建设 openVPN"},{"content":"","date":"0001-01-01T00:00:00Z","permalink":"https://mkbooks.github.io/blog/p/","title":""},{"content":"","date":"0001-01-01T00:00:00Z","permalink":"https://mkbooks.github.io/blog/p/","title":""},{"content":"","date":"0001-01-01T00:00:00Z","permalink":"https://mkbooks.github.io/blog/p/","title":""},{"content":"","date":"0001-01-01T00:00:00Z","permalink":"https://mkbooks.github.io/blog/p/","title":""},{"content":"","date":"0001-01-01T00:00:00Z","permalink":"https://mkbooks.github.io/blog/p/","title":""},{"content":"","date":"0001-01-01T00:00:00Z","permalink":"https://mkbooks.github.io/blog/p/","title":""},{"content":"","date":"0001-01-01T00:00:00Z","permalink":"https://mkbooks.github.io/blog/p/","title":""},{"content":"下载镜像 1  docker pull cwq1913/lama-cleaner:gpu-0.33.0   准备 1 2 3 4 5 6 7 8 9  mkdir lama \u0026amp;\u0026amp; cd lama mkdir -p {huggingface_cache,torch_cache} curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add - distribution=$(. /etc/os-release;echo $ID$VERSION_ID) curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list sudo apt-get update sudo apt-get install -y nvidia-docker2 sudo systemctl restart docker   制作镜像 1 2 3 4 5 6 7 8  lama$ cat docker_build_triton/Dockerfile.triton FROM cwq1913/lama-cleaner:gpu-0.33.0 RUN apt-get update \u0026amp;\u0026amp; apt-get install -y --no-install-recommends \\ python3-pip \u0026amp;\u0026amp; \\ rm -rf /var/lib/apt/lists/* RUN pip3 install triton   1  docker build -t lama-cleaner-triton -f Dockerfile.triton .   运行 第一次运行，需要下载很多东西，等待即可\n1  docker run -d --restart unless-stopped --name lama-cleaner -p 8184:8184 -v $(pwd)/torch_cache:/root/.cache/torch -v $(pwd)/huggingface_cache:/root/.cache/huggingface --gpus all lama-cleaner-triton lama-cleaner --port=8184 --host=0.0.0.0 --gui   ","date":"0001-01-01T00:00:00Z","permalink":"https://mkbooks.github.io/blog/p/lama-%E4%BD%BF%E7%94%A8/","title":"lama 使用"},{"content":"运行 1  /usr/bin$ ./apipost7 --in-process-gpu   ","date":"0001-01-01T00:00:00Z","permalink":"https://mkbooks.github.io/blog/p/ubuntu22-%E4%BD%BF%E7%94%A8-apipost7/","title":"ubuntu22 使用 apipost7"},{"content":"要在Ubuntu系统中为AppImage文件创建快捷启动，可以按照以下步骤进行操作：\n一般流程 以 Cursor-0.1.9.AppImage 为例  打开终端，进入到AppImage文件所在的目录。 chmod +x Cursor-0.1.9.AppImage sudo cp Cursor-0.1.9.AppImage /usr/local/bin/Cursor gedit ~/.local/share/applications/Cursor.desktop 在打开的gedit窗口中输入以下内容：  1 2 3 4 5  [Desktop Entry] Type=Application Name=Cursor Exec=/usr/local/bin/Cursor Icon=/home/cjx/图片/Cursor.png   保存并关闭gedit窗口。 现在，在桌面上应该会出现一个新的快捷方式，你可以使用它来启动你的AppImage程序了。  ","date":"0001-01-01T00:00:00Z","permalink":"https://mkbooks.github.io/blog/p/ubuntu%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%BB%99appimage%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA%E5%BF%AB%E6%8D%B7%E5%90%AF%E5%8A%A8/","title":"Ubuntu系统中给AppImage文件创建快捷启动"},{"content":"下载镜像 1  docker pull nagadomi/waifu2x:latest   运行 1 2  mkdir waifu2x \u0026amp;\u0026amp; cd waifu2x docker run --gpus all -p 8812:8812 nagadomi/waifu2x:latest th web.lua   ","date":"0001-01-01T00:00:00Z","permalink":"https://mkbooks.github.io/blog/p/waifu2x-%E4%BD%BF%E7%94%A8/","title":"waifu2x 使用"}]