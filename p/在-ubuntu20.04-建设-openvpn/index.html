<!doctype html><html lang=en-us dir=ltr>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="è¿æ¥å„ä¸ªå†…ç½‘æœºå™¨é—´çš„ç½‘ç»œ"><title>åœ¨ Ubuntu20.04 å»ºè®¾ openVPN</title>
<link rel=canonical href=https://mkbooks.github.io/blog/p/%E5%9C%A8-ubuntu20.04-%E5%BB%BA%E8%AE%BE-openvpn/>
<link rel=stylesheet href=/blog/scss/style.min.ac77dcf8b111b51da39a92990f431923f210f3876d85798a2125667f96dc33a4.css><meta property="og:title" content="åœ¨ Ubuntu20.04 å»ºè®¾ openVPN">
<meta property="og:description" content="è¿æ¥å„ä¸ªå†…ç½‘æœºå™¨é—´çš„ç½‘ç»œ">
<meta property="og:url" content="https://mkbooks.github.io/blog/p/%E5%9C%A8-ubuntu20.04-%E5%BB%BA%E8%AE%BE-openvpn/">
<meta property="og:site_name" content="æˆ‘çš„ç©ºé—´">
<meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="ç½‘ç»œ"><meta property="article:tag" content="openVPN"><meta property="article:published_time" content="2020-08-06T00:00:00+00:00"><meta property="article:modified_time" content="2020-08-06T00:00:00+00:00">
<meta name=twitter:title content="åœ¨ Ubuntu20.04 å»ºè®¾ openVPN">
<meta name=twitter:description content="è¿æ¥å„ä¸ªå†…ç½‘æœºå™¨é—´çš„ç½‘ç»œ">
</head>
<body class=article-page>
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky">
<button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box>
<span class=hamburger-inner></span>
</span>
</button>
<header>
<figure class=site-avatar>
<a href=/blog/>
<img src=/blog/img/1_hu8b5a3db4a21c8e092ed8817bbbdf793a_61250_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a>
<span class=emoji>ğŸ¥</span>
</figure>
<div class=site-meta>
<h1 class=site-name><a href=/blog>æˆ‘çš„ç©ºé—´</a></h1>
<h2 class=site-description>å¸¸é¦™ç‰&é™ˆé‡‘é‘«.</h2>
</div>
</header><ol class=social-menu>
<li>
<a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg>
</a>
</li>
<li>
<a href=https://twitter.com target=_blank title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg>
</a>
</li>
</ol><ol class=menu id=main-menu>
<li>
<a href=/blog/blog/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span>
</a>
</li>
<li>
<a href=/blog/blog/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span>
</a>
</li>
<li>
<a href=/blog/blog/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span>
</a>
</li>
<li>
<a href=/blog/blog/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span>
</a>
</li>
<li>
<a href=/blog/blog/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span>
</a>
</li>
<div class=menu-bottom-section>
<li id=i18n-switch><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://mkbooks.github.io/blog/en/>English</option><option value=https://mkbooks.github.io/blog/ selected>ä¸­æ–‡</option></select>
</li>
<li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span>
</li>
</div>
</ol>
</aside>
<main class="main full-width">
<article class=main-article>
<header class=article-header>
<div class=article-details>
<header class=article-category>
<a href=/blog/categories/%E7%BD%91%E7%BB%9C/>
ç½‘ç»œ
</a>
<a href=/blog/categories/openvpn/>
openVPN
</a>
</header>
<div class=article-title-wrapper>
<h2 class=article-title>
<a href=/blog/p/%E5%9C%A8-ubuntu20.04-%E5%BB%BA%E8%AE%BE-openvpn/>åœ¨ Ubuntu20.04 å»ºè®¾ openVPN</a>
</h2>
<h3 class=article-subtitle>
è¿æ¥å„ä¸ªå†…ç½‘æœºå™¨é—´çš„ç½‘ç»œ
</h3>
</div>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Aug 06, 2020</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
é˜…è¯»æ—¶é•¿: 15 åˆ†é’Ÿ
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<h1 id=openvpn>openvpn</h1>
<p>æ“ä½œç³»ç»Ÿ: Ubuntu 20.04</p>
<p>å‚è€ƒæ–‡æ¡£ï¼š</p>
<p><a class=link href=https://openvpn.net/community-resources/ target=_blank rel=noopener>openVPNå®˜æ–¹æ–‡æ¡£</a></p>
<p><a class=link href=https://www.digitalocean.com/community/tutorials/how-to-set-up-and-configure-an-openvpn-server-on-ubuntu-20-04 target=_blank rel=noopener>DigitalOceanå®˜æ–¹æ–‡æ¡£</a></p>
<h2 id=åˆå§‹æœåŠ¡å™¨è®¾ç½®>åˆå§‹æœåŠ¡å™¨è®¾ç½®</h2>
<h3 id=openvpn-æœåŠ¡å™¨>OpenVPN æœåŠ¡å™¨</h3>
<h4 id=åˆ›å»ºæ–°ç”¨æˆ·>åˆ›å»ºæ–°ç”¨æˆ·</h4>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo adduser sammy

# æˆäºˆ sudo æƒé™
sudo usermod -aG sudo sammy

# åˆ‡æ¢ç”¨æˆ·
su sammy
</code></pre></td></tr></table>
</div>
</div><h5 id=åˆ›å»ºå¯†é’¥å¯¹>åˆ›å»ºå¯†é’¥å¯¹</h5>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>ssh-keygen

# å°†å…¬é’¥å¤åˆ¶åˆ°æœ¬æœº
touch ~/.ssh/authorized_keys &amp;&amp; cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys
</code></pre></td></tr></table>
</div>
</div><h3 id=ca-æœåŠ¡å™¨>CA æœåŠ¡å™¨</h3>
<h4 id=åˆ›å»ºæ–°ç”¨æˆ·-1>åˆ›å»ºæ–°ç”¨æˆ·</h4>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo adduser sammy

# æˆäºˆ sudo æƒé™
sudo usermod -aG sudo sammy

# åˆ‡æ¢ç”¨æˆ·
su sammy
</code></pre></td></tr></table>
</div>
</div><h5 id=åˆ›å»ºå¯†é’¥å¯¹-1>åˆ›å»ºå¯†é’¥å¯¹</h5>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>ssh-keygen

# å°†å…¬é’¥å¤åˆ¶åˆ°æœ¬æœº
touch ~/.ssh/authorized_keys &amp;&amp; cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys

# å°†å…¬é’¥å¤åˆ¶åˆ° OpenVPN æœåŠ¡å™¨
cat ~/.ssh/id_rsa.pub
# å°†ä¸Šé¢å‘½ä»¤æ‰§è¡Œç»“æœå¤åˆ¶åˆ° OpenVPN æœåŠ¡å™¨çš„ /home/sammy/.ssh/authorized_keys æ–‡ä»¶ä¸­

# å°† OpenVPN æœåŠ¡å™¨çš„å…¬é’¥å¤åˆ¶åˆ°æœ¬æœºï¼Œåœ¨ OpenVPN æœåŠ¡å™¨æ‰§è¡Œä¸‹é¢å‘½ä»¤:
cat ~/.ssh/id_rsa.pub
# å°†ä¸Šé¢å‘½ä»¤æ‰§è¡Œç»“æœå¤åˆ¶åˆ° CA æœåŠ¡å™¨çš„ /home/sammy/.ssh/authorized_keys æ–‡ä»¶ä¸­
</code></pre></td></tr></table>
</div>
</div><h4 id=å®‰è£…-easy-rsa>å®‰è£… Easy-RSA</h4>
<blockquote>
<p>ç‰ˆæœ¬ï¼š3.0.6ã€‚</p>
</blockquote>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo apt update
sudo apt install easy-rsa

# æŸ¥çœ‹ç‰ˆæœ¬ï¼š
dpkg -l|grep easy-rsa
ii  easy-rsa                              3.0.6-1                               all          Simple shell based CA utility
</code></pre></td></tr></table>
</div>
</div><h4 id=åˆ›å»ºå…¬å¼€å¯†ç åŒ™åŸºç¡€å»ºè®¾ç›®å½•>åˆ›å»ºå…¬å¼€å¯†ç åŒ™åŸºç¡€å»ºè®¾ç›®å½•</h4>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>mkdir ~/easy-rsa

# ä½¿ç”¨æ­¤ç›®å½•åˆ›å»ºæŒ‡å‘å‰ä¸€æ­¥ä¸­å®‰è£…çš„ easy-rsa åŒ…æ–‡ä»¶çš„ç¬¦å·é“¾æ¥ã€‚
ln -s /usr/share/easy-rsa/* ~/easy-rsa/

# ç¡®ä¿åªæœ‰æ‰€æœ‰è€…å¯ä»¥ä½¿ç”¨ chmod å‘½ä»¤è®¿é—®å®ƒ:
chmod 700 /home/sammy/easy-rsa
</code></pre></td></tr></table>
</div>
</div><p>åœ¨ easy-rsa ç›®å½•ä¸­åˆå§‹åŒ– PKI:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cd ~/easy-rsa
./easyrsa init-pki
</code></pre></td></tr></table>
</div>
</div><h4 id=åˆ›å»ºè¯ä¹¦é¢å‘æœºæ„>åˆ›å»ºè¯ä¹¦é¢å‘æœºæ„</h4>
<p>åˆ›å»ºå¹¶ç”¨ä¸€äº›é»˜è®¤å€¼å¡«å……ä¸€ä¸ªåä¸º vars çš„æ–‡ä»¶ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>vi vars
cat vars

set_var EASYRSA_REQ_COUNTRY    &#34;CN&#34;
set_var EASYRSA_REQ_PROVINCE   &#34;GuangDong&#34;
set_var EASYRSA_REQ_CITY       &#34;ShenZhen&#34;
set_var EASYRSA_REQ_ORG        &#34;KLB&#34;
set_var EASYRSA_REQ_EMAIL      &#34;chenjinxin@chenjinxin.cn&#34;
set_var EASYRSA_REQ_OU         &#34;Community&#34;
set_var EASYRSA_ALGO           &#34;ec&#34;
set_var EASYRSA_DIGEST         &#34;sha512&#34;
</code></pre></td></tr></table>
</div>
</div><p>ä¸ºè¯ä¹¦é¢å‘æœºæ„åˆ›å»ºæ ¹å…¬é’¥å’Œç§é’¥å¯¹(ä¸æƒ³æ¯æ¬¡ä¸ CA äº¤äº’æ—¶éƒ½è¢«æç¤ºè¾“å…¥å¯†ç ï¼Œå¯ä»¥ä½¿ç”¨ nopass é€‰é¡¹è¿è¡Œ build-CA å‘½ä»¤)</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># æŒ‰ ENTER æ¥å—é»˜è®¤é…ç½®
./easyrsa build-ca nopass
</code></pre></td></tr></table>
</div>
</div><h2 id=å®‰è£…-openvpn-å’Œ-easy-rsa>å®‰è£… OpenVPN å’Œ Easy-RSA</h2>
<h3 id=openvpn-æœåŠ¡å™¨-1>OpenVPN æœåŠ¡å™¨</h3>
<p>æ›´æ–° OpenVPN æœåŠ¡å™¨çš„è½¯ä»¶åŒ…ç´¢å¼•å¹¶å®‰è£… OpenVPN å’Œ Easy-RSAã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo apt update
sudo apt install openvpn easy-rsa

# æŸ¥çœ‹ç‰ˆæœ¬
dpkg -l|grep easy-rsa
ii  easy-rsa                              3.0.6-1                               all          Simple shell based CA utility
openvpn --version
OpenVPN 2.5.5 x86_64-pc-linux-gnu [SSL (OpenSSL)] [LZO] [LZ4] [EPOLL] [PKCS11] [MH/PKTINFO] [AEAD] built on Mar 22 2022
library versions: OpenSSL 3.0.2 15 Mar 2022, LZO 2.10
......
</code></pre></td></tr></table>
</div>
</div><p>åœ¨ OpenVPN æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæ–°ç›®å½• ~/easy-rsa, ä» easyrsa åŒ…å®‰è£…åˆ° ~/easy-rsa ç›®å½•ä¸­çš„è„šæœ¬åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æ¥:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>mkdir ~/easy-rsa
ln -s /usr/share/easy-rsa/* ~/easy-rsa/

# ç¡®ä¿ç›®å½•çš„æ‰€æœ‰è€…æ˜¯æ‚¨çš„é root sudo ç”¨æˆ·ï¼Œå¹¶ä½¿ç”¨chmodä»¥ä¸‹å‘½ä»¤é™åˆ¶å¯¹è¯¥ç”¨æˆ·çš„è®¿é—®ï¼š
sudo chown sammy ~/easy-rsa
chmod 700 ~/easy-rsa
</code></pre></td></tr></table>
</div>
</div><h2 id=ä¸º-openvpn-åˆ›å»º-pki>ä¸º OpenVPN åˆ›å»º PKI</h2>
<h3 id=openvpn-æœåŠ¡å™¨-2>OpenVPN æœåŠ¡å™¨</h3>
<p>åœ¨åˆ›å»º OpenVPN æœåŠ¡å™¨çš„ç§é’¥å’Œè¯ä¹¦ä¹‹å‰ï¼Œæ‚¨éœ€è¦åœ¨ OpenVPN æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæœ¬åœ°å…¬é’¥åŸºç¡€è®¾æ–½ç›®å½•ã€‚æ‚¨å°†ä½¿ç”¨æ­¤ç›®å½•æ¥ç®¡ç†æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„è¯ä¹¦è¯·æ±‚ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨æ‚¨çš„ CA æœåŠ¡å™¨ä¸Šè¿›è¡Œã€‚</p>
<p>è¦åœ¨æ‚¨çš„ OpenVPN æœåŠ¡å™¨ä¸Šæ„å»º PKI ç›®å½•ï¼Œæ‚¨éœ€è¦å¡«å……ä¸€ä¸ª vars ä½¿ç”¨ä¸€äº›é»˜è®¤å€¼è°ƒç”¨çš„æ–‡ä»¶ã€‚é¦–å…ˆæ‚¨å°† cd è¿›å…¥è¯¥ easy-rsa ç›®å½•ï¼Œç„¶åæ‚¨å°†ä½¿ç”¨ vi æˆ–æ‚¨å–œæ¬¢çš„æ–‡æœ¬ç¼–è¾‘å™¨åˆ›å»ºå’Œç¼–è¾‘æ–‡ä»¶ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cd ~/easy-rsa
vi vars
</code></pre></td></tr></table>
</div>
</div><p>æ‰“å¼€æ–‡ä»¶åï¼Œç²˜è´´ä»¥ä¸‹ä¸¤è¡Œï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>set_var EASYRSA_ALGO &#34;ec&#34;
set_var EASYRSA_DIGEST &#34;sha512&#34;
</code></pre></td></tr></table>
</div>
</div><p>å¡«å…… vars æ–‡ä»¶åï¼Œæ‚¨å¯ä»¥ç»§ç»­åˆ›å»º PKI ç›®å½•ã€‚ä¸ºæ­¤ï¼Œè¯· easyrsa ä½¿ç”¨è¯¥ init-pki é€‰é¡¹è¿è¡Œè„šæœ¬ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>./easyrsa init-pki
</code></pre></td></tr></table>
</div>
</div><h2 id=åˆ›å»º-openvpn-æœåŠ¡å™¨è¯ä¹¦è¯·æ±‚å’Œç§é’¥>åˆ›å»º OpenVPN æœåŠ¡å™¨è¯ä¹¦è¯·æ±‚å’Œç§é’¥</h2>
<h3 id=openvpn-æœåŠ¡å™¨-3>OpenVPN æœåŠ¡å™¨</h3>
<p>ç”Ÿæˆç§é’¥å’Œè¯ä¹¦ç­¾åè¯·æ±‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cd ~/easy-rsa
</code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨ï¼Œæ‚¨å°† easyrsa ä½¿ç”¨è¯¥ gen-req é€‰é¡¹åè·Ÿæœºå™¨çš„é€šç”¨åç§° (CN) æ¥è°ƒç”¨ã€‚CN å¯ä»¥æ˜¯æ‚¨å–œæ¬¢çš„ä»»ä½•å†…å®¹ï¼Œä½†ä½¿å…¶å…·æœ‰æè¿°æ€§ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼ŒOpenVPN æœåŠ¡å™¨çš„ CN å°†æ˜¯server. ä¸€å®šè¦åŒ…æ‹¬è¯¥nopassé€‰é¡¹ã€‚å¦‚æœä¸è¿™æ ·åšï¼Œå°†å¯¹è¯·æ±‚æ–‡ä»¶è¿›è¡Œå¯†ç ä¿æŠ¤ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä»¥åå‡ºç°æƒé™é—®é¢˜ã€‚</p>
<p>æ³¨æ„ï¼šå¦‚æœæ‚¨é€‰æ‹©serveræ­¤å¤„ä»¥å¤–çš„åç§°ï¼Œåˆ™å¿…é¡»è°ƒæ•´ä¸‹é¢çš„ä¸€äº›è¯´æ˜ã€‚ä¾‹å¦‚ï¼Œå°†ç”Ÿæˆçš„æ–‡ä»¶å¤åˆ¶åˆ°/etc/openvpnç›®å½•æ—¶ï¼Œæ‚¨å¿…é¡»æ›¿æ¢æ­£ç¡®çš„åç§°ã€‚æ‚¨è¿˜å¿…é¡»/etc/openvpn/server.confç¨åä¿®æ”¹è¯¥æ–‡ä»¶ä»¥æŒ‡å‘æ­£ç¡®çš„.crtå’Œ.keyæ–‡ä»¶ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>./easyrsa gen-req server nopass
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>Output
Common Name (eg: your user, host, or server name) [server]:

Keypair and certificate request completed. Your files are:
req: /home/sammy/easy-rsa/pki/reqs/server.req
key: /home/sammy/easy-rsa/pki/private/server.key
</code></pre></td></tr></table>
</div>
</div><p>è¿™å°†ä¸ºæœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªç§é’¥å’Œä¸€ä¸ªåä¸ºserver.req. å°†æœåŠ¡å™¨å¯†é’¥å¤åˆ¶åˆ°/etc/openvpn/serverç›®å½•ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo cp /home/sammy/easy-rsa/pki/private/server.key /etc/openvpn/server/
</code></pre></td></tr></table>
</div>
</div><h2 id=ç­¾ç½²-openvpn-æœåŠ¡å™¨çš„è¯ä¹¦è¯·æ±‚>ç­¾ç½² OpenVPN æœåŠ¡å™¨çš„è¯ä¹¦è¯·æ±‚</h2>
<h3 id=ca-æœåŠ¡å™¨-1>CA æœåŠ¡å™¨</h3>
<p>åœ¨ OpenVPN æœåŠ¡å™¨ä¸Šï¼Œä½œä¸ºæ‚¨çš„é root ç”¨æˆ·ï¼Œä½¿ç”¨ SCP æˆ–å…¶ä»–ä¼ è¾“æ–¹æ³•å°† server.req è¯ä¹¦è¯·æ±‚å¤åˆ¶åˆ° CA æœåŠ¡å™¨è¿›è¡Œç­¾åï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># scp sammy@your_openvpn_server_ip:/home/sammy/easy-rsa/pki/reqs/server.req /tmp
scp sammy@123.125.32.26:/home/sammy/easy-rsa/pki/reqs/server.req /tmp
</code></pre></td></tr></table>
</div>
</div><p>è¿›å…¥ ~/easy-rsa åˆ›å»º PK çš„ç›®å½•ï¼Œç„¶åä½¿ç”¨easyrsaè„šæœ¬å¯¼å…¥è¯ä¹¦è¯·æ±‚ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cd ~/easy-rsa
./easyrsa import-req /tmp/server.req server
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>Output
...
The request has been successfully imported with a short name of: server
You may now use this name to perform signing operations on this request.
</code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥ï¼Œé€šè¿‡è¿è¡Œeasyrsaå¸¦æœ‰sign-reqé€‰é¡¹çš„è„šæœ¬æ¥ç­¾ç½²è¯·æ±‚ï¼Œåè·Ÿè¯·æ±‚ç±»å‹å’Œé€šç”¨åç§°ã€‚è¯·æ±‚ç±»å‹å¯ä»¥æ˜¯clientæˆ–serverã€‚ç”±äºæˆ‘ä»¬æ­£åœ¨å¤„ç† OpenVPN æœåŠ¡å™¨çš„è¯ä¹¦è¯·æ±‚ï¼Œè¯·åŠ¡å¿…ä½¿ç”¨serverè¯·æ±‚ç±»å‹ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>./easyrsa sign-req server server
</code></pre></td></tr></table>
</div>
</div><p>åœ¨è¾“å‡ºä¸­ï¼Œç³»ç»Ÿä¼šæç¤ºæ‚¨éªŒè¯è¯·æ±‚æ˜¯å¦æ¥è‡ªå—ä¿¡ä»»çš„æ¥æºã€‚è¾“å…¥yesç„¶åæŒ‰ENTERç¡®è®¤ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>Output
Note: using Easy-RSA configuration from: ./vars

Using SSL: openssl OpenSSL 1.1.1f  31 Mar 2020


You are about to sign the following certificate.
Please check over the details shown below for accuracy. Note that this request
has not been cryptographically verified. Please be sure it came from a trusted
source or that you have verified the request checksum with the sender.

Request subject, to be signed as a server certificate for 1080 days:

subject=
    commonName                = server


Type the word &#39;yes&#39; to continue, or any other input to abort.
  Confirm request details: yes
Using configuration from /home/sammy/easy-rsa/pki/safessl-easyrsa.cnf
Check that the request matches the signature
Signature ok
The Subject&#39;s Distinguished Name is as follows
commonName            :ASN.1 12:&#39;server&#39;
Certificate is to be certified until Jul  6 05:46:50 2025 GMT (1080 days)

Write out database with 1 new entries
Data Base Updated

Certificate created at: /home/sammy/easy-rsa/pki/issued/server.crt
</code></pre></td></tr></table>
</div>
</div><p>å®Œæˆè¿™äº›æ­¥éª¤åï¼Œæ‚¨å·²ç»ä½¿ç”¨ CA æœåŠ¡å™¨çš„ç§é’¥ç­¾ç½²äº† OpenVPN æœåŠ¡å™¨çš„è¯ä¹¦è¯·æ±‚ã€‚ç”Ÿæˆçš„server.crtæ–‡ä»¶åŒ…å« OpenVPN æœåŠ¡å™¨çš„å…¬å…±åŠ å¯†å¯†é’¥ï¼Œä»¥åŠæ¥è‡ª CA æœåŠ¡å™¨çš„ç­¾åã€‚ç­¾åçš„ç›®çš„æ˜¯å‘Šè¯‰ä»»ä½•ä¿¡ä»» CA æœåŠ¡å™¨çš„äººï¼Œå½“ä»–ä»¬è¿æ¥åˆ° OpenVPN æœåŠ¡å™¨æ—¶ï¼Œä»–ä»¬ä¹Ÿå¯ä»¥ä¿¡ä»»å®ƒã€‚</p>
<p>è¦å®Œæˆé…ç½®è¯ä¹¦ï¼Œè¯·å°†server.crtå’Œca.crtæ–‡ä»¶ä» CA æœåŠ¡å™¨å¤åˆ¶åˆ° OpenVPN æœåŠ¡å™¨ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># scp pki/issued/server.crt sammy@your_vpn_server_ip:/tmp
# scp pki/ca.crt sammy@your_vpn_server_ip:/tmp
scp pki/issued/server.crt sammy@123.125.32.26:/tmp
scp pki/ca.crt sammy@123.125.32.26:/tmp
</code></pre></td></tr></table>
</div>
</div><h3 id=openvpn-æœåŠ¡å™¨-4>OpenVPN æœåŠ¡å™¨</h3>
<p>ç°åœ¨å›åˆ°æ‚¨çš„ OpenVPN æœåŠ¡å™¨ï¼Œå°†æ–‡ä»¶å¤åˆ¶ /tmp åˆ° /etc/openvpn/serverï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo cp /tmp/{server.crt,ca.crt} /etc/openvpn/server
</code></pre></td></tr></table>
</div>
</div><h2 id=é…ç½®-openvpn-åŠ å¯†ææ–™>é…ç½® OpenVPN åŠ å¯†ææ–™</h2>
<h3 id=openvpn-æœåŠ¡å™¨-5>OpenVPN æœåŠ¡å™¨</h3>
<p>ä¸ºäº†å¢åŠ ä¸€å±‚å®‰å…¨æ€§ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªé¢å¤–çš„å…±äº«å¯†é’¥ï¼ŒæœåŠ¡å™¨å’Œæ‰€æœ‰å®¢æˆ·ç«¯å°†ä½¿ç”¨OpenVPN çš„tls-cryptæŒ‡ä»¤ã€‚æ­¤é€‰é¡¹ç”¨äºæ··æ·†æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æœ€åˆç›¸äº’è¿æ¥æ—¶ä½¿ç”¨çš„ TLS è¯ä¹¦ã€‚OpenVPN æœåŠ¡å™¨ä¹Ÿä½¿ç”¨å®ƒæ¥å¯¹ä¼ å…¥çš„æ•°æ®åŒ…æ‰§è¡Œå¿«é€Ÿæ£€æŸ¥ï¼šå¦‚æœä½¿ç”¨é¢„å…±äº«å¯†é’¥å¯¹æ•°æ®åŒ…è¿›è¡Œç­¾åï¼Œåˆ™æœåŠ¡å™¨ä¼šå¯¹å…¶è¿›è¡Œå¤„ç†ï¼›å¦‚æœå®ƒæ²¡æœ‰ç­¾åï¼Œé‚£ä¹ˆæœåŠ¡å™¨çŸ¥é“å®ƒæ¥è‡ªä¸å—ä¿¡ä»»çš„æ¥æºå¹¶ä¸”å¯ä»¥ä¸¢å¼ƒå®ƒè€Œä¸å¿…æ‰§è¡Œé¢å¤–çš„è§£å¯†å·¥ä½œã€‚</p>
<p>æ­¤é€‰é¡¹å°†æœ‰åŠ©äºç¡®ä¿æ‚¨çš„ OpenVPN æœåŠ¡å™¨èƒ½å¤Ÿåº”å¯¹æœªç»èº«ä»½éªŒè¯çš„æµé‡ã€ç«¯å£æ‰«æå’Œæ‹’ç»æœåŠ¡æ”»å‡»ï¼Œè¿™äº›æ”»å‡»ä¼šå ç”¨æœåŠ¡å™¨èµ„æºã€‚è¿™ä¹Ÿä½¿å¾—è¯†åˆ« OpenVPN ç½‘ç»œæµé‡å˜å¾—æ›´åŠ å›°éš¾ã€‚</p>
<p>è¦ç”Ÿæˆtls-crypté¢„å…±äº«å¯†é’¥ï¼Œè¯·åœ¨ OpenVPN æœåŠ¡å™¨ä¸Šçš„~/easy-rsaç›®å½•ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cd ~/easy-rsa
openvpn --genkey secret ta.key
</code></pre></td></tr></table>
</div>
</div><p>ç»“æœå°†æ˜¯ä¸€ä¸ªåä¸ºta.key. å¤åˆ¶åˆ°/etc/openvpn/server/ç›®å½•ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo cp ta.key /etc/openvpn/server
</code></pre></td></tr></table>
</div>
</div><p>å°†è¿™äº›æ–‡ä»¶æ”¾åœ¨ OpenVPN æœåŠ¡å™¨ä¸Šåï¼Œæ‚¨å°±å¯ä»¥ä¸ºæ‚¨çš„ç”¨æˆ·åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶ï¼Œæ‚¨å°†ä½¿ç”¨å®ƒä»¬è¿æ¥åˆ° VPNã€‚</p>
<h2 id=ç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦å’Œå¯†é’¥å¯¹>ç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦å’Œå¯†é’¥å¯¹</h2>
<h3 id=openvpn-æœåŠ¡å™¨-6>OpenVPN æœåŠ¡å™¨</h3>
<p>å°½ç®¡æ‚¨å¯ä»¥åœ¨å®¢æˆ·ç«¯è®¡ç®—æœºä¸Šç”Ÿæˆç§é’¥å’Œè¯ä¹¦è¯·æ±‚ï¼Œç„¶åå°†å…¶å‘é€åˆ° CA è¿›è¡Œç­¾åï¼Œä½†æœ¬æŒ‡å—æ¦‚è¿°äº†åœ¨ OpenVPN æœåŠ¡å™¨ä¸Šç”Ÿæˆè¯ä¹¦è¯·æ±‚çš„è¿‡ç¨‹ã€‚è¿™ç§æ–¹æ³•çš„å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè„šæœ¬ï¼Œè¯¥è„šæœ¬å°†è‡ªåŠ¨ç”ŸæˆåŒ…å«æ‰€æœ‰å¿…éœ€å¯†é’¥å’Œè¯ä¹¦çš„å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ã€‚è¿™è®©æ‚¨ä¸å¿…å°†å¯†é’¥ã€è¯ä¹¦å’Œé…ç½®æ–‡ä»¶ä¼ è¾“åˆ°å®¢æˆ·ç«¯ï¼Œå¹¶ç®€åŒ–åŠ å…¥ VPN çš„è¿‡ç¨‹ã€‚</p>
<p>æˆ‘ä»¬å°†ä¸ºæœ¬æŒ‡å—ç”Ÿæˆå•ä¸ªå®¢æˆ·ç«¯å¯†é’¥å’Œè¯ä¹¦å¯¹ã€‚å¦‚æœæ‚¨æœ‰å¤šä¸ªå®¢æˆ·ï¼Œæ‚¨å¯ä»¥å¯¹æ¯ä¸ªå®¢æˆ·é‡å¤æ­¤è¿‡ç¨‹ã€‚ä½†è¯·æ³¨æ„ï¼Œæ‚¨éœ€è¦ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯çš„è„šæœ¬ä¼ é€’ä¸€ä¸ªå”¯ä¸€çš„åç§°å€¼ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œç¬¬ä¸€ä¸ªè¯ä¹¦/å¯†é’¥å¯¹ç§°ä¸º client1.</p>
<p>é¦–å…ˆåœ¨æ‚¨çš„ä¸»ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªç›®å½•ç»“æ„æ¥å­˜å‚¨å®¢æˆ·ç«¯è¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>mkdir -p ~/client-configs/keys
</code></pre></td></tr></table>
</div>
</div><p>ç”±äºæ‚¨å°†å®¢æˆ·çš„è¯ä¹¦/å¯†é’¥å¯¹å’Œé…ç½®æ–‡ä»¶å­˜å‚¨åœ¨æ­¤ç›®å½•ä¸­ï¼Œå› æ­¤æ‚¨ç°åœ¨åº”è¯¥é”å®šå…¶æƒé™ä½œä¸ºå®‰å…¨æªæ–½ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>chmod -R 700 ~/client-configs
</code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥ï¼Œå¯¼èˆªå› EasyRSA ç›®å½•å¹¶ easyrsa ä½¿ç”¨gen-req å’Œnopass é€‰é¡¹ä»¥åŠå®¢æˆ·ç«¯çš„é€šç”¨åç§°è¿è¡Œè„šæœ¬ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cd ~/easy-rsa
./easyrsa gen-req client1 nopass
</code></pre></td></tr></table>
</div>
</div><p>æŒ‰ ENTER ç¡®è®¤å¸¸ç”¨åç§°ã€‚ç„¶åï¼Œå°† client1.key æ–‡ä»¶å¤åˆ¶åˆ° ~/client-configs/keys/ æ‚¨ä¹‹å‰åˆ›å»ºçš„ç›®å½•ä¸­ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cp pki/private/client1.key ~/client-configs/keys/
</code></pre></td></tr></table>
</div>
</div><h3 id=ca-æœåŠ¡å™¨-2>CA æœåŠ¡å™¨</h3>
<p>ç°åœ¨ç™»å½•åˆ°æ‚¨çš„ CA æœåŠ¡å™¨ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œå°† client1.req ä½¿ç”¨å®‰å…¨æ–¹æ³•å°†æ–‡ä»¶ä¼ è¾“åˆ°æ‚¨çš„ CA æœåŠ¡å™¨ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># scp sammy@your_openvpn_server_ip:/home/sammy/easy-rsa/pki/reqs/client1.req /tmp
scp sammy@123.125.32.26:/home/sammy/easy-rsa/pki/reqs/client1.req /tmp
</code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œå¯¼èˆªåˆ° EasyRSA ç›®å½•ï¼Œå¹¶å¯¼å…¥è¯ä¹¦è¯·æ±‚ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cd ~/easy-rsa
./easyrsa import-req /tmp/client1.req client1
</code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥ï¼Œä»¥ä¸æ‚¨åœ¨ä¸Šä¸€æ­¥ä¸­ä¸ºæœåŠ¡å™¨æ‰€åšçš„ç›¸åŒçš„æ–¹å¼ç­¾ç½²è¯·æ±‚ã€‚ä¸è¿‡è¿™ä¸€æ¬¡ï¼Œè¯·åŠ¡å¿…æŒ‡å®šclientè¯·æ±‚ç±»å‹ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>./easyrsa sign-req client client1
</code></pre></td></tr></table>
</div>
</div><p>å‡ºç°æç¤ºæ—¶ï¼Œè¾“å…¥yesä»¥ç¡®è®¤æ‚¨æ‰“ç®—ç­¾ç½²è¯ä¹¦è¯·æ±‚å¹¶ä¸”å®ƒæ¥è‡ªå—ä¿¡ä»»çš„æ¥æºï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>Output
Note: using Easy-RSA configuration from: ./vars

Using SSL: openssl OpenSSL 1.1.1f  31 Mar 2020


You are about to sign the following certificate.
Please check over the details shown below for accuracy. Note that this request
has not been cryptographically verified. Please be sure it came from a trusted
source or that you have verified the request checksum with the sender.

Request subject, to be signed as a client certificate for 1080 days:

subject=
    commonName                = client1


Type the word &#39;yes&#39; to continue, or any other input to abort.
  Confirm request details: yes
Using configuration from /home/sammy/easy-rsa/pki/safessl-easyrsa.cnf
Check that the request matches the signature
Signature ok
The Subject&#39;s Distinguished Name is as follows
commonName            :ASN.1 12:&#39;client1&#39;
Certificate is to be certified until Jul  6 06:18:09 2025 GMT (1080 days)

Write out database with 1 new entries
Data Base Updated

Certificate created at: /home/sammy/easy-rsa/pki/issued/client1.crt
</code></pre></td></tr></table>
</div>
</div><p>è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸ºclient1.crt. å°†æ­¤æ–‡ä»¶ä¼ è¾“å›æœåŠ¡å™¨ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># scp pki/issued/client1.crt sammy@your_server_ip:/tmp
scp pki/issued/client1.crt sammy@123.125.32.26:/tmp
</code></pre></td></tr></table>
</div>
</div><h3 id=openvpn-æœåŠ¡å™¨-7>OpenVPN æœåŠ¡å™¨</h3>
<p>å›åˆ°æ‚¨çš„ OpenVPN æœåŠ¡å™¨ï¼Œå°†å®¢æˆ·ç«¯è¯ä¹¦å¤åˆ¶åˆ°~/client-configs/keys/ç›®å½•ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cp /tmp/client1.crt ~/client-configs/keys/
</code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥ï¼Œå°† ca.crt å’Œ ta.key æ–‡ä»¶ä¹Ÿå¤åˆ¶åˆ° ~/client-configs/keys/ ç›®å½•ä¸­ï¼Œå¹¶ä¸ºæ‚¨çš„ sudo ç”¨æˆ·è®¾ç½®é€‚å½“çš„æƒé™ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cp ~/easy-rsa/ta.key ~/client-configs/keys/
sudo cp /etc/openvpn/server/ca.crt ~/client-configs/keys/
sudo chown sammy.sammy ~/client-configs/keys/*
</code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ï¼Œæ‚¨çš„æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„è¯ä¹¦å’Œå¯†é’¥éƒ½å·²ç”Ÿæˆå¹¶å­˜å‚¨åœ¨ OpenVPN æœåŠ¡å™¨ä¸Šçš„ç›¸åº”ç›®å½•ä¸­ã€‚ä»ç„¶éœ€è¦å¯¹è¿™äº›æ–‡ä»¶æ‰§è¡Œä¸€äº›æ“ä½œï¼Œä½†è¿™äº›å°†åœ¨ç¨åçš„æ­¥éª¤ä¸­è¿›è¡Œã€‚ç°åœ¨ï¼Œæ‚¨å¯ä»¥ç»§ç»­é…ç½® OpenVPNã€‚</p>
<h2 id=é…ç½®-openvpn>é…ç½® OpenVPN</h2>
<h3 id=openvpn-æœåŠ¡å™¨-8>OpenVPN æœåŠ¡å™¨</h3>
<p>åƒè®¸å¤šå…¶ä»–å¹¿æ³›ä½¿ç”¨çš„å¼€æºå·¥å…·ä¸€æ ·ï¼ŒOpenVPN æœ‰è®¸å¤šé…ç½®é€‰é¡¹å¯ç”¨äºæ ¹æ®æ‚¨çš„ç‰¹å®šéœ€æ±‚è‡ªå®šä¹‰æ‚¨çš„æœåŠ¡å™¨ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æä¾›æœ‰å…³å¦‚ä½•æ ¹æ®æ­¤è½¯ä»¶æ–‡æ¡£ä¸­åŒ…å«çš„ç¤ºä¾‹é…ç½®æ–‡ä»¶ä¹‹ä¸€è®¾ç½® OpenVPN æœåŠ¡å™¨é…ç½®çš„è¯´æ˜ã€‚</p>
<p>é¦–å…ˆï¼Œå¤åˆ¶ç¤ºä¾‹ server.conf æ–‡ä»¶ä½œä¸ºæ‚¨è‡ªå·±çš„é…ç½®æ–‡ä»¶çš„èµ·ç‚¹ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo cp /usr/share/doc/openvpn/examples/sample-config-files/server.conf /etc/openvpn/server/
</code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨æ‚¨é€‰æ‹©çš„æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€æ–°æ–‡ä»¶è¿›è¡Œç¼–è¾‘ã€‚æˆ‘ä»¬å°†åœ¨ç¤ºä¾‹ä¸­ä½¿ç”¨ viï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo vi /etc/openvpn/server/server.conf
</code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬éœ€è¦æ›´æ”¹æ­¤æ–‡ä»¶ä¸­çš„å‡ è¡Œã€‚é¦–å…ˆï¼ŒHMACé€šè¿‡æœç´¢ tls-auth æŒ‡ä»¤æ‰¾åˆ°é…ç½®çš„éƒ¨åˆ†ã€‚é»˜è®¤æƒ…å†µä¸‹å°†å¯ç”¨æ­¤è¡Œã€‚é€šè¿‡;åœ¨è¡Œçš„å¼€å¤´æ·»åŠ  aæ¥æ³¨é‡Šæ‰å®ƒã€‚ç„¶ååœ¨å®ƒåªåŒ…å«å€¼ä¹‹åæ·»åŠ ä¸€ä¸ªæ–°è¡Œ tls-crypt ta.keyï¼š</p>
<p>/etc/openvpn/server/server.conf</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>;tls-auth ta.key 0 # This file is secret
tls-crypt ta.key
</code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥ï¼Œé€šè¿‡æŸ¥æ‰¾cipherè¡Œæ‰¾åˆ°æœ‰å…³åŠ å¯†å¯†ç çš„éƒ¨åˆ†ã€‚é»˜è®¤å€¼è®¾ç½®ä¸ºAES-256-CBCï¼Œä½†æ˜¯ï¼ŒAES-256-GCMå¯†ç æä¾›æ›´å¥½çš„åŠ å¯†çº§åˆ«å’Œæ€§èƒ½ï¼Œå¹¶ä¸”åœ¨æœ€æ–°çš„ OpenVPN å®¢æˆ·ç«¯ä¸­å¾—åˆ°å¾ˆå¥½çš„æ”¯æŒã€‚æˆ‘ä»¬å°†é€šè¿‡;åœ¨æ­¤è¡Œçš„å¼€å¤´æ·»åŠ ä¸€ä¸ªç¬¦å·æ¥æ³¨é‡Šæ‰é»˜è®¤å€¼ï¼Œç„¶åæˆ‘ä»¬å°†åœ¨å®ƒåŒ…å«æ›´æ–°åçš„å€¼ä¹‹åæ·»åŠ å¦ä¸€è¡ŒAES-256-GCMï¼š</p>
<p>/etc/openvpn/server/server.conf</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>;cipher AES-256-CBC
cipher AES-256-GCM
</code></pre></td></tr></table>
</div>
</div><p>åœ¨æ­¤è¡Œä¹‹åï¼Œæ·»åŠ ä¸€ä¸ªauthæŒ‡ä»¤æ¥é€‰æ‹© HMAC æ¶ˆæ¯æ‘˜è¦ç®—æ³•ã€‚ä¸ºæ­¤ï¼ŒSHA256æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼š</p>
<p>/etc/openvpn/server/server.conf</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>auth SHA256
</code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥ï¼Œæ‰¾åˆ°åŒ…å«dhæŒ‡ä»¤çš„è¡Œï¼Œè¯¥æŒ‡ä»¤å®šä¹‰äº† Diffie-Hellman å‚æ•°ã€‚ç”±äºæˆ‘ä»¬å·²å°†æ‰€æœ‰è¯ä¹¦é…ç½®ä¸ºä½¿ç”¨æ¤­åœ†æ›²çº¿å¯†ç æœ¯ï¼Œå› æ­¤ä¸éœ€è¦ Diffie-Hellman ç§å­æ–‡ä»¶ã€‚æ³¨é‡Šæ‰çœ‹èµ·æ¥åƒdh dh2048.pemæˆ–çš„ç°æœ‰è¡Œdh dh.pemã€‚Diffie-Hellman å¯†é’¥çš„æ–‡ä»¶åå¯èƒ½ä¸ç¤ºä¾‹æœåŠ¡å™¨é…ç½®æ–‡ä»¶ä¸­åˆ—å‡ºçš„ä¸åŒã€‚ç„¶ååœ¨å®ƒåé¢æ·»åŠ ä¸€è¡Œå†…å®¹dh noneï¼š</p>
<p>/etc/openvpn/server/server.conf</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>;dh dh2048.pem
dh none
</code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¸Œæœ› OpenVPN ä¸€æ—¦å¯åŠ¨å°±åœ¨æ²¡æœ‰ç‰¹æƒçš„æƒ…å†µä¸‹è¿è¡Œï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å‘Šè¯‰å®ƒä»¥ç”¨æˆ·nobodyå’Œç»„nogroup è¿è¡Œã€‚è¦å¯ç”¨æ­¤åŠŸèƒ½ï¼Œè¯·é€šè¿‡åˆ é™¤æ¯è¡Œå¼€å¤´çš„ç¬¦å·æ¥æŸ¥æ‰¾å’Œå–æ¶ˆæ³¨é‡Šuser nobodyå’Œè¡Œï¼šgroup nogroup;</p>
<p>/etc/openvpn/server/server.conf</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>user nobody
group nogroup
</code></pre></td></tr></table>
</div>
</div><h2 id=è°ƒæ•´-openvpn-æœåŠ¡å™¨ç½‘ç»œé…ç½®>è°ƒæ•´ OpenVPN æœåŠ¡å™¨ç½‘ç»œé…ç½®</h2>
<h3 id=openvpn-æœåŠ¡å™¨-9>OpenVPN æœåŠ¡å™¨</h3>
<p>æœåŠ¡å™¨ç½‘ç»œé…ç½®çš„æŸäº›æ–¹é¢éœ€è¦è¿›è¡Œè°ƒæ•´ï¼Œä»¥ä¾¿ OpenVPN å¯ä»¥é€šè¿‡ VPN æ­£ç¡®è·¯ç”±æµé‡ã€‚å…¶ä¸­ç¬¬ä¸€ä¸ªæ˜¯IP è½¬å‘ï¼Œè¿™æ˜¯ä¸€ç§ç¡®å®š IP æµé‡åº”è·¯ç”±åˆ°ä½•å¤„çš„æ–¹æ³•ã€‚è¿™å¯¹äºæ‚¨çš„æœåŠ¡å™¨å°†æä¾›çš„ VPN åŠŸèƒ½è‡³å…³é‡è¦ã€‚</p>
<p>è¦è°ƒæ•´ OpenVPN æœåŠ¡å™¨çš„é»˜è®¤ IP è½¬å‘è®¾ç½®ï¼Œè¯· /etc/sysctl.conf ä½¿ç”¨ vi æˆ–é¦–é€‰ç¼–è¾‘å™¨æ‰“å¼€æ–‡ä»¶ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo vi /etc/sysctl.conf
</code></pre></td></tr></table>
</div>
</div><p>ç„¶ååœ¨æ–‡ä»¶åº•éƒ¨æ·»åŠ ä»¥ä¸‹è¡Œï¼š</p>
<p>/etc/sysctl.conf</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>net.ipv4.ip_forward = 1
</code></pre></td></tr></table>
</div>
</div><p>å®Œæˆåä¿å­˜å¹¶å…³é—­æ–‡ä»¶ã€‚</p>
<p>è¦è¯»å–æ–‡ä»¶å¹¶åŠ è½½å½“å‰ä¼šè¯çš„æ–°å€¼ï¼Œè¯·é”®å…¥ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo sysctl -p
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>Output
net.ipv4.ip_forward = 1
</code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨ï¼Œæ‚¨çš„ OpenVPN æœåŠ¡å™¨å°†èƒ½å¤Ÿå°†ä¼ å…¥æµé‡ä»ä¸€ä¸ªä»¥å¤ªç½‘è®¾å¤‡è½¬å‘åˆ°å¦ä¸€ä¸ªã€‚æ­¤è®¾ç½®ç¡®ä¿æœåŠ¡å™¨å¯ä»¥å°†è¿æ¥åˆ°è™šæ‹Ÿ VPN æ¥å£çš„å®¢æˆ·ç«¯çš„æµé‡é€šè¿‡å…¶å…¶ä»–ç‰©ç†ä»¥å¤ªç½‘è®¾å¤‡å¼•å¯¼å‡ºå»ã€‚æ­¤é…ç½®å°†é€šè¿‡æœåŠ¡å™¨çš„ IP åœ°å€è·¯ç”±æ¥è‡ªå®¢æˆ·ç«¯çš„æ‰€æœ‰ç½‘ç»œæµé‡ï¼Œå¹¶ä¸”å°†æœ‰æ•ˆåœ°éšè—å®¢æˆ·ç«¯çš„å…¬å…± IP åœ°å€ã€‚</p>
<p>åœ¨ä¸‹ä¸€æ­¥ä¸­ï¼Œæ‚¨éœ€è¦é…ç½®ä¸€äº›é˜²ç«å¢™è§„åˆ™ï¼Œä»¥ç¡®ä¿è¿›å‡º OpenVPN æœåŠ¡å™¨çš„æµé‡æ­£å¸¸æµåŠ¨ã€‚</p>
<h2 id=é˜²ç«å¢™é…ç½®æœªå¼€å¯é˜²ç«å¢™å¯ä»¥è·³è¿‡>é˜²ç«å¢™é…ç½®(æœªå¼€å¯é˜²ç«å¢™å¯ä»¥è·³è¿‡)</h2>
<h3 id=openvpn-æœåŠ¡å™¨-10>OpenVPN æœåŠ¡å™¨</h3>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‚¨å·²ç»åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…äº† OpenVPNï¼Œå¯¹å…¶è¿›è¡Œäº†é…ç½®ï¼Œå¹¶ç”Ÿæˆäº†å®¢æˆ·ç«¯è®¿é—® VPN æ‰€éœ€çš„å¯†é’¥å’Œè¯ä¹¦ã€‚ä½†æ˜¯ï¼Œæ‚¨å°šæœªå‘ OpenVPN æä¾›æœ‰å…³ä»å®¢æˆ·ç«¯å‘é€ä¼ å…¥ Web æµé‡çš„ä½ç½®çš„ä»»ä½•è¯´æ˜ã€‚æ‚¨å¯ä»¥é€šè¿‡å»ºç«‹ä¸€äº›é˜²ç«å¢™è§„åˆ™å’Œè·¯ç”±é…ç½®æ¥è§„å®šæœåŠ¡å™¨åº”å¦‚ä½•å¤„ç†å®¢æˆ·ç«¯æµé‡ã€‚</p>
<p>å‡è®¾æ‚¨éµå¾ªäº†æœ¬æ•™ç¨‹å¼€å§‹æ—¶çš„å…ˆå†³æ¡ä»¶ï¼Œæ‚¨åº”è¯¥å·²ç»ufwåœ¨æœåŠ¡å™¨ä¸Šå®‰è£…å¹¶è¿è¡Œã€‚è¦å…è®¸ OpenVPN é€šè¿‡é˜²ç«å¢™ï¼Œæ‚¨éœ€è¦å¯ç”¨ä¼ªè£…ï¼Œè¿™æ˜¯ä¸€ç§ iptables æ¦‚å¿µï¼Œå¯æä¾›å³æ—¶åŠ¨æ€ç½‘ç»œåœ°å€è½¬æ¢ (NAT) ä»¥æ­£ç¡®è·¯ç”±å®¢æˆ·ç«¯è¿æ¥ã€‚</p>
<p>åœ¨æ‰“å¼€é˜²ç«å¢™é…ç½®æ–‡ä»¶æ·»åŠ ä¼ªè£…è§„åˆ™ä¹‹å‰ï¼Œé¦–å…ˆè¦æ‰¾åˆ°è‡ªå·±æœºå™¨çš„å…¬ç½‘æ¥å£ã€‚ä¸ºæ­¤ï¼Œè¯·é”®å…¥ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>ip route list default
</code></pre></td></tr></table>
</div>
</div><p>æ‚¨çš„å…¬å…±æ¥å£æ˜¯åœ¨æ­¤å‘½ä»¤çš„è¾“å‡ºä¸­æ‰¾åˆ°çš„è·Ÿåœ¨å•è¯â€œdevâ€ä¹‹åçš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œæ­¤ç»“æœæ˜¾ç¤ºåä¸º çš„æ¥å£eth0ï¼Œå®ƒåœ¨ä¸‹é¢çªå‡ºæ˜¾ç¤ºï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>Output
default via 159.65.160.1 dev eth0 proto static
</code></pre></td></tr></table>
</div>
</div><p>å½“æ‚¨æ‹¥æœ‰ä¸é»˜è®¤è·¯ç”±å…³è”çš„æ¥å£æ—¶ï¼Œæ‰“å¼€ /etc/ufw/before.rules æ–‡ä»¶ä»¥æ·»åŠ ç›¸å…³é…ç½®ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo nano /etc/ufw/before.rules
</code></pre></td></tr></table>
</div>
</div><p>UFW è§„åˆ™é€šå¸¸ä½¿ç”¨è¯¥ufwå‘½ä»¤æ·»åŠ ã€‚before.rulesä½†æ˜¯ï¼Œåœ¨åŠ è½½ä¼ ç»Ÿ UFW è§„åˆ™ä¹‹å‰ï¼Œä¼šè¯»å–æ–‡ä»¶ä¸­åˆ—å‡ºçš„è§„åˆ™å¹¶å°†å…¶æ”¾ç½®åˆ°ä½ã€‚åœ¨æ–‡ä»¶é¡¶éƒ¨ï¼Œæ·»åŠ ä¸‹é¢çªå‡ºæ˜¾ç¤ºçš„è¡Œã€‚è¿™å°†ä¸ºè¡¨ä¸­çš„POSTROUTINGé“¾è®¾ç½®é»˜è®¤ç­–ç•¥natå¹¶ä¼ªè£…æ¥è‡ª VPN çš„ä»»ä½•æµé‡ã€‚è¯·è®°ä½eth0å°†ä»¥-A POSTROUTINGä¸‹è¡Œä¸­çš„å†…å®¹æ›¿æ¢ä¸ºæ‚¨åœ¨ä¸Šè¿°å‘½ä»¤ä¸­æ‰¾åˆ°çš„ç•Œé¢ï¼š</p>
<p>/etc/ufw/before.rules</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>#
# rules.before
#
# Rules that should be run before the ufw command line added rules. Custom
# rules should be added to one of these chains:
#   ufw-before-input
#   ufw-before-output
#   ufw-before-forward
#

# START OPENVPN RULES
# NAT table rules
*nat
:POSTROUTING ACCEPT [0:0]
# Allow traffic from OpenVPN client to eth0 (change to the interface you discovered!)
-A POSTROUTING -s 10.8.0.0/8 -o eth0 -j MASQUERADE
COMMIT
# END OPENVPN RULES

# Don&#39;t delete these required lines, otherwise there will be errors
*filter
. . .
</code></pre></td></tr></table>
</div>
</div><p>å®Œæˆåä¿å­˜å¹¶å…³é—­æ–‡ä»¶ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦å‘Šè¯‰ UFW é»˜è®¤æƒ…å†µä¸‹ä¹Ÿå…è®¸è½¬å‘æ•°æ®åŒ…ã€‚ä¸ºæ­¤ï¼Œè¯·æ‰“å¼€ /etc/default/ufw æ–‡ä»¶ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo nano /etc/default/ufw
</code></pre></td></tr></table>
</div>
</div><p>åœ¨é‡Œé¢ï¼Œæ‰¾åˆ°DEFAULT_FORWARD_POLICYæŒ‡ä»¤å¹¶å°†å€¼ä» æ›´æ”¹ DROP ä¸º ACCEPT ï¼š</p>
<p>/etc/default/ufw</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>DEFAULT_FORWARD_POLICY=&#34;ACCEPT&#34;
</code></pre></td></tr></table>
</div>
</div><p>å®Œæˆåä¿å­˜å¹¶å…³é—­æ–‡ä»¶ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œè°ƒæ•´é˜²ç«å¢™æœ¬èº«ä»¥å…è®¸ OpenVPN çš„æµé‡ã€‚å¦‚æœæ‚¨æ²¡æœ‰æ›´æ”¹æ–‡ä»¶ä¸­çš„ç«¯å£å’Œåè®®/etc/openvpn/server.confï¼Œåˆ™éœ€è¦æ‰“å¼€ UDP æµé‡åˆ° port 1194ã€‚å¦‚æœæ‚¨ä¿®æ”¹äº†ç«¯å£å’Œ/æˆ–åè®®ï¼Œè¯·æ›¿æ¢æ‚¨åœ¨æ­¤å¤„é€‰æ‹©çš„å€¼ã€‚</p>
<p>å¦‚æœæ‚¨åœ¨éµå¾ªå…ˆå†³æ¡ä»¶æ•™ç¨‹æ—¶å¿˜è®°æ·»åŠ  SSH ç«¯å£ï¼Œè¯·åœ¨æ­¤å¤„æ·»åŠ ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo ufw allow 1194/udp
sudo ufw allow OpenSSH
</code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ï¼šå¦‚æœæ‚¨ä½¿ç”¨ä¸åŒçš„é˜²ç«å¢™æˆ–è‡ªå®šä¹‰äº† UFW é…ç½®ï¼Œåˆ™å¯èƒ½éœ€è¦æ·»åŠ å…¶ä»–é˜²ç«å¢™è§„åˆ™ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å†³å®šéš§é“æ‰€æœ‰çš„ç½‘ç»œæµé‡é€šè¿‡VPNè¿æ¥ï¼Œä½ éœ€è¦ç¡®ä¿ç«¯å£53æµé‡å…è®¸DNSè¯·æ±‚ï¼Œè€Œåƒæ¸¯å£80å’Œ443åˆ†åˆ«ä¸ºHTTPå’ŒHTTPSæµé‡ã€‚å¦‚æœæ‚¨åœ¨ VPN ä¸Šä½¿ç”¨äº†å…¶ä»–åè®®ï¼Œé‚£ä¹ˆæ‚¨è¿˜éœ€è¦ä¸ºå®ƒä»¬æ·»åŠ è§„åˆ™ã€‚</p>
<p>æ·»åŠ è¿™äº›è§„åˆ™åï¼Œç¦ç”¨å¹¶é‡æ–°å¯ç”¨ UFW ä»¥é‡æ–°å¯åŠ¨å®ƒå¹¶ä»æ‚¨ä¿®æ”¹çš„æ‰€æœ‰æ–‡ä»¶ä¸­åŠ è½½æ›´æ”¹ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo ufw disable
sudo ufw enable
</code></pre></td></tr></table>
</div>
</div><p>æ‚¨çš„æœåŠ¡å™¨ç°å·²é…ç½®ä¸ºæ­£ç¡®å¤„ç† OpenVPN æµé‡ã€‚è®¾ç½®å¥½é˜²ç«å¢™è§„åˆ™åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šå¯åŠ¨ OpenVPN æœåŠ¡ã€‚</p>
<h2 id=å¯åŠ¨-openvpn>å¯åŠ¨ OpenVPN</h2>
<h3 id=openvpn-æœåŠ¡å™¨-11>OpenVPN æœåŠ¡å™¨</h3>
<p>OpenVPN ä½œä¸º systemd æœåŠ¡è¿è¡Œï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ systemctl å®ƒæ¥ç®¡ç†å®ƒã€‚æˆ‘ä»¬ä¼šå°† OpenVPN é…ç½®ä¸ºåœ¨å¯åŠ¨æ—¶å¯åŠ¨ï¼Œå› æ­¤åªè¦æ‚¨çš„æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼Œæ‚¨å°±å¯ä»¥éšæ—¶è¿æ¥åˆ°æ‚¨çš„ VPNã€‚ä¸ºæ­¤ï¼Œè¯·å°† OpenVPN æœåŠ¡æ·»åŠ åˆ° systemctlï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo systemctl -f enable openvpn-server@server.service
</code></pre></td></tr></table>
</div>
</div><p>ç„¶åå¯åŠ¨OpenVPNæœåŠ¡ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo systemctl start openvpn-server@server.service
</code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä»”ç»†æ£€æŸ¥ OpenVPN æœåŠ¡æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚æ‚¨åº”è¯¥active (running)åœ¨è¾“å‡ºä¸­çœ‹åˆ°ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo systemctl status openvpn-server@server.service
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>Output
â— openvpn-server@server.service - OpenVPN service for server
     Loaded: loaded (/lib/systemd/system/openvpn-server@.service; enabled; vendor preset: enabled)
     Active: active (running) since Wed 2020-04-29 15:39:59 UTC; 6s ago
       Docs: man:openvpn(8)
             https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage
             https://community.openvpn.net/openvpn/wiki/HOWTO
   Main PID: 16872 (openvpn)
     Status: &#34;Initialization Sequence Completed&#34;
      Tasks: 1 (limit: 1137)
     Memory: 1.0M
     CGroup: /system.slice/system-openvpn\x2dserver.slice/openvpn-server@server.service
             â””â”€16872 /usr/sbin/openvpn --status /run/openvpn-server/status-server.log --status-version 2 --suppress-timestamps --c&gt;
. . .
. . .
Apr 29 15:39:59 ubuntu-20 openvpn[16872]: Initialization Sequence Completed
</code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬ç°åœ¨å·²ç»å®Œæˆäº† OpenVPN çš„æœåŠ¡å™¨ç«¯é…ç½®ã€‚æ¥ä¸‹æ¥ï¼Œæ‚¨å°†é…ç½®æ‚¨çš„å®¢æˆ·ç«¯æœºå™¨å¹¶è¿æ¥åˆ° OpenVPN æœåŠ¡å™¨ã€‚</p>
<h2 id=åˆ›å»ºå®¢æˆ·ç«¯é…ç½®åŸºç¡€æ¶æ„æ— ç‰¹æ®Šéœ€æ±‚å¯ä»¥è·³è¿‡>åˆ›å»ºå®¢æˆ·ç«¯é…ç½®åŸºç¡€æ¶æ„(æ— ç‰¹æ®Šéœ€æ±‚å¯ä»¥è·³è¿‡)</h2>
<h3 id=openvpn-æœåŠ¡å™¨-12>OpenVPN æœåŠ¡å™¨</h3>
<p>ä¸º OpenVPN å®¢æˆ·ç«¯åˆ›å»ºé…ç½®æ–‡ä»¶å¯èƒ½æœ‰äº›å¤æ‚ï¼Œå› ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯éƒ½å¿…é¡»æœ‰è‡ªå·±çš„é…ç½®ï¼Œå¹¶ä¸”æ¯ä¸ªå®¢æˆ·ç«¯éƒ½å¿…é¡»ä¸æœåŠ¡å™¨é…ç½®æ–‡ä»¶ä¸­åˆ—å‡ºçš„è®¾ç½®ä¿æŒä¸€è‡´ã€‚è¿™ä¸€æ­¥ä¸æ˜¯ç¼–å†™åªèƒ½åœ¨ä¸€ä¸ªå®¢æˆ·ç«¯ä¸Šä½¿ç”¨çš„å•ä¸ªé…ç½®æ–‡ä»¶ï¼Œè€Œæ˜¯æ¦‚è¿°äº†æ„å»ºå®¢æˆ·ç«¯é…ç½®åŸºç¡€ç»“æ„çš„è¿‡ç¨‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥å³æ—¶ç”Ÿæˆé…ç½®æ–‡ä»¶ã€‚æ‚¨å°†é¦–å…ˆåˆ›å»ºä¸€ä¸ªâ€œåŸºæœ¬â€é…ç½®æ–‡ä»¶ï¼Œç„¶åæ„å»ºä¸€ä¸ªè„šæœ¬ï¼Œè¯¥è„šæœ¬å°†å…è®¸æ‚¨æ ¹æ®éœ€è¦ç”Ÿæˆå”¯ä¸€çš„å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ã€è¯ä¹¦å’Œå¯†é’¥ã€‚</p>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ï¼Œæ‚¨å°†<code>client-configs</code>åœ¨ä¹‹å‰åˆ›å»ºçš„ç›®å½•ä¸­å­˜å‚¨å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>mkdir -p ~/client-configs/files
</code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥ï¼Œå°†ç¤ºä¾‹å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°<code>client-configs</code>ç›®å½•ä¸­ä»¥ç”¨ä½œåŸºæœ¬é…ç½®ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cp /usr/share/doc/openvpn/examples/sample-config-files/client.conf ~/client-configs/base.conf
</code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨<code>nano</code>æˆ–æ‚¨å–œæ¬¢çš„æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€è¿™ä¸ªæ–°æ–‡ä»¶ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>nano ~/client-configs/base.conf
</code></pre></td></tr></table>
</div>
</div><p>åœ¨é‡Œé¢ï¼Œæ‰¾åˆ°<code>remote</code>æŒ‡ä»¤ã€‚è¿™å°†å®¢æˆ·ç«¯æŒ‡å‘æ‚¨çš„ OpenVPN æœåŠ¡å™¨åœ°å€â€”â€”æ‚¨çš„ OpenVPN æœåŠ¡å™¨çš„å…¬å…± IP åœ°å€ã€‚å¦‚æœæ‚¨å†³å®šæ›´æ”¹ OpenVPN æœåŠ¡å™¨æ­£åœ¨ä¾¦å¬çš„ç«¯å£ï¼Œæ‚¨è¿˜éœ€è¦æ›´æ”¹<code>1194</code>ä¸ºæ‚¨é€‰æ‹©çš„ç«¯å£ï¼š</p>
<p>~/client-configs/base.conf</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>. . .
# The hostname/IP and port of the server.
# You can have multiple remote entries
# to load balance between the servers.
remote your_server_ip 1194
. . .
</code></pre></td></tr></table>
</div>
</div><p>ç¡®ä¿åè®®ä¸æ‚¨åœ¨æœåŠ¡å™¨é…ç½®ä¸­ä½¿ç”¨çš„å€¼åŒ¹é…ï¼š</p>
<p>~/client-configs/base.conf</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>proto udp
</code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥ï¼Œé€šè¿‡åˆ é™¤æ¯è¡Œå¼€å¤´çš„ç¬¦å·æ¥å–æ¶ˆå¯¹<code>user</code>and<code>group</code>æŒ‡ä»¤çš„æ³¨é‡Š<code>;</code>ï¼š</p>
<p>~/client-configs/base.conf</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># Downgrade privileges after initialization (non-Windows only)
user nobody
group nogroup
</code></pre></td></tr></table>
</div>
</div><p>æŸ¥æ‰¾è®¾ç½®çš„æŒ‡ç¤º<code>ca</code>ï¼Œ<code>cert</code>å’Œ<code>key</code>ã€‚æ³¨é‡Šæ‰è¿™äº›æŒ‡ä»¤ï¼Œå› ä¸ºæ‚¨å¾ˆå¿«å°±ä¼šåœ¨æ–‡ä»¶æœ¬èº«ä¸­æ·»åŠ è¯ä¹¦å’Œå¯†é’¥ï¼š</p>
<p>~/client-configs/base.conf</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># SSL/TLS parms.
# See the server config file for more
# description. It&#39;s best to use
# a separate .crt/.key file pair
# for each client. A single ca
# file can be used for all clients.
;ca ca.crt
;cert client.crt
;key client.key
</code></pre></td></tr></table>
</div>
</div><p>åŒæ ·ï¼Œæ³¨é‡Šæ‰è¯¥<code>tls-auth</code>æŒ‡ä»¤ï¼Œå› ä¸ºæ‚¨å°†<code>ta.key</code>ç›´æ¥æ·»åŠ åˆ°å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ä¸­ï¼ˆå¹¶ä¸”æœåŠ¡å™¨è®¾ç½®ä¸ºä½¿ç”¨<code>tls-crypt</code>ï¼‰ï¼š</p>
<p>~/client-configs/base.conf</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># If a tls-auth key is used on the server
# then every client must also have the key.
;tls-auth ta.key 1
</code></pre></td></tr></table>
</div>
</div><p>é•œåƒæ‚¨åœ¨æ–‡ä»¶ä¸­è®¾ç½®çš„<code>cipher</code>å’Œ<code>auth</code>è®¾ç½®<code>/etc/openvpn/server/server.conf</code>ï¼š</p>
<p>~/client-configs/base.conf</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cipher AES-256-GCM
auth SHA256
</code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥ï¼Œ<code>key-direction</code>åœ¨æ–‡ä»¶ä¸­çš„æŸå¤„æ·»åŠ æŒ‡ä»¤ã€‚æ‚¨<strong>å¿…é¡»</strong>å°†å…¶è®¾ç½®ä¸ºâ€œ1â€æ‰èƒ½ä½¿ VPN åœ¨å®¢æˆ·ç«¯è®¡ç®—æœºä¸Šæ­£å¸¸è¿è¡Œï¼š</p>
<p>~/client-configs/base.conf</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>key-direction 1
</code></pre></td></tr></table>
</div>
</div><p>æœ€åï¼Œæ·»åŠ ä¸€äº›<strong>æ³¨é‡Šæ‰çš„</strong>è¡Œæ¥å¤„ç†åŸºäº Linux çš„ VPN å®¢æˆ·ç«¯å°†ç”¨äº DNS è§£æçš„å„ç§æ–¹æ³•ã€‚æ‚¨å°†æ·»åŠ ä¸¤ä¸ªç›¸ä¼¼ä½†å•ç‹¬çš„æ³¨é‡Šè¡Œé›†ã€‚ç¬¬ä¸€ç»„ç”¨äº<em>ä¸</em>ç”¨äº<code>systemd-resolved</code>ç®¡ç† DNS çš„å®¢æˆ·ç«¯ã€‚è¿™äº›å®¢æˆ·ç«¯ä¾é è¯¥<code>resolvconf</code>å®ç”¨ç¨‹åºæ¥æ›´æ–° Linux å®¢æˆ·ç«¯çš„ DNS ä¿¡æ¯ã€‚</p>
<p>~/client-configs/base.conf</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>; script-security 2
; up /etc/openvpn/update-resolv-conf
; down /etc/openvpn/update-resolv-conf
</code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨ä¸º<code>systemd-resolved</code>ç”¨äº DNS è§£æçš„å®¢æˆ·ç«¯æ·»åŠ å¦ä¸€ç»„è¡Œï¼š</p>
<p>~/client-configs/base.conf</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>; script-security 2
; up /etc/openvpn/update-systemd-resolved
; down /etc/openvpn/update-systemd-resolved
; down-pre
; dhcp-option DOMAIN-ROUTE .
</code></pre></td></tr></table>
</div>
</div><p>å®Œæˆåä¿å­˜å¹¶å…³é—­æ–‡ä»¶ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªè„šæœ¬ï¼Œè¯¥è„šæœ¬å°†ä½¿ç”¨ç›¸å…³çš„è¯ä¹¦ã€å¯†é’¥å’ŒåŠ å¯†æ–‡ä»¶ç¼–è¯‘æ‚¨çš„åŸºæœ¬é…ç½®ï¼Œç„¶åå°†ç”Ÿæˆçš„é…ç½®æ”¾åœ¨<code>~/client-configs/files</code>ç›®å½•ä¸­ã€‚æ‰“å¼€<code>make_config.sh</code>åœ¨<code>~/client-configs</code>ç›®å½•ä¸­è°ƒç”¨çš„æ–°æ–‡ä»¶ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>nano ~/client-configs/make_config.sh
</code></pre></td></tr></table>
</div>
</div><p>åœ¨é‡Œé¢ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<p>~/client-configs/make_config.sh</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=cp>#!/bin/bash
</span><span class=cp></span>
<span class=c1># First argument: Client identifier</span>

<span class=nv>KEY_DIR</span><span class=o>=</span>~/client-configs/keys
<span class=nv>OUTPUT_DIR</span><span class=o>=</span>~/client-configs/files
<span class=nv>BASE_CONFIG</span><span class=o>=</span>~/client-configs/base.conf

cat <span class=si>${</span><span class=nv>BASE_CONFIG</span><span class=si>}</span> <span class=se>\
</span><span class=se></span>    &lt;<span class=o>(</span><span class=nb>echo</span> -e <span class=s1>&#39;&lt;ca&gt;&#39;</span><span class=o>)</span> <span class=se>\
</span><span class=se></span>    <span class=si>${</span><span class=nv>KEY_DIR</span><span class=si>}</span>/ca.crt <span class=se>\
</span><span class=se></span>    &lt;<span class=o>(</span><span class=nb>echo</span> -e <span class=s1>&#39;&lt;/ca&gt;\n&lt;cert&gt;&#39;</span><span class=o>)</span> <span class=se>\
</span><span class=se></span>    <span class=si>${</span><span class=nv>KEY_DIR</span><span class=si>}</span>/.crt <span class=se>\
</span><span class=se></span>    &lt;<span class=o>(</span><span class=nb>echo</span> -e <span class=s1>&#39;&lt;/cert&gt;\n&lt;key&gt;&#39;</span><span class=o>)</span> <span class=se>\
</span><span class=se></span>    <span class=si>${</span><span class=nv>KEY_DIR</span><span class=si>}</span>/.key <span class=se>\
</span><span class=se></span>    &lt;<span class=o>(</span><span class=nb>echo</span> -e <span class=s1>&#39;&lt;/key&gt;\n&lt;tls-crypt&gt;&#39;</span><span class=o>)</span> <span class=se>\
</span><span class=se></span>    <span class=si>${</span><span class=nv>KEY_DIR</span><span class=si>}</span>/ta.key <span class=se>\
</span><span class=se></span>    &lt;<span class=o>(</span><span class=nb>echo</span> -e <span class=s1>&#39;&lt;/tls-crypt&gt;&#39;</span><span class=o>)</span> <span class=se>\
</span><span class=se></span>    &gt; <span class=si>${</span><span class=nv>OUTPUT_DIR</span><span class=si>}</span>/.ovpn
</code></pre></td></tr></table>
</div>
</div><p>å®Œæˆåä¿å­˜å¹¶å…³é—­æ–‡ä»¶ã€‚</p>
<p>åœ¨ç»§ç»­ä¹‹å‰ï¼Œè¯·ç¡®ä¿é€šè¿‡é”®å…¥ä»¥ä¸‹å†…å®¹å°†æ­¤æ–‡ä»¶æ ‡è®°ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>chmod 700 ~/client-configs/make_config.sh
</code></pre></td></tr></table>
</div>
</div><p>æ­¤è„šæœ¬å°†å¤åˆ¶<code>base.conf</code>æ‚¨åˆ›å»ºçš„æ–‡ä»¶ï¼Œæ”¶é›†æ‚¨ä¸ºå®¢æˆ·ç«¯åˆ›å»ºçš„æ‰€æœ‰è¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶ï¼Œæå–å®ƒä»¬çš„å†…å®¹ï¼Œå°†å®ƒä»¬é™„åŠ åˆ°åŸºæœ¬é…ç½®æ–‡ä»¶çš„å‰¯æœ¬ï¼Œå¹¶å°†æ‰€æœ‰è¿™äº›å†…å®¹å¯¼å‡ºåˆ°æ–°çš„å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ã€‚è¿™æ„å‘³ç€ï¼Œä¸å¿…å•ç‹¬ç®¡ç†å®¢æˆ·ç«¯çš„é…ç½®ã€è¯ä¹¦å’Œå¯†é’¥æ–‡ä»¶ï¼Œæ‰€æœ‰éœ€è¦çš„ä¿¡æ¯éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªåœ°æ–¹ã€‚ä½¿ç”¨æ­¤æ–¹æ³•çš„å¥½å¤„æ˜¯ï¼Œå¦‚æœæ‚¨å°†æ¥éœ€è¦æ·»åŠ å®¢æˆ·ç«¯ï¼Œæ‚¨å¯ä»¥è¿è¡Œæ­¤è„šæœ¬æ¥å¿«é€Ÿåˆ›å»ºä¸€ä¸ªæ–°çš„é…ç½®æ–‡ä»¶ï¼Œå¹¶ç¡®ä¿æ‰€æœ‰é‡è¦ä¿¡æ¯éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªæ˜“äºè®¿é—®çš„å•ä¸ªåœ°ç‚¹ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œæ¯æ¬¡æ·»åŠ æ–°å®¢æˆ·ç«¯æ—¶ï¼Œæ‚¨éƒ½éœ€è¦ä¸ºå…¶ç”Ÿæˆæ–°çš„å¯†é’¥å’Œè¯ä¹¦ï¼Œç„¶åæ‰èƒ½è¿è¡Œæ­¤è„šæœ¬å¹¶ç”Ÿæˆå…¶é…ç½®æ–‡ä»¶ã€‚æ‚¨å°†åœ¨ä¸‹ä¸€æ­¥ä¸­ç»ƒä¹ ä½¿ç”¨æ­¤è„šæœ¬ã€‚</p>
<h2 id=ç”Ÿæˆå®¢æˆ·ç«¯é…ç½®>ç”Ÿæˆå®¢æˆ·ç«¯é…ç½®</h2>
<p>ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cd ~/client-configs
./make_config.sh client1
</code></pre></td></tr></table>
</div>
</div><p>è¿™å°†<code>client1.ovpn</code>åœ¨æ‚¨çš„<code>~/client-configs/files</code>ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºçš„æ–‡ä»¶ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>ls ~/client-configs/files
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>Output
client1.ovpn
</code></pre></td></tr></table>
</div>
</div><p>æ‚¨éœ€è¦å°†æ­¤æ–‡ä»¶ä¼ è¾“åˆ°æ‚¨è®¡åˆ’ç”¨ä½œå®¢æˆ·ç«¯çš„è®¾å¤‡ã€‚ä¾‹å¦‚ï¼Œè¿™å¯èƒ½æ˜¯æ‚¨çš„æœ¬åœ°è®¡ç®—æœºæˆ–ç§»åŠ¨è®¾å¤‡ã€‚</p>
<p>è™½ç„¶ç”¨äºå®Œæˆæ­¤ä¼ è¾“çš„ç¡®åˆ‡åº”ç”¨ç¨‹åºå–å†³äºæ‚¨è®¾å¤‡çš„æ“ä½œç³»ç»Ÿå’Œæ‚¨çš„ä¸ªäººåå¥½ï¼Œä½†å¯é ä¸”å®‰å…¨çš„æ–¹æ³•æ˜¯åœ¨åç«¯ä½¿ç”¨ SFTPï¼ˆSSH æ–‡ä»¶ä¼ è¾“åè®®ï¼‰æˆ– SCPï¼ˆå®‰å…¨å¤åˆ¶ï¼‰ã€‚è¿™å°†é€šè¿‡åŠ å¯†è¿æ¥ä¼ è¾“æ‚¨å®¢æˆ·ç«¯çš„ VPN èº«ä»½éªŒè¯æ–‡ä»¶ã€‚</p>
<p>è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹ SFTP å‘½ä»¤ï¼Œæ‚¨å¯ä»¥ä»æœ¬åœ°è®¡ç®—æœºï¼ˆmacOS æˆ– Linuxï¼‰è¿è¡Œè¯¥å‘½ä»¤ã€‚è¿™ä¼šå°†<code>client1.ovpn</code>æˆ‘ä»¬åœ¨ä¸Šä¸€æ­¥ä¸­åˆ›å»ºçš„æ–‡ä»¶å¤åˆ¶åˆ°æ‚¨çš„ä¸»ç›®å½•ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># sftp sammy@openvpn_server_ip:client-configs/files/client1.ovpn ~/
sftp sammy@123.125.32.26:client-configs/files/client1.ovpn ~/
</code></pre></td></tr></table>
</div>
</div><h2 id=å®‰è£…å®¢æˆ·ç«¯é…ç½®>å®‰è£…å®¢æˆ·ç«¯é…ç½®</h2>
<p><strong>ç¦»çº¿å®‰è£…</strong></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># ubuntu20.04 ç³»ç»Ÿ
sudo dpkg -i pkg/ubuntu20.04/openvpn_2.4.7-1ubuntu2.20.04.4_amd64.deb
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># redhat8.6 ç³»ç»Ÿ
sudo rpm -i pkg/redhat8.6/pkg/*
</code></pre></td></tr></table>
</div>
</div><p><strong>åœ¨çº¿å®‰è£…</strong></p>
<p>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Linuxï¼Œåˆ™å¯ä»¥æ ¹æ®æ‚¨çš„å‘è¡Œç‰ˆä½¿ç”¨å¤šç§å·¥å…·ã€‚æ‚¨çš„æ¡Œé¢ç¯å¢ƒæˆ–çª—å£ç®¡ç†å™¨å¯èƒ½è¿˜åŒ…æ‹¬è¿æ¥å®ç”¨ç¨‹åºã€‚</p>
<p>ç„¶è€Œï¼Œæœ€é€šç”¨çš„è¿æ¥æ–¹å¼æ˜¯ä½¿ç”¨ OpenVPN è½¯ä»¶ã€‚</p>
<p>åœ¨ Ubuntu æˆ– Debian ä¸Šï¼Œæ‚¨å¯ä»¥åƒåœ¨æœåŠ¡å™¨ä¸Šä¸€æ ·é€šè¿‡é”®å…¥ä»¥ä¸‹å†…å®¹æ¥å®‰è£…å®ƒï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo apt update
sudo apt install openvpn
</code></pre></td></tr></table>
</div>
</div><p>åœ¨ CentOS ä¸Šï¼Œæ‚¨å¯ä»¥å¯ç”¨ EPEL å­˜å‚¨åº“ï¼Œç„¶åé”®å…¥ä»¥ä¸‹å†…å®¹è¿›è¡Œå®‰è£…ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>sudo dnf install epel-release
sudo dnf install openvpn
</code></pre></td></tr></table>
</div>
</div><h4 id=é…ç½®ä½¿ç”¨çš„å®¢æˆ·ç«¯-systemd-resolved>é…ç½®ä½¿ç”¨çš„å®¢æˆ·ç«¯ <code>systemd-resolved</code></h4>
<p>é¦–å…ˆ<code>systemd-resolved</code>é€šè¿‡æ£€æŸ¥<code>/etc/resolv.conf</code>æ–‡ä»¶æ¥ç¡®å®šæ‚¨çš„ç³»ç»Ÿæ˜¯å¦ç”¨äºå¤„ç† DNS è§£æï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cat /etc/resolv.conf
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>Output
# This file is managed by man:systemd-resolved(8). Do not edit.
. . .

nameserver 127.0.0.53
options edns0
</code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ‚¨çš„ç³»ç»Ÿé…ç½®ä¸º<code>systemd-resolved</code>ç”¨äº DNS è§£æï¼Œåˆ™<code>nameserver</code>é€‰é¡¹åé¢çš„ IP åœ°å€å°†ä¸º<code>127.0.0.53</code>. æ–‡ä»¶ä¸­è¿˜åº”è¯¥æœ‰æ³¨é‡Šï¼Œå¦‚æ˜¾ç¤ºçš„è¾“å‡ºï¼Œè§£é‡Šå¦‚ä½•<code>systemd-resolved</code>ç®¡ç†æ–‡ä»¶ã€‚å¦‚æœæ‚¨æœ‰ä¸€ä¸ªä¸åŒçš„ IP åœ°å€ï¼Œ<code>127.0.0.53</code>é‚£ä¹ˆæ‚¨çš„ç³»ç»Ÿå¯èƒ½æ²¡æœ‰ä½¿ç”¨<code>systemd-resolved</code>ï¼Œæ‚¨å¯ä»¥è½¬è‡³ä¸‹ä¸€èŠ‚é…ç½®å…·æœ‰<code>update-resolv-conf</code>è„šæœ¬çš„Linux å®¢æˆ·ç«¯ã€‚</p>
<p>è¦æ”¯æŒè¿™äº›å®¢æˆ·ç«¯ï¼Œè¯·é¦–å…ˆå®‰è£…è¯¥<code>openvpn-systemd-resolved</code>è½¯ä»¶åŒ…ã€‚å®ƒæä¾›äº†å¼ºåˆ¶<code>systemd-resolved</code>ä½¿ç”¨ VPN æœåŠ¡å™¨è¿›è¡Œ DNS è§£æçš„è„šæœ¬ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo apt install openvpn-systemd-resolved
</code></pre></td></tr></table>
</div>
</div><p>å®‰è£…è¯¥è½¯ä»¶åŒ…ä¹‹ä¸€ï¼Œé…ç½®å®¢æˆ·ç«¯ä»¥ä½¿ç”¨å®ƒï¼Œå¹¶é€šè¿‡ VPN æ¥å£å‘é€æ‰€æœ‰ DNS æŸ¥è¯¢ã€‚æ‰“å¼€å®¢æˆ·ç«¯çš„ VPN æ–‡ä»¶ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>nano client1.ovpn
</code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨å–æ¶ˆæ³¨é‡Šæ‚¨ä¹‹å‰æ·»åŠ çš„ä»¥ä¸‹å‡ è¡Œï¼š</p>
<p>client1.ovpn</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>script-security 2
up /etc/openvpn/update-systemd-resolved
down /etc/openvpn/update-systemd-resolved
down-pre
dhcp-option DOMAIN-ROUTE .
</code></pre></td></tr></table>
</div>
</div><h4 id=é…ç½®ä½¿ç”¨çš„å®¢æˆ·ç«¯-update-resolv-conf>é…ç½®ä½¿ç”¨çš„å®¢æˆ·ç«¯ <code>update-resolv-conf</code></h4>
<p>å¦‚æœæ‚¨çš„ç³»ç»Ÿä¸<code>systemd-resolved</code>ç”¨äºç®¡ç† DNSï¼Œè¯·æ£€æŸ¥æ‚¨çš„å‘è¡Œç‰ˆæ˜¯å¦åŒ…å«<code>/etc/openvpn/update-resolv-conf</code>è„šæœ¬ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>ls /etc/openvpn
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>Output
update-resolv-conf
</code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ‚¨çš„å®¢æˆ·ç«¯åŒ…å«è¯¥<code>update-resolv-conf</code>æ–‡ä»¶ï¼Œè¯·ç¼–è¾‘æ‚¨ä¹‹å‰ä¼ è¾“çš„ OpenVPN å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>nano client1.ovpn
</code></pre></td></tr></table>
</div>
</div><p>å–æ¶ˆæ³¨é‡Šæ‚¨æ·»åŠ çš„ç”¨äºè°ƒæ•´ DNS è®¾ç½®çš„ä¸‰è¡Œï¼š</p>
<p>client1.ovpn</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>script-security 2
up /etc/openvpn/update-resolv-conf
down /etc/openvpn/update-resolv-conf
</code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ‚¨ä½¿ç”¨ CentOSï¼Œè¯·å°†<code>group</code>æŒ‡ä»¤ä»<code>nogroup</code>toæ›´æ”¹<code>nobody</code>ä¸ºåŒ¹é…å‘è¡Œç‰ˆçš„å¯ç”¨ç»„ï¼š</p>
<p>client1.ovpn</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>group nobody
</code></pre></td></tr></table>
</div>
</div><p>ä¿å­˜å¹¶å…³é—­æ–‡ä»¶ã€‚</p>
<p><strong>è¿æ¥</strong></p>
<p>ç°åœ¨ï¼Œæ‚¨åªéœ€å°†<code>openvpn</code>å‘½ä»¤æŒ‡å‘å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶å³å¯è¿æ¥åˆ° VPN ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># å¯åŠ¨å‰æ³¨æ„æ£€æŸ¥ client1.ovpn çš„ 62 è¡Œã€‚åœ¨ Ubuntu ç³»ç»Ÿä¸Šæ˜¯ group nogroupï¼Œåœ¨ CentOS ç³»ç»Ÿä¸Šæ˜¯ group nobody
sudo openvpn --config client1.ovpn
</code></pre></td></tr></table>
</div>
</div><p>è¿™åº”è¯¥å°†æ‚¨è¿æ¥åˆ°æ‚¨çš„ VPNã€‚</p>
<p>**æ³¨æ„ï¼š**å¦‚æœæ‚¨çš„å®¢æˆ·ç«¯ç”¨äº<code>systemd-resolved</code>ç®¡ç† DNSï¼Œè¯·é€šè¿‡è¿è¡Œå¦‚ä¸‹<code>systemd-resolve --status</code>å‘½ä»¤æ£€æŸ¥è®¾ç½®æ˜¯å¦æ­£ç¡®åº”ç”¨ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>systemd-resolve --status tun0
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>Output
Link 22 (tun0)
. . .
         DNS Servers: 208.67.222.222
                      208.67.220.220
          DNS Domain: ~.
</code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ‚¨çœ‹åˆ°æ‚¨åœ¨ OpenVPN æœåŠ¡å™¨ä¸Šé…ç½®çš„ DNS æœåŠ¡å™¨çš„ IP åœ°å€ï¼Œä»¥åŠè¾“å‡ºä¸­<em>DNS åŸŸ</em>çš„<code>~.</code>è®¾ç½®ï¼Œé‚£ä¹ˆæ‚¨å·²æ­£ç¡®é…ç½®æ‚¨çš„å®¢æˆ·ç«¯ä»¥ä½¿ç”¨ VPN æœåŠ¡å™¨çš„ DNS è§£æå™¨ã€‚</p>
<h2 id=æ’¤é”€å®¢æˆ·ç«¯è¯ä¹¦>æ’¤é”€å®¢æˆ·ç«¯è¯ä¹¦</h2>
<p>æœ‰æ—¶ï¼Œæ‚¨å¯èƒ½éœ€è¦æ’¤é”€å®¢æˆ·ç«¯è¯ä¹¦ä»¥é˜²æ­¢è¿›ä¸€æ­¥è®¿é—® OpenVPN æœåŠ¡å™¨ã€‚</p>
<h3 id=ca-æœåŠ¡å™¨-3>CA æœåŠ¡å™¨</h3>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cd ~/easy-rsa
./easyrsa revoke client1
</code></pre></td></tr></table>
</div>
</div><p>è¿™å°†è¦æ±‚æ‚¨é€šè¿‡è¾“å…¥ yes æ¥ç¡®è®¤æ’¤é”€:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>Output
Please confirm you wish to revoke the certificate with the following subject:

subject=
    commonName                = client-ccx


Type the word &#39;yes&#39; to continue, or any other input to abort.
  Continue with revocation: yes
Using configuration from /home/sammy/easy-rsa/pki/safessl-easyrsa.cnf
Revoking Certificate D3060496FB55BF756C970DF564AA4C17.
Data Base Updated

IMPORTANT!!!

Revocation was successful. You must run gen-crl and upload a CRL to your
infrastructure in order to prevent the revoked cert from being accepted.
</code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„æ’¤é”€è¯ä¹¦è¡Œä¸Šçªå‡ºæ˜¾ç¤ºçš„å€¼ã€‚æ­¤å€¼æ˜¯è¦æ’¤é”€çš„è¯ä¹¦çš„å”¯ä¸€åºåˆ—å·ã€‚å¦‚æœè¦æ£€æŸ¥æœ¬èŠ‚æœ€åä¸€æ­¥ä¸­çš„æ’¤é”€åˆ—è¡¨ä»¥éªŒè¯è¯ä¹¦æ˜¯å¦åœ¨å…¶ä¸­ï¼Œåˆ™éœ€è¦æ­¤å€¼ã€‚</p>
<p>åœ¨ç¡®è®¤æ“ä½œä¹‹åï¼ŒCA å°†æ’¤é”€è¯ä¹¦ã€‚ä½†æ˜¯ï¼Œä¾èµ– CA çš„è¿œç¨‹ç³»ç»Ÿæ— æ³•æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•è¯ä¹¦è¢«æ’¤é”€ã€‚ç”¨æˆ·å’ŒæœåŠ¡å™¨ä»ç„¶å¯ä»¥ä½¿ç”¨è¯¥è¯ä¹¦ï¼Œç›´è‡³è¯¥è¯ä¹¦çš„è¯ä¹¦åŠé”€åˆ—è¡¨(CRL)åˆ†å‘ç»™æ‰€æœ‰ä¾èµ–è¯¥è¯ä¹¦çš„ç³»ç»Ÿä¸ºæ­¢ã€‚</p>
<p><strong>ç”Ÿæˆä¸€ä¸ªè¯ä¹¦åŠé”€åˆ—è¡¨</strong></p>
<p>åœ¨ ~/easy-rsa ç›®å½•ä¸­ä½¿ç”¨ gen-CRL é€‰é¡¹è¿è¡Œ easy-rsa å‘½ä»¤:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cd ~/easy-rsa
./easyrsa gen-crl
</code></pre></td></tr></table>
</div>
</div><p>å‘é€è¯ä¹¦åŠé”€åˆ—è¡¨</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># scp ~/easy-rsa/pki/crl.pem sammy@your_server_ip:/tmp
scp ~/easy-rsa/pki/crl.pem sammy@123.125.32.26:/tmp
</code></pre></td></tr></table>
</div>
</div><h3 id=openvpn-æœåŠ¡å™¨-13>OpenVPN æœåŠ¡å™¨</h3>
<p>ä½¿ç”¨è¿™äº›è¯´æ˜æ’¤é”€å®¢æˆ·ç«¯è¯ä¹¦åï¼Œæ‚¨éœ€è¦å°†ç”Ÿæˆçš„ crl.pem æ–‡ä»¶å¤åˆ¶åˆ° /etc/openvpn/server ç›®å½•ä¸­çš„ OpenVPN æœåŠ¡å™¨ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo cp /tmp/crl.pem /etc/openvpn/server/
</code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥ï¼Œæ‰“å¼€ OpenVPN æœåŠ¡å™¨é…ç½®æ–‡ä»¶:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo nano /etc/openvpn/server/server.conf
</code></pre></td></tr></table>
</div>
</div><p>åœ¨æ–‡ä»¶åº•éƒ¨ï¼Œæ·»åŠ  crl-verify é€‰é¡¹ï¼Œè¯¥é€‰é¡¹å°†æŒ‡ç¤º OpenVPN æœåŠ¡å™¨åœ¨æ¯æ¬¡å°è¯•è¿æ¥æ—¶æ£€æŸ¥æ‚¨åˆ›å»ºçš„è¯ä¹¦åŠé”€åˆ—è¡¨ï¼š</p>
<p>/etc/openvpn/server/server.conf</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>crl-verify crl.pem
</code></pre></td></tr></table>
</div>
</div><p>ä¿å­˜å¹¶å…³é—­æ–‡ä»¶ã€‚
æœ€åï¼Œé‡æ–°å¯åŠ¨ OpenVPN ä»¥å®ç°è¯ä¹¦æ’¤é”€:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo systemctl restart openvpn-server@server.service
</code></pre></td></tr></table>
</div>
</div><p>å®¢æˆ·ç«¯åº”è¯¥ä¸å†èƒ½å¤Ÿä½¿ç”¨æ—§å‡­æ®æˆåŠŸè¿æ¥åˆ°æœåŠ¡å™¨ã€‚
è¦æ’¤é”€å…¶ä»–å®¢æˆ·ç«¯ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æµç¨‹æ“ä½œï¼š</p>
<ol>
<li>ä½¿ç”¨ ./easyrsa revoke client_name å‘½ä»¤æ’¤é”€è¯ä¹¦</li>
<li>ç”Ÿæˆæ–°çš„ CRL</li>
<li>å°†æ–°çš„ crl.pem æ–‡ä»¶ä¼ è¾“åˆ°æ‚¨çš„ OpenVPN æœåŠ¡å™¨å¹¶å°†å…¶å¤åˆ¶åˆ° /etc/openvpn/server/ ç›®å½•ä»¥è¦†ç›–æ—§åˆ—è¡¨ã€‚</li>
<li>é‡æ–°å¯åŠ¨ OpenVPN æœåŠ¡ã€‚</li>
</ol>
<p>æ‚¨å¯ä»¥ä½¿ç”¨æ­¤è¿‡ç¨‹æ’¤é”€æ‚¨ä¹‹å‰ä¸ºæœåŠ¡å™¨é¢å‘çš„ä»»ä½•è¯ä¹¦ã€‚</p>
<h2 id=é…ç½®æ›´å¤šå®¢æˆ·ç«¯>é…ç½®æ›´å¤šå®¢æˆ·ç«¯</h2>
<p><strong>ä¿®æ”¹ client1 ä¸ºä½ è¦çš„å®¢æˆ·ç«¯åç§°</strong></p>
<h3 id=openvpn-æœåŠ¡å™¨-14>OpenVPN æœåŠ¡å™¨</h3>
<p>åˆ° EasyRSA ç›®å½•å¹¶ easyrsa ä½¿ç”¨gen-req å’Œ nopass é€‰é¡¹ä»¥åŠå®¢æˆ·ç«¯çš„é€šç”¨åç§°è¿è¡Œè„šæœ¬ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cd ~/easy-rsa
./easyrsa gen-req client1 nopass
</code></pre></td></tr></table>
</div>
</div><p>æŒ‰ ENTER ç¡®è®¤å¸¸ç”¨åç§°ã€‚ç„¶åï¼Œå°† client1.key æ–‡ä»¶å¤åˆ¶åˆ° ~/client-configs/keys/ æ‚¨ä¹‹å‰åˆ›å»ºçš„ç›®å½•ä¸­ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cp pki/private/client1.key ~/client-configs/keys/
</code></pre></td></tr></table>
</div>
</div><h3 id=ca-æœåŠ¡å™¨-4>CA æœåŠ¡å™¨</h3>
<p>ç°åœ¨ç™»å½•åˆ°æ‚¨çš„ CA æœåŠ¡å™¨ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œå°† client1.req ä½¿ç”¨å®‰å…¨æ–¹æ³•å°†æ–‡ä»¶ä¼ è¾“åˆ°æ‚¨çš„ CA æœåŠ¡å™¨ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># scp sammy@your_openvpn_server_ip:/home/sammy/easy-rsa/pki/reqs/client1.req /tmp
scp sammy@123.125.32.26:/home/sammy/easy-rsa/pki/reqs/client1.req /tmp
</code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œå¯¼èˆªåˆ° EasyRSA ç›®å½•ï¼Œå¹¶å¯¼å…¥è¯ä¹¦è¯·æ±‚ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cd ~/easy-rsa
./easyrsa import-req /tmp/client1.req client1
./easyrsa sign-req client client1
</code></pre></td></tr></table>
</div>
</div><p>å‡ºç°æç¤ºæ—¶ï¼Œè¾“å…¥ ye sä»¥ç¡®è®¤æ‚¨æ‰“ç®—ç­¾ç½²è¯ä¹¦è¯·æ±‚å¹¶ä¸”å®ƒæ¥è‡ªå—ä¿¡ä»»çš„æ¥æºï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>Output
Note: using Easy-RSA configuration from: ./vars

Using SSL: openssl OpenSSL 1.1.1f  31 Mar 2020


You are about to sign the following certificate.
Please check over the details shown below for accuracy. Note that this request
has not been cryptographically verified. Please be sure it came from a trusted
source or that you have verified the request checksum with the sender.

Request subject, to be signed as a client certificate for 1080 days:

subject=
    commonName                = client1


Type the word &#39;yes&#39; to continue, or any other input to abort.
  Confirm request details: yes
Using configuration from /home/sammy/easy-rsa/pki/safessl-easyrsa.cnf
Check that the request matches the signature
Signature ok
The Subject&#39;s Distinguished Name is as follows
commonName            :ASN.1 12:&#39;client1&#39;
Certificate is to be certified until Jul  6 06:18:09 2025 GMT (1080 days)

Write out database with 1 new entries
Data Base Updated

Certificate created at: /home/sammy/easy-rsa/pki/issued/client1.crt
</code></pre></td></tr></table>
</div>
</div><p>è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸º client1.crt å°†æ­¤æ–‡ä»¶ä¼ è¾“å›æœåŠ¡å™¨ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># scp pki/issued/client1.crt sammy@your_server_ip:/tmp
scp pki/issued/client1.crt sammy@123.125.32.26:/tmp
</code></pre></td></tr></table>
</div>
</div><h3 id=openvpn-æœåŠ¡å™¨-15>OpenVPN æœåŠ¡å™¨</h3>
<p>å›åˆ°æ‚¨çš„ OpenVPN æœåŠ¡å™¨ï¼Œå°†å®¢æˆ·ç«¯è¯ä¹¦å¤åˆ¶åˆ°~/client-configs/keys/ç›®å½•ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cp /tmp/client1.crt ~/client-configs/keys/
</code></pre></td></tr></table>
</div>
</div><p>ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cd ~/client-configs
./make_config.sh client1
</code></pre></td></tr></table>
</div>
</div><p>è¿™å°†<code>client1.ovpn</code>åœ¨æ‚¨çš„<code>~/client-configs/files</code>ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºçš„æ–‡ä»¶ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>ls ~/client-configs/files
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>Output
client1.ovpn
</code></pre></td></tr></table>
</div>
</div><p>æ‚¨éœ€è¦å°†æ­¤æ–‡ä»¶ä¼ è¾“åˆ°æ‚¨è®¡åˆ’ç”¨ä½œå®¢æˆ·ç«¯çš„è®¾å¤‡ã€‚ä¾‹å¦‚ï¼Œè¿™å¯èƒ½æ˜¯æ‚¨çš„æœ¬åœ°è®¡ç®—æœºæˆ–ç§»åŠ¨è®¾å¤‡ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># sftp sammy@openvpn_server_ip:client-configs/files/client1.ovpn ~/
sftp sammy@123.125.32.26:client-configs/files/client1.ovpn ~/
</code></pre></td></tr></table>
</div>
</div><h3 id=å®‰è£…å®¢æˆ·ç«¯é…ç½®-1>å®‰è£…å®¢æˆ·ç«¯é…ç½®</h3>
<p><strong>ç¦»çº¿å®‰è£…</strong></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># ubuntu20.04 ç³»ç»Ÿ
sudo dpkg -i pkg/ubuntu20.04/openvpn_2.4.7-1ubuntu2.20.04.4_amd64.deb
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># redhat8.6 ç³»ç»Ÿ
sudo rpm -i pkg/redhat8.6/pkg/*
</code></pre></td></tr></table>
</div>
</div><p><strong>åœ¨çº¿å®‰è£…</strong></p>
<p>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Linuxï¼Œåˆ™å¯ä»¥æ ¹æ®æ‚¨çš„å‘è¡Œç‰ˆä½¿ç”¨å¤šç§å·¥å…·ã€‚æ‚¨çš„æ¡Œé¢ç¯å¢ƒæˆ–çª—å£ç®¡ç†å™¨å¯èƒ½è¿˜åŒ…æ‹¬è¿æ¥å®ç”¨ç¨‹åºã€‚</p>
<p>ç„¶è€Œï¼Œæœ€é€šç”¨çš„è¿æ¥æ–¹å¼æ˜¯ä½¿ç”¨ OpenVPN è½¯ä»¶ã€‚</p>
<p>åœ¨ Ubuntu æˆ– Debian ä¸Šï¼Œæ‚¨å¯ä»¥åƒåœ¨æœåŠ¡å™¨ä¸Šä¸€æ ·é€šè¿‡é”®å…¥ä»¥ä¸‹å†…å®¹æ¥å®‰è£…å®ƒï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo apt update
sudo apt install openvpn
</code></pre></td></tr></table>
</div>
</div><p>åœ¨ CentOS ä¸Šï¼Œæ‚¨å¯ä»¥å¯ç”¨ EPEL å­˜å‚¨åº“ï¼Œç„¶åé”®å…¥ä»¥ä¸‹å†…å®¹è¿›è¡Œå®‰è£…ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>sudo dnf install epel-release
sudo dnf install openvpn
</code></pre></td></tr></table>
</div>
</div><h4 id=é…ç½®ä½¿ç”¨çš„å®¢æˆ·ç«¯-systemd-resolved-1>é…ç½®ä½¿ç”¨çš„å®¢æˆ·ç«¯ <code>systemd-resolved</code></h4>
<p>é¦–å…ˆ<code>systemd-resolved</code>é€šè¿‡æ£€æŸ¥<code>/etc/resolv.conf</code>æ–‡ä»¶æ¥ç¡®å®šæ‚¨çš„ç³»ç»Ÿæ˜¯å¦ç”¨äºå¤„ç† DNS è§£æï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>cat /etc/resolv.conf
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>Output
# This file is managed by man:systemd-resolved(8). Do not edit.
. . .

nameserver 127.0.0.53
options edns0
</code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ‚¨çš„ç³»ç»Ÿé…ç½®ä¸º<code>systemd-resolved</code>ç”¨äº DNS è§£æï¼Œåˆ™<code>nameserver</code>é€‰é¡¹åé¢çš„ IP åœ°å€å°†ä¸º<code>127.0.0.53</code>. æ–‡ä»¶ä¸­è¿˜åº”è¯¥æœ‰æ³¨é‡Šï¼Œå¦‚æ˜¾ç¤ºçš„è¾“å‡ºï¼Œè§£é‡Šå¦‚ä½•<code>systemd-resolved</code>ç®¡ç†æ–‡ä»¶ã€‚å¦‚æœæ‚¨æœ‰ä¸€ä¸ªä¸åŒçš„ IP åœ°å€ï¼Œ<code>127.0.0.53</code>é‚£ä¹ˆæ‚¨çš„ç³»ç»Ÿå¯èƒ½æ²¡æœ‰ä½¿ç”¨<code>systemd-resolved</code>ï¼Œæ‚¨å¯ä»¥è½¬è‡³ä¸‹ä¸€èŠ‚é…ç½®å…·æœ‰<code>update-resolv-conf</code>è„šæœ¬çš„Linux å®¢æˆ·ç«¯ã€‚</p>
<p>è¦æ”¯æŒè¿™äº›å®¢æˆ·ç«¯ï¼Œè¯·é¦–å…ˆå®‰è£…è¯¥<code>openvpn-systemd-resolved</code>è½¯ä»¶åŒ…ã€‚å®ƒæä¾›äº†å¼ºåˆ¶<code>systemd-resolved</code>ä½¿ç”¨ VPN æœåŠ¡å™¨è¿›è¡Œ DNS è§£æçš„è„šæœ¬ã€‚</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo apt install openvpn-systemd-resolved
</code></pre></td></tr></table>
</div>
</div><p>å®‰è£…è¯¥è½¯ä»¶åŒ…ä¹‹ä¸€ï¼Œé…ç½®å®¢æˆ·ç«¯ä»¥ä½¿ç”¨å®ƒï¼Œå¹¶é€šè¿‡ VPN æ¥å£å‘é€æ‰€æœ‰ DNS æŸ¥è¯¢ã€‚æ‰“å¼€å®¢æˆ·ç«¯çš„ VPN æ–‡ä»¶ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>nano client1.ovpn
</code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨å–æ¶ˆæ³¨é‡Šæ‚¨ä¹‹å‰æ·»åŠ çš„ä»¥ä¸‹å‡ è¡Œï¼š</p>
<p>client1.ovpn</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>script-security 2
up /etc/openvpn/update-systemd-resolved
down /etc/openvpn/update-systemd-resolved
down-pre
dhcp-option DOMAIN-ROUTE .
</code></pre></td></tr></table>
</div>
</div><h4 id=é…ç½®ä½¿ç”¨çš„å®¢æˆ·ç«¯-update-resolv-conf-1>é…ç½®ä½¿ç”¨çš„å®¢æˆ·ç«¯ <code>update-resolv-conf</code></h4>
<p>å¦‚æœæ‚¨çš„ç³»ç»Ÿä¸<code>systemd-resolved</code>ç”¨äºç®¡ç† DNSï¼Œè¯·æ£€æŸ¥æ‚¨çš„å‘è¡Œç‰ˆæ˜¯å¦åŒ…å«<code>/etc/openvpn/update-resolv-conf</code>è„šæœ¬ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>ls /etc/openvpn
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>Output
update-resolv-conf
</code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ‚¨çš„å®¢æˆ·ç«¯åŒ…å«è¯¥<code>update-resolv-conf</code>æ–‡ä»¶ï¼Œè¯·ç¼–è¾‘æ‚¨ä¹‹å‰ä¼ è¾“çš„ OpenVPN å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>nano client1.ovpn
</code></pre></td></tr></table>
</div>
</div><p>å–æ¶ˆæ³¨é‡Šæ‚¨æ·»åŠ çš„ç”¨äºè°ƒæ•´ DNS è®¾ç½®çš„ä¸‰è¡Œï¼š</p>
<p>client1.ovpn</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>script-security 2
up /etc/openvpn/update-resolv-conf
down /etc/openvpn/update-resolv-conf
</code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ‚¨ä½¿ç”¨ CentOSï¼Œè¯·å°†<code>group</code>æŒ‡ä»¤ä»<code>nogroup</code>toæ›´æ”¹<code>nobody</code>ä¸ºåŒ¹é…å‘è¡Œç‰ˆçš„å¯ç”¨ç»„ï¼š</p>
<p>client1.ovpn</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>group nobody
</code></pre></td></tr></table>
</div>
</div><p>ä¿å­˜å¹¶å…³é—­æ–‡ä»¶ã€‚</p>
<p><strong>è¿æ¥</strong></p>
<p>ç°åœ¨ï¼Œæ‚¨åªéœ€å°†<code>openvpn</code>å‘½ä»¤æŒ‡å‘å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶å³å¯è¿æ¥åˆ° VPN ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># å¯åŠ¨å‰æ³¨æ„æ£€æŸ¥ client1.ovpn çš„ 62 è¡Œã€‚åœ¨ Ubuntu ç³»ç»Ÿä¸Šæ˜¯ group nogroupï¼Œåœ¨ CentOS ç³»ç»Ÿä¸Šæ˜¯ group nobody
sudo openvpn --config client1.ovpn
</code></pre></td></tr></table>
</div>
</div><p>è¿™åº”è¯¥å°†æ‚¨è¿æ¥åˆ°æ‚¨çš„ VPNã€‚</p>
<p>**æ³¨æ„ï¼š**å¦‚æœæ‚¨çš„å®¢æˆ·ç«¯ç”¨äº<code>systemd-resolved</code>ç®¡ç† DNSï¼Œè¯·é€šè¿‡è¿è¡Œå¦‚ä¸‹<code>systemd-resolve --status</code>å‘½ä»¤æ£€æŸ¥è®¾ç½®æ˜¯å¦æ­£ç¡®åº”ç”¨ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>systemd-resolve --status tun0
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>Output
Link 22 (tun0)
. . .
         DNS Servers: 208.67.222.222
                      208.67.220.220
          DNS Domain: ~.
</code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ‚¨çœ‹åˆ°æ‚¨åœ¨ OpenVPN æœåŠ¡å™¨ä¸Šé…ç½®çš„ DNS æœåŠ¡å™¨çš„ IP åœ°å€ï¼Œä»¥åŠè¾“å‡ºä¸­<em>DNS åŸŸ</em>çš„<code>~.</code>è®¾ç½®ï¼Œé‚£ä¹ˆæ‚¨å·²æ­£ç¡®é…ç½®æ‚¨çš„å®¢æˆ·ç«¯ä»¥ä½¿ç”¨ VPN æœåŠ¡å™¨çš„ DNS è§£æå™¨ã€‚</p>
<h1 id=å®‰è£…-openvpn-å®¢æˆ·ç«¯é…ç½®>å®‰è£… OpenVPN å®¢æˆ·ç«¯é…ç½®</h1>
<p><strong>ç¦»çº¿å®‰è£…</strong></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo rpm -i pkg/redhat8.6/pkg/*
</code></pre></td></tr></table>
</div>
</div><p>é…ç½®æ–‡ä»¶</p>
<ul>
<li>xxx-master.ovpn: åœ¨ master èŠ‚ç‚¹ä½¿ç”¨ï¼Œä¼šå›ºå®š VPN çš„ IPï¼Œåªèƒ½å•èŠ‚ç‚¹ä½¿ç”¨ã€‚</li>
<li>xxx-worker.ovpn: åœ¨ worker èŠ‚ç‚¹ä½¿ç”¨ï¼Œä¸ä¼šå›ºå®š VPN çš„ IPï¼Œå¯ä»¥å¤šèŠ‚ç‚¹ä½¿ç”¨ã€‚</li>
</ul>
<p><strong>é…ç½®ä½¿ç”¨</strong></p>
<blockquote>
<p>å¦‚æœå®¢æˆ·ç«¯éœ€è¦å›ºå®šç«¯å£çš„æƒ…å†µæ‰æ“ä½œï¼Œä¸€èˆ¬æƒ…å†µå¿½ç•¥ã€‚å›ºå®šå®¢æˆ·ç«¯ç«¯å£ï¼šä¿®æ”¹ xxx.ovpn ç¬¬ 58 è¡Œï¼Œnobind -> port 51194</p>
</blockquote>
<p>è®¾ç½® systemctl ç®¡ç†</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># å¤åˆ¶æ–‡ä»¶
sudo cp xxx.ovpn /etc/openvpn/client/client.conf
# å¼€æœºå¯åŠ¨
systemctl enable openvpn-client@client
# å¯åŠ¨
systemctl start openvpn-client@client
# åœæ­¢
systemctl stop openvpn-client@client
</code></pre></td></tr></table>
</div>
</div><p>æµ‹è¯•</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>systemctl status openvpn-client@client
ping 10.10.0.1
</code></pre></td></tr></table>
</div>
</div><h1 id=å…¶å®ƒè®¾ç½®>å…¶å®ƒè®¾ç½®</h1>
<h2 id=å®¢æˆ·ç«¯å›ºå®šç«¯å£>å®¢æˆ·ç«¯å›ºå®šç«¯å£</h2>
<p>ä¿®æ”¹ client1.ovpn ç¬¬ 58 è¡Œï¼Œnobind -> port 51194</p>
<h2 id=è®¾ç½®-systemctl-å¯åŠ¨>è®¾ç½® systemctl å¯åŠ¨</h2>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo cp client1.ovpn /etc/openvpn/client/client.conf
# å¼€æœºå¯åŠ¨
systemctl enable openvpn-client@client
# å¯åŠ¨
systemctl start openvpn-client@client
# åœæ­¢
systemctl stop openvpn-client@client

# æµ‹è¯•
systemctl status openvpn-client@client
ping 10.8.0.1
</code></pre></td></tr></table>
</div>
</div><h2 id=å›ºå®šå®¢æˆ·ç«¯-ip>å›ºå®šå®¢æˆ·ç«¯ IP</h2>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># openvpn æœåŠ¡å™¨
vi /etc/openvpn/server/server.conf
# æ·»åŠ ä¸€è¡Œ
client-config-dir /etc/openvpn/ccd
</code></pre></td></tr></table>
</div>
</div><p>åœ¨ /etc/openvpn/ccd åˆ›å»ºæ–‡ä»¶ï¼Œæ–‡ä»¶åä¸ºå®¢æˆ·ç«¯çš„ CN åç§°ï¼Œå†…å®¹ä¸º<code>ifconfig-push ${IP} ${NETMASK}</code></p>
<p>æ ·ä¾‹ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sammy@OpenVPN:/etc/openvpn/ccd$ ll
total 12
drwxr-xr-x 2 root root 4096 Aug 22 15:50 ./
drwxr-xr-x 5 root root 4096 Aug 22 15:19 ../
-rw-r--r-- 1 root root   35 Aug 22 15:50 tx-cjx-master
sammy@OpenVPN:/etc/openvpn/ccd$ cat tx-cjx-master 
ifconfig-push 10.8.0.100 10.8.0.99
</code></pre></td></tr></table>
</div>
</div><h3 id=æ•ˆæœ>æ•ˆæœ</h3>
<p>åœ¨å¼€å¯äº†å…è®¸å®¢æˆ·ç«¯è¯ä¹¦å¤ç”¨çš„æƒ…å†µä¸‹ã€‚å›ºå®šäº† IP çš„è¯ä¹¦è¢«é‡å¤ä½¿ç”¨æ—¶ï¼Œåªæœ‰æœ€åä¸€ä¸ªä½¿ç”¨è€…å¯ä»¥è¿æ¥åˆ°æœåŠ¡å™¨ï¼ŒIP å›ºå®šã€‚
æœªå›ºå®š IP çš„è¯ä¹¦å¯ä»¥æ­£å¸¸å¤ç”¨ã€‚</p>
<h1 id=å®‰è£…-openvpn-å®¢æˆ·ç«¯é…ç½®-1>å®‰è£… OpenVPN å®¢æˆ·ç«¯é…ç½®</h1>
<p><strong>ç¦»çº¿å®‰è£…</strong></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo rpm -i pkg/redhat8.6/pkg/*
</code></pre></td></tr></table>
</div>
</div><p>é…ç½®æ–‡ä»¶</p>
<ul>
<li>xxx-master.ovpn: åœ¨ master èŠ‚ç‚¹ä½¿ç”¨ï¼Œä¼šå›ºå®š VPN çš„ IPï¼Œåªèƒ½å•èŠ‚ç‚¹ä½¿ç”¨ã€‚</li>
<li>xxx-worker.ovpn: åœ¨ worker èŠ‚ç‚¹ä½¿ç”¨ï¼Œä¸ä¼šå›ºå®š VPN çš„ IPï¼Œå¯ä»¥å¤šèŠ‚ç‚¹ä½¿ç”¨ã€‚</li>
</ul>
<p><strong>é…ç½®ä½¿ç”¨</strong></p>
<blockquote>
<p>å¦‚æœå®¢æˆ·ç«¯éœ€è¦å›ºå®šç«¯å£çš„æƒ…å†µæ‰æ“ä½œï¼Œä¸€èˆ¬æƒ…å†µå¿½ç•¥ã€‚å›ºå®šå®¢æˆ·ç«¯ç«¯å£ï¼šä¿®æ”¹ xxx.ovpn ç¬¬ 58 è¡Œï¼Œnobind -> port 51194</p>
</blockquote>
<p>è®¾ç½® systemctl ç®¡ç†</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># å¤åˆ¶æ–‡ä»¶
sudo cp xxx.ovpn /etc/openvpn/client/client.conf
# å¼€æœºå¯åŠ¨
systemctl enable openvpn-client@client
# å¯åŠ¨
systemctl start openvpn-client@client
# åœæ­¢
systemctl stop openvpn-client@client
</code></pre></td></tr></table>
</div>
</div><p>æµ‹è¯•</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>systemctl status openvpn-client@client
ping 10.10.0.1
</code></pre></td></tr></table>
</div>
</div>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/blog/tags/%E7%BD%91%E7%BB%9C/>ç½‘ç»œ</a>
<a href=/blog/tags/openvpn/>openVPN</a>
</section>
<section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
</footer>
</article>
<aside class=related-content--wrapper>
<h2 class=section-title>ç›¸å…³æ–‡ç« </h2>
<div class=related-content>
<div class="flex article-list--tile">
<article>
<a href=/blog/p/%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0-0001/>
<div class=article-details>
<h2 class=article-title>ç½‘ç»œå­¦ä¹ -0001</h2>
</div>
</a>
</article>
<article>
<a href=/blog/p/%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0-0001/>
<div class=article-details>
<h2 class=article-title>ç½‘ç»œå­¦ä¹ -0001</h2>
</div>
</a>
</article>
<article>
<a href=/blog/p/%E7%BD%91%E7%BB%9C%E9%97%AE%E9%A2%98/>
<div class=article-details>
<h2 class=article-title>ç½‘ç»œé—®é¢˜</h2>
</div>
</a>
</article>
<article>
<a href=/blog/p/iptables/>
<div class=article-details>
<h2 class=article-title>iptables</h2>
</div>
</a>
</article>
<article>
<a href=/blog/p/ip-netns-ling/>
<div class=article-details>
<h2 class=article-title>ip-netns-ling</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<div class=disqus-container>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//hugo-theme-stack.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
<style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style>
<script>window.addEventListener('onColorSchemeChange',a=>{typeof DISQUS=='object'&&DISQUS.reset({reload:!0})})</script>
<footer class=site-footer>
<section class=copyright>
&copy;
2020 -
2022 æˆ‘çš„ç©ºé—´
</section>
<section class=powerby>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.13.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡
<br><a href=https://beian.miit.gov.cn/ target=_blank>ç²¤ICPå¤‡19123935å·</a>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous>
</main>
<aside class="sidebar right-sidebar sticky">
<section class="widget archives">
<div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
</div>
<h2 class="widget-title section-title">ç›®å½•</h2>
<div class=widget--toc>
<nav id=TableOfContents>
<ol>
<li><a href=#åˆå§‹æœåŠ¡å™¨è®¾ç½®>åˆå§‹æœåŠ¡å™¨è®¾ç½®</a>
<ol>
<li><a href=#openvpn-æœåŠ¡å™¨>OpenVPN æœåŠ¡å™¨</a>
<ol>
<li><a href=#åˆ›å»ºæ–°ç”¨æˆ·>åˆ›å»ºæ–°ç”¨æˆ·</a></li>
</ol>
</li>
<li><a href=#ca-æœåŠ¡å™¨>CA æœåŠ¡å™¨</a>
<ol>
<li><a href=#åˆ›å»ºæ–°ç”¨æˆ·-1>åˆ›å»ºæ–°ç”¨æˆ·</a></li>
<li><a href=#å®‰è£…-easy-rsa>å®‰è£… Easy-RSA</a></li>
<li><a href=#åˆ›å»ºå…¬å¼€å¯†ç åŒ™åŸºç¡€å»ºè®¾ç›®å½•>åˆ›å»ºå…¬å¼€å¯†ç åŒ™åŸºç¡€å»ºè®¾ç›®å½•</a></li>
<li><a href=#åˆ›å»ºè¯ä¹¦é¢å‘æœºæ„>åˆ›å»ºè¯ä¹¦é¢å‘æœºæ„</a></li>
</ol>
</li>
</ol>
</li>
<li><a href=#å®‰è£…-openvpn-å’Œ-easy-rsa>å®‰è£… OpenVPN å’Œ Easy-RSA</a>
<ol>
<li><a href=#openvpn-æœåŠ¡å™¨-1>OpenVPN æœåŠ¡å™¨</a></li>
</ol>
</li>
<li><a href=#ä¸º-openvpn-åˆ›å»º-pki>ä¸º OpenVPN åˆ›å»º PKI</a>
<ol>
<li><a href=#openvpn-æœåŠ¡å™¨-2>OpenVPN æœåŠ¡å™¨</a></li>
</ol>
</li>
<li><a href=#åˆ›å»º-openvpn-æœåŠ¡å™¨è¯ä¹¦è¯·æ±‚å’Œç§é’¥>åˆ›å»º OpenVPN æœåŠ¡å™¨è¯ä¹¦è¯·æ±‚å’Œç§é’¥</a>
<ol>
<li><a href=#openvpn-æœåŠ¡å™¨-3>OpenVPN æœåŠ¡å™¨</a></li>
</ol>
</li>
<li><a href=#ç­¾ç½²-openvpn-æœåŠ¡å™¨çš„è¯ä¹¦è¯·æ±‚>ç­¾ç½² OpenVPN æœåŠ¡å™¨çš„è¯ä¹¦è¯·æ±‚</a>
<ol>
<li><a href=#ca-æœåŠ¡å™¨-1>CA æœåŠ¡å™¨</a></li>
<li><a href=#openvpn-æœåŠ¡å™¨-4>OpenVPN æœåŠ¡å™¨</a></li>
</ol>
</li>
<li><a href=#é…ç½®-openvpn-åŠ å¯†ææ–™>é…ç½® OpenVPN åŠ å¯†ææ–™</a>
<ol>
<li><a href=#openvpn-æœåŠ¡å™¨-5>OpenVPN æœåŠ¡å™¨</a></li>
</ol>
</li>
<li><a href=#ç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦å’Œå¯†é’¥å¯¹>ç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦å’Œå¯†é’¥å¯¹</a>
<ol>
<li><a href=#openvpn-æœåŠ¡å™¨-6>OpenVPN æœåŠ¡å™¨</a></li>
<li><a href=#ca-æœåŠ¡å™¨-2>CA æœåŠ¡å™¨</a></li>
<li><a href=#openvpn-æœåŠ¡å™¨-7>OpenVPN æœåŠ¡å™¨</a></li>
</ol>
</li>
<li><a href=#é…ç½®-openvpn>é…ç½® OpenVPN</a>
<ol>
<li><a href=#openvpn-æœåŠ¡å™¨-8>OpenVPN æœåŠ¡å™¨</a></li>
</ol>
</li>
<li><a href=#è°ƒæ•´-openvpn-æœåŠ¡å™¨ç½‘ç»œé…ç½®>è°ƒæ•´ OpenVPN æœåŠ¡å™¨ç½‘ç»œé…ç½®</a>
<ol>
<li><a href=#openvpn-æœåŠ¡å™¨-9>OpenVPN æœåŠ¡å™¨</a></li>
</ol>
</li>
<li><a href=#é˜²ç«å¢™é…ç½®æœªå¼€å¯é˜²ç«å¢™å¯ä»¥è·³è¿‡>é˜²ç«å¢™é…ç½®(æœªå¼€å¯é˜²ç«å¢™å¯ä»¥è·³è¿‡)</a>
<ol>
<li><a href=#openvpn-æœåŠ¡å™¨-10>OpenVPN æœåŠ¡å™¨</a></li>
</ol>
</li>
<li><a href=#å¯åŠ¨-openvpn>å¯åŠ¨ OpenVPN</a>
<ol>
<li><a href=#openvpn-æœåŠ¡å™¨-11>OpenVPN æœåŠ¡å™¨</a></li>
</ol>
</li>
<li><a href=#åˆ›å»ºå®¢æˆ·ç«¯é…ç½®åŸºç¡€æ¶æ„æ— ç‰¹æ®Šéœ€æ±‚å¯ä»¥è·³è¿‡>åˆ›å»ºå®¢æˆ·ç«¯é…ç½®åŸºç¡€æ¶æ„(æ— ç‰¹æ®Šéœ€æ±‚å¯ä»¥è·³è¿‡)</a>
<ol>
<li><a href=#openvpn-æœåŠ¡å™¨-12>OpenVPN æœåŠ¡å™¨</a></li>
</ol>
</li>
<li><a href=#ç”Ÿæˆå®¢æˆ·ç«¯é…ç½®>ç”Ÿæˆå®¢æˆ·ç«¯é…ç½®</a></li>
<li><a href=#å®‰è£…å®¢æˆ·ç«¯é…ç½®>å®‰è£…å®¢æˆ·ç«¯é…ç½®</a>
<ol>
<li>
<ol>
<li><a href=#é…ç½®ä½¿ç”¨çš„å®¢æˆ·ç«¯-systemd-resolved>é…ç½®ä½¿ç”¨çš„å®¢æˆ·ç«¯ <code>systemd-resolved</code></a></li>
<li><a href=#é…ç½®ä½¿ç”¨çš„å®¢æˆ·ç«¯-update-resolv-conf>é…ç½®ä½¿ç”¨çš„å®¢æˆ·ç«¯ <code>update-resolv-conf</code></a></li>
</ol>
</li>
</ol>
</li>
<li><a href=#æ’¤é”€å®¢æˆ·ç«¯è¯ä¹¦>æ’¤é”€å®¢æˆ·ç«¯è¯ä¹¦</a>
<ol>
<li><a href=#ca-æœåŠ¡å™¨-3>CA æœåŠ¡å™¨</a></li>
<li><a href=#openvpn-æœåŠ¡å™¨-13>OpenVPN æœåŠ¡å™¨</a></li>
</ol>
</li>
<li><a href=#é…ç½®æ›´å¤šå®¢æˆ·ç«¯>é…ç½®æ›´å¤šå®¢æˆ·ç«¯</a>
<ol>
<li><a href=#openvpn-æœåŠ¡å™¨-14>OpenVPN æœåŠ¡å™¨</a></li>
<li><a href=#ca-æœåŠ¡å™¨-4>CA æœåŠ¡å™¨</a></li>
<li><a href=#openvpn-æœåŠ¡å™¨-15>OpenVPN æœåŠ¡å™¨</a></li>
<li><a href=#å®‰è£…å®¢æˆ·ç«¯é…ç½®-1>å®‰è£…å®¢æˆ·ç«¯é…ç½®</a>
<ol>
<li><a href=#é…ç½®ä½¿ç”¨çš„å®¢æˆ·ç«¯-systemd-resolved-1>é…ç½®ä½¿ç”¨çš„å®¢æˆ·ç«¯ <code>systemd-resolved</code></a></li>
<li><a href=#é…ç½®ä½¿ç”¨çš„å®¢æˆ·ç«¯-update-resolv-conf-1>é…ç½®ä½¿ç”¨çš„å®¢æˆ·ç«¯ <code>update-resolv-conf</code></a></li>
</ol>
</li>
</ol>
</li>
</ol>
<ol>
<li><a href=#å®¢æˆ·ç«¯å›ºå®šç«¯å£>å®¢æˆ·ç«¯å›ºå®šç«¯å£</a></li>
<li><a href=#è®¾ç½®-systemctl-å¯åŠ¨>è®¾ç½® systemctl å¯åŠ¨</a></li>
<li><a href=#å›ºå®šå®¢æˆ·ç«¯-ip>å›ºå®šå®¢æˆ·ç«¯ IP</a>
<ol>
<li><a href=#æ•ˆæœ>æ•ˆæœ</a></li>
</ol>
</li>
</ol>
</nav>
</div>
</section>
</aside>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/blog/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>