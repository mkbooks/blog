<!doctype html><html lang=en-us dir=ltr>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="kubernetes-docker"><title>kubernetes</title>
<link rel=canonical href=https://mkbooks.github.io/blog/p/kubernetes/>
<link rel=stylesheet href=/blog/scss/style.min.ac77dcf8b111b51da39a92990f431923f210f3876d85798a2125667f96dc33a4.css><meta property="og:title" content="kubernetes">
<meta property="og:description" content="kubernetes-docker">
<meta property="og:url" content="https://mkbooks.github.io/blog/p/kubernetes/">
<meta property="og:site_name" content="æˆ‘çš„ç©ºé—´">
<meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="kubernetes"><meta property="article:tag" content="äº‘åŸç”Ÿ"><meta property="article:published_time" content="2024-07-18T23:01:00+08:00"><meta property="article:modified_time" content="2024-07-18T23:01:00+08:00">
<meta name=twitter:title content="kubernetes">
<meta name=twitter:description content="kubernetes-docker">
<link rel="shortcut icon" href=https://chenjinxin.cn/images/favicon.png>
</head>
<body class=article-page>
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky">
<button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box>
<span class=hamburger-inner></span>
</span>
</button>
<header>
<figure class=site-avatar>
<a href=/blog/>
<img src=/blog/img/1_hu8b5a3db4a21c8e092ed8817bbbdf793a_61250_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a>
<span class=emoji>ğŸ¥</span>
</figure>
<div class=site-meta>
<h1 class=site-name><a href=/blog>æˆ‘çš„ç©ºé—´</a></h1>
<h2 class=site-description>å¸¸é¦™ç‰&é™ˆé‡‘é‘«.</h2>
</div>
</header><ol class=social-menu>
<li>
<a href=https://github.com/chenjinxin1124 target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg>
</a>
</li>
</ol><ol class=menu id=main-menu>
<li>
<a href=/blog/blog/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span>
</a>
</li>
<li>
<a href=/blog/blog/%E5%85%B3%E4%BA%8E/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>å…³äº</span>
</a>
</li>
<li>
<a href=/blog/blog/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span>
</a>
</li>
<li>
<a href=/blog/blog/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span>
</a>
</li>
<li>
<a href=/blog/blog/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span>
</a>
</li>
<div class=menu-bottom-section>
<li id=i18n-switch><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://mkbooks.github.io/blog/en/>English</option><option value=https://mkbooks.github.io/blog/ selected>ä¸­æ–‡</option></select>
</li>
<li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span>
</li>
</div>
</ol>
</aside>
<main class="main full-width">
<article class=main-article>
<header class=article-header>
<div class=article-details>
<header class=article-category>
<a href=/blog/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/>
äº‘åŸç”Ÿ
</a>
</header>
<div class=article-title-wrapper>
<h2 class=article-title>
<a href=/blog/p/kubernetes/>kubernetes</a>
</h2>
<h3 class=article-subtitle>
kubernetes-docker
</h3>
</div>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jul 18, 2024</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
é˜…è¯»æ—¶é•¿: 13 åˆ†é’Ÿ
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<h2 id=äº‘åŸç”Ÿ>äº‘åŸç”Ÿ</h2>
<p>äº‘ï¼šæŠ½è±¡çš„è®¡ç®—èµ„æºï¼ˆè®¡ç®—èµ„æºæ± : å…¬æœ‰äº‘ã€ç§æœ‰äº‘ã€æ··åˆäº‘ï¼‰</p>
<p>äº‘åŸç”Ÿçš„åŸºæœ¬æ€æƒ³ï¼š
0. åŸºç¡€æ¶æ„å³ä»£ç ï¼ŒGitOps: äº‘åŸç”Ÿä¸­ç®¡ç†çš„ä¸€åˆ‡å¯¹è±¡éƒ½ç”¨gitçš„æ–¹å¼ä»¥æºä»£ç çš„å½¢å¼ç®¡ç†èµ·æ¥ï¼Œåšåˆ°ç»å¯¹çš„å¯è¿½æº¯ã€‚</p>
<ol>
<li>åŠ¨æ€ç¯å¢ƒï¼ˆäº‘èµ„æºä¸€ä½“ï¼Œä¸å…³å¿ƒæ˜¯å“ªæ¥çš„èµ„æºï¼‰</li>
<li>è‡ªåŠ¨åŒ–ï¼ˆå£°æ˜å¼APIï¼Œæœ€ç»ˆä¸€è‡´æ€§ï¼‰</li>
<li>DevOps
<ol>
<li>CI/CDï¼ˆæµæ°´çº¿å¯¹æ¥äº‘æœåŠ¡ï¼‰</li>
</ol>
</li>
<li>&mldr;&mldr;</li>
</ol>
<h2 id=kubernetes>kubernetes</h2>
<blockquote>
<p>äº‘ç”Ÿæ€çš„æ ¸å¿ƒç»„ä»¶</p>
</blockquote>
<p>Kubernetesï¼ˆç®€ç§°K8sï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„<strong>å®¹å™¨ç¼–æ’</strong>å¹³å°ï¼Œç”¨äºè‡ªåŠ¨åŒ–éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨ç¨‹åºã€‚</p>
<h3 id=å®¹å™¨æŠ€æœ¯>å®¹å™¨æŠ€æœ¯</h3>
<ol>
<li>Namespace: è¿›ç¨‹éš”ç¦»
<ol>
<li>PIDï¼ˆProcess IDï¼‰å‘½åç©ºé—´ï¼šéš”ç¦»è¿›ç¨‹IDï¼Œæ¯ä¸ªå®¹å™¨å¯ä»¥æœ‰è‡ªå·±çš„è¿›ç¨‹ç¼–å·ã€‚</li>
<li>ç½‘ç»œï¼ˆNetworkï¼‰å‘½åç©ºé—´ï¼šéš”ç¦»ç½‘ç»œæ¥å£ï¼Œå®¹å™¨å†…çš„åº”ç”¨çœ‹åˆ°çš„åªæ˜¯å®¹å™¨å†…çš„ç½‘ç»œç¯å¢ƒã€‚</li>
<li>æŒ‚è½½ï¼ˆMountï¼‰å‘½åç©ºé—´ï¼šéš”ç¦»æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹ï¼Œæ¯ä¸ªå®¹å™¨å¯ä»¥æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿå¸ƒå±€ã€‚</li>
<li>IPCï¼ˆInter-Process Communicationï¼‰å‘½åç©ºé—´ï¼šéš”ç¦»è¿›ç¨‹é—´é€šä¿¡èµ„æºï¼Œä¾‹å¦‚ä¿¡å·é‡å’Œæ¶ˆæ¯é˜Ÿåˆ—ã€‚</li>
<li>UTSï¼ˆUnix Timesharing Systemï¼‰å‘½åç©ºé—´ï¼šéš”ç¦»ä¸»æœºåå’ŒåŸŸåï¼Œå®¹å™¨å¯ä»¥æœ‰è‡ªå·±çš„ä¸»æœºåã€‚</li>
<li>ç”¨æˆ·ï¼ˆUserï¼‰å‘½åç©ºé—´ï¼šéš”ç¦»ç”¨æˆ·IDå’Œç»„IDï¼Œå®¹å™¨å†…çš„rootå¯ä»¥ä¸å®¿ä¸»æœºçš„rootæœ‰ä¸åŒçš„æƒé™ã€‚</li>
</ol>
</li>
<li>Cgroupï¼šèµ„æºç®¡æ§
<ol>
<li>CPU</li>
<li>å†…å­˜</li>
<li>ç¡¬ç›˜ I/O</li>
</ol>
</li>
<li>UnionFSï¼šæ–‡ä»¶ç³»ç»ŸæœåŠ¡</li>
</ol>
<h3 id=å®¹å™¨æŠ€æœ¯è§£å†³äº†å“ªäº›é—®é¢˜>å®¹å™¨æŠ€æœ¯è§£å†³äº†å“ªäº›é—®é¢˜</h3>
<h4 id=1-ç¯å¢ƒä¸€è‡´æ€§é—®é¢˜>1. ç¯å¢ƒä¸€è‡´æ€§é—®é¢˜</h4>
<p>å®¹å™¨ç¡®ä¿äº†ä»å¼€å‘åˆ°æµ‹è¯•å†åˆ°ç”Ÿäº§çš„ç¯å¢ƒä¸€è‡´æ€§ã€‚è¿™è§£å†³äº†â€œåœ¨æˆ‘çš„æœºå™¨ä¸Šè¿è¡Œæ­£å¸¸â€è¿™ç±»é—®é¢˜ï¼Œå› ä¸ºå®¹å™¨ä¸ºåº”ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ªéš”ç¦»çš„ã€ä¸€è‡´çš„è¿è¡Œç¯å¢ƒï¼ŒåŒ…æ‹¬ç›¸åŒçš„è½¯ä»¶ã€é…ç½®å’Œä¾èµ–ã€‚</p>
<h4 id=2-é…ç½®ç®¡ç†é—®é¢˜>2. é…ç½®ç®¡ç†é—®é¢˜</h4>
<p>å®¹å™¨é€šè¿‡å°†åº”ç”¨ç¨‹åºåŠå…¶å…¨éƒ¨ä¾èµ–æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œç®€åŒ–äº†é…ç½®ç®¡ç†ã€‚è¿™æ„å‘³ç€å¼€å‘è€…ä¸éœ€è¦åœ¨æ¯ä¸ªç¯å¢ƒä¸­é‡æ–°é…ç½®åº”ç”¨ç¨‹åºï¼Œå¯ä»¥é¿å…å› é…ç½®å·®å¼‚å¯¼è‡´çš„é”™è¯¯ã€‚</p>
<h4 id=3-å…¼å®¹æ€§å’Œä¾èµ–é—®é¢˜>3. å…¼å®¹æ€§å’Œä¾èµ–é—®é¢˜</h4>
<p>é€šè¿‡ä½¿ç”¨å®¹å™¨ï¼Œå¼€å‘è€…å¯ä»¥æ‰“åŒ…åº”ç”¨ç¨‹åºæ‰€éœ€çš„åº“ã€å·¥å…·å’Œè¿è¡Œæ—¶ç¯å¢ƒï¼Œé¿å…äº†è½¯ä»¶åœ¨ä¸åŒç³»ç»Ÿç¯å¢ƒä¸‹è¿è¡Œæ—¶å¯èƒ½é‡åˆ°çš„å…¼å®¹æ€§å’Œä¾èµ–é—®é¢˜ã€‚</p>
<h4 id=4-å¿«é€Ÿéƒ¨ç½²å’Œæ‰©å±•>4. å¿«é€Ÿéƒ¨ç½²å’Œæ‰©å±•</h4>
<p>å®¹å™¨çš„è½»é‡çº§ç‰¹æ€§ä½¿å¾—å¯åŠ¨é€Ÿåº¦éå¸¸å¿«ï¼Œå‡ ä¹å¯ä»¥å®ç°ç§’çº§éƒ¨ç½²ã€‚è¿™å¯¹äºéœ€è¦å¿«é€Ÿæ‰©å±•çš„æœåŠ¡å°¤å…¶é‡è¦ã€‚å®¹å™¨è¿˜æ”¯æŒè‡ªåŠ¨åŒ–çš„éƒ¨ç½²å’Œæ‰©å±•ï¼Œä½¿å¾—ç®¡ç†å¤§è§„æ¨¡åº”ç”¨ç¨‹åºå˜å¾—æ›´åŠ å®¹æ˜“ã€‚</p>
<h4 id=5-èµ„æºåˆ©ç”¨å’Œéš”ç¦»>5. èµ„æºåˆ©ç”¨å’Œéš”ç¦»</h4>
<p>å®¹å™¨åœ¨æ“ä½œç³»ç»Ÿçº§åˆ«è¿›è¡Œèµ„æºéš”ç¦»ï¼Œä½¿å¾—æ¯ä¸ªå®¹å™¨éƒ½è¿è¡Œåœ¨æŒ‡å®šçš„èµ„æºé™åˆ¶ä¹‹å†…ï¼Œè€Œä¸ä¼šå¹²æ‰°å…¶ä»–å®¹å™¨ã€‚åŒæ—¶ï¼Œå®¹å™¨å…±äº«åŒä¸€ä¸ªæ“ä½œç³»ç»Ÿæ ¸å¿ƒï¼Œä¸ä¼ ç»Ÿçš„è™šæ‹Ÿæœºç›¸æ¯”ï¼Œèƒ½æ›´æœ‰æ•ˆåœ°åˆ©ç”¨ç‰©ç†èµ„æºã€‚</p>
<h4 id=6-ç§»æ¤æ€§é—®é¢˜>6. ç§»æ¤æ€§é—®é¢˜</h4>
<p>å®¹å™¨æŠ€æœ¯æé«˜äº†åº”ç”¨ç¨‹åºçš„ç§»æ¤æ€§ã€‚ç”±äºå®¹å™¨åœ¨ä»»ä½•æ”¯æŒå®¹å™¨è¿è¡Œæ—¶çš„ç³»ç»Ÿä¸Šéƒ½èƒ½è¿è¡Œï¼Œè¿™ä½¿å¾—ä»ä¸€ä¸ªç¯å¢ƒè¿ç§»åˆ°å¦ä¸€ä¸ªç¯å¢ƒï¼ˆå¦‚ä»ç‰©ç†æœºåˆ°äº‘å¹³å°ï¼‰å˜å¾—ç®€å•å’Œå¯é ã€‚</p>
<h4 id=7-æŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜cicd>7. æŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜ï¼ˆCI/CDï¼‰</h4>
<p>å®¹å™¨éå¸¸é€‚åˆå®ç°è‡ªåŠ¨åŒ–çš„æŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜æµç¨‹ã€‚å¼€å‘è€…å¯ä»¥å¿«é€Ÿæ„å»ºå’Œå›æ»šåº”ç”¨ç¨‹åºç‰ˆæœ¬ï¼Œå®ç°é«˜é¢‘ç‡çš„æ›´æ–°å’Œéƒ¨ç½²ï¼Œè€Œä¸å½±å“ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚</p>
<h4 id=8-é™ä½å¼€å‘ä¸è¿ç»´devopsçš„éšœç¢>8. é™ä½å¼€å‘ä¸è¿ç»´ï¼ˆDevOpsï¼‰çš„éšœç¢</h4>
<p>å®¹å™¨åŒ–é¼“åŠ±é‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œæ¯ä¸ªæœåŠ¡å¯ä»¥ç‹¬ç«‹å¼€å‘ã€éƒ¨ç½²å’Œæ‰©å±•ã€‚è¿™é™ä½äº†å›¢é˜Ÿé—´çš„åè°ƒå¤æ‚æ€§ï¼ŒåŠ é€Ÿäº†å¼€å‘æµç¨‹ï¼Œä½¿å¼€å‘å’Œè¿ç»´æ›´åŠ ç´§å¯†åœ°åˆä½œã€‚</p>
<p><img src=https://mkbooks.github.io/k8s-001/2/1/images/%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%92%8C%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%80%81%E7%9A%84%E5%AF%B9%E6%AF%94-%E8%99%9A%E6%8B%9F%E6%9C%BA.png loading=lazy alt=è™šæ‹Ÿæœºå’Œå®¹å™¨è¿è¡Œæ€çš„å¯¹æ¯”></p>
<p><img src=https://mkbooks.github.io/k8s-001/2/1/images/%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%92%8C%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%80%81%E7%9A%84%E5%AF%B9%E6%AF%94-%E5%AE%B9%E5%99%A8.png loading=lazy alt=è™šæ‹Ÿæœºå’Œå®¹å™¨è¿è¡Œæ€çš„å¯¹æ¯”></p>
<h2 id=docker>docker</h2>
<h3 id=å®‰è£…>å®‰è£…</h3>
<p>åœ¨ ubuntu ä¸Šå®‰è£… Docker è¿è¡Œæ—¶ï¼Œå‚è€ƒ <a class=link href=https://docs.docker.com/engine/install/ubuntu/ target=_blank rel=noopener>https://docs.docker.com/engine/install/ubuntu/</a></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>$ sudo apt-get update
$ sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg-agent \
    software-properties-common
$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
$ sudo add-apt-repository \
    &#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu \
    $(lsb_release -cs) \
    stable&#34;
$ sudo apt-get update
$ sudo apt-get install docker-ce docker-ce-cli containerd.io
</code></pre></td></tr></table>
</div>
</div><h3 id=æ“ä½œ>æ“ä½œ</h3>
<p>å¯åŠ¨ï¼š</p>
<ul>
<li>docker run
<ul>
<li>-it äº¤äº’</li>
<li>-d åå°è¿è¡Œ</li>
<li>-p ç«¯å£æ˜ å°„</li>
<li>-v ç£ç›˜æŒ‚è½½</li>
</ul>
</li>
<li>å¯åŠ¨å·²ç»ˆæ­¢å®¹å™¨
<ul>
<li>docker start</li>
</ul>
</li>
<li>åœæ­¢å®¹å™¨
<ul>
<li>docker stop</li>
</ul>
</li>
<li>æŸ¥çœ‹å®¹å™¨è¿›ç¨‹
<ul>
<li>docker ps</li>
</ul>
</li>
<li>æŸ¥çœ‹å®¹å™¨ç»†èŠ‚ï¼š
<ul>
<li>docker inspect &lt;containerid></li>
</ul>
</li>
<li>è¿›å…¥å®¹å™¨ï¼›
<ul>
<li>docker exec -it &lt;containerid> bash</li>
</ul>
</li>
<li>Docker attachï¼š
<ul>
<li>é€šè¿‡ nsenter</li>
<li>PID=$(docker inspect &ndash;format &ldquo;{{ .State.Pid }}&rdquo; &lt;container>)</li>
<li>$ nsenter &ndash;target $PID &ndash;mount &ndash;uts &ndash;ipc &ndash;net &ndash;pid</li>
</ul>
</li>
<li>æ‹·è´æ–‡ä»¶è‡³å®¹å™¨å†…ï¼š
<ul>
<li>docker cp file1 &lt;containerid>:/file-to-path</li>
</ul>
</li>
</ul>
<h3 id=demo>Demo</h3>
<p>ä»£ç : main.go</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=kn>package</span> <span class=nx>main</span>

<span class=kn>import</span> <span class=p>(</span>
	<span class=s>&#34;fmt&#34;</span>
	<span class=s>&#34;os&#34;</span>

	<span class=s>&#34;github.com/gin-gonic/gin&#34;</span>
	<span class=s>&#34;github.com/thinkeridea/go-extend/exnet&#34;</span>
<span class=p>)</span>

<span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
	<span class=nx>r</span> <span class=o>:=</span> <span class=nx>gin</span><span class=p>.</span><span class=nf>Default</span><span class=p>()</span>
	<span class=nx>r</span><span class=p>.</span><span class=nf>GET</span><span class=p>(</span><span class=s>&#34;/healthz&#34;</span><span class=p>,</span> <span class=nx>healthHandler</span><span class=p>)</span>
	<span class=c1>// listen and serve on 0.0.0.0:8080
</span><span class=c1></span>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>Run</span><span class=p>();</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
	<span class=p>}</span>
<span class=p>}</span>

<span class=c1>// healthHandler healthcheckå®ç°, curl -v localhost:8080/healthz -H &#34;ttt:yyy&#34;
</span><span class=c1></span><span class=kd>func</span> <span class=nf>healthHandler</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>

	<span class=c1>// éå†requestçš„headerå¹¶å¾ªç¯å†™å…¥response header
</span><span class=c1></span>	<span class=k>for</span> <span class=nx>k</span><span class=p>,</span> <span class=nx>v</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>c</span><span class=p>.</span><span class=nx>Request</span><span class=p>.</span><span class=nx>Header</span> <span class=p>{</span>
		<span class=nx>c</span><span class=p>.</span><span class=nx>Writer</span><span class=p>.</span><span class=nf>Header</span><span class=p>().</span><span class=nf>Set</span><span class=p>(</span><span class=nx>k</span><span class=p>,</span> <span class=nx>v</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
	<span class=p>}</span>

	<span class=c1>// è·å–ç¯å¢ƒå˜é‡VERSIONå¹¶å†™å…¥reponse header
</span><span class=c1></span>	<span class=nx>c</span><span class=p>.</span><span class=nx>Writer</span><span class=p>.</span><span class=nf>Header</span><span class=p>().</span><span class=nf>Set</span><span class=p>(</span><span class=s>&#34;version&#34;</span><span class=p>,</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Getenv</span><span class=p>(</span><span class=s>&#34;VERSION&#34;</span><span class=p>))</span>

	<span class=c1>// æ—¥å¿—è®°å½•å®¢æˆ·ç«¯ip, httpè¿”å›ç , è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º
</span><span class=c1></span>	<span class=nx>ip</span> <span class=o>:=</span> <span class=nx>exnet</span><span class=p>.</span><span class=nf>ClientPublicIP</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span>
	<span class=k>if</span> <span class=nx>ip</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
		<span class=nx>ip</span> <span class=p>=</span> <span class=nx>exnet</span><span class=p>.</span><span class=nf>ClientIP</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span>
	<span class=p>}</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;å®¢æˆ·ç«¯ip:%s, httpè¿”å›ç :%d\n&#34;</span><span class=p>,</span> <span class=nx>ip</span><span class=p>,</span> <span class=mi>200</span><span class=p>)</span>

	<span class=c1>// å“åº”healthcheckä¿¡æ¯, çŠ¶æ€ç ä¸º200
</span><span class=c1></span>	<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
		<span class=s>&#34;message&#34;</span><span class=p>:</span> <span class=s>&#34;pong&#34;</span><span class=p>,</span>
	<span class=p>})</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>Dockerfile1ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=k>FROM</span><span class=s> golang:alpine</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>ENV</span> <span class=nv>GO111MODULE</span><span class=o>=</span>on <span class=se>\
</span><span class=se></span>    <span class=nv>CGO_ENABLED</span><span class=o>=</span><span class=m>0</span> <span class=se>\
</span><span class=se></span>    <span class=nv>GOOS</span><span class=o>=</span>linux <span class=se>\
</span><span class=se></span>    <span class=nv>GOARCH</span><span class=o>=</span>amd64 <span class=se>\
</span><span class=se></span>	<span class=nv>GOPROXY</span><span class=o>=</span><span class=s2>&#34;https://goproxy.cn,direct&#34;</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>WORKDIR</span><span class=s> /root/ccx</span><span class=err>
</span><span class=err></span><span class=k>COPY</span> main.go .<span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>RUN</span> go mod init example.com/httpserver<span class=err>
</span><span class=err></span><span class=k>RUN</span> go mod tidy<span class=err>
</span><span class=err></span><span class=k>RUN</span> go build -o httpserver .<span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>WORKDIR</span><span class=s> /opt/modules/httpserver</span><span class=err>
</span><span class=err></span><span class=k>RUN</span> mkdir src .<span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>RUN</span> cp /root/ccx/httpserver ./src<span class=err>
</span><span class=err></span><span class=k>EXPOSE</span><span class=s> 8080</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;/opt/modules/httpserver/src/httpserver&#34;</span><span class=p>]</span><span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>æµ‹è¯•è¿è¡Œï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>docker build -t ccx/httpserver:v0.0.1 .
docker run -d --name httpserver -p 9090:8080 -e <span class=nv>VERSION</span><span class=o>=</span>v0.0.1 ccx/httpserver:v0.0.1
docker logs -f httpserver

curl -v localhost:9090/healthz -H <span class=s2>&#34;ttt:yyy&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>æ„å»ºä¼˜åŒ–ï¼šDockerfile2ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=c># ç¼–è¯‘é˜¶æ®µ</span><span class=err>
</span><span class=err></span><span class=k>FROM</span><span class=s> golang:1.17-alpine AS build</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=c># GO111MODULE=on: å¼ºåˆ¶å¼€å¯gomod</span><span class=err>
</span><span class=err></span><span class=c># GOPROXY=&#34;https://goproxy.cn,direct&#34;: ä½¿ç”¨å›½å†…ä¸ƒç‰›äº‘åŒ…ä»£ç†</span><span class=err>
</span><span class=err></span><span class=c># CGO_ENABLED=0: å…³é—­cgoï¼Œå¦åˆ™åœ¨alpineä¸å¯è¿è¡Œã€‚</span><span class=err>
</span><span class=err></span><span class=k>ENV</span> <span class=nv>GO111MODULE</span><span class=o>=</span>on <span class=se>\
</span><span class=se></span>    <span class=nv>CGO_ENABLED</span><span class=o>=</span><span class=m>0</span> <span class=se>\
</span><span class=se></span>    <span class=nv>GOOS</span><span class=o>=</span>linux <span class=se>\
</span><span class=se></span>    <span class=nv>GOARCH</span><span class=o>=</span>amd64 <span class=se>\
</span><span class=se></span>	<span class=nv>GOPROXY</span><span class=o>=</span><span class=s2>&#34;https://goproxy.cn,direct&#34;</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=c># æ‹·è´æºç </span><span class=err>
</span><span class=err></span><span class=k>WORKDIR</span><span class=s> /go/src/</span><span class=err>
</span><span class=err></span><span class=k>COPY</span> main.go .<span class=err>
</span><span class=err>
</span><span class=err></span><span class=c># é¢„ä¸‹è½½ä¾èµ– modules åˆ°å®¹å™¨æœ¬åœ° cache</span><span class=err>
</span><span class=err></span><span class=k>RUN</span> go mod init example.com/httpserver<span class=err>
</span><span class=err></span><span class=k>RUN</span> go mod tidy<span class=err>
</span><span class=err>
</span><span class=err></span><span class=c># ç¼–è¯‘goç¨‹åº</span><span class=err>
</span><span class=err></span><span class=k>RUN</span> go build -o /tmp/httpserver<span class=err>
</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=c># è¿è¡Œé˜¶æ®µ</span><span class=err>
</span><span class=err></span><span class=k>FROM</span><span class=s> scratch</span><span class=err>
</span><span class=err></span><span class=c># æ‹·è´ç¼–è¯‘é˜¶æ®µç¼–è¯‘å¥½çš„ç¨‹åºåŒ…</span><span class=err>
</span><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>build /tmp/httpserver /bin/httpserver<span class=err>
</span><span class=err></span><span class=c># å¼€æ”¾çš„ç«¯å£</span><span class=err>
</span><span class=err></span><span class=k>EXPOSE</span><span class=s> 8080</span><span class=err>
</span><span class=err></span><span class=c># å®¹å™¨å¯åŠ¨æ‰§è¡Œå‘½ä»¤ï¼Œå¯åŠ¨httpserveræœåŠ¡</span><span class=err>
</span><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;/bin/httpserver&#34;</span><span class=p>]</span><span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>æµ‹è¯•è¿è¡Œï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>docker build -t ccx/httpserver:v0.0.2 .
docker run -d --name httpserver -p 9090:8080 -e <span class=nv>VERSION</span><span class=o>=</span>v0.0.2 ccx/httpserver:v0.0.2
docker logs -f httpserver

curl -v localhost:9090/healthz -H <span class=s2>&#34;ttt:yyy&#34;</span>

<span class=c1># é•œåƒæ¯”è¾ƒ</span>
docker images<span class=p>|</span>grep httpserver
ccx/httpserver   v0.0.2        1fc9919e6afa   About a minute ago   9.93MB
ccx/httpserver   v0.0.1        22fc44df77a6   <span class=m>1</span> days ago          558MB
</code></pre></td></tr></table>
</div>
</div><p>åŸºç¡€é•œåƒå·®å¼‚: Dockerfile3ï¼š</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=c># ç¼–è¯‘é˜¶æ®µ</span><span class=err>
</span><span class=err></span><span class=k>FROM</span><span class=s> golang:1.17-alpine AS build</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=c># GO111MODULE=on: å¼ºåˆ¶å¼€å¯gomod</span><span class=err>
</span><span class=err></span><span class=c># GOPROXY=&#34;https://goproxy.cn,direct&#34;: ä½¿ç”¨å›½å†…ä¸ƒç‰›äº‘åŒ…ä»£ç†</span><span class=err>
</span><span class=err></span><span class=c># CGO_ENABLED=0: å…³é—­cgoï¼Œå¦åˆ™åœ¨alpineä¸å¯è¿è¡Œã€‚</span><span class=err>
</span><span class=err></span><span class=k>ENV</span> <span class=nv>GO111MODULE</span><span class=o>=</span>on <span class=se>\
</span><span class=se></span>    <span class=nv>CGO_ENABLED</span><span class=o>=</span><span class=m>0</span> <span class=se>\
</span><span class=se></span>    <span class=nv>GOOS</span><span class=o>=</span>linux <span class=se>\
</span><span class=se></span>    <span class=nv>GOARCH</span><span class=o>=</span>amd64 <span class=se>\
</span><span class=se></span>	<span class=nv>GOPROXY</span><span class=o>=</span><span class=s2>&#34;https://goproxy.cn,direct&#34;</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=c># æ‹·è´æºç </span><span class=err>
</span><span class=err></span><span class=k>WORKDIR</span><span class=s> /go/src/</span><span class=err>
</span><span class=err></span><span class=k>COPY</span> main.go .<span class=err>
</span><span class=err>
</span><span class=err></span><span class=c># é¢„ä¸‹è½½ä¾èµ– modules åˆ°å®¹å™¨æœ¬åœ° cache</span><span class=err>
</span><span class=err></span><span class=k>RUN</span> go mod init example.com/httpserver<span class=err>
</span><span class=err></span><span class=k>RUN</span> go mod tidy<span class=err>
</span><span class=err>
</span><span class=err></span><span class=c># ç¼–è¯‘goç¨‹åº</span><span class=err>
</span><span class=err></span><span class=k>RUN</span> go build -o /tmp/httpserver<span class=err>
</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=c># è¿è¡Œé˜¶æ®µ</span><span class=err>
</span><span class=err></span><span class=k>FROM</span><span class=s> alpine:latest</span><span class=err>
</span><span class=err></span><span class=c># æ‹·è´ç¼–è¯‘é˜¶æ®µç¼–è¯‘å¥½çš„ç¨‹åºåŒ…</span><span class=err>
</span><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>build /tmp/httpserver /bin/httpserver<span class=err>
</span><span class=err></span><span class=c># å¼€æ”¾çš„ç«¯å£</span><span class=err>
</span><span class=err></span><span class=k>EXPOSE</span><span class=s> 8080</span><span class=err>
</span><span class=err></span><span class=c># å®¹å™¨å¯åŠ¨æ‰§è¡Œå‘½ä»¤ï¼Œå¯åŠ¨httpserveræœåŠ¡</span><span class=err>
</span><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;/bin/httpserver&#34;</span><span class=p>]</span><span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>æµ‹è¯•</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>docker build -t ccx/httpserver:v0.0.3 .
docker run -d --name httpserver -p 9090:8080 -e <span class=nv>VERSION</span><span class=o>=</span>v0.0.3 ccx/httpserver:v0.0.3
docker logs -f httpserver

curl -v localhost:9090/healthz -H <span class=s2>&#34;ttt:yyy&#34;</span>

<span class=c1># é•œåƒæ¯”è¾ƒ</span>
docker images<span class=p>|</span>grep httpserver
ccx/httpserver   v0.0.3        e6ccaa261248   <span class=m>29</span> seconds ago   15.5MB
ccx/httpserver   v0.0.2        1fc9919e6afa   <span class=m>4</span> minutes ago    9.93MB
ccx/httpserver   v0.0.1        22fc44df77a6   <span class=m>1</span> days ago      558MB
</code></pre></td></tr></table>
</div>
</div><h2 id=é—®é¢˜åŒæ ·çš„ä¸€ä»½ä»£ç åœ¨ä¸åŒç¯å¢ƒä¸­å¯ä»¥æ‰“å‡ºå®Œå…¨ä¸€æ ·çš„åˆ¶å“å—>é—®é¢˜ï¼šåŒæ ·çš„ä¸€ä»½ä»£ç ï¼Œåœ¨ä¸åŒç¯å¢ƒä¸­å¯ä»¥æ‰“å‡ºå®Œå…¨ä¸€æ ·çš„åˆ¶å“å—ï¼Ÿ</h2>
<blockquote>
<p><strong>å¯ä¿¡è¦æ±‚</strong></p>
</blockquote>
<p>å¯èƒ½å¯¼è‡´å·®å¼‚çš„å‡ ç‚¹å› ç´ ï¼š</p>
<ol>
<li>åŸºç¡€é•œåƒç‰ˆæœ¬
<ol>
<li>åŸå› ï¼šåŸºç¡€é•œåƒè™½ç„¶æŒ‡å®šäº†ç‰ˆæœ¬ï¼Œä½†ä¸åŒé•œåƒä»“åº“ä¸‹åŒä¸€ç‰ˆæœ¬çš„é•œåƒä¸èƒ½ä¿è¯ä¸€è‡´ã€‚</li>
<li>åº”å¯¹æªæ–½ï¼šå°†å¸¸ç”¨çš„åŸºç¡€é•œåƒå’Œä¾èµ–åŒ…ï¼ˆæ„å»ºé•œåƒè¿‡ç¨‹ä¸­çš„ä¾èµ–åŒ…ï¼‰å­˜å‚¨åœ¨ç§æœ‰é•œåƒä»“åº“ä¸­ã€‚</li>
</ol>
</li>
<li>ä¾èµ–åŒ…çš„ç‰ˆæœ¬
<ol>
<li>åŸå› ï¼š<code>go mod tidy</code> ä¼šæ‹‰å–ä¾èµ–åŒ…çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¦‚æœæŸäº›åŒ…æœ‰æ–°çš„å‘å¸ƒï¼Œæ„å»ºå‡ºçš„é•œåƒä¹Ÿä¼šæœ‰æ‰€ä¸åŒã€‚</li>
<li>åº”å¯¹æªæ–½ï¼šé€šè¿‡ <code>go.mod</code> æ–‡ä»¶æ¥é”å®šå…·ä½“ç‰ˆæœ¬ï¼Œç»“åˆ <code>go.sum</code> ç¡®ä¿ä¾èµ–çš„ä¸€è‡´æ€§ã€‚</li>
</ol>
</li>
<li>ç¼“å­˜
<ol>
<li>åŸå› ï¼šDocker ä½¿ç”¨æ„å»ºç¼“å­˜æ¥åŠ é€Ÿæ„å»ºè¿‡ç¨‹ã€‚å¦‚æœç¼“å­˜ä¸åŒï¼Œæ„å»ºç»“æœä¹Ÿå¯èƒ½æœ‰æ‰€ä¸åŒã€‚</li>
<li>åº”å¯¹æªæ–½ï¼šé€šè¿‡ &ndash;no-cache é€‰é¡¹æ¥ç¦ç”¨ç¼“å­˜ï¼Œç¡®ä¿æ¯æ¬¡æ„å»ºéƒ½æ˜¯å…¨æ–°çš„ã€‚</li>
</ol>
</li>
</ol>
<h2 id=namespace>Namespace</h2>
<h3 id=æ¥å£æµ‹è¯•>æ¥å£æµ‹è¯•</h3>
<h4 id=è¿›å…¥å®¹å™¨æµ‹è¯•>è¿›å…¥å®¹å™¨æµ‹è¯•</h4>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>docker exec -it httpserver sh

/opt/modules/httpserver # curl -v localhost:8080/healthz -H &#34;ttt:yyy&#34;
sh: curl: not found
</code></pre></td></tr></table>
</div>
</div><h4 id=å®¿ä¸»æœºæµ‹è¯•>å®¿ä¸»æœºæµ‹è¯•</h4>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>curl -v localhost:9090/healthz -H &#34;ttt:yyy&#34;
*   Trying 127.0.0.1:9090...
* TCP_NODELAY set
* Connected to localhost (127.0.0.1) port 9090 (#0)
&gt; GET /healthz HTTP/1.1
&gt; Host: localhost:9090
&gt; User-Agent: curl/7.68.0
&gt; Accept: */*
&gt; ttt:yyy
&gt; 
* Mark bundle as not supporting multiuse
&lt; HTTP/1.1 200 OK
&lt; Accept: */*
&lt; Content-Type: application/json; charset=utf-8
&lt; Ttt: yyy
&lt; User-Agent: curl/7.68.0
&lt; Version: v0.0.1
&lt; Date: Thu, 06 Oct 2022 10:07:17 GMT
&lt; Content-Length: 18
&lt; 
* Connection #0 to host localhost left intact
{&#34;message&#34;:&#34;pong&#34;}% 
</code></pre></td></tr></table>
</div>
</div><h3 id=æŸ¥çœ‹å®¹å™¨ä¿¡æ¯>æŸ¥çœ‹å®¹å™¨ä¿¡æ¯</h3>
<p>è·å–<code>Pid</code></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>docker ps | grep httpserver

docker inspect httpserver|grep -i pid
            &#34;Pid&#34;: 36309,
            &#34;PidMode&#34;: &#34;&#34;,
            &#34;PidsLimit&#34;: null,
</code></pre></td></tr></table>
</div>
</div><h3 id=æŸ¥çœ‹å®¹å™¨-ip>æŸ¥çœ‹å®¹å™¨ ip</h3>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>docker exec -it httpserver sh

/opt/modules/httpserver # ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
23: eth0@if24: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue state UP 
    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0
       valid_lft forever preferred_lft forever
</code></pre></td></tr></table>
</div>
</div><h3 id=ä»å®¿ä¸»æœºé€šè¿‡-namespace-è®¿é—®å®¹å™¨çš„ç½‘ç»œ>ä»å®¿ä¸»æœºé€šè¿‡ namespace è®¿é—®å®¹å™¨çš„ç½‘ç»œ</h3>
<p>æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„ namespaceï¼š<code>lsns â€“t &lt;type></code></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>lsns -t net
        NS TYPE NPROCS   PID USER    NETNSID NSFS COMMAND
4026531992 net     124  9158 cjx  unassigned      /lib/systemd/systemd --user
4026533051 net       2 19842 cjx  unassigned      /usr/share/code/code --type=zygo
4026533633 net      25  9679 cjx  unassigned      /opt/google/chrome/chrome --type
4026533725 net       1  9680 cjx  unassigned      /opt/google/chrome/nacl_helper
</code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹æŸè¿›ç¨‹çš„ namespaceï¼š<code>ls -la /proc/&lt;pid>/ns/</code></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo ls -la /proc/36309/ns/
æ€»ç”¨é‡ 0
dr-x--x--x 2 root root 0 10æœˆ  6 17:55 .
dr-xr-xr-x 9 root root 0 10æœˆ  6 17:55 ..
lrwxrwxrwx 1 root root 0 10æœˆ  6 18:03 cgroup -&gt; &#39;cgroup:[4026531835]&#39;
lrwxrwxrwx 1 root root 0 10æœˆ  6 17:56 ipc -&gt; &#39;ipc:[4026533336]&#39;
lrwxrwxrwx 1 root root 0 10æœˆ  6 17:56 mnt -&gt; &#39;mnt:[4026533334]&#39;
lrwxrwxrwx 1 root root 0 10æœˆ  6 17:55 net -&gt; &#39;net:[4026533339]&#39;
lrwxrwxrwx 1 root root 0 10æœˆ  6 17:56 pid -&gt; &#39;pid:[4026533337]&#39;
lrwxrwxrwx 1 root root 0 10æœˆ  6 18:03 pid_for_children -&gt; &#39;pid:[4026533337]&#39;
lrwxrwxrwx 1 root root 0 10æœˆ  6 18:03 user -&gt; &#39;user:[4026531837]&#39;
lrwxrwxrwx 1 root root 0 10æœˆ  6 17:56 uts -&gt; &#39;uts:[4026533335]&#39;
</code></pre></td></tr></table>
</div>
</div><p>è¿›å…¥æŸ namespace è¿è¡Œå‘½ä»¤ï¼š<code>nsenter -t &lt;pid> -n ip addr</code></p>
<ul>
<li>-n: æŒ‡å®šç½‘ç»œ ns</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo nsenter -t 36309 -n ip a 
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
23: eth0@if24: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default 
    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0
       valid_lft forever preferred_lft forever
</code></pre></td></tr></table>
</div>
</div><h3 id=æµ‹è¯•æ¥å£å®¹å™¨å†…æ²¡æœ‰å®‰è£…-curlåªèƒ½é€šè¿‡è¿™ä¸ªæ–¹æ³•æµ‹è¯•å¦åˆ™éœ€è¦æŠŠæ¥å£ç«¯å£å¼€æ”¾å‡ºæ¥>æµ‹è¯•æ¥å£(å®¹å™¨å†…æ²¡æœ‰å®‰è£… curlï¼Œåªèƒ½é€šè¿‡è¿™ä¸ªæ–¹æ³•æµ‹è¯•ï¼Œå¦åˆ™éœ€è¦æŠŠæ¥å£ç«¯å£å¼€æ”¾å‡ºæ¥)</h3>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo nsenter -t 36309 -n curl -v localhost:8080/healthz -H &#34;ttt:yyy&#34;      
*   Trying 127.0.0.1:8080...
* TCP_NODELAY set
* Connected to localhost (127.0.0.1) port 8080 (#0)
&gt; GET /healthz HTTP/1.1
&gt; Host: localhost:8080
&gt; User-Agent: curl/7.68.0
&gt; Accept: */*
&gt; ttt:yyy
&gt; 
* Mark bundle as not supporting multiuse
&lt; HTTP/1.1 200 OK
&lt; Accept: */*
&lt; Content-Type: application/json; charset=utf-8
&lt; Ttt: yyy
&lt; User-Agent: curl/7.68.0
&lt; Version: v0.0.1
&lt; Date: Thu, 06 Oct 2022 10:05:41 GMT
&lt; Content-Length: 18
&lt; 
* Connection #0 to host localhost left intact
{&#34;message&#34;:&#34;pong&#34;}%                             
</code></pre></td></tr></table>
</div>
</div><h3 id=å°†æ–°è¿›ç¨‹æ”¾å…¥ç‹¬ç«‹çš„ç½‘ç»œ>å°†æ–°è¿›ç¨‹æ”¾å…¥ç‹¬ç«‹çš„ç½‘ç»œ</h3>
<p>åœ¨æ–° network namespace æ‰§è¡Œ sleep æŒ‡ä»¤ï¼š<code>sudo unshare -fn sleep 60</code></p>
<ul>
<li>-fn: æ”¾å…¥ç‹¬ç«‹çš„ç½‘ç»œ ns</li>
</ul>
<p>æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯<code>sudo ps -ef|grep 'sleep 60'</code></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>sudo ps -ef<span class=p>|</span>grep <span class=s1>&#39;sleep 60&#39;</span>

root       <span class=m>13747</span>   <span class=m>12656</span>  <span class=m>0</span> 12:31 pts/0    00:00:00 sudo unshare -fn sleep <span class=m>60</span>
root       <span class=m>13748</span>   <span class=m>13747</span>  <span class=m>0</span> 12:31 pts/0    00:00:00 unshare -fn sleep <span class=m>60</span>
root       <span class=m>13749</span>   <span class=m>13748</span>  <span class=m>0</span> 12:31 pts/0    00:00:00 sleep <span class=m>60</span>
cjx        <span class=m>13766</span>   <span class=m>13489</span>  <span class=m>0</span> 12:31 pts/1    00:00:00 grep --color<span class=o>=</span>auto sleep <span class=m>60</span>
</code></pre></td></tr></table>
</div>
</div><p>è¿›å…¥æ”¹è¿›ç¨‹æ‰€åœ¨ Namespace æŸ¥çœ‹ç½‘ç»œé…ç½®ï¼Œä¸ä¸»æœºä¸ä¸€è‡´<code>sudo nsenter -t 13489 -n ip a</code></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>sudo nsenter -t <span class=m>13489</span> -n ip a
1: lo: &lt;LOOPBACK&gt; mtu <span class=m>65536</span> qdisc noop state DOWN group default qlen <span class=m>1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹ç½‘ç»œ Namespace<code>lsns -t net</code></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>lsns -t net
        NS TYPE NPROCS   PID USER    NETNSID NSFS COMMAND
<span class=m>4026531840</span> net      <span class=m>66</span>  <span class=m>8880</span> cjx  unassigned      /lib/systemd/systemd --user

sudo lsns -t net
        NS TYPE NPROCS   PID USER     NETNSID NSFS                           COMMAND
<span class=m>4026531840</span> net     <span class=m>327</span>     <span class=m>1</span> root  unassigned                                /sbin/init auto noprompt
<span class=m>4026532649</span> net       <span class=m>1</span>  <span class=m>1288</span> rtkit unassigned                                /usr/libexec/rtkit-daemon
<span class=m>4026532716</span> net       <span class=m>5</span> <span class=m>13036</span> root           <span class=m>0</span> /run/docker/netns/d07ea2c2f615 nginx: master process nginx -g daemon off<span class=p>;</span>
<span class=m>4026532800</span> net       <span class=m>2</span> <span class=m>13748</span> root  unassigned                                unshare -fn sleep <span class=m>60</span>

sudo ls -la /proc/13748/ns/
total <span class=m>0</span>
dr-x--x--x <span class=m>2</span> root root <span class=m>0</span> Jul <span class=m>18</span> 12:31 .
dr-xr-xr-x <span class=m>9</span> root root <span class=m>0</span> Jul <span class=m>18</span> 12:31 ..
lrwxrwxrwx <span class=m>1</span> root root <span class=m>0</span> Jul <span class=m>18</span> 12:31 cgroup -&gt; <span class=s1>&#39;cgroup:[4026531835]&#39;</span>
lrwxrwxrwx <span class=m>1</span> root root <span class=m>0</span> Jul <span class=m>18</span> 12:31 ipc -&gt; <span class=s1>&#39;ipc:[4026531839]&#39;</span>
lrwxrwxrwx <span class=m>1</span> root root <span class=m>0</span> Jul <span class=m>18</span> 12:31 mnt -&gt; <span class=s1>&#39;mnt:[4026531841]&#39;</span>
lrwxrwxrwx <span class=m>1</span> root root <span class=m>0</span> Jul <span class=m>18</span> 12:31 net -&gt; <span class=s1>&#39;net:[4026532800]&#39;</span>
lrwxrwxrwx <span class=m>1</span> root root <span class=m>0</span> Jul <span class=m>18</span> 12:31 pid -&gt; <span class=s1>&#39;pid:[4026531836]&#39;</span>
lrwxrwxrwx <span class=m>1</span> root root <span class=m>0</span> Jul <span class=m>18</span> 12:31 pid_for_children -&gt; <span class=s1>&#39;pid:[4026531836]&#39;</span>
lrwxrwxrwx <span class=m>1</span> root root <span class=m>0</span> Jul <span class=m>18</span> 12:31 <span class=nb>time</span> -&gt; <span class=s1>&#39;time:[4026531834]&#39;</span>
lrwxrwxrwx <span class=m>1</span> root root <span class=m>0</span> Jul <span class=m>18</span> 12:31 time_for_children -&gt; <span class=s1>&#39;time:[4026531834]&#39;</span>
lrwxrwxrwx <span class=m>1</span> root root <span class=m>0</span> Jul <span class=m>18</span> 12:31 user -&gt; <span class=s1>&#39;user:[4026531837]&#39;</span>
lrwxrwxrwx <span class=m>1</span> root root <span class=m>0</span> Jul <span class=m>18</span> 12:31 uts -&gt; <span class=s1>&#39;uts:[4026531838]&#39;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=cgroup-cpu>cgroup cpu</h2>
<p>ä»£ç ï¼šmain.go</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=kn>package</span> <span class=nx>main</span>

<span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
	<span class=k>go</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
		<span class=k>for</span> <span class=p>{</span>

		<span class=p>}</span>
	<span class=p>}()</span>

	<span class=k>for</span> <span class=p>{</span>

	<span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>åœ¨ cgroup cpu å­ç³»ç»Ÿç›®å½•ä¸­åˆ›å»ºç›®å½•ç»“æ„</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=nb>cd</span> /sys/fs/cgroup/cpu
sudo mkdir cpudemo
<span class=nb>cd</span> cpudemo

âœ  cpudemo ll
æ€»ç”¨é‡ <span class=m>0</span>
drwxr-xr-x <span class=m>2</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 20:37 .
dr-xr-xr-x <span class=m>7</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 07:21 ..
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 20:37 cgroup.clone_children
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 20:37 cgroup.procs
-r--r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 20:37 cpuacct.stat
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 20:37 cpuacct.usage
-r--r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 20:37 cpuacct.usage_all
-r--r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 20:37 cpuacct.usage_percpu
-r--r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 20:37 cpuacct.usage_percpu_sys
-r--r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 20:37 cpuacct.usage_percpu_user
-r--r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 20:37 cpuacct.usage_sys
-r--r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 20:37 cpuacct.usage_user
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 20:37 cpu.cfs_period_us
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 20:37 cpu.cfs_quota_us
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 20:37 cpu.shares
-r--r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 20:37 cpu.stat
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 20:37 cpu.uclamp.max
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 20:37 cpu.uclamp.min
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 20:37 notify_on_release
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 20:37 tasks

âœ  cpudemo cat cpu.shares                 
<span class=m>1024</span>

é™åˆ¶ä½¿ç”¨å¤šå°‘ CPU æ—¶é—´ç‰‡ï¼Œ-1 è¡¨ç¤ºä¸é™åˆ¶
âœ  cpudemo cat cpu.cfs_quota_us          
-1

ä¸€ä¸ª CPU æ—¶é—´ç‰‡æ•°
âœ  cpudemo cat cpu.cfs_period_us                
<span class=m>100000</span>

ç›‘æ§çš„è¿›ç¨‹ IDï¼Œæ–°å»ºå‡ºæ¥çš„ä¸ºç©º
âœ  cpudemo cat cgroup.procs
</code></pre></td></tr></table>
</div>
</div><p><code>cpu.shares</code>ã€<code>cpu.cfs_quota_us</code>ã€<code>cpu.cfs_period_us</code>å…³ç³»ï¼š</p>
<p>cpu.cfs_quota_us ä¸ cpu.cfs_period_us ä¸€èµ·ä½¿ç”¨ï¼Œç”¨äºé™åˆ¶ cgroup ä¸­æ‰€æœ‰è¿›ç¨‹åœ¨ä¸€å®šæ—¶é—´å‘¨æœŸå†…å¯ä»¥ä½¿ç”¨çš„ CPU æ—¶é—´æ€»é‡ã€‚è¿™ä¸ªå‚æ•°æä¾›äº†ä¸€ç§ç¡¬æ€§é™åˆ¶ï¼Œç¡®ä¿ cgroup ä¸­çš„è¿›ç¨‹ä¸ä¼šè¶…è¿‡æŒ‡å®šçš„ CPU ä½¿ç”¨é‡ã€‚</p>
<p>cpu.shares æ˜¯ä¸€ä¸ªç›¸å¯¹æƒé‡å‚æ•°ï¼Œå®ƒå†³å®šäº†åœ¨å¤šä¸ª cgroup ä¹‹é—´ç«äº‰ CPU èµ„æºæ—¶ï¼Œæ¯ä¸ª cgroup èƒ½å¤Ÿè·å¾—çš„ CPU æ—¶é—´çš„ç›¸å¯¹æ¯”ä¾‹ã€‚è¿™ä¸ªå‚æ•°å¹¶ä¸æä¾›ç¡¬æ€§é™åˆ¶ï¼Œè€Œæ˜¯åœ¨èµ„æºç«äº‰æ—¶å½±å“ CPU æ—¶é—´çš„åˆ†é…æ¯”ä¾‹ã€‚</p>
<p>å½“ cpu.cfs_quota_us å’Œ cpu.shares åŒæ—¶è®¾ç½®æ—¶ï¼Œå®ƒä»¬ä¼šæŒ‰ç…§ä»¥ä¸‹æ–¹å¼å…±åŒä½œç”¨ï¼š</p>
<p>èµ„æºç«äº‰æ—¶çš„ä¼˜å…ˆçº§ï¼šå¦‚æœç³»ç»Ÿä¸Šçš„ CPU èµ„æºå……è¶³ï¼Œä¸åœ¨ç«äº‰çŠ¶æ€ï¼Œé‚£ä¹ˆæ‰€æœ‰ cgroup éƒ½å¯ä»¥ä½¿ç”¨æ›´å¤šçš„ CPU æ—¶é—´ï¼Œä¸ä¼šå—åˆ° cpu.shares è®¾ç½®çš„é™åˆ¶ã€‚ä½†æ˜¯ï¼Œå¦‚æœ CPU èµ„æºç´§å¼ ï¼Œå¤šä¸ª cgroup ä¹‹é—´å¼€å§‹ç«äº‰ CPU æ—¶é—´ï¼Œcpu.shares çš„å€¼å°†å†³å®šå®ƒä»¬è·å– CPU æ—¶é—´çš„ç›¸å¯¹æƒé‡ã€‚</p>
<h3 id=è¿è¡Œ-busyloop>è¿è¡Œ busyloop</h3>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>âœ  busyloop git:<span class=o>(</span>main<span class=o>)</span> âœ— go build -o busyloop main.go
âœ  busyloop git:<span class=o>(</span>main<span class=o>)</span> âœ— ll 
æ€»ç”¨é‡ 1.2M
-rwxrwxr-x <span class=m>1</span> cjx cjx 1.2M 10æœˆ  <span class=m>7</span> 20:42 busyloop
-rw-rw-r-- <span class=m>1</span> cjx cjx   <span class=m>73</span> 10æœˆ  <span class=m>7</span> 20:34 main.go
âœ  busyloop git:<span class=o>(</span>main<span class=o>)</span> âœ— ./busyloop
</code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œ top æŸ¥çœ‹ CPU ä½¿ç”¨æƒ…å†µï¼ŒCPU å ç”¨ 200%</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>top - 20:43:20 up 13:21,  <span class=m>1</span> user,  load average: 1.62, 0.87, 0.91
ä»»åŠ¡: <span class=m>531</span> total,   <span class=m>3</span> running, <span class=m>527</span> sleeping,   <span class=m>0</span> stopped,   <span class=m>1</span> zombie
%Cpu<span class=o>(</span>s<span class=o>)</span>: 11.1 us,  0.3 sy,  0.0 ni, 87.2 id,  0.0 wa,  0.0 hi,  1.4 si,  0.0 st
MiB Mem : 128749.5 total, 117783.0 free,   5873.8 used,   5092.6 buff/cache
MiB Swap:      0.0 total,      0.0 free,      0.0 used. 121378.7 avail Mem 

 è¿›ç¨‹å· USER      PR  NI    VIRT    RES    SHR    %CPU  %MEM     TIME+ COMMAND      
  <span class=m>52435</span> cjx       <span class=m>20</span>   <span class=m>0</span>  <span class=m>702364</span>   <span class=m>1160</span>    <span class=m>648</span> R 200.0   0.0   0:44.07 busyloop  
......
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=c1># é€šè¿‡ cgroup é™åˆ¶ cpu</span>
<span class=nb>cd</span> /sys/fs/cgroup/cpu/cpudemo

<span class=c1># æŠŠè¿›ç¨‹æ·»åŠ åˆ° cgroup è¿›ç¨‹é…ç½®ç»„</span>
<span class=c1># echo ps -ef|grep busyloop|grep -v grep|awk &#39;{print $2}&#39; &gt; cgroup.procs</span>
âœ  cpudemo ps -ef<span class=p>|</span>grep busyloop<span class=p>|</span>grep -v grep<span class=p>|</span>awk <span class=s1>&#39;{print $2}&#39;</span> 
<span class=m>52435</span>
âœ  cpudemo cat cgroup.procs
<span class=m>52435</span>

<span class=c1># è®¾ç½® cpuquota</span>
<span class=nb>echo</span> <span class=m>10000</span> &gt; cpu.cfs_quota_us
cat cpu.cfs_quota_us
</code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œ top æŸ¥çœ‹ CPU ä½¿ç”¨æƒ…å†µï¼ŒCPU å ç”¨å˜ä¸º10%(cpu.cfs_quota_us/cpu.cfs_period_us -> 10000/100000)</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>top - 20:49:11 up 13:27,  <span class=m>1</span> user,  load average: 1.28, 1.58, 1.26
ä»»åŠ¡: <span class=m>531</span> total,   <span class=m>3</span> running, <span class=m>527</span> sleeping,   <span class=m>0</span> stopped,   <span class=m>1</span> zombie
%Cpu<span class=o>(</span>s<span class=o>)</span>:  1.7 us,  0.5 sy,  0.0 ni, 97.7 id,  0.0 wa,  0.0 hi,  0.1 si,  0.0 st
MiB Mem : 128749.5 total, 117765.6 free,   5888.9 used,   5095.0 buff/cache
MiB Swap:      0.0 total,      0.0 free,      0.0 used. 121364.8 avail Mem 

 è¿›ç¨‹å· USER      PR  NI    VIRT    RES    SHR    %CPU  %MEM     TIME+ COMMAND      
   <span class=m>4507</span> cjx       <span class=m>20</span>   <span class=m>0</span> 1125.5g <span class=m>481848</span> <span class=m>208608</span> S  11.0   0.4  46:28.85 chrome       
  <span class=m>52435</span> cjx       <span class=m>20</span>   <span class=m>0</span>  <span class=m>702364</span>   <span class=m>1160</span>    <span class=m>648</span> R  10.3   0.0  11:28.43 busyloop
</code></pre></td></tr></table>
</div>
</div><h3 id=å–„ååˆ é™¤>å–„ååˆ é™¤</h3>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sudo apt install cgroup-tools
sudo cgdelete cpu:cpudemo
</code></pre></td></tr></table>
</div>
</div><h2 id=cgroup-memory>cgroup memory</h2>
<p>åœ¨ cgroup memory å­ç³»ç»Ÿç›®å½•ä¸­åˆ›å»ºç›®å½•ç»“æ„</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=nb>cd</span> /sys/fs/cgroup/memory
mkdir memorydemo
<span class=nb>cd</span> memorydemo

ls -la
æ€»ç”¨é‡ <span class=m>0</span>
drwxr-xr-x <span class=m>2</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:01 .
dr-xr-xr-x <span class=m>7</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 07:21 ..
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 cgroup.clone_children
--w--w--w- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 cgroup.event_control
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 cgroup.procs <span class=c1># ç®¡æ§çš„è¿›ç¨‹</span>
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 memory.failcnt
--w------- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 memory.force_empty
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 memory.kmem.failcnt
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 memory.kmem.limit_in_bytes
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 memory.kmem.max_usage_in_bytes
-r--r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 memory.kmem.slabinfo
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 memory.kmem.tcp.failcnt
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 memory.kmem.tcp.limit_in_bytes
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 memory.kmem.tcp.max_usage_in_bytes
-r--r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 memory.kmem.tcp.usage_in_bytes
-r--r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 memory.kmem.usage_in_bytes
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 memory.limit_in_bytes
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 memory.max_usage_in_bytes
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 memory.move_charge_at_immigrate
-r--r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 memory.numa_stat
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 memory.oom_control
---------- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 memory.pressure_level
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 memory.soft_limit_in_bytes
-r--r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 memory.stat
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 memory.swappiness
-r--r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 memory.usage_in_bytes
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 memory.use_hierarchy
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 notify_on_release
-rw-r--r-- <span class=m>1</span> root root <span class=m>0</span> 10æœˆ  <span class=m>7</span> 21:02 tasks
</code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡ cgroup é™åˆ¶ memory</p>
<p>æŠŠè¿›ç¨‹æ·»åŠ åˆ° cgroup è¿›ç¨‹é…ç½®ç»„</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=nb>echo</span> &lt;pid&gt; &gt; cgroup.procs
</code></pre></td></tr></table>
</div>
</div><p>è®¾ç½® memory.limit_in_bytes</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=nb>echo</span> <span class=m>104960000</span> &gt; memory.limit_in_bytes
</code></pre></td></tr></table>
</div>
</div><h2 id=overlayfs>OverlayFS</h2>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/blog/tags/kubernetes/>kubernetes</a>
<a href=/blog/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/>äº‘åŸç”Ÿ</a>
</section>
<section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
</footer>
</article>
<aside class=related-content--wrapper>
<h2 class=section-title>ç›¸å…³æ–‡ç« </h2>
<div class=related-content>
<div class="flex article-list--tile">
<article>
<a href=/blog/p/k8s-%E9%A9%B1%E9%80%90%E8%8A%82%E7%82%B9/>
<div class=article-details>
<h2 class=article-title>k8s é©±é€èŠ‚ç‚¹</h2>
</div>
</a>
</article>
<article>
<a href=/blog/p/k8s%E5%BC%BA%E5%88%B6%E5%88%A0%E9%99%A4podpvpvc%E5%92%8Cnsnamespace%E6%96%B9%E6%B3%95/>
<div class=article-details>
<h2 class=article-title>k8så¼ºåˆ¶åˆ é™¤pod&pv&pvcå’Œns&namespaceæ–¹æ³•</h2>
</div>
</a>
</article>
<article>
<a href=/blog/p/k8s%E7%9A%84namespace%E4%B8%80%E7%9B%B4terminating%E7%9A%84%E5%AE%8C%E7%BE%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/>
<div class=article-details>
<h2 class=article-title>k8sçš„namespaceä¸€ç›´Terminatingçš„å®Œç¾è§£å†³æ–¹æ¡ˆ</h2>
</div>
</a>
</article>
<article>
<a href=/blog/p/controller-manager/>
<div class=article-details>
<h2 class=article-title>Controller Manager</h2>
</div>
</a>
</article>
<article>
<a href=/blog/p/%E5%81%9C%E6%AD%A2deployment%E4%B8%8D%E5%88%A0%E9%99%A4/>
<div class=article-details>
<h2 class=article-title>åœæ­¢deploymentä¸åˆ é™¤</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<div class=disqus-container>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//hugo-theme-stack.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
<style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style>
<script>window.addEventListener('onColorSchemeChange',a=>{typeof DISQUS=='object'&&DISQUS.reset({reload:!0})})</script>
<footer class=site-footer>
<section class=copyright>
&copy;
2020 -
2025 æˆ‘çš„ç©ºé—´
</section>
<section class=powerby>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.13.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡
<br><a href=https://beian.miit.gov.cn/ target=_blank>ç²¤ICPå¤‡19123935å·</a>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous>
</main>
<aside class="sidebar right-sidebar sticky">
<section class="widget archives">
<div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
</div>
<h2 class="widget-title section-title">ç›®å½•</h2>
<div class=widget--toc>
<nav id=TableOfContents>
<ol>
<li><a href=#äº‘åŸç”Ÿ>äº‘åŸç”Ÿ</a></li>
<li><a href=#kubernetes>kubernetes</a>
<ol>
<li><a href=#å®¹å™¨æŠ€æœ¯>å®¹å™¨æŠ€æœ¯</a></li>
<li><a href=#å®¹å™¨æŠ€æœ¯è§£å†³äº†å“ªäº›é—®é¢˜>å®¹å™¨æŠ€æœ¯è§£å†³äº†å“ªäº›é—®é¢˜</a>
<ol>
<li><a href=#1-ç¯å¢ƒä¸€è‡´æ€§é—®é¢˜>1. ç¯å¢ƒä¸€è‡´æ€§é—®é¢˜</a></li>
<li><a href=#2-é…ç½®ç®¡ç†é—®é¢˜>2. é…ç½®ç®¡ç†é—®é¢˜</a></li>
<li><a href=#3-å…¼å®¹æ€§å’Œä¾èµ–é—®é¢˜>3. å…¼å®¹æ€§å’Œä¾èµ–é—®é¢˜</a></li>
<li><a href=#4-å¿«é€Ÿéƒ¨ç½²å’Œæ‰©å±•>4. å¿«é€Ÿéƒ¨ç½²å’Œæ‰©å±•</a></li>
<li><a href=#5-èµ„æºåˆ©ç”¨å’Œéš”ç¦»>5. èµ„æºåˆ©ç”¨å’Œéš”ç¦»</a></li>
<li><a href=#6-ç§»æ¤æ€§é—®é¢˜>6. ç§»æ¤æ€§é—®é¢˜</a></li>
<li><a href=#7-æŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜cicd>7. æŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜ï¼ˆCI/CDï¼‰</a></li>
<li><a href=#8-é™ä½å¼€å‘ä¸è¿ç»´devopsçš„éšœç¢>8. é™ä½å¼€å‘ä¸è¿ç»´ï¼ˆDevOpsï¼‰çš„éšœç¢</a></li>
</ol>
</li>
</ol>
</li>
<li><a href=#docker>docker</a>
<ol>
<li><a href=#å®‰è£…>å®‰è£…</a></li>
<li><a href=#æ“ä½œ>æ“ä½œ</a></li>
<li><a href=#demo>Demo</a></li>
</ol>
</li>
<li><a href=#é—®é¢˜åŒæ ·çš„ä¸€ä»½ä»£ç åœ¨ä¸åŒç¯å¢ƒä¸­å¯ä»¥æ‰“å‡ºå®Œå…¨ä¸€æ ·çš„åˆ¶å“å—>é—®é¢˜ï¼šåŒæ ·çš„ä¸€ä»½ä»£ç ï¼Œåœ¨ä¸åŒç¯å¢ƒä¸­å¯ä»¥æ‰“å‡ºå®Œå…¨ä¸€æ ·çš„åˆ¶å“å—ï¼Ÿ</a></li>
<li><a href=#namespace>Namespace</a>
<ol>
<li><a href=#æ¥å£æµ‹è¯•>æ¥å£æµ‹è¯•</a>
<ol>
<li><a href=#è¿›å…¥å®¹å™¨æµ‹è¯•>è¿›å…¥å®¹å™¨æµ‹è¯•</a></li>
<li><a href=#å®¿ä¸»æœºæµ‹è¯•>å®¿ä¸»æœºæµ‹è¯•</a></li>
</ol>
</li>
<li><a href=#æŸ¥çœ‹å®¹å™¨ä¿¡æ¯>æŸ¥çœ‹å®¹å™¨ä¿¡æ¯</a></li>
<li><a href=#æŸ¥çœ‹å®¹å™¨-ip>æŸ¥çœ‹å®¹å™¨ ip</a></li>
<li><a href=#ä»å®¿ä¸»æœºé€šè¿‡-namespace-è®¿é—®å®¹å™¨çš„ç½‘ç»œ>ä»å®¿ä¸»æœºé€šè¿‡ namespace è®¿é—®å®¹å™¨çš„ç½‘ç»œ</a></li>
<li><a href=#æµ‹è¯•æ¥å£å®¹å™¨å†…æ²¡æœ‰å®‰è£…-curlåªèƒ½é€šè¿‡è¿™ä¸ªæ–¹æ³•æµ‹è¯•å¦åˆ™éœ€è¦æŠŠæ¥å£ç«¯å£å¼€æ”¾å‡ºæ¥>æµ‹è¯•æ¥å£(å®¹å™¨å†…æ²¡æœ‰å®‰è£… curlï¼Œåªèƒ½é€šè¿‡è¿™ä¸ªæ–¹æ³•æµ‹è¯•ï¼Œå¦åˆ™éœ€è¦æŠŠæ¥å£ç«¯å£å¼€æ”¾å‡ºæ¥)</a></li>
<li><a href=#å°†æ–°è¿›ç¨‹æ”¾å…¥ç‹¬ç«‹çš„ç½‘ç»œ>å°†æ–°è¿›ç¨‹æ”¾å…¥ç‹¬ç«‹çš„ç½‘ç»œ</a></li>
</ol>
</li>
<li><a href=#cgroup-cpu>cgroup cpu</a>
<ol>
<li><a href=#è¿è¡Œ-busyloop>è¿è¡Œ busyloop</a></li>
<li><a href=#å–„ååˆ é™¤>å–„ååˆ é™¤</a></li>
</ol>
</li>
<li><a href=#cgroup-memory>cgroup memory</a></li>
<li><a href=#overlayfs>OverlayFS</a></li>
</ol>
</nav>
</div>
</section>
</aside>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/blog/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>