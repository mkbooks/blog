<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>K8S on 我的空间</title><link>https://mkbooks.github.io/blog/tags/k8s/</link><description>Recent content in K8S on 我的空间</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Wed, 17 Aug 2022 11:03:18 +0800</lastBuildDate><atom:link href="https://mkbooks.github.io/blog/tags/k8s/index.xml" rel="self" type="application/rss+xml"/><item><title>k8s强制删除pod&amp;pv&amp;pvc和ns&amp;namespace方法</title><link>https://mkbooks.github.io/blog/p/k8s%E5%BC%BA%E5%88%B6%E5%88%A0%E9%99%A4podpvpvc%E5%92%8Cnsnamespace%E6%96%B9%E6%B3%95/</link><pubDate>Wed, 17 Aug 2022 11:03:18 +0800</pubDate><guid>https://mkbooks.github.io/blog/p/k8s%E5%BC%BA%E5%88%B6%E5%88%A0%E9%99%A4podpvpvc%E5%92%8Cnsnamespace%E6%96%B9%E6%B3%95/</guid><description>&lt;p>转载: &lt;a class="link" href="https://www.cnblogs.com/fengdejiyixx/p/15186831.html" target="_blank" rel="noopener"
>https://www.cnblogs.com/fengdejiyixx/p/15186831.html&lt;/a>&lt;/p>
&lt;p>注意：以下操作方法十分危险，三思而行！！！&lt;/p>
&lt;p>如果名称空间、pod、pv、pvc全部处于“Terminating”状态时，此时的该名称空间下的所有控制器都已经被删除了，之所以出现pod、pvc、pv、ns无法删除，那是因为kubelet 阻塞，有其他的资源在使用该namespace，比如CRD等，尝试重启kubelet，再删除该namespace 也不好使。&lt;/p>
&lt;p>正确的删除方法：删除pod&amp;ndash;&amp;gt; 删除pvc &amp;mdash;&amp;gt; 删除pv &amp;ndash;&amp;gt; 删除名称空间&lt;/p>
&lt;h1 id="1-强制删除pod">1. 强制删除pod&lt;/h1>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">kubectl delete pod &amp;lt;your-pod-name&amp;gt; -n &amp;lt;name-space&amp;gt; --force --grace-period=0
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>解决方法：加参数 &amp;ndash;force &amp;ndash;grace-period=0，grace-period表示过渡存活期，默认30s，在删除POD之前允许POD慢慢终止其上的容器进程，从而优雅退出，0表示立即终止POD&lt;/p>
&lt;h1 id="2-强制删除pvpvc">2. 强制删除pv、pvc&lt;/h1>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">kubectl patch pv xxx -p &amp;#39;{&amp;#34;metadata&amp;#34;:{&amp;#34;finalizers&amp;#34;:null}}&amp;#39;
kubectl patch pvc xxx -p &amp;#39;{&amp;#34;metadata&amp;#34;:{&amp;#34;finalizers&amp;#34;:null}}&amp;#39;
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>直接删除 k8s etcd 数据库中的记录！&lt;/p>
&lt;h1 id="3-强制删除ns">3. 强制删除ns&lt;/h1>
&lt;p>在尝试以下命令强制删除也不好使：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">kubectl delete ns &amp;lt;terminating-namespace&amp;gt; --force --grace-period=0
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>解决方法：&lt;/p>
&lt;p>1）运行以下命令以查看处于“Terminating”状态的namespace：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">kubectl get namespaces
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>2）选择一个Terminating namespace，并查看namespace 中的 finalizer。运行以下命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">$ kubectl get namespace &amp;lt;terminating-namespace&amp;gt; -o yaml
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>输出信息如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">apiVersion: v1
kind: Namespace
metadata:
creationTimestamp: &amp;#34;2019-11-20T15:18:06Z&amp;#34;
deletionTimestamp: &amp;#34;2020-01-16T02:50:02Z&amp;#34;
name: &amp;lt;terminating-namespace&amp;gt;
resourceVersion: &amp;#34;3249493&amp;#34;
selfLink: /api/v1/namespaces/knative-eventing
uid: f300ea38-c8c2-4653-b432-b66103e412db
spec:
finalizers:
- kubernetes
status:
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>3）导出json格式到文件&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">kubectl get namespace &amp;lt;terminating-namespace&amp;gt; -o json &amp;gt;tmp.json
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>4）编辑tmp.josn，删除finalizers 字段的值&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">{
&amp;#34;apiVersion&amp;#34;: &amp;#34;v1&amp;#34;,
&amp;#34;kind&amp;#34;: &amp;#34;Namespace&amp;#34;,
&amp;#34;metadata&amp;#34;: {
&amp;#34;creationTimestamp&amp;#34;: &amp;#34;2019-11-20T15:18:06Z&amp;#34;,
&amp;#34;deletionTimestamp&amp;#34;: &amp;#34;2020-01-16T02:50:02Z&amp;#34;,
&amp;#34;name&amp;#34;: &amp;#34;&amp;lt;terminating-namespace&amp;gt;&amp;#34;,
&amp;#34;resourceVersion&amp;#34;: &amp;#34;3249493&amp;#34;,
&amp;#34;selfLink&amp;#34;: &amp;#34;/api/v1/namespaces/knative-eventing&amp;#34;,
&amp;#34;uid&amp;#34;: &amp;#34;f300ea38-c8c2-4653-b432-b66103e412db&amp;#34;
},
&amp;#34;spec&amp;#34;: { #从此行开始删除
&amp;#34;finalizers&amp;#34;: []
}, # 删到此行
&amp;#34;status&amp;#34;: {
&amp;#34;phase&amp;#34;: &amp;#34;Terminating&amp;#34;
}
}
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>5）开启proxy&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">kubectl proxy
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>执行该命令后，当前终端会被卡住
6）打开新的一个窗口，执行以下命令&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">curl -k -H &amp;#34;Content-Type: application/json&amp;#34; -X PUT --data-binary @tmp.json http://127.0.0.1:8001/api/v1/namespaces/&amp;lt;terminating-namespace&amp;gt;/finalize
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>输出信息如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">{
&amp;#34;kind&amp;#34;: &amp;#34;Namespace&amp;#34;,
&amp;#34;apiVersion&amp;#34;: &amp;#34;v1&amp;#34;,
&amp;#34;metadata&amp;#34;: {
&amp;#34;name&amp;#34;: &amp;#34;istio-system&amp;#34;,
&amp;#34;selfLink&amp;#34;: &amp;#34;/api/v1/namespaces/istio-system/finalize&amp;#34;,
&amp;#34;uid&amp;#34;: &amp;#34;2e274537-727f-4a8f-ae8c-397473ed619a&amp;#34;,
&amp;#34;resourceVersion&amp;#34;: &amp;#34;3249492&amp;#34;,
&amp;#34;creationTimestamp&amp;#34;: &amp;#34;2019-11-20T15:18:06Z&amp;#34;,
&amp;#34;deletionTimestamp&amp;#34;: &amp;#34;2020-01-16T02:50:02Z&amp;#34;
},
&amp;#34;spec&amp;#34;: {
},
&amp;#34;status&amp;#34;: {
&amp;#34;phase&amp;#34;: &amp;#34;Terminating&amp;#34;
}
}
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>7）确认处于Terminating 状态的namespace已经被删除&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">kubectl get namespaces
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果还有处于Terminating 状态的namespace，重复以上操作，删除即可！&lt;/p></description></item><item><title>k8s的namespace一直Terminating的完美解决方案</title><link>https://mkbooks.github.io/blog/p/k8s%E7%9A%84namespace%E4%B8%80%E7%9B%B4terminating%E7%9A%84%E5%AE%8C%E7%BE%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</link><pubDate>Wed, 17 Aug 2022 11:03:18 +0800</pubDate><guid>https://mkbooks.github.io/blog/p/k8s%E7%9A%84namespace%E4%B8%80%E7%9B%B4terminating%E7%9A%84%E5%AE%8C%E7%BE%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</guid><description>&lt;p>转载: &lt;a class="link" href="https://www.cnblogs.com/zisefeizhu/p/13786053.html" target="_blank" rel="noopener"
>https://www.cnblogs.com/zisefeizhu/p/13786053.html&lt;/a>&lt;/p>
&lt;p>在k8s集群中进行测试删除namespace是经常的事件，而为了方便操作，一般都是直接对整个名称空间进行删除操作。
相信道友们在进行此步操作的时候，会遇到要删除的namespace一直处于Terminating。下面我将给出一个完美的解决方案，&lt;/p>
&lt;p>测试demo&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">创建demo namespace
# kubectl create ns test
namespace/test created
删除demo namespace
# kubectl delete ns test
namespace &amp;#34;test&amp;#34; deleted
一直处于deleted不见exit
查看状态 可见test namespace 处于Terminating
# kubectl get ns -w
NAME STATUS AGE
test Terminating 18s
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>下面给出一种完美的解决方案：调用接口删除&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">开启一个代理终端
# kubectl proxy
Starting to serve on 127.0.0.1:8001
再开启一个操作终端
将test namespace的配置文件输出保存
# kubectl get ns test -o json &amp;gt; test.json
删除spec及status部分的内容还有metadata字段后的&amp;#34;,&amp;#34;号，切记！
剩下内容大致如下
{
&amp;#34;apiVersion&amp;#34;: &amp;#34;v1&amp;#34;,
&amp;#34;kind&amp;#34;: &amp;#34;Namespace&amp;#34;,
&amp;#34;metadata&amp;#34;: {
&amp;#34;annotations&amp;#34;: {
&amp;#34;cattle.io/status&amp;#34;: &amp;#34;{\&amp;#34;Conditions\&amp;#34;:[{\&amp;#34;Type\&amp;#34;:\&amp;#34;ResourceQuotaInit\&amp;#34;,\&amp;#34;Status\&amp;#34;:\&amp;#34;True\&amp;#34;,\&amp;#34;Message\&amp;#34;:\&amp;#34;\&amp;#34;,\&amp;#34;LastUpdateTime\&amp;#34;:\&amp;#34;2020-10-09T07:12:17Z\&amp;#34;},{\&amp;#34;Type\&amp;#34;:\&amp;#34;InitialRolesPopulated\&amp;#34;,\&amp;#34;Status\&amp;#34;:\&amp;#34;True\&amp;#34;,\&amp;#34;Message\&amp;#34;:\&amp;#34;\&amp;#34;,\&amp;#34;LastUpdateTime\&amp;#34;:\&amp;#34;2020-10-09T07:12:18Z\&amp;#34;}]}&amp;#34;,
&amp;#34;lifecycle.cattle.io/create.namespace-auth&amp;#34;: &amp;#34;true&amp;#34;
},
&amp;#34;creationTimestamp&amp;#34;: &amp;#34;2020-10-09T07:12:16Z&amp;#34;,
&amp;#34;deletionTimestamp&amp;#34;: &amp;#34;2020-10-09T07:12:22Z&amp;#34;,
&amp;#34;name&amp;#34;: &amp;#34;test&amp;#34;,
&amp;#34;resourceVersion&amp;#34;: &amp;#34;471648079&amp;#34;,
&amp;#34;selfLink&amp;#34;: &amp;#34;/api/v1/namespaces/test&amp;#34;,
&amp;#34;uid&amp;#34;: &amp;#34;862d311e-d87a-48c2-bc48-332a4db9dbdb&amp;#34;
}
}
调接口删除
# curl -k -H &amp;#34;Content-Type: application/json&amp;#34; -X PUT --data-binary @test.json http://127.0.0.1:8001/api/v1/namespaces/test/finalize
{
&amp;#34;kind&amp;#34;: &amp;#34;Namespace&amp;#34;,
&amp;#34;apiVersion&amp;#34;: &amp;#34;v1&amp;#34;,
&amp;#34;metadata&amp;#34;: {
&amp;#34;name&amp;#34;: &amp;#34;test&amp;#34;,
&amp;#34;selfLink&amp;#34;: &amp;#34;/api/v1/namespaces/test/finalize&amp;#34;,
&amp;#34;uid&amp;#34;: &amp;#34;862d311e-d87a-48c2-bc48-332a4db9dbdb&amp;#34;,
&amp;#34;resourceVersion&amp;#34;: &amp;#34;471648079&amp;#34;,
&amp;#34;creationTimestamp&amp;#34;: &amp;#34;2020-10-09T07:12:16Z&amp;#34;,
&amp;#34;deletionTimestamp&amp;#34;: &amp;#34;2020-10-09T07:12:22Z&amp;#34;,
&amp;#34;annotations&amp;#34;: {
&amp;#34;cattle.io/status&amp;#34;: &amp;#34;{\&amp;#34;Conditions\&amp;#34;:[{\&amp;#34;Type\&amp;#34;:\&amp;#34;ResourceQuotaInit\&amp;#34;,\&amp;#34;Status\&amp;#34;:\&amp;#34;True\&amp;#34;,\&amp;#34;Message\&amp;#34;:\&amp;#34;\&amp;#34;,\&amp;#34;LastUpdateTime\&amp;#34;:\&amp;#34;2020-10-09T07:12:17Z\&amp;#34;},{\&amp;#34;Type\&amp;#34;:\&amp;#34;InitialRolesPopulated\&amp;#34;,\&amp;#34;Status\&amp;#34;:\&amp;#34;True\&amp;#34;,\&amp;#34;Message\&amp;#34;:\&amp;#34;\&amp;#34;,\&amp;#34;LastUpdateTime\&amp;#34;:\&amp;#34;2020-10-09T07:12:18Z\&amp;#34;}]}&amp;#34;,
&amp;#34;lifecycle.cattle.io/create.namespace-auth&amp;#34;: &amp;#34;true&amp;#34;
}
},
&amp;#34;spec&amp;#34;: {
},
&amp;#34;status&amp;#34;: {
&amp;#34;phase&amp;#34;: &amp;#34;Terminating&amp;#34;,
&amp;#34;conditions&amp;#34;: [
{
&amp;#34;type&amp;#34;: &amp;#34;NamespaceDeletionDiscoveryFailure&amp;#34;,
&amp;#34;status&amp;#34;: &amp;#34;True&amp;#34;,
&amp;#34;lastTransitionTime&amp;#34;: &amp;#34;2020-10-09T07:12:27Z&amp;#34;,
&amp;#34;reason&amp;#34;: &amp;#34;DiscoveryFailed&amp;#34;,
&amp;#34;message&amp;#34;: &amp;#34;Discovery failed for some groups, 1 failing: unable to retrieve the complete list of server APIs: metrics.k8s.io/v1beta1: the server is currently unable to handle the request&amp;#34;
},
{
&amp;#34;type&amp;#34;: &amp;#34;NamespaceDeletionGroupVersionParsingFailure&amp;#34;,
&amp;#34;status&amp;#34;: &amp;#34;False&amp;#34;,
&amp;#34;lastTransitionTime&amp;#34;: &amp;#34;2020-10-09T07:12:28Z&amp;#34;,
&amp;#34;reason&amp;#34;: &amp;#34;ParsedGroupVersions&amp;#34;,
&amp;#34;message&amp;#34;: &amp;#34;All legacy kube types successfully parsed&amp;#34;
},
{
&amp;#34;type&amp;#34;: &amp;#34;NamespaceDeletionContentFailure&amp;#34;,
&amp;#34;status&amp;#34;: &amp;#34;False&amp;#34;,
&amp;#34;lastTransitionTime&amp;#34;: &amp;#34;2020-10-09T07:12:28Z&amp;#34;,
&amp;#34;reason&amp;#34;: &amp;#34;ContentDeleted&amp;#34;,
&amp;#34;message&amp;#34;: &amp;#34;All content successfully deleted&amp;#34;
}
]
}
}
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查看结果&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">1、delete 状态终止
kubectl delete ns test
namespace &amp;#34;test&amp;#34; deleted
2、Terminating状态终止
kubectl get ns -w
test Terminating 18s
test Terminating 17m
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>名称空间被删除掉&lt;/p></description></item></channel></rss>